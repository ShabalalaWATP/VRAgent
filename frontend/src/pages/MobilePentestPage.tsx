import React, { useState, useEffect } from "react";
import LearnPageLayout from "../components/LearnPageLayout";
import {
  Box,
  Button,
  Container,
  Typography,
  Paper,
  Chip,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Alert,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  IconButton,
  Tooltip,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Grid,
  Card,
  CardContent,
  alpha,
  Divider,
  LinearProgress,
  useTheme,
  useMediaQuery,
  Drawer,
  Fab,
} from "@mui/material";
import ArrowBackIcon from "@mui/icons-material/ArrowBack";
import ExpandMoreIcon from "@mui/icons-material/ExpandMore";
import ContentCopyIcon from "@mui/icons-material/ContentCopy";
import PhoneAndroidIcon from "@mui/icons-material/PhoneAndroid";
import AppleIcon from "@mui/icons-material/Apple";
import SecurityIcon from "@mui/icons-material/Security";
import StorageIcon from "@mui/icons-material/Storage";
import WifiIcon from "@mui/icons-material/Wifi";
import BuildIcon from "@mui/icons-material/Build";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import WarningIcon from "@mui/icons-material/Warning";
import BugReportIcon from "@mui/icons-material/BugReport";
import CodeIcon from "@mui/icons-material/Code";
import LockOpenIcon from "@mui/icons-material/LockOpen";
import FingerprintIcon from "@mui/icons-material/Fingerprint";
import DownloadIcon from "@mui/icons-material/Download";
import VisibilityIcon from "@mui/icons-material/Visibility";
import QuizIcon from "@mui/icons-material/Quiz";
import EmojiEventsIcon from "@mui/icons-material/EmojiEvents";
import RefreshIcon from "@mui/icons-material/Refresh";
import MenuIcon from "@mui/icons-material/Menu";
import KeyboardArrowUpIcon from "@mui/icons-material/KeyboardArrowUp";
import InfoIcon from "@mui/icons-material/Info";
import PlaylistAddCheckIcon from "@mui/icons-material/PlaylistAddCheck";
import { Link } from "react-router-dom";

// Theme colors for consistent styling
const themeColors = {
  primary: "#10b981",
  primaryLight: "#34d399",
  secondary: "#8b5cf6",
  accent: "#f59e0b",
  bgCard: "#111424",
  bgNested: "#0c0f1c",
  border: "rgba(16, 185, 129, 0.2)",
  textMuted: "#94a3b8",
};

// Section navigation items
const sectionNavItems = [
  { id: "intro", label: "Introduction", icon: <InfoIcon fontSize="small" /> },
  { id: "overview", label: "Overview", icon: <PhoneAndroidIcon fontSize="small" /> },
  { id: "tools", label: "Tools", icon: <BuildIcon fontSize="small" /> },
  { id: "data-storage", label: "Data Storage", icon: <StorageIcon fontSize="small" /> },
  { id: "network", label: "Network", icon: <WifiIcon fontSize="small" /> },
  { id: "frida", label: "Frida", icon: <SecurityIcon fontSize="small" /> },
  { id: "checklist", label: "Checklist", icon: <PlaylistAddCheckIcon fontSize="small" /> },
  { id: "quiz-section", label: "Knowledge Check", icon: <QuizIcon fontSize="small" /> },
];

// Quiz Question Interface
interface QuizQuestion {
  id: number;
  question: string;
  options: string[];
  correctAnswer: number;
  explanation: string;
  topic: string;
}

// Mobile Pentesting Quiz Question Bank (75 questions)
const questionBank: QuizQuestion[] = [
  // Section 1: Mobile Security Fundamentals (10 questions)
  { id: 1, question: "What is the primary purpose of mobile application penetration testing?", options: ["To break the app permanently", "To identify security vulnerabilities before attackers do", "To improve app performance", "To test user interface"], correctAnswer: 1, explanation: "Mobile pentesting aims to discover security weaknesses in apps before malicious actors can exploit them.", topic: "Fundamentals" },
  { id: 2, question: "Which security standard provides guidelines for mobile app security testing?", options: ["PCI-DSS only", "OWASP MASTG (Mobile Application Security Testing Guide)", "ISO 27001 only", "HIPAA only"], correctAnswer: 1, explanation: "OWASP MASTG is the comprehensive guide for mobile security testing methodology.", topic: "Fundamentals" },
  { id: 3, question: "What is the difference between static and dynamic analysis?", options: ["No difference", "Static analyzes code without running; dynamic analyzes running app", "Static is faster", "Dynamic requires source code"], correctAnswer: 1, explanation: "Static analysis examines code/binary without execution; dynamic analysis tests the running application.", topic: "Fundamentals" },
  { id: 4, question: "What does MASVS stand for?", options: ["Mobile App Security Verification Standard", "Mobile Application Security Vulnerability Scanner", "Mobile Attack Surface Verification System", "Mobile Application Secure Validation Standard"], correctAnswer: 0, explanation: "MASVS is OWASP's Mobile Application Security Verification Standard for security requirements.", topic: "Fundamentals" },
  { id: 5, question: "Why is mobile security testing important for enterprises?", options: ["Only for compliance", "Mobile apps often access sensitive corporate data and APIs", "Just for app store approval", "Only for marketing"], correctAnswer: 1, explanation: "Enterprise mobile apps frequently handle sensitive data and connect to critical backend systems.", topic: "Fundamentals" },
  { id: 6, question: "What is the mobile attack surface?", options: ["The phone's screen", "All potential entry points for attacks on a mobile app", "The app store", "The mobile network"], correctAnswer: 1, explanation: "Attack surface includes all interfaces where an attacker could attempt to enter or extract data.", topic: "Fundamentals" },
  { id: 7, question: "Which platforms are primary targets for mobile pentesting?", options: ["Only Android", "Only iOS", "Android and iOS", "Windows Mobile only"], correctAnswer: 2, explanation: "Both Android and iOS are the dominant mobile platforms requiring security testing.", topic: "Fundamentals" },
  { id: 8, question: "What is a threat model in mobile security?", options: ["A mobile device model", "Structured approach to identify threats and vulnerabilities", "A testing tool", "A security certification"], correctAnswer: 1, explanation: "Threat modeling identifies potential threats, attack vectors, and security controls needed.", topic: "Fundamentals" },
  { id: 9, question: "What are the main MASVS verification levels?", options: ["Basic, Medium, Advanced", "L1 (Standard) and L2 (Defense-in-Depth)", "Alpha, Beta, Production", "Low, Medium, High"], correctAnswer: 1, explanation: "MASVS defines L1 for standard security and L2 for apps requiring defense-in-depth.", topic: "Fundamentals" },
  { id: 10, question: "What is responsible disclosure in mobile pentesting?", options: ["Hiding vulnerabilities", "Reporting findings to vendors before public disclosure", "Never reporting bugs", "Selling exploits"], correctAnswer: 1, explanation: "Responsible disclosure means reporting vulnerabilities to the vendor and allowing time to fix before public disclosure.", topic: "Fundamentals" },

  // Section 2: Android Security (12 questions)
  { id: 11, question: "What is the Android application sandbox?", options: ["A game feature", "Isolation mechanism giving each app unique UID and file permissions", "Cloud storage", "An emulator"], correctAnswer: 1, explanation: "Android sandboxes apps using Linux UID isolation to protect apps from each other.", topic: "Android Security" },
  { id: 12, question: "Where are Android app private files stored?", options: ["/sdcard/", "/data/data/<package_name>/", "/system/app/", "/tmp/"], correctAnswer: 1, explanation: "Private app data is stored in /data/data/<package_name>/ with app-specific permissions.", topic: "Android Security" },
  { id: 13, question: "What is an Android Content Provider vulnerability?", options: ["Battery drain", "Improperly secured data access component exposing sensitive data", "UI issue", "Performance bug"], correctAnswer: 1, explanation: "Insecure Content Providers can expose app data to other apps if not properly protected.", topic: "Android Security" },
  { id: 14, question: "What does 'android:exported=true' mean for a component?", options: ["Component is encrypted", "Component can be accessed by other apps", "Component is exported to file", "Component is disabled"], correctAnswer: 1, explanation: "exported=true means other apps can interact with that activity, service, or receiver.", topic: "Android Security" },
  { id: 15, question: "What is ADB (Android Debug Bridge)?", options: ["A mobile browser", "Command-line tool for communicating with Android devices", "A security scanner", "An antivirus app"], correctAnswer: 1, explanation: "ADB is a versatile tool for debugging, installing apps, and accessing device shell.", topic: "Android Security" },
  { id: 16, question: "What are Android runtime permissions?", options: ["Install-time only", "Permissions requested and granted at runtime for sensitive resources", "System permissions only", "Developer permissions"], correctAnswer: 1, explanation: "Dangerous permissions must be requested at runtime, giving users control over sensitive access.", topic: "Android Security" },
  { id: 17, question: "What is Drozer used for?", options: ["Photo editing", "Android security assessment framework for testing app components", "Music streaming", "File compression"], correctAnswer: 1, explanation: "Drozer is a comprehensive Android security testing framework for component analysis.", topic: "Android Security" },
  { id: 18, question: "What is an Intent in Android security context?", options: ["User intention", "Messaging object that can be intercepted or manipulated", "A file type", "A security certificate"], correctAnswer: 1, explanation: "Intents are messaging objects; insecure intents can leak data or be hijacked.", topic: "Android Security" },
  { id: 19, question: "What is Android KeyStore?", options: ["App store", "Secure hardware-backed storage for cryptographic keys", "Password manager", "File storage"], correctAnswer: 1, explanation: "Android KeyStore provides secure key storage, often hardware-backed on modern devices.", topic: "Android Security" },
  { id: 20, question: "What does 'adb backup' security concern involve?", options: ["No concern", "Apps allowing backup may have data extracted", "Only affects system apps", "Only affects rooted devices"], correctAnswer: 1, explanation: "If android:allowBackup=true, app data can be extracted via adb backup without root.", topic: "Android Security" },
  { id: 21, question: "What is WebView security risk?", options: ["No risk", "JavaScript bridges and insecure configurations can lead to code execution", "Only UI issues", "Only affects old devices"], correctAnswer: 1, explanation: "Insecure WebViews with JavaScript enabled can execute malicious code or leak data.", topic: "Android Security" },
  { id: 22, question: "What is Magisk used for in pentesting?", options: ["Malware creation", "Systemless root solution with module support for testing", "App development", "Photo editing"], correctAnswer: 1, explanation: "Magisk provides systemless root, allowing security testing while hiding root from apps.", topic: "Android Security" },

  // Section 3: iOS Security (12 questions)
  { id: 23, question: "What is iOS App Sandbox?", options: ["A game", "Security mechanism restricting app access to its own container", "Cloud storage", "An emulator"], correctAnswer: 1, explanation: "iOS sandbox restricts each app to its own container directory with limited system access.", topic: "iOS Security" },
  { id: 24, question: "What is Keychain in iOS?", options: ["Physical keychain", "Encrypted database for storing sensitive data like passwords", "File browser", "Settings app"], correctAnswer: 1, explanation: "iOS Keychain securely stores passwords, certificates, and other sensitive credentials.", topic: "iOS Security" },
  { id: 25, question: "What is jailbreaking in iOS context?", options: ["Breaking the screen", "Removing iOS security restrictions to gain root access", "Updating iOS", "Factory reset"], correctAnswer: 1, explanation: "Jailbreaking bypasses iOS security to allow root access and testing capabilities.", topic: "iOS Security" },
  { id: 26, question: "What tool is used for iOS app decryption on jailbroken devices?", options: ["Xcode", "Clutch or frida-ios-dump", "iTunes", "Safari"], correctAnswer: 1, explanation: "Tools like Clutch or frida-ios-dump decrypt App Store apps for analysis on jailbroken devices.", topic: "iOS Security" },
  { id: 27, question: "What is Cycript?", options: ["A programming language", "Runtime exploration tool for iOS apps using JavaScript/Objective-C", "A build tool", "A text editor"], correctAnswer: 1, explanation: "Cycript allows runtime manipulation of iOS apps using JavaScript and Objective-C.", topic: "iOS Security" },
  { id: 28, question: "What is the iOS Data Protection API?", options: ["Antivirus", "Encryption API that protects files based on device lock state", "Backup tool", "Network protection"], correctAnswer: 1, explanation: "Data Protection API encrypts files with keys protected by device passcode and hardware.", topic: "iOS Security" },
  { id: 29, question: "What is a .ipa file?", options: ["Audio file", "iOS Application Archive - packaged iOS app", "Image file", "Settings file"], correctAnswer: 1, explanation: "IPA (iOS App Store Package) is the archive format for iOS applications.", topic: "iOS Security" },
  { id: 30, question: "What is objection for iOS?", options: ["A complaint", "Runtime mobile exploration toolkit built on Frida", "An IDE", "A compiler"], correctAnswer: 1, explanation: "objection provides runtime app analysis capabilities powered by Frida framework.", topic: "iOS Security" },
  { id: 31, question: "What are iOS URL schemes security concerns?", options: ["No concerns", "Can be hijacked or leak data through improper handling", "Only affect Safari", "Only for web apps"], correctAnswer: 1, explanation: "Custom URL schemes can be hijacked by malicious apps or leak sensitive parameters.", topic: "iOS Security" },
  { id: 32, question: "What is the iOS Secure Enclave?", options: ["App container", "Hardware security module for key storage and biometrics", "iCloud feature", "Safari mode"], correctAnswer: 1, explanation: "Secure Enclave is a hardware security processor for cryptographic operations and biometrics.", topic: "iOS Security" },
  { id: 33, question: "What is binary analysis in iOS pentesting?", options: ["Counting files", "Examining the compiled app binary for security issues", "Testing the battery", "Checking storage"], correctAnswer: 1, explanation: "Binary analysis examines the compiled executable for hardcoded secrets, protections, and vulnerabilities.", topic: "iOS Security" },
  { id: 34, question: "What does class-dump do for iOS apps?", options: ["Deletes classes", "Extracts Objective-C class information from binaries", "Compresses files", "Encrypts apps"], correctAnswer: 1, explanation: "class-dump extracts Objective-C runtime information from Mach-O binaries.", topic: "iOS Security" },

  // Section 4: Network & API Testing (10 questions)
  { id: 35, question: "What is SSL/TLS pinning?", options: ["Physical pin", "Hardcoding expected server certificate in app to prevent MITM", "Password storage", "Network speed"], correctAnswer: 1, explanation: "Certificate pinning validates server certificates against embedded pins to prevent interception.", topic: "Network Security" },
  { id: 36, question: "What is Burp Suite used for in mobile testing?", options: ["Game development", "Intercepting and analyzing HTTP/HTTPS traffic", "Photo editing", "Music production"], correctAnswer: 1, explanation: "Burp Suite is a proxy for intercepting, analyzing, and modifying mobile app traffic.", topic: "Network Security" },
  { id: 37, question: "What is certificate transparency?", options: ["Clear certificates", "Public log of issued certificates to detect misissued certs", "Certificate deletion", "Private certificates"], correctAnswer: 1, explanation: "Certificate Transparency logs help detect maliciously issued certificates.", topic: "Network Security" },
  { id: 38, question: "What is mitmproxy?", options: ["Antivirus", "Open-source interactive HTTPS proxy for traffic interception", "Password manager", "File browser"], correctAnswer: 1, explanation: "mitmproxy is an open-source tool for intercepting and modifying network traffic.", topic: "Network Security" },
  { id: 39, question: "How can SSL pinning be bypassed?", options: ["Cannot be bypassed", "Using Frida scripts or modifying the app binary", "Only by rebooting", "Only by reinstalling"], correctAnswer: 1, explanation: "SSL pinning can be bypassed using tools like Frida, objection, or by patching the app.", topic: "Network Security" },
  { id: 40, question: "What is API security testing for mobile apps?", options: ["Testing the phone", "Testing backend APIs for authentication, authorization, and injection flaws", "Testing the app store", "Testing the OS"], correctAnswer: 1, explanation: "API testing checks backend endpoints for security vulnerabilities accessible from mobile apps.", topic: "Network Security" },
  { id: 41, question: "What is OAuth in mobile apps?", options: ["A database", "Authorization framework for granting limited access", "A file format", "An encryption algorithm"], correctAnswer: 1, explanation: "OAuth allows apps to access resources on behalf of users with limited, scoped permissions.", topic: "Network Security" },
  { id: 42, question: "What is a JWT vulnerability in mobile context?", options: ["No vulnerabilities", "Weak secrets, algorithm confusion, or improper validation", "Only affects servers", "Only affects iOS"], correctAnswer: 1, explanation: "JWT vulnerabilities include weak signing, none algorithm, and improper claim validation.", topic: "Network Security" },
  { id: 43, question: "What is a replay attack?", options: ["Video replay", "Reusing captured requests to perform unauthorized actions", "App reinstallation", "OS update"], correctAnswer: 1, explanation: "Replay attacks resend valid captured requests to repeat transactions or actions.", topic: "Network Security" },
  { id: 44, question: "Why test for cleartext traffic?", options: ["No reason", "Unencrypted traffic exposes sensitive data to eavesdroppers", "Only for aesthetics", "Only for performance"], correctAnswer: 1, explanation: "Cleartext HTTP traffic can be intercepted, exposing credentials and sensitive data.", topic: "Network Security" },

  // Section 5: Data Storage Security (8 questions)
  { id: 45, question: "What is insecure data storage?", options: ["Full storage", "Storing sensitive data in unprotected locations", "Cloud storage", "External storage only"], correctAnswer: 1, explanation: "Insecure storage involves keeping sensitive data in plaintext or easily accessible locations.", topic: "Data Storage" },
  { id: 46, question: "What is SQLite injection in mobile apps?", options: ["Database optimization", "Injecting malicious SQL through unsanitized input", "Database backup", "Database encryption"], correctAnswer: 1, explanation: "SQL injection in mobile SQLite databases can expose or modify local app data.", topic: "Data Storage" },
  { id: 47, question: "What should not be stored in SharedPreferences?", options: ["App settings", "Passwords, tokens, and other sensitive credentials", "UI preferences", "Language settings"], correctAnswer: 1, explanation: "SharedPreferences is not encrypted by default and shouldn't store sensitive data.", topic: "Data Storage" },
  { id: 48, question: "What is the risk of logging sensitive data?", options: ["No risk", "Logs may be accessible to other apps or through backup extraction", "Only affects debug builds", "Only affects old devices"], correctAnswer: 1, explanation: "Sensitive data in logs can be accessed through logcat, backups, or crash reports.", topic: "Data Storage" },
  { id: 49, question: "What is realm database security?", options: ["Always secure", "Realm databases need encryption enabled for sensitive data", "Only for iOS", "No security needed"], correctAnswer: 1, explanation: "Realm databases must have encryption enabled to protect data at rest.", topic: "Data Storage" },
  { id: 50, question: "What is clipboard security concern?", options: ["No concern", "Sensitive data copied to clipboard accessible by other apps", "Only affects text", "Only affects images"], correctAnswer: 1, explanation: "Clipboard data can be accessed by other apps, risking password and sensitive data exposure.", topic: "Data Storage" },
  { id: 51, question: "What is keyboard cache risk?", options: ["No risk", "Typed sensitive data may be cached by keyboard for autocomplete", "Only affects external keyboards", "Only affects old devices"], correctAnswer: 1, explanation: "Keyboard autocomplete caches typed words, potentially including passwords.", topic: "Data Storage" },
  { id: 52, question: "What is screenshot/snapshot protection?", options: ["Preventing camera use", "Preventing system from capturing app content in snapshots", "Disabling screenshots entirely", "Photo encryption"], correctAnswer: 1, explanation: "Apps should prevent sensitive content from appearing in app switcher snapshots.", topic: "Data Storage" },

  // Section 6: Authentication & Session (8 questions)
  { id: 53, question: "What is biometric authentication bypass?", options: ["Improving biometrics", "Circumventing fingerprint/face authentication", "Biometric enrollment", "Biometric update"], correctAnswer: 1, explanation: "Attackers may bypass biometrics through fallback mechanisms or implementation flaws.", topic: "Authentication" },
  { id: 54, question: "What is session fixation in mobile apps?", options: ["Stable sessions", "Attacker sets session ID before victim authenticates", "Session timeout", "Session encryption"], correctAnswer: 1, explanation: "Session fixation forces a known session token on the victim to hijack their session.", topic: "Authentication" },
  { id: 55, question: "What is insecure authentication?", options: ["Strong passwords", "Weak, bypassable, or improperly implemented auth mechanisms", "Biometric auth", "Two-factor auth"], correctAnswer: 1, explanation: "Insecure authentication includes weak passwords, missing validation, and bypassable checks.", topic: "Authentication" },
  { id: 56, question: "What is token storage best practice?", options: ["SharedPreferences plaintext", "Encrypted storage like Keychain/KeyStore", "In app memory only", "In log files"], correctAnswer: 1, explanation: "Tokens should be stored in secure, encrypted storage like iOS Keychain or Android KeyStore.", topic: "Authentication" },
  { id: 57, question: "What is account enumeration?", options: ["Counting users", "Discovering valid usernames through login response differences", "User registration", "Account deletion"], correctAnswer: 1, explanation: "Different error messages for valid/invalid usernames allow attackers to enumerate accounts.", topic: "Authentication" },
  { id: 58, question: "What is brute force protection?", options: ["Physical protection", "Rate limiting and lockouts to prevent password guessing", "Password strength", "Encryption strength"], correctAnswer: 1, explanation: "Apps should implement rate limiting and account lockouts to prevent credential brute-forcing.", topic: "Authentication" },
  { id: 59, question: "What is the risk of 'Remember Me' functionality?", options: ["No risk", "Long-lived tokens may be stolen if device is compromised", "Only affects web apps", "Only affects old devices"], correctAnswer: 1, explanation: "Persistent login tokens increase the window for token theft and unauthorized access.", topic: "Authentication" },
  { id: 60, question: "What is multi-factor authentication bypass?", options: ["Enabling MFA", "Circumventing additional authentication factors", "MFA enrollment", "MFA recovery"], correctAnswer: 1, explanation: "MFA bypass exploits fallback mechanisms or implementation flaws in second factors.", topic: "Authentication" },

  // Section 7: Code Security (8 questions)
  { id: 61, question: "What is code obfuscation?", options: ["Code deletion", "Making code difficult to understand through renaming and restructuring", "Code compilation", "Code formatting"], correctAnswer: 1, explanation: "Obfuscation makes reverse engineering harder by obscuring code logic and names.", topic: "Code Security" },
  { id: 62, question: "What is anti-tampering?", options: ["App updates", "Detecting and preventing modifications to the app", "User blocking", "Network protection"], correctAnswer: 1, explanation: "Anti-tampering detects if the app binary has been modified and prevents execution.", topic: "Code Security" },
  { id: 63, question: "What is root/jailbreak detection?", options: ["Phone specs", "Detecting if device security has been compromised", "Hardware testing", "Battery testing"], correctAnswer: 1, explanation: "Apps detect rooted/jailbroken devices to protect against runtime manipulation.", topic: "Code Security" },
  { id: 64, question: "What is debugger detection?", options: ["Debugging help", "Detecting if a debugger is attached to prevent analysis", "Log monitoring", "Performance testing"], correctAnswer: 1, explanation: "Debugger detection prevents attackers from dynamically analyzing app behavior.", topic: "Code Security" },
  { id: 65, question: "What is emulator detection?", options: ["Finding emulators", "Detecting if app runs on emulator instead of real device", "Emulator installation", "Performance testing"], correctAnswer: 1, explanation: "Emulator detection prevents analysis in controlled environments like Android emulators.", topic: "Code Security" },
  { id: 66, question: "What are hardcoded secrets?", options: ["Strong secrets", "API keys, passwords embedded directly in code", "Secret features", "Encrypted secrets"], correctAnswer: 1, explanation: "Hardcoded secrets in the binary can be extracted through reverse engineering.", topic: "Code Security" },
  { id: 67, question: "What is runtime application self-protection (RASP)?", options: ["Antivirus", "Runtime security monitoring and protection built into the app", "Backup feature", "Performance tool"], correctAnswer: 1, explanation: "RASP provides runtime protection by detecting and responding to attacks.", topic: "Code Security" },
  { id: 68, question: "What is native code security concern?", options: ["No concerns", "Native code can have memory corruption vulnerabilities", "Only affects performance", "Only affects old devices"], correctAnswer: 1, explanation: "Native code may contain buffer overflows, use-after-free, and other memory issues.", topic: "Code Security" },

  // Section 8: Tools & Methodology (7 questions)
  { id: 69, question: "What is MobSF?", options: ["Mobile browser", "Automated mobile security testing framework", "App store", "Development IDE"], correctAnswer: 1, explanation: "Mobile Security Framework automates static and dynamic analysis of mobile apps.", topic: "Tools" },
  { id: 70, question: "What is Frida?", options: ["A social app", "Dynamic instrumentation toolkit for runtime manipulation", "A camera app", "A messaging app"], correctAnswer: 1, explanation: "Frida injects JavaScript to hook and modify app behavior at runtime.", topic: "Tools" },
  { id: 71, question: "What is apktool?", options: ["APK builder only", "Tool to decode and rebuild Android APK files", "App store", "Antivirus"], correctAnswer: 1, explanation: "apktool decodes APKs to readable format and can rebuild them after modification.", topic: "Tools" },
  { id: 72, question: "What is jadx?", options: ["Java runtime", "DEX to Java decompiler for analyzing Android apps", "JavaScript engine", "Database tool"], correctAnswer: 1, explanation: "jadx decompiles DEX bytecode to readable Java source code.", topic: "Tools" },
  { id: 73, question: "What is Hopper/IDA for mobile?", options: ["Games", "Disassemblers for analyzing native mobile binaries", "Music players", "Photo editors"], correctAnswer: 1, explanation: "Hopper and IDA Pro are disassemblers for reverse engineering native code.", topic: "Tools" },
  { id: 74, question: "What is a mobile pentest report?", options: ["Bug list only", "Comprehensive document with findings, risks, and remediation", "Code review", "Performance report"], correctAnswer: 1, explanation: "Pentest reports document vulnerabilities, their impact, and recommended fixes.", topic: "Tools" },
  { id: 75, question: "What is the testing methodology order?", options: ["Random testing", "Recon, static analysis, dynamic analysis, reporting", "Only automated scans", "Only manual testing"], correctAnswer: 1, explanation: "Systematic methodology: reconnaissance, static analysis, dynamic analysis, then reporting.", topic: "Tools" },
];

// Quiz Section Component
function QuizSection() {
  const theme = useTheme();
  const [quizStarted, setQuizStarted] = React.useState(false);
  const [currentQuestions, setCurrentQuestions] = React.useState<QuizQuestion[]>([]);
  const [userAnswers, setUserAnswers] = React.useState<{ [key: number]: number }>({});
  const [showResults, setShowResults] = React.useState(false);
  const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);

  const shuffleAndSelectQuestions = () => {
    const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
    return shuffled.slice(0, 10);
  };

  const startQuiz = () => {
    setCurrentQuestions(shuffleAndSelectQuestions());
    setUserAnswers({});
    setShowResults(false);
    setCurrentQuestionIndex(0);
    setQuizStarted(true);
  };

  const handleAnswerSelect = (questionId: number, answerIndex: number) => {
    setUserAnswers((prev) => ({ ...prev, [questionId]: answerIndex }));
  };

  const calculateScore = () => {
    let correct = 0;
    currentQuestions.forEach((q) => {
      if (userAnswers[q.id] === q.correctAnswer) correct++;
    });
    return correct;
  };

  const getScoreColor = (score: number) => {
    if (score >= 8) return "#10b981";
    if (score >= 6) return "#f59e0b";
    return "#ef4444";
  };

  const getScoreMessage = (score: number) => {
    if (score === 10) return "Perfect! You're a mobile security expert! üèÜ";
    if (score >= 8) return "Excellent work! Strong mobile pentesting knowledge! üåü";
    if (score >= 6) return "Good job! Keep studying mobile security! üìö";
    if (score >= 4) return "Not bad, but review the material again. üí™";
    return "Keep learning! Review the sections above. üìñ";
  };

  if (!quizStarted) {
    return (
      <Paper id="quiz-section" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: alpha("#10b981", 0.03), border: `2px solid ${alpha("#10b981", 0.2)}` }}>
        <Typography variant="h5" sx={{ fontWeight: 800, mb: 2, display: "flex", alignItems: "center", gap: 2 }}>
          <Box sx={{ width: 48, height: 48, borderRadius: 2, background: "linear-gradient(135deg, #10b981, #059669)", display: "flex", alignItems: "center", justifyContent: "center" }}>
            <QuizIcon sx={{ color: "white", fontSize: 28 }} />
          </Box>
          Test Your Mobile Pentesting Knowledge
        </Typography>
        <Typography variant="body1" sx={{ mb: 3, color: "text.secondary" }}>
          Ready to test what you've learned? Take this <strong>10-question quiz</strong> covering mobile pentesting fundamentals. Questions are randomly selected from a pool of <strong>75 questions</strong>!
        </Typography>
        <Grid container spacing={2} sx={{ mb: 3 }}>
          {[{ label: "Questions", value: "10", color: "#10b981" }, { label: "Question Pool", value: "75", color: "#3b82f6" }, { label: "Topics", value: "8", color: "#8b5cf6" }, { label: "Retakes", value: "‚àû", color: "#f59e0b" }].map((stat) => (
            <Grid item xs={6} sm={3} key={stat.label}>
              <Paper sx={{ p: 2, textAlign: "center", bgcolor: alpha(stat.color, 0.1), borderRadius: 2 }}>
                <Typography variant="h4" sx={{ fontWeight: 800, color: stat.color }}>{stat.value}</Typography>
                <Typography variant="caption" color="text.secondary">{stat.label}</Typography>
              </Paper>
            </Grid>
          ))}
        </Grid>
        <Button variant="contained" size="large" onClick={startQuiz} startIcon={<QuizIcon />} sx={{ background: "linear-gradient(135deg, #10b981, #059669)", fontWeight: 700, px: 4, py: 1.5, "&:hover": { background: "linear-gradient(135deg, #059669, #047857)" } }}>
          Start Quiz
        </Button>
      </Paper>
    );
  }

  if (showResults) {
    const score = calculateScore();
    return (
      <Paper id="quiz-section" sx={{ p: 4, mb: 4, borderRadius: 3, border: `2px solid ${alpha(getScoreColor(score), 0.3)}` }}>
        <Typography variant="h5" sx={{ fontWeight: 800, mb: 3, display: "flex", alignItems: "center", gap: 2 }}>
          <EmojiEventsIcon sx={{ color: getScoreColor(score), fontSize: 36 }} /> Quiz Results
        </Typography>
        <Box sx={{ textAlign: "center", mb: 4 }}>
          <Typography variant="h1" sx={{ fontWeight: 900, color: getScoreColor(score) }}>{score}/10</Typography>
          <Typography variant="h6" color="text.secondary" sx={{ mb: 2 }}>{getScoreMessage(score)}</Typography>
          <Chip label={`${score * 10}%`} sx={{ bgcolor: alpha(getScoreColor(score), 0.15), color: getScoreColor(score), fontWeight: 700, fontSize: "1rem" }} />
        </Box>
        <Divider sx={{ my: 3 }} />
        <Typography variant="h6" sx={{ fontWeight: 700, mb: 2 }}>Review Your Answers:</Typography>
        {currentQuestions.map((q, index) => {
          const isCorrect = userAnswers[q.id] === q.correctAnswer;
          return (
            <Paper key={q.id} sx={{ p: 2, mb: 2, borderRadius: 2, bgcolor: alpha(isCorrect ? "#10b981" : "#ef4444", 0.05), border: `1px solid ${alpha(isCorrect ? "#10b981" : "#ef4444", 0.2)}` }}>
              <Box sx={{ display: "flex", alignItems: "flex-start", gap: 1, mb: 1 }}>
                <Chip label={`Q${index + 1}`} size="small" sx={{ bgcolor: isCorrect ? "#10b981" : "#ef4444", color: "white", fontWeight: 700 }} />
                <Typography variant="body2" sx={{ fontWeight: 600 }}>{q.question}</Typography>
              </Box>
              <Typography variant="body2" color="text.secondary" sx={{ ml: 5 }}>
                <strong>Your answer:</strong> {q.options[userAnswers[q.id]] || "Not answered"}
                {!isCorrect && (<><br /><strong style={{ color: "#10b981" }}>Correct:</strong> {q.options[q.correctAnswer]}</>)}
              </Typography>
              {!isCorrect && <Alert severity="info" sx={{ mt: 1, ml: 5 }}><Typography variant="caption">{q.explanation}</Typography></Alert>}
            </Paper>
          );
        })}
        <Box sx={{ display: "flex", gap: 2, mt: 3 }}>
          <Button variant="contained" onClick={startQuiz} startIcon={<RefreshIcon />} sx={{ background: "linear-gradient(135deg, #10b981, #059669)", fontWeight: 700 }}>Try Again</Button>
          <Button variant="outlined" onClick={() => setQuizStarted(false)}>Back to Overview</Button>
        </Box>
      </Paper>
    );
  }

  const currentQuestion = currentQuestions[currentQuestionIndex];
  const answeredCount = Object.keys(userAnswers).length;

  return (
    <Paper id="quiz-section" sx={{ p: 4, mb: 4, borderRadius: 3, border: `2px solid ${alpha("#10b981", 0.2)}` }}>
      <Box sx={{ mb: 3 }}>
        <Box sx={{ display: "flex", justifyContent: "space-between", alignItems: "center", mb: 1 }}>
          <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>Question {currentQuestionIndex + 1} of 10</Typography>
          <Chip label={currentQuestion.topic} size="small" sx={{ bgcolor: alpha("#8b5cf6", 0.15), color: "#8b5cf6", fontWeight: 600 }} />
        </Box>
        <LinearProgress variant="determinate" value={((currentQuestionIndex + 1) / 10) * 100} sx={{ height: 8, borderRadius: 1, bgcolor: alpha("#10b981", 0.1), "& .MuiLinearProgress-bar": { bgcolor: "#10b981" } }} />
      </Box>
      <Typography variant="h6" sx={{ fontWeight: 700, mb: 3, lineHeight: 1.5 }}>{currentQuestion.question}</Typography>
      <Grid container spacing={2} sx={{ mb: 4 }}>
        {currentQuestion.options.map((option, index) => {
          const isSelected = userAnswers[currentQuestion.id] === index;
          return (
            <Grid item xs={12} key={index}>
              <Paper onClick={() => handleAnswerSelect(currentQuestion.id, index)} sx={{ p: 2, borderRadius: 2, cursor: "pointer", bgcolor: isSelected ? alpha("#10b981", 0.1) : "background.paper", border: `2px solid ${isSelected ? "#10b981" : alpha(theme.palette.divider, 0.2)}`, transition: "all 0.2s", "&:hover": { borderColor: "#10b981", bgcolor: alpha("#10b981", 0.05) } }}>
                <Box sx={{ display: "flex", alignItems: "center", gap: 2 }}>
                  <Box sx={{ width: 32, height: 32, borderRadius: "50%", bgcolor: isSelected ? "#10b981" : alpha(theme.palette.divider, 0.3), color: isSelected ? "white" : "text.secondary", display: "flex", alignItems: "center", justifyContent: "center", fontWeight: 700 }}>{String.fromCharCode(65 + index)}</Box>
                  <Typography variant="body1" sx={{ fontWeight: isSelected ? 600 : 400 }}>{option}</Typography>
                </Box>
              </Paper>
            </Grid>
          );
        })}
      </Grid>
      <Box sx={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <Button variant="outlined" disabled={currentQuestionIndex === 0} onClick={() => setCurrentQuestionIndex((p) => p - 1)}>Previous</Button>
        <Typography variant="body2" color="text.secondary">{answeredCount}/10 answered</Typography>
        {currentQuestionIndex < 9 ? (
          <Button variant="contained" onClick={() => setCurrentQuestionIndex((p) => p + 1)} sx={{ background: "linear-gradient(135deg, #10b981, #059669)" }}>Next</Button>
        ) : (
          <Button variant="contained" onClick={() => setShowResults(true)} disabled={answeredCount < 10} sx={{ background: answeredCount >= 10 ? "linear-gradient(135deg, #3b82f6, #2563eb)" : undefined, fontWeight: 700 }}>Submit Quiz</Button>
        )}
      </Box>
    </Paper>
  );
}

const CodeBlock: React.FC<{ code: string; language?: string; title?: string }> = ({
  code,
  language = "bash",
  title,
}) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = () => {
    navigator.clipboard.writeText(code);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <Paper
      sx={{
        bgcolor: "#0d1117",
        borderRadius: 2,
        position: "relative",
        my: 2,
        border: "1px solid rgba(16, 185, 129, 0.2)",
        overflow: "hidden",
      }}
    >
      {title && (
        <Box sx={{ px: 2, py: 1, bgcolor: "rgba(16, 185, 129, 0.1)", borderBottom: "1px solid rgba(16, 185, 129, 0.2)" }}>
          <Typography variant="subtitle2" sx={{ color: "#10b981", fontWeight: 600 }}>{title}</Typography>
        </Box>
      )}
      <Box sx={{ position: "absolute", top: title ? 40 : 8, right: 8, display: "flex", gap: 1 }}>
        <Chip label={language} size="small" sx={{ bgcolor: alpha("#10b981", 0.2), color: "#10b981", fontSize: "0.7rem" }} />
        <Tooltip title={copied ? "Copied!" : "Copy"}>
          <IconButton size="small" onClick={handleCopy} sx={{ color: copied ? "#10b981" : "#888" }}>
            <ContentCopyIcon fontSize="small" />
          </IconButton>
        </Tooltip>
      </Box>
      <Box
        component="pre"
        sx={{
          m: 0,
          p: 2,
          pt: 3,
          overflow: "auto",
          fontFamily: "'Fira Code', 'Consolas', monospace",
          fontSize: "0.8rem",
          color: "#e6edf3",
          lineHeight: 1.6,
        }}
      >
        {code}
      </Box>
    </Paper>
  );
};

const MobilePentestPage: React.FC = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down("md"));
  const [activeSection, setActiveSection] = useState("intro");
  const [mobileNavOpen, setMobileNavOpen] = useState(false);

  const scrollToSection = (sectionId: string) => {
    setActiveSection(sectionId);
    const element = document.getElementById(sectionId);
    if (element) {
      const offset = 80;
      const elementPosition = element.getBoundingClientRect().top;
      const offsetPosition = elementPosition + window.pageYOffset - offset;
      window.scrollTo({ top: offsetPosition, behavior: "smooth" });
    }
    setMobileNavOpen(false);
  };

  useEffect(() => {
    const handleScroll = () => {
      const sections = sectionNavItems.map((item) => item.id);
      for (const sectionId of sections) {
        const element = document.getElementById(sectionId);
        if (element) {
          const rect = element.getBoundingClientRect();
          if (rect.top <= 120 && rect.bottom >= 120) {
            setActiveSection(sectionId);
            break;
          }
        }
      }
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  // Sidebar navigation component
  const sidebarNav = (
    <Box sx={{ p: 2 }}>
      <Typography
        variant="overline"
        sx={{ color: themeColors.textMuted, fontWeight: 600, px: 1, mb: 1, display: "block" }}
      >
        Navigation
      </Typography>
      {sectionNavItems.map((item) => (
        <Box
          key={item.id}
          onClick={() => scrollToSection(item.id)}
          sx={{
            display: "flex",
            alignItems: "center",
            gap: 1.5,
            px: 2,
            py: 1,
            borderRadius: 2,
            cursor: "pointer",
            mb: 0.5,
            bgcolor: activeSection === item.id ? alpha(themeColors.primary, 0.15) : "transparent",
            borderLeft: activeSection === item.id ? `3px solid ${themeColors.primary}` : "3px solid transparent",
            color: activeSection === item.id ? themeColors.primary : themeColors.textMuted,
            transition: "all 0.2s ease",
            "&:hover": {
              bgcolor: alpha(themeColors.primary, 0.1),
              color: themeColors.primary,
            },
          }}
        >
          {item.icon}
          <Typography variant="body2" sx={{ fontWeight: activeSection === item.id ? 600 : 400 }}>
            {item.label}
          </Typography>
        </Box>
      ))}
    </Box>
  );

  const tools = [
    { name: "Frida", purpose: "Dynamic instrumentation & hooking", platform: "Both", icon: "üß™" },
    { name: "Objection", purpose: "Runtime exploration (Frida-based)", platform: "Both", icon: "üéØ" },
    { name: "MobSF", purpose: "Automated static/dynamic analysis", platform: "Both", icon: "üîç" },
    { name: "jadx-gui", purpose: "Android APK decompiler to Java/Kotlin", platform: "Android", icon: "üì¶" },
    { name: "apktool", purpose: "APK unpacking/repacking/smali", platform: "Android", icon: "üõ†Ô∏è" },
    { name: "aapt / aapt2", purpose: "Manifest, resources, and certificate inspection", platform: "Android", icon: "üóÇÔ∏è" },
    { name: "adb", purpose: "Android Debug Bridge CLI", platform: "Android", icon: "üì±" },
    { name: "mitmproxy / Burp", purpose: "HTTP/S interception & scripting", platform: "Both", icon: "üåê" },
    { name: "r2frida", purpose: "Radare2 + Frida reversing", platform: "Android", icon: "üß≠" },
    { name: "Hopper/IDA", purpose: "iOS binary disassembly", platform: "iOS", icon: "üíª" },
    { name: "class-dump", purpose: "Extract ObjC headers from iOS apps", platform: "iOS", icon: "üìã" },
    { name: "Cycript", purpose: "iOS runtime manipulation", platform: "iOS", icon: "‚ö°" },
  ];

  const pageContext = `This page covers mobile application penetration testing including:
- Android and iOS security fundamentals
- Mobile pentest tools: Frida, Objection, MobSF, jadx, apktool, mitmproxy
- Static analysis of APKs and IPAs
- Dynamic analysis and runtime hooking
- Certificate pinning bypass techniques
- Data storage security assessment
- Network traffic interception
- Common mobile vulnerabilities and exploitation
- Mobile app assessment methodology`;

  return (
    <LearnPageLayout pageTitle="Mobile Pentest" pageContext={pageContext}>
      <Box sx={{ minHeight: "100vh", bgcolor: "#0a0a0f", py: 4 }}>
        <Container maxWidth="xl">
          <Grid container spacing={3}>
            {/* Sidebar Navigation - Hidden on mobile */}
            <Grid item md={2.5} sx={{ display: { xs: "none", md: "block" } }}>
              <Paper
                sx={{
                  position: "sticky",
                  top: 80,
                  bgcolor: themeColors.bgCard,
                  borderRadius: 3,
                  border: `1px solid ${themeColors.border}`,
                  overflow: "hidden",
                }}
              >
                {sidebarNav}
              </Paper>
            </Grid>

            {/* Main Content */}
            <Grid item xs={12} md={9.5}>
              {/* Section: Introduction */}
              <Paper id="intro" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Chip
                  component={Link}
                  to="/learn"
                  icon={<ArrowBackIcon />}
                  label="Back to Learning Hub"
                  clickable
                  variant="outlined"
                  sx={{ borderRadius: 2, mb: 3 }}
                />
                
                <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                  <Box
                    sx={{
                      p: 1.5,
                      borderRadius: 2,
                      background: "linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(52, 211, 153, 0.1) 100%)",
                      border: "1px solid rgba(16, 185, 129, 0.3)",
                    }}
                  >
                    <PhoneAndroidIcon sx={{ fontSize: 36, color: themeColors.primary }} />
                  </Box>
                  <Box>
                    <Typography
                      variant="h3"
                      sx={{
                        fontWeight: 700,
                        background: `linear-gradient(135deg, ${themeColors.primary} 0%, ${themeColors.primaryLight} 50%, #6ee7b7 100%)`,
                        backgroundClip: "text",
                        WebkitBackgroundClip: "text",
                        color: "transparent",
                      }}
                    >
                      Mobile App Pentesting
                    </Typography>
                    <Typography variant="body1" sx={{ color: "grey.500" }}>
                      Security testing methodology for Android and iOS applications
                    </Typography>
                  </Box>
                </Box>
                
                <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap", mt: 2 }}>
                  <Chip 
                    icon={<PhoneAndroidIcon />} 
                    label="Android" 
                    size="small" 
                    sx={{ bgcolor: alpha(themeColors.primary, 0.15), color: themeColors.primary, borderColor: themeColors.primary }}
                    variant="outlined"
                  />
                  <Chip 
                    icon={<AppleIcon />} 
                    label="iOS" 
                    size="small"
                    sx={{ bgcolor: alpha(themeColors.secondary, 0.15), color: themeColors.secondary, borderColor: themeColors.secondary }}
                    variant="outlined"
                  />
                  <Chip icon={<SecurityIcon />} label="OWASP MASTG" size="small" variant="outlined" />
                  <Chip icon={<BugReportIcon />} label="Runtime Analysis" size="small" variant="outlined" />
                </Box>
              </Paper>

              {/* Section: Overview */}
              <Paper id="overview" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Typography variant="h5" sx={{ color: themeColors.primary, mb: 3, fontWeight: 600 }}>
                  Overview
                </Typography>

                {/* Quick Stats */}
                <Grid container spacing={2} sx={{ mb: 4 }}>
                  {[
                    { icon: <BuildIcon />, label: "10 Tools", color: themeColors.primary },
                    { icon: <BugReportIcon />, label: "OWASP Top 10", color: themeColors.accent },
                    { icon: <CodeIcon />, label: "Frida Scripts", color: themeColors.secondary },
                    { icon: <SecurityIcon />, label: "SSL Bypass", color: "#ef4444" },
                  ].map((stat) => (
                    <Grid item xs={6} sm={3} key={stat.label}>
                      <Paper
                        sx={{
                          p: 2,
                          textAlign: "center",
                          bgcolor: alpha(stat.color, 0.05),
                          border: `1px solid ${alpha(stat.color, 0.2)}`,
                          borderRadius: 2,
                        }}
                      >
                        <Box sx={{ color: stat.color, mb: 0.5 }}>{stat.icon}</Box>
                        <Typography variant="body2" sx={{ color: "grey.300", fontWeight: 500 }}>
                          {stat.label}
                        </Typography>
                      </Paper>
                    </Grid>
                  ))}
                </Grid>

                {/* Platform Cards */}
                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                    <Card 
                      sx={{ 
                        bgcolor: themeColors.bgNested,
                        border: "1px solid",
                        borderColor: alpha(themeColors.primary, 0.3),
                        borderRadius: 3,
                        overflow: "hidden",
                      }}
                    >
                      <Box sx={{ height: 4, background: `linear-gradient(90deg, ${themeColors.primary}, ${themeColors.primaryLight})` }} />
                      <CardContent sx={{ p: 3 }}>
                        <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                          <Box sx={{ p: 1.5, borderRadius: 2, bgcolor: alpha(themeColors.primary, 0.15) }}>
                            <PhoneAndroidIcon sx={{ color: themeColors.primary, fontSize: 28 }} />
                          </Box>
                          <Box>
                            <Typography variant="h6" sx={{ color: themeColors.primary, fontWeight: 600 }}>Android</Typography>
                            <Typography variant="caption" sx={{ color: "grey.500" }}>APK / Java / Kotlin</Typography>
                          </Box>
                          <Chip label="Easier" size="small" sx={{ ml: "auto", bgcolor: alpha(themeColors.primary, 0.2), color: themeColors.primary }} />
                        </Box>
                        <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 2 }} />
                        <Grid container spacing={1}>
                          {[
                            { icon: <DownloadIcon />, text: "APK files easily extracted" },
                            { icon: <CodeIcon />, text: "Java bytecode decompiles well" },
                            { icon: <VisibilityIcon />, text: "Emulator testing supported" },
                            { icon: <LockOpenIcon />, text: "Root detection common" },
                          ].map((item, idx) => (
                            <Grid item xs={12} key={idx}>
                              <Box sx={{ display: "flex", alignItems: "center", gap: 1.5 }}>
                                <Box sx={{ color: themeColors.primary, opacity: 0.7 }}>{item.icon}</Box>
                                <Typography variant="body2" sx={{ color: "grey.300" }}>{item.text}</Typography>
                              </Box>
                            </Grid>
                          ))}
                        </Grid>
                      </CardContent>
                    </Card>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <Card 
                      sx={{ 
                        bgcolor: themeColors.bgNested,
                        border: "1px solid",
                        borderColor: alpha(themeColors.secondary, 0.3),
                        borderRadius: 3,
                        overflow: "hidden",
                      }}
                    >
                      <Box sx={{ height: 4, background: `linear-gradient(90deg, ${themeColors.secondary}, #a855f7)` }} />
                      <CardContent sx={{ p: 3 }}>
                        <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                          <Box sx={{ p: 1.5, borderRadius: 2, bgcolor: alpha(themeColors.secondary, 0.15) }}>
                            <AppleIcon sx={{ color: themeColors.secondary, fontSize: 28 }} />
                          </Box>
                          <Box>
                            <Typography variant="h6" sx={{ color: themeColors.secondary, fontWeight: 600 }}>iOS</Typography>
                            <Typography variant="caption" sx={{ color: "grey.500" }}>IPA / Swift / Obj-C</Typography>
                          </Box>
                          <Chip label="Harder" size="small" sx={{ ml: "auto", bgcolor: alpha(themeColors.accent, 0.2), color: themeColors.accent }} />
                        </Box>
                        <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 2 }} />
                        <Grid container spacing={1}>
                          {[
                            { icon: <DownloadIcon />, text: "IPA extraction needs jailbreak" },
                            { icon: <CodeIcon />, text: "Compiled ARM, harder to RE" },
                            { icon: <VisibilityIcon />, text: "Requires macOS or device" },
                            { icon: <FingerprintIcon />, text: "Jailbreak detection common" },
                          ].map((item, idx) => (
                            <Grid item xs={12} key={idx}>
                              <Box sx={{ display: "flex", alignItems: "center", gap: 1.5 }}>
                                <Box sx={{ color: themeColors.secondary, opacity: 0.7 }}>{item.icon}</Box>
                                <Typography variant="body2" sx={{ color: "grey.300" }}>{item.text}</Typography>
                              </Box>
                            </Grid>
                          ))}
                        </Grid>
                      </CardContent>
                    </Card>
                  </Grid>
                </Grid>
              </Paper>

              {/* Section: Tools */}
              <Paper id="tools" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Typography variant="h5" sx={{ color: themeColors.primary, mb: 1, fontWeight: 600 }}>
                  Essential Tools
                </Typography>
                <Typography variant="body2" sx={{ color: themeColors.textMuted, mb: 3 }}>
                  Core toolkit for mobile application security testing
                </Typography>

              <Grid container spacing={2} sx={{ mb: 3 }}>
                {tools.map((tool) => (
                  <Grid item xs={12} sm={6} md={4} key={tool.name}>
                    <Paper
                      sx={{
                        p: 2,
                        bgcolor: "#0d1117",
                        border: "1px solid",
                        borderColor: tool.platform === "Android" ? alpha("#10b981", 0.2) : tool.platform === "iOS" ? alpha("#8b5cf6", 0.2) : alpha("#3b82f6", 0.2),
                        borderRadius: 2,
                        height: "100%",
                        transition: "all 0.2s",
                        "&:hover": {
                          borderColor: tool.platform === "Android" ? "#10b981" : tool.platform === "iOS" ? "#8b5cf6" : "#3b82f6",
                          transform: "translateY(-2px)",
                        },
                      }}
                    >
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                        <Typography sx={{ fontSize: "1.2rem" }}>{tool.icon}</Typography>
                        <Typography sx={{ color: tool.platform === "Android" ? "#10b981" : tool.platform === "iOS" ? "#8b5cf6" : "#3b82f6", fontWeight: 600 }}>
                          {tool.name}
                        </Typography>
                      </Box>
                      <Typography variant="body2" sx={{ color: "grey.400", mb: 1.5, fontSize: "0.8rem" }}>
                        {tool.purpose}
                      </Typography>
                      <Chip 
                        label={tool.platform} 
                        size="small" 
                        sx={{ 
                          fontSize: "0.7rem",
                          bgcolor: tool.platform === "Both" ? alpha("#3b82f6", 0.15) : tool.platform === "Android" ? alpha("#10b981", 0.15) : alpha("#8b5cf6", 0.15),
                          color: tool.platform === "Both" ? "#3b82f6" : tool.platform === "Android" ? "#10b981" : "#8b5cf6",
                        }} 
                      />
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 3 }} />

              <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                Quick Setup
              </Typography>

              <CodeBlock
                title="Android Analysis Setup"
                language="bash"
                code={`# Extract & decompile APK
apktool d app.apk -o app_extracted
jadx -d output/ app.apk

# Install & debug app
adb install app.apk
adb shell pm list packages | grep appname
adb logcat | grep -i "com.app.name"`}
              />

              <CodeBlock
                title="iOS Analysis Setup"
                language="bash"
                code={`# Extract IPA (jailbroken device)
scp root@device:/var/containers/Bundle/Application/*/App.app .

# Decrypt binary (if encrypted)
./flexdecrypt /path/to/App

# Start MobSF (Docker)
docker run -p 8000:8000 opensecurity/mobile-security-framework-mobsf`}
              />

              <Grid container spacing={2}>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Signing & Entitlements Checks"
                    language="bash"
                    code={`# Android signing info
apksigner verify --print-certs app.apk
keytool -printcert -jarfile app.apk | grep -E "Owner|Valid"

# iOS entitlements + provisioning
codesign -d --entitlements - App.app/Contents/MacOS/App
security cms -D -i embedded.mobileprovision | grep -E "Name|get-task-allow"

# Debuggable clues
aapt dump xmltree app.apk AndroidManifest.xml | grep debuggable
/usr/libexec/PlistBuddy -c "Print :UIFileSharingEnabled" Info.plist`}
                  />
                </Grid>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Environment Prep"
                    language="bash"
                    code={`# Android emulator with Magisk (example heads-up)
# Use Pixel x86_64 image; flash patched boot for Magisk; disable Play Protect

# Proxy trust paths
# Android: add user CA to /system/etc/security/cacerts (rooted) or network_security_config
# iOS: install CA and enable full trust (Settings > General > About > Certificate Trust)

# Baseline captures
adb logcat -c && adb logcat > launch.log
tcpdump -i any -w launch.pcap`}
                  />
                </Grid>
              </Grid>

              <Grid container spacing={3} sx={{ mt: 1 }}>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#10b981", fontWeight: 600, mb: 1 }}>
                      Android First 10 Minutes
                    </Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>
                      Quick wins before deeper reversing
                    </Typography>
                    <Box sx={{ mt: 2, display: "grid", gap: 1.5 }}>
                      {[
                        { label: "Manifest & export review", value: 65, color: "#10b981" },
                        { label: "Network surface mapped", value: 50, color: "#f59e0b" },
                        { label: "Runtime hooks planned", value: 35, color: "#3b82f6" },
                      ].map((item) => (
                        <Box key={item.label}>
                          <Box sx={{ display: "flex", justifyContent: "space-between", color: "grey.400", fontSize: "0.8rem", mb: 0.5 }}>
                            <span>{item.label}</span>
                            <span>{item.value}%</span>
                          </Box>
                          <LinearProgress
                            variant="determinate"
                            value={item.value}
                            sx={{
                              height: 6,
                              borderRadius: 999,
                              bgcolor: "rgba(255,255,255,0.06)",
                              "& .MuiLinearProgress-bar": {
                                backgroundColor: item.color,
                              },
                            }}
                          />
                        </Box>
                      ))}
                    </Box>
                    <List dense sx={{ mt: 1 }}>
                      {[
                        "Pull and open AndroidManifest.xml (aapt/apktool) to spot exported components.",
                        "Scan for hardcoded base URLs, API keys, and feature flags in assets/res/strings.xml.",
                        "Check signing cert (keytool) to tell prod vs debug builds.",
                        "Baseline logcat while launching to catch secrets and crash clues early.",
                      ].map((item, idx) => (
                        <ListItem key={item} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <Chip label={idx + 1} size="small" sx={{ width: 22, height: 22, fontSize: "0.75rem", bgcolor: alpha("#10b981", 0.15), color: "#10b981" }} />
                          </ListItemIcon>
                          <ListItemText
                            primary={item}
                            sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }}
                          />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#f59e0b", fontWeight: 600, mb: 1 }}>
                      Android Dynamic Targets
                    </Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>
                      Plan hooks and breakpoints before launching Frida
                    </Typography>
                    <List dense sx={{ mt: 1 }}>
                      {[
                        "WebView bridges (addJavascriptInterface) and custom schemes/deep links.",
                        "OkHttp/Retrofit clients, interceptors, and custom certificate pinners.",
                        "KeyStore access (KeyStore.getInstance/KeyGenerator) and keystore aliases.",
                        "Room/Realm database helpers plus encryption wrappers.",
                        "SafetyNet/Play Integrity or root checks (SafetyNetApi, DroidGuard).",
                        "Feature flags/build configs toggling debug logging or alternate hosts.",
                      ].map((item) => (
                        <ListItem key={item} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <SecurityIcon sx={{ color: "#f59e0b" }} />
                          </ListItemIcon>
                          <ListItemText
                            primary={item}
                            sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }}
                          />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
              </Grid>

              <Grid container spacing={3} sx={{ mt: 2 }}>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#8b5cf6", fontWeight: 600, mb: 1 }}>
                      iOS First 10 Minutes
                    </Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>
                      Snapshot the surface before heavy reversing
                    </Typography>
                    <List dense sx={{ mt: 1 }}>
                      {[
                        "Unpack IPA and check entitlements/provisioning profile (debuggable? get-task-allow?).",
                        "Inspect Info.plist for ATS exceptions, URL schemes, and exported custom handlers.",
                        "List embedded frameworks; note common network libs (Alamofire/URLSession) and crypto libs.",
                        "Run class-dump / frida-objc to enumerate ObjC classes and selectors (login/token/storage).",
                        "Baseline console logs with idevicesyslog while launching; capture endpoints and secrets.",
                      ].map((item) => (
                        <ListItem key={item} sx={{ py: 0.4 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <CheckCircleIcon sx={{ color: "#8b5cf6" }} fontSize="small" />
                          </ListItemIcon>
                          <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                        </ListItem>
                      ))}
                    </List>
                    <CodeBlock
                      title="iOS Recon Quick Hits"
                      language="bash"
                      code={`# Entitlements / provisioning
codesign -d --entitlements - App.app/Contents/MacOS/App
security cms -D -i embedded.mobileprovision | grep -i get-task-allow

# URL schemes
/usr/libexec/PlistBuddy -c "Print :CFBundleURLTypes" Info.plist

# Enumerate classes/selectors (jailbroken)
frida-objc dump com.app.name
idevicesyslog | grep -i "com.app.name"`}
                    />
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#3b82f6", fontWeight: 600, mb: 1 }}>
                      Device Profiles & Access
                    </Typography>
                    <TableContainer>
                      <Table size="small">
                        <TableHead>
                          <TableRow>
                            <TableCell sx={{ color: "grey.500" }}>Profile</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Pros</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Best For</TableCell>
                          </TableRow>
                        </TableHead>
                        <TableBody>
                          {[
                            ["Android Emulator", "Quick snapshots, easy proxying, Magisk possible", "Static triage, Frida/Objection hooks, UI automation"],
                            ["Rooted Android", "Real sensors & OEM stacks", "Keystore tests, SafetyNet/Play Integrity bypass attempts"],
                            ["Jailbroken iOS", "Full filesystem + Frida, class-dump", "Keychain access, runtime hooks, decrypted binaries"],
                            ["Non-jailbroken iOS + proxy", "Real-world baseline", "ATS/pinning behavior, certificate trust paths"],
                          ].map(([profile, pros, best]) => (
                            <TableRow key={profile}>
                              <TableCell sx={{ color: "grey.200" }}>{profile}</TableCell>
                              <TableCell sx={{ color: "grey.400" }}>{pros}</TableCell>
                              <TableCell sx={{ color: "grey.300" }}>{best}</TableCell>
                            </TableRow>
                          ))}
                        </TableBody>
                      </Table>
                    </TableContainer>
                    <Alert severity="info" sx={{ mt: 2, bgcolor: "rgba(16,185,129,0.08)", "& .MuiAlert-icon": { color: "#10b981" } }}>
                      Keep at least two environments: one permissive (root/jailbreak) for hooks and one stock for validating real-world impact.
                    </Alert>
                  </Paper>
                </Grid>
              </Grid>

              <CodeBlock
                title="Android Recon Snippets"
                language="bash"
                code={`# Manifest, permissions, and exported components
aapt dump xmltree app.apk AndroidManifest.xml | grep -i exported
aapt dump badging app.apk | head -n 20

# Signing cert & build variant clues
keytool -printcert -jarfile app.apk
apksigner verify --print-certs app.apk

# Quick static sweeps
grep -R \"http\" -n app_extracted/res/values* app_extracted/smali*
strings app.apk | head

# Runtime baseline
adb shell dumpsys package com.app.name | findstr /i exported
adb logcat -s \"com.app.name\" \"AndroidRuntime\"`}
              />

              <CodeBlock
                title="Smali Patch: force root check to false"
                language="smali"
                code={`.method public isDeviceRooted()Z
    .locals 1
    const/4 v0, 0x0
    # Always return false to skip root detection
    return v0
.end method

# Rebuild & resign after patching:
#   apktool b app_extracted -o patched.apk
#   apksigner sign --ks tester.keystore patched.apk`}
              />
              </Paper>

              {/* Section: Data Storage */}
              <Paper id="data-storage" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Typography variant="h5" sx={{ color: themeColors.primary, mb: 1, fontWeight: 600 }}>
                  Insecure Data Storage
                </Typography>
                <Typography variant="body2" sx={{ color: themeColors.textMuted, mb: 3 }}>
                  Mobile apps frequently store sensitive data insecurely on device
                </Typography>

                <Alert 
                  severity="warning" 
                  sx={{ 
                    mb: 3, 
                    bgcolor: alpha(themeColors.accent, 0.1),
                    "& .MuiAlert-icon": { color: themeColors.accent },
                  }}
                >
                  <strong>OWASP M9:</strong> Insecure Data Storage is a top mobile vulnerability.
                  Always check local storage for tokens, credentials, and PII!
                </Alert>

                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                  <Paper sx={{ bgcolor: "#0d1117", borderRadius: 2, overflow: "hidden", height: "100%" }}>
                    <Box sx={{ p: 2, bgcolor: alpha("#10b981", 0.1), borderBottom: "1px solid", borderColor: alpha("#10b981", 0.2) }}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                        <PhoneAndroidIcon sx={{ color: "#10b981" }} />
                        <Typography variant="h6" sx={{ color: "#10b981" }}>Android Storage</Typography>
                      </Box>
                    </Box>
                    <Box sx={{ p: 2 }}>
                      <CodeBlock
                        language="bash"
                        code={`# App's private directory
adb shell run-as com.app.name \\
  ls /data/data/com.app.name/

# SharedPreferences (often has tokens!)
adb shell cat /data/data/com.app.name/\\
  shared_prefs/*.xml

# SQLite databases
adb pull /data/data/com.app.name/databases/
sqlite3 database.db ".dump"

# External storage (world-readable!)
adb shell ls /sdcard/Android/data/com.app.name/

# Search secrets in decompiled APK
grep -rE "api[_-]?key|password|secret|token" \\
  ./app_extracted/`}
                      />
                    </Box>
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ bgcolor: "#0d1117", borderRadius: 2, overflow: "hidden", height: "100%" }}>
                    <Box sx={{ p: 2, bgcolor: alpha("#8b5cf6", 0.1), borderBottom: "1px solid", borderColor: alpha("#8b5cf6", 0.2) }}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                        <AppleIcon sx={{ color: "#8b5cf6" }} />
                        <Typography variant="h6" sx={{ color: "#8b5cf6" }}>iOS Storage</Typography>
                      </Box>
                    </Box>
                    <Box sx={{ p: 2 }}>
                      <CodeBlock
                        language="bash"
                        code={`# App sandbox (jailbroken)
cd /var/mobile/Containers/Data/\\
  Application/<UUID>/

# Check plist files
find . -name "*.plist" -exec plutil -p {} \\;

# Keychain items
./keychain-dumper

# NSUserDefaults
cat Library/Preferences/\\
  com.app.name.plist

# SQLite databases
find . -name "*.sqlite" -o -name "*.db" | \\
  xargs -I {} sqlite3 {} ".tables"`}
                      />
                    </Box>
                  </Paper>
                </Grid>
              </Grid>

              <Box sx={{ mt: 4 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Common Vulnerabilities
                </Typography>
                <Grid container spacing={2}>
                  {[
                    { issue: "Plaintext credentials in SharedPrefs", severity: "Critical", color: "#ef4444" },
                    { issue: "API keys hardcoded in source", severity: "Critical", color: "#ef4444" },
                    { issue: "JWT tokens stored unencrypted", severity: "High", color: "#f59e0b" },
                    { issue: "PII logged to console/files", severity: "High", color: "#f59e0b" },
                    { issue: "Backup flag enabled (allowBackup)", severity: "Medium", color: "#3b82f6" },
                    { issue: "Data in external storage", severity: "Medium", color: "#3b82f6" },
                  ].map((item) => (
                    <Grid item xs={12} sm={6} key={item.issue}>
                      <Paper
                        sx={{
                          p: 2,
                          bgcolor: alpha(item.color, 0.05),
                          border: `1px solid ${alpha(item.color, 0.2)}`,
                          borderRadius: 2,
                          display: "flex",
                          alignItems: "center",
                          gap: 2,
                        }}
                      >
                        <WarningIcon sx={{ color: item.color }} />
                        <Box sx={{ flex: 1 }}>
                          <Typography variant="body2" sx={{ color: "grey.200" }}>{item.issue}</Typography>
                        </Box>
                        <Chip 
                          label={item.severity} 
                          size="small" 
                          sx={{ bgcolor: alpha(item.color, 0.2), color: item.color, fontWeight: 600 }}
                        />
                      </Paper>
                    </Grid>
                    ))}
                </Grid>
              </Box>

              <Box sx={{ mt: 4 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Android Artifact Map
                </Typography>
                <TableContainer
                  component={Paper}
                  sx={{
                    bgcolor: "#0d1117",
                    borderRadius: 2,
                    border: "1px solid rgba(255,255,255,0.05)",
                  }}
                >
                  <Table size="small">
                    <TableHead>
                      <TableRow>
                        <TableCell sx={{ color: "grey.500", fontWeight: 600 }}>Artifact</TableCell>
                        <TableCell sx={{ color: "grey.500", fontWeight: 600 }}>Location</TableCell>
                        <TableCell sx={{ color: "grey.500", fontWeight: 600 }}>What to inspect</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {[
                        { artifact: "SharedPreferences", location: "/data/data/<pkg>/shared_prefs/*.xml", inspect: "Tokens, feature flags, cached credentials, remember-me flags" },
                        { artifact: "SQLite / Room", location: "/data/data/<pkg>/databases/*.db", inspect: "PII, tokens, offline caches; check if SQLCipher or custom crypto used" },
                        { artifact: "WebView cache", location: "/data/data/<pkg>/app_webview/", inspect: "Cookies, cached responses, session replay risk" },
                        { artifact: "External storage", location: "/sdcard/Android/data/<pkg>/", inspect: "Images, PDFs, logs written world-readable" },
                        { artifact: "Keystore metadata", location: "KeyStore alias names (logcat/code)", inspect: "Alias names leak purpose; check if StrongBox/Hardware-backed required" },
                        { artifact: "Crash/log files", location: "/data/data/<pkg>/files/ /cache/", inspect: "Stack traces, API endpoints, verbose logging toggles" },
                      ].map((row) => (
                        <TableRow key={row.artifact} hover>
                          <TableCell sx={{ color: "grey.200" }}>{row.artifact}</TableCell>
                          <TableCell sx={{ color: "grey.400", fontFamily: "'Fira Code', monospace", fontSize: "0.85rem" }}>
                            {row.location}
                          </TableCell>
                          <TableCell sx={{ color: "grey.300" }}>{row.inspect}</TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
                <Alert
                  severity="info"
                  sx={{
                    mt: 2,
                    bgcolor: alpha("#10b981", 0.08),
                    border: `1px solid ${alpha("#10b981", 0.2)}`,
                    "& .MuiAlert-icon": { color: "#10b981" },
                  }}
                >
                  <strong>Keystore reality:</strong> Android Keystore entries cannot be exported, but keys can often be abused if apps allow decrypt/sign without user auth.
                  Hook the KeyStore alias and padding/mode to reproduce decryption in-memory.
                </Alert>
              </Box>

              <Box sx={{ mt: 4 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 1.5 }}>
                  Storage Testing Playbook
                </Typography>
                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Typography variant="subtitle1" sx={{ color: "#10b981", fontWeight: 600, mb: 1 }}>
                        Steps (Android/iOS)
                      </Typography>
                      <List dense>
                        {[
                          "Pull app sandbox (run-as/root/jailbreak) and enumerate SharedPrefs/NSUserDefaults, databases, caches, and logs.",
                          "Search for secrets in XML/plist/JSON; diff against in-memory values via Frida to see what gets decrypted at runtime.",
                          "Check backup/export paths: allowBackup flag (Android) and iTunes backup permissions (iOS) for data exfil via backup.",
                          "Verify platform crypto: AndroidKeyStore alias strength (hardware-backed?), iOS Keychain accessibility (kSecAttrAccessible).",
                          "Attempt downgrade: toggle offline/airplane mode to see if tokens are cached or stored long-term.",
                        ].map((item) => (
                          <ListItem key={item} sx={{ py: 0.4 }}>
                            <ListItemIcon sx={{ minWidth: 28 }}>
                              <CheckCircleIcon sx={{ color: "#10b981" }} fontSize="small" />
                            </ListItemIcon>
                            <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                          </ListItem>
                        ))}
                      </List>
                    </Paper>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <CodeBlock
                      title="Quick Greps & Logs"
                      language="bash"
                      code={`# Android: look for secrets
  grep -R \"Bearer|token|secret|key\" -n app_extracted/
  adb logcat | grep -i \"token\"
  
  # iOS: plist + keychain clues (jailbroken)
  plutil -p Library/Preferences/*.plist | head
  keychain_dumper | grep -i token
  
  # Room/Realm/SQLCipher checks
  file /data/data/<pkg>/databases/* | grep SQLite
  strings /data/data/<pkg>/databases/* | head
  
  # SQLCipher quick test (prompts if encrypted)
  sqlcipher /data/data/<pkg>/databases/secure.db \"PRAGMA key='test'; .tables\"
  
  # Realm file header check
  xxd -l 16 /data/data/<pkg>/databases/default.realm`}
                    />
                  </Grid>
                </Grid>
              </Box>

              <Box sx={{ mt: 3 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Pinning Bypass Options
                </Typography>
                <Grid container spacing={3}>
                  <Grid item xs={12} md={7}>
                    <TableContainer component={Paper} sx={{ bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Table size="small">
                        <TableHead>
                          <TableRow>
                            <TableCell sx={{ color: "grey.500" }}>Framework</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Approach</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Notes</TableCell>
                          </TableRow>
                        </TableHead>
                        <TableBody>
                          {[
                            ["OkHttp/Retrofit", "Hook CertificatePinner/TrustManager with Frida; repack network_security_config to trust user CAs", "Debug builds often trust user CAs if <certificates src=\"user\"/> present"],
                            ["WebView", "Hook WebViewClient.onReceivedSslError and SslErrorHandler.proceed()", "Look for custom WebViewClient overrides that bypass errors"],
                            ["NSURLSession (iOS)", "Hook -URLSession:didReceiveChallenge:completionHandler: to always trust", "Alternatively drop a custom NSURLProtocol to intercept requests"],
                            ["TrustKit/AFNetworking", "Hook pin validation methods or replace serverTrust evaluation", "Class-dump to locate TSKPinValidation or AFURLSessionManager"],
                            ["Custom native libs", "Frida Gum + Interceptor on SSL_write/SSL_connect/objc_msgSend", "Use frida-trace -U -i \"SSL_*\" -f <pkg> for quick wins"],
                          ].map(([fw, approach, note]) => (
                            <TableRow key={fw}>
                              <TableCell sx={{ color: "grey.200" }}>{fw}</TableCell>
                              <TableCell sx={{ color: "grey.300" }}>{approach}</TableCell>
                              <TableCell sx={{ color: "grey.400" }}>{note}</TableCell>
                            </TableRow>
                          ))}
                        </TableBody>
                      </Table>
                    </TableContainer>
                  </Grid>
                  <Grid item xs={12} md={5}>
                    <CodeBlock
                      title="API Replay & GraphQL Probes"
                      language="bash"
                      code={`# Replay captured request (HTTPie)
http -f POST https://api.example.com/login \\
  Authorization:"Bearer <token>" user_id:=123

# IDOR/GraphQL exploration
http https://api.example.com/graphql \\
  query='{me{id,email} users{ id email }}'

# Mitmproxy inline script to fuzz IDs
mitmdump -s idor_fuzz.py -p 8080

# Burp Repeater: remove pins/headers and observe server behavior`}
                    />
                  </Grid>
                </Grid>
              </Box>
              </Paper>

              {/* Section: Network */}
              <Paper id="network" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Typography variant="h5" sx={{ color: themeColors.primary, mb: 1, fontWeight: 600 }}>
                  Network Security Testing
                </Typography>
                <Typography variant="body2" sx={{ color: themeColors.textMuted, mb: 3 }}>
                  Intercept and analyze mobile app network traffic
                </Typography>

                <Grid container spacing={3} sx={{ mb: 3 }}>
                  <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 3, bgcolor: themeColors.bgNested, borderRadius: 2, border: `1px solid ${themeColors.border}` }}>
                      <Typography variant="h6" sx={{ color: themeColors.primary, mb: 2, display: "flex", alignItems: "center", gap: 1 }}>
                        <PhoneAndroidIcon /> Android Proxy Setup
                      </Typography>
                      <List dense>
                        {[
                          "Export Burp CA certificate (.der)",
                          "Push to device: adb push burp.der /sdcard/",
                          "Settings > Security > Install from storage",
                          "Set WiFi proxy to <your-ip>:8080",
                        ].map((step, idx) => (
                          <ListItem key={idx} sx={{ py: 0.5 }}>
                            <ListItemIcon sx={{ minWidth: 28 }}>
                              <Chip label={idx + 1} size="small" sx={{ width: 20, height: 20, fontSize: "0.7rem", bgcolor: themeColors.primary }} />
                            </ListItemIcon>
                            <ListItemText primary={step} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                          </ListItem>
                        ))}
                      </List>
                      <Alert severity="warning" sx={{ mt: 2, py: 0 }}>
                        <Typography variant="caption">Android 7+: CA certs must be in system store or app must trust user certs</Typography>
                      </Alert>
                    </Paper>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 3, bgcolor: themeColors.bgNested, borderRadius: 2, border: `1px solid ${themeColors.border}` }}>
                      <Typography variant="h6" sx={{ color: themeColors.secondary, mb: 2, display: "flex", alignItems: "center", gap: 1 }}>
                        <AppleIcon /> iOS Proxy Setup
                      </Typography>
                      <List dense>
                      {[
                        "Navigate to http://burp in Safari",
                        "Download & install CA Certificate",
                        "Settings > General > About > Certificate Trust",
                        "Enable full trust for Burp cert",
                        "Set WiFi proxy to <your-ip>:8080",
                      ].map((step, idx) => (
                        <ListItem key={idx} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <Chip label={idx + 1} size="small" sx={{ width: 20, height: 20, fontSize: "0.7rem", bgcolor: "#8b5cf6" }} />
                          </ListItemIcon>
                          <ListItemText primary={step} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
              </Grid>

              <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                What to Look For
              </Typography>
              <Grid container spacing={2}>
                {[
                  { icon: <WarningIcon />, issue: "HTTP instead of HTTPS", desc: "Sensitive data transmitted in plaintext", color: "#ef4444" },
                  { icon: <LockOpenIcon />, issue: "No certificate pinning", desc: "Easy to intercept with proxy", color: "#f59e0b" },
                  { icon: <VisibilityIcon />, issue: "Tokens in URLs/logs", desc: "Exposed in server logs & history", color: "#f59e0b" },
                  { icon: <SecurityIcon />, issue: "Weak authentication", desc: "Predictable tokens, no expiry", color: "#3b82f6" },
                  { icon: <BugReportIcon />, issue: "IDOR vulnerabilities", desc: "Change IDs to access other users", color: "#ef4444" },
                  { icon: <CodeIcon />, issue: "API key in requests", desc: "Hardcoded keys in traffic", color: "#f59e0b" },
                ].map((item) => (
                  <Grid item xs={12} sm={6} key={item.issue}>
                    <Paper
                      sx={{
                        p: 2,
                        bgcolor: alpha(item.color, 0.05),
                        border: `1px solid ${alpha(item.color, 0.15)}`,
                        borderRadius: 2,
                      }}
                    >
                      <Box sx={{ display: "flex", alignItems: "flex-start", gap: 1.5 }}>
                        <Box sx={{ color: item.color, mt: 0.3 }}>{item.icon}</Box>
                        <Box>
                          <Typography variant="body2" sx={{ color: "grey.200", fontWeight: 500 }}>{item.issue}</Typography>
                          <Typography variant="caption" sx={{ color: "grey.500" }}>{item.desc}</Typography>
                        </Box>
                      </Box>
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 3 }} />

              <Box sx={{ mt: 2 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Android Network Deep Dive
                </Typography>
                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Typography variant="subtitle1" sx={{ color: "#10b981", fontWeight: 600, mb: 1 }}>
                        Checklist before attacking
                      </Typography>
                      <List dense>
                        {[
                          "Confirm if android:usesCleartextTraffic=\"true\" or network_security_config enables cleartext.",
                          "Identify OkHttp/Retrofit clients and look for custom CertificatePinner or HostnameVerifier overrides.",
                          "Check if debug overrides trust user CAs (debuggable builds) but release pins system only.",
                          "Inspect WebViewClient.onReceivedSslError overrides that may silently ignore errors.",
                          "Look for gRPC/GraphQL endpoints; test with replay and mutation not just REST.",
                        ].map((item) => (
                          <ListItem key={item} sx={{ py: 0.5 }}>
                            <ListItemIcon sx={{ minWidth: 28 }}>
                              <SecurityIcon sx={{ color: "#10b981" }} />
                            </ListItemIcon>
                            <ListItemText
                              primary={item}
                              sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }}
                            />
                          </ListItem>
                        ))}
                      </List>
                      <Alert severity="warning" sx={{ mt: 1, bgcolor: alpha("#f59e0b", 0.08), "& .MuiAlert-icon": { color: "#f59e0b" } }}>
                        <Typography variant="caption">
                          Android 7+ trusts user CAs only for debuggable apps unless <code>src=\"user\"</code> is specified in <code>network_security_config</code>.
                        </Typography>
                      </Alert>
                    </Paper>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <CodeBlock
                      title="network_security_config.xml (hardened)"
                      language="xml"
                      code={`<network-security-config>
  <domain-config cleartextTrafficPermitted="false">
    <domain includeSubdomains="true">api.example.com</domain>
    <pin-set expiration="2025-12-31">
      <pin digest="SHA-256">base64==</pin>
      <pin digest="SHA-256">backupPin==</pin>
    </pin-set>
  </domain-config>
  <debug-overrides>
    <trust-anchors>
      <certificates src="system" />
      <!-- If this is present, proxies will work on debuggable builds -->
      <certificates src="user" />
    </trust-anchors>
  </debug-overrides>
</network-security-config>`}
                    />
                    <CodeBlock
                      title="Pinning bypass via repack"
                      language="bash"
                      code={`# Make the app trust user CAs (emulators/rooted devices)
apktool d app.apk -o app_extracted
sed -i '' 's/src=\"system\"/src=\"user\"/g' app_extracted/res/xml/network_security_config.xml
apktool b app_extracted -o patched.apk
apksigner sign --ks tester.keystore patched.apk

# Or hook CertificatePinner at runtime (Frida)
frida -U -f com.app.name -l bypass.js --no-pause`}
                    />
                  </Grid>
                </Grid>
              </Box>
              </Paper>

              {/* Section: Frida */}
              <Paper id="frida" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Typography variant="h5" sx={{ color: themeColors.primary, mb: 1, fontWeight: 600 }}>
                  Frida Dynamic Instrumentation
                </Typography>
                <Typography variant="body2" sx={{ color: themeColors.textMuted, mb: 3 }}>
                  Inject JavaScript into running apps to bypass security controls
                </Typography>

                <Alert 
                  severity="info" 
                  sx={{ 
                    mb: 3,
                    bgcolor: alpha("#3b82f6", 0.1),
                    "& .MuiAlert-icon": { color: "#3b82f6" },
                  }}
                >
                  <strong>Frida</strong> lets you hook functions, modify return values, and trace execution 
                  at runtime. Perfect for bypassing SSL pinning, root detection, and debugging obfuscated apps.
                </Alert>

                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                    <CodeBlock
                      title="Frida Setup"
                      language="bash"
                      code={`# Install Frida tools
pip install frida-tools

# Download frida-server for your device arch
# https://github.com/frida/frida/releases

# Push & run on Android (rooted)
adb push frida-server /data/local/tmp/
adb shell chmod +x /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &

# List running apps
frida-ps -U

# Attach to running app
frida -U -n "App Name" -l script.js

# Spawn app with script
frida -U -f com.app.name -l script.js`}
                  />
                </Grid>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Objection (Frida Made Easy)"
                    language="bash"
                    code={`# Install objection
pip install objection

# Explore running app
objection -g "com.app.name" explore

# Common bypasses (inside objection)
android sslpinning disable
android root disable
ios sslpinning disable
ios jailbreak disable

# Dump keychain/keystore
ios keychain dump
android keystore list

# Search classes
android hooking search classes password
ios hooking search classes Token`}
                  />
                </Grid>
              </Grid>

              <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 3 }} />

              <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                Common Bypass Scripts
              </Typography>

              <Accordion defaultExpanded sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <LockOpenIcon sx={{ color: "#10b981" }} />
                    <Typography sx={{ color: "#10b981" }}>SSL Pinning Bypass (Android)</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    // Bypass TrustManager
    var TrustManager = Java.use('javax.net.ssl.X509TrustManager');
    var SSLContext = Java.use('javax.net.ssl.SSLContext');
    
    var TrustAllCerts = Java.registerClass({
        name: 'com.bypass.TrustAllCerts',
        implements: [TrustManager],
        methods: {
            checkClientTrusted: function(chain, authType) {},
            checkServerTrusted: function(chain, authType) {},
            getAcceptedIssuers: function() { return []; }
        }
    });
    
    var ctx = SSLContext.getInstance("TLS");
    ctx.init(null, [TrustAllCerts.$new()], null);
    console.log("[+] SSL Pinning Bypassed!");
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <FingerprintIcon sx={{ color: "#f59e0b" }} />
                    <Typography sx={{ color: "#f59e0b" }}>Root Detection Bypass</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    // Hook common root check methods
    var RootBeer = Java.use("com.scottyab.rootbeer.RootBeer");
    RootBeer.isRooted.implementation = function() {
        console.log("[+] RootBeer.isRooted() bypassed");
        return false;
    };
    
    // Hook Runtime.exec for "su" checks
    var Runtime = Java.use("java.lang.Runtime");
    Runtime.exec.overload('java.lang.String').implementation = function(cmd) {
        if (cmd.indexOf("su") !== -1) {
            console.log("[+] Blocked: " + cmd);
            throw new Error("Command not found");
        }
        return this.exec(cmd);
    };
    
    // Hook File.exists for path checks
    var File = Java.use("java.io.File");
    File.exists.implementation = function() {
        var path = this.getAbsolutePath();
        if (path.indexOf("su") !== -1 || path.indexOf("Superuser") !== -1) {
            console.log("[+] Hidden: " + path);
            return false;
        }
        return this.exists();
    };
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <WifiIcon sx={{ color: "#10b981" }} />
                    <Typography sx={{ color: "#10b981" }}>Log OkHttp Requests (Android)</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    var RequestBuilder = Java.use("okhttp3.Request$Builder");
    RequestBuilder.build.implementation = function() {
        var req = this.build();
        console.log("[HTTP] " + req.method() + " " + req.url());
        var headers = req.headers();
        for (var i = 0; i < headers.size(); i++) {
            var name = headers.name(i);
            var value = headers.value(i);
            console.log("  " + name + ": " + value);
        }
        return req;
    };
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <LockOpenIcon sx={{ color: "#3b82f6" }} />
                    <Typography sx={{ color: "#3b82f6" }}>Trace Crypto (Cipher / KeySpec)</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    var Cipher = Java.use("javax.crypto.Cipher");
    var SecretKeySpec = Java.use("javax.crypto.spec.SecretKeySpec");
    var IvParameterSpec = Java.use("javax.crypto.spec.IvParameterSpec");

    SecretKeySpec.$init.overload('[B', 'java.lang.String').implementation = function(key, alg) {
        console.log("[+] KeySpec created for " + alg + " len=" + key.length);
        return this.$init(key, alg);
    };

    IvParameterSpec.$init.overload('[B').implementation = function(iv) {
        console.log("[+] IV: " + bytesToHex(iv));
        return this.$init(iv);
    };

    Cipher.doFinal.overload('[B').implementation = function(data) {
        console.log("[+] Cipher " + this.getAlgorithm() + " opmode=" + this.getOpmode());
        console.log("    in : " + bytesToHex(data));
        var out = this.doFinal(data);
        console.log("    out: " + bytesToHex(out));
        return out;
    };

    function bytesToHex(arr) {
        return Array.prototype.map.call(Java.array('byte', arr), function(b) {
            return ('0' + (b & 0xff).toString(16)).slice(-2);
        }).join('');
    }
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <AppleIcon sx={{ color: "#8b5cf6" }} />
                    <Typography sx={{ color: "#8b5cf6" }}>iOS Hooks: NSURLSession + Keychain</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    title="Trust all challenges (Objective-C)"
                    language="javascript"
                    code={`if (ObjC.available) {
  const NSURLSession = ObjC.classes.NSURLSession;
  const delegateCls = ObjC.classes.NSURLSessionDelegate;
  Interceptor.attach(delegateCls['- URLSession:didReceiveChallenge:completionHandler:'].implementation, {
    onEnter(args) {
      const handler = new ObjC.Block(args[4]);
      handler.implementation = function(_chal, _cred) {
        const trust = ObjC.classes.NSURLCredential.credentialWithTrust_(args[3].value());
        return handler.original(_chal, trust);
      };
      console.log("[+] TLS challenge bypassed");
    }
  });
}`}
                  />
                  <CodeBlock
                    title="Log Keychain fetches (SecItemCopyMatching)"
                    language="javascript"
                    code={`const resolver = new ApiResolver("module");
resolver.enumerateMatches("exports:*/SecItemCopyMatching", {
  onMatch: function(match) {
    Interceptor.attach(match.address, {
      onEnter(args) {
        console.log("[+] Keychain query");
      },
      onLeave(retval) {
        console.log("[+] Keychain result: " + retval);
      }
    });
  },
  onComplete: function() {}
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <SecurityIcon sx={{ color: "#3b82f6" }} />
                    <Typography sx={{ color: "#3b82f6" }}>Stealth & Trace Targets</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <List dense>
                    {[
                      "Spawn with --no-pause to minimize startup lag; attach late only if anti-debug present in early code.",
                      "Hide Frida process name: rename frida-server binary; consider tcp port randomization on rooted devices.",
                      "Trace families: SSL_* (OpenSSL), objc_msgSend (iOS), JNI_OnLoad + RegisterNatives (Android native), KeyStore/Keychain APIs.",
                      "Log call stacks for sensitive calls (crypto, keystore, jailbreak checks) to map code paths quickly.",
                    ].map((item) => (
                      <ListItem key={item} sx={{ py: 0.3 }}>
                        <ListItemIcon sx={{ minWidth: 28 }}>
                          <CheckCircleIcon sx={{ color: "#3b82f6" }} fontSize="small" />
                        </ListItemIcon>
                        <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                      </ListItem>
                    ))}
                  </List>
                  <CodeBlock
                    title="Quick trace targets"
                    language="bash"
                    code={`# TLS / crypto
frida-trace -U -f com.app.name -i "SSL_*" -i "EVP_*"

# Android keystore + integrity APIs
frida-trace -U -f com.app.name -I "android.security.*" -I "com.google.android.gms.safetynet.*"

# iOS Objective-C messaging (heavy output)
frida-trace -U -f com.app.name -m "-[NSURLSession* *]"`}
                  />
                </AccordionDetails>
              </Accordion>

              <Alert severity="success" sx={{ mt: 3, bgcolor: alpha(themeColors.primary, 0.1), "& .MuiAlert-icon": { color: themeColors.primary } }}>
                <strong>Pro Tip:</strong> Use <code>frida-trace</code> to quickly trace method calls:
                <br />
                <code>frida-trace -U -i "SSL*" -n "App Name"</code>
              </Alert>
              </Paper>

              {/* Section: Checklist */}
              <Paper id="checklist" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: themeColors.bgCard, border: `1px solid ${themeColors.border}` }}>
                <Typography variant="h5" sx={{ color: themeColors.primary, mb: 1, fontWeight: 600 }}>
                  Mobile Pentest Checklist
                </Typography>
                <Typography variant="body2" sx={{ color: themeColors.textMuted, mb: 3 }}>
                  Comprehensive testing checklist based on OWASP MASTG
                </Typography>

                <Paper sx={{ p: 3, mb: 3, bgcolor: themeColors.bgNested, border: `1px solid ${themeColors.border}`, borderRadius: 2 }}>
                  <Typography variant="h6" sx={{ color: themeColors.primary, mb: 1 }}>
                    Engagement Flow (Day 1-2)
                  </Typography>
                  <List dense>
                    {[
                      "Baseline: collect hashes, app version/build, device profile, and proxy/log setup; snapshot VM/device state.",
                      "Static pass: manifest/Info.plist/entitlements, strings/secrets, exported components, network config, library inventory.",
                      "Dynamic plan: choose proxy/pinning bypass, Frida hooks (root/jailbreak/keystore/URLSession/OkHttp), and target flows (auth/payment/upload).",
                      "Execution: record PCAP + device logs + Frida output; capture screenshots/requests for each finding.",
                      "Wrap-up: dump storage (prefs/keychain/db), export modified APK/IPA and scripts used, compile IOC list (hosts, pins, keys).",
                    ].map((item) => (
                      <ListItem key={item} sx={{ py: 0.35 }}>
                        <ListItemIcon sx={{ minWidth: 28 }}>
                          <CheckCircleIcon sx={{ color: themeColors.primary }} fontSize="small" />
                        </ListItemIcon>
                        <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300" } }} />
                      </ListItem>
                    ))}
                  </List>
                </Paper>

                <Paper sx={{ p: 3, mb: 3, bgcolor: themeColors.bgNested, border: `1px solid ${themeColors.border}`, borderRadius: 2 }}>
                  <Typography variant="h6" sx={{ color: "#3b82f6", mb: 1 }}>
                    Evidence Capture Checklist
                  </Typography>
                  <List dense>
                    {[
                      "Keep copies of original APK/IPA hashes, signing info, and build numbers.",
                      "Save proxy history (Burp/Mitmproxy) + PCAPs with timestamps for replay.",
                      "Export Frida/Objection scripts and terminal logs for reproducibility.",
                    "Capture storage artifacts (prefs/db/plist/realm) with hashes and paths.",
                    "Document bypass steps (pinning/root/jailbreak) and patched binaries used.",
                  ].map((item) => (
                    <ListItem key={item} sx={{ py: 0.35 }}>
                      <ListItemIcon sx={{ minWidth: 28 }}>
                        <CheckCircleIcon sx={{ color: "#3b82f6" }} fontSize="small" />
                      </ListItemIcon>
                      <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300" } }} />
                    </ListItem>
                  ))}
                </List>
              </Paper>

              <Grid container spacing={3}>
                {[
                  { 
                    category: "Static Analysis", 
                    icon: <CodeIcon />,
                    color: "#3b82f6",
                    items: [
                      "Decompile APK/IPA and review source",
                      "Search for hardcoded secrets & API keys",
                      "Check AndroidManifest.xml permissions",
                      "Review network_security_config.xml",
                      "Analyze third-party libraries for CVEs",
                      "Check for debug flags and logging",
                    ]
                  },
                  { 
                    category: "Data Storage", 
                    icon: <StorageIcon />,
                    color: "#f59e0b",
                    items: [
                      "Check SharedPreferences/NSUserDefaults",
                      "Examine SQLite databases for PII",
                      "Review Keychain/Keystore usage",
                      "Check logs for sensitive data",
                      "Verify backup flag (allowBackup)",
                      "Test clipboard data exposure",
                    ]
                  },
                  { 
                    category: "Network Security", 
                    icon: <WifiIcon />,
                    color: "#10b981",
                    items: [
                      "Test for SSL/TLS pinning",
                      "Intercept API traffic with proxy",
                      "Check for HTTP endpoints",
                      "Analyze authentication tokens",
                      "Test for IDOR vulnerabilities",
                      "Review API error messages",
                    ]
                  },
                  { 
                    category: "Runtime Analysis", 
                    icon: <BugReportIcon />,
                    color: "#ef4444",
                    items: [
                      "Bypass root/jailbreak detection",
                      "Hook and modify sensitive functions",
                      "Test biometric authentication bypass",
                      "Check runtime integrity checks",
                      "Test anti-tampering mechanisms",
                      "Analyze memory for secrets",
                    ]
                  },
                ].map((section) => (
                  <Grid item xs={12} md={6} key={section.category}>
                    <Paper 
                      sx={{ 
                        bgcolor: "#0d1117", 
                        borderRadius: 2, 
                        overflow: "hidden",
                        border: `1px solid ${alpha(section.color, 0.2)}`,
                        height: "100%",
                      }}
                    >
                      <Box 
                        sx={{ 
                          p: 2, 
                          bgcolor: alpha(section.color, 0.1),
                          borderBottom: `1px solid ${alpha(section.color, 0.2)}`,
                          display: "flex",
                          alignItems: "center",
                          gap: 1.5,
                        }}
                      >
                        <Box sx={{ color: section.color }}>{section.icon}</Box>
                        <Typography variant="h6" sx={{ color: section.color, fontWeight: 600 }}>
                          {section.category}
                        </Typography>
                      </Box>
                      <Box sx={{ p: 2 }}>
                        {section.items.map((item, idx) => (
                          <Box 
                            key={idx} 
                            sx={{ 
                              display: "flex", 
                              alignItems: "center", 
                              gap: 1.5, 
                              py: 0.75,
                              borderBottom: idx < section.items.length - 1 ? "1px solid rgba(255,255,255,0.03)" : "none",
                            }}
                          >
                            <CheckCircleIcon sx={{ fontSize: 16, color: "grey.600" }} />
                            <Typography variant="body2" sx={{ color: "grey.300" }}>{item}</Typography>
                          </Box>
                        ))}
                      </Box>
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Box sx={{ mt: 4, p: 3, bgcolor: alpha(themeColors.secondary, 0.1), borderRadius: 2, border: `1px solid ${alpha(themeColors.secondary, 0.2)}` }}>
                <Typography variant="h6" sx={{ color: themeColors.secondary, mb: 2 }}>
                  Essential Resources
                </Typography>
                <Grid container spacing={2}>
                  {[
                    { name: "OWASP MASTG", desc: "Mobile Application Security Testing Guide" },
                    { name: "OWASP MASVS", desc: "Mobile Application Security Verification Standard" },
                    { name: "Frida Codeshare", desc: "Community Frida scripts" },
                    { name: "MobSF Docs", desc: "Mobile Security Framework documentation" },
                  ].map((resource) => (
                    <Grid item xs={12} sm={6} key={resource.name}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                        <CheckCircleIcon sx={{ color: themeColors.secondary, fontSize: 18 }} />
                        <Box>
                          <Typography variant="body2" sx={{ color: "grey.200", fontWeight: 500 }}>{resource.name}</Typography>
                          <Typography variant="caption" sx={{ color: "grey.500" }}>{resource.desc}</Typography>
                        </Box>
                      </Box>
                    </Grid>
                  ))}
                </Grid>
              </Box>
              </Paper>

              {/* Quiz Section */}
              <QuizSection />
            </Grid>
          </Grid>

          {/* Mobile Navigation Drawer */}
          <Drawer
            anchor="left"
            open={mobileNavOpen}
            onClose={() => setMobileNavOpen(false)}
            sx={{
              display: { xs: "block", md: "none" },
              "& .MuiDrawer-paper": {
                width: 280,
                bgcolor: themeColors.bgCard,
                borderRight: `1px solid ${themeColors.border}`,
              },
            }}
          >
            {sidebarNav}
          </Drawer>

          {/* FABs */}
          <Fab
            color="primary"
            size="medium"
            onClick={() => setMobileNavOpen(true)}
            sx={{
              display: { xs: "flex", md: "none" },
              position: "fixed",
              bottom: 80,
              right: 16,
              bgcolor: themeColors.primary,
              "&:hover": { bgcolor: themeColors.primaryLight },
            }}
          >
            <MenuIcon />
          </Fab>
          <Fab
            size="small"
            onClick={() => window.scrollTo({ top: 0, behavior: "smooth" })}
            sx={{
              position: "fixed",
              bottom: 16,
              right: 16,
              bgcolor: alpha(themeColors.primary, 0.2),
              color: themeColors.primary,
              "&:hover": { bgcolor: alpha(themeColors.primary, 0.3) },
            }}
          >
            <KeyboardArrowUpIcon />
          </Fab>
        </Container>
      </Box>
    </LearnPageLayout>
  );
};

export default MobilePentestPage;
