import React, { useState } from "react";
import LearnPageLayout from "../components/LearnPageLayout";
import {
  Box,
  Container,
  Typography,
  Paper,
  Tabs,
  Tab,
  Chip,
  Button,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Alert,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  IconButton,
  Tooltip,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Grid,
  Card,
  CardContent,
  alpha,
  Divider,
  LinearProgress,
} from "@mui/material";
import ArrowBackIcon from "@mui/icons-material/ArrowBack";
import ExpandMoreIcon from "@mui/icons-material/ExpandMore";
import ContentCopyIcon from "@mui/icons-material/ContentCopy";
import PhoneAndroidIcon from "@mui/icons-material/PhoneAndroid";
import AppleIcon from "@mui/icons-material/Apple";
import SecurityIcon from "@mui/icons-material/Security";
import StorageIcon from "@mui/icons-material/Storage";
import WifiIcon from "@mui/icons-material/Wifi";
import BuildIcon from "@mui/icons-material/Build";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import WarningIcon from "@mui/icons-material/Warning";
import BugReportIcon from "@mui/icons-material/BugReport";
import CodeIcon from "@mui/icons-material/Code";
import LockOpenIcon from "@mui/icons-material/LockOpen";
import FingerprintIcon from "@mui/icons-material/Fingerprint";
import DownloadIcon from "@mui/icons-material/Download";
import VisibilityIcon from "@mui/icons-material/Visibility";
import { useNavigate } from "react-router-dom";

interface TabPanelProps {
  children?: React.ReactNode;
  index: number;
  value: number;
}

function TabPanel(props: TabPanelProps) {
  const { children, value, index, ...other } = props;
  return (
    <div role="tabpanel" hidden={value !== index} {...other}>
      {value === index && <Box sx={{ py: 3 }}>{children}</Box>}
    </div>
  );
}

const CodeBlock: React.FC<{ code: string; language?: string; title?: string }> = ({
  code,
  language = "bash",
  title,
}) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = () => {
    navigator.clipboard.writeText(code);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <Paper
      sx={{
        bgcolor: "#0d1117",
        borderRadius: 2,
        position: "relative",
        my: 2,
        border: "1px solid rgba(16, 185, 129, 0.2)",
        overflow: "hidden",
      }}
    >
      {title && (
        <Box sx={{ px: 2, py: 1, bgcolor: "rgba(16, 185, 129, 0.1)", borderBottom: "1px solid rgba(16, 185, 129, 0.2)" }}>
          <Typography variant="subtitle2" sx={{ color: "#10b981", fontWeight: 600 }}>{title}</Typography>
        </Box>
      )}
      <Box sx={{ position: "absolute", top: title ? 40 : 8, right: 8, display: "flex", gap: 1 }}>
        <Chip label={language} size="small" sx={{ bgcolor: alpha("#10b981", 0.2), color: "#10b981", fontSize: "0.7rem" }} />
        <Tooltip title={copied ? "Copied!" : "Copy"}>
          <IconButton size="small" onClick={handleCopy} sx={{ color: copied ? "#10b981" : "#888" }}>
            <ContentCopyIcon fontSize="small" />
          </IconButton>
        </Tooltip>
      </Box>
      <Box
        component="pre"
        sx={{
          m: 0,
          p: 2,
          pt: 3,
          overflow: "auto",
          fontFamily: "'Fira Code', 'Consolas', monospace",
          fontSize: "0.8rem",
          color: "#e6edf3",
          lineHeight: 1.6,
        }}
      >
        {code}
      </Box>
    </Paper>
  );
};

const MobilePentestPage: React.FC = () => {
  const navigate = useNavigate();
  const [tabValue, setTabValue] = useState(0);

  const handleTabChange = (_: React.SyntheticEvent, newValue: number) => {
    setTabValue(newValue);
  };

  const tools = [
    { name: "Frida", purpose: "Dynamic instrumentation & hooking", platform: "Both", icon: "üß™" },
    { name: "Objection", purpose: "Runtime exploration (Frida-based)", platform: "Both", icon: "üéØ" },
    { name: "MobSF", purpose: "Automated static/dynamic analysis", platform: "Both", icon: "üîç" },
    { name: "jadx-gui", purpose: "Android APK decompiler to Java/Kotlin", platform: "Android", icon: "üì¶" },
    { name: "apktool", purpose: "APK unpacking/repacking/smali", platform: "Android", icon: "üõ†Ô∏è" },
    { name: "aapt / aapt2", purpose: "Manifest, resources, and certificate inspection", platform: "Android", icon: "üóÇÔ∏è" },
    { name: "adb", purpose: "Android Debug Bridge CLI", platform: "Android", icon: "üì±" },
    { name: "mitmproxy / Burp", purpose: "HTTP/S interception & scripting", platform: "Both", icon: "üåê" },
    { name: "r2frida", purpose: "Radare2 + Frida reversing", platform: "Android", icon: "üß≠" },
    { name: "Hopper/IDA", purpose: "iOS binary disassembly", platform: "iOS", icon: "üíª" },
    { name: "class-dump", purpose: "Extract ObjC headers from iOS apps", platform: "iOS", icon: "üìã" },
    { name: "Cycript", purpose: "iOS runtime manipulation", platform: "iOS", icon: "‚ö°" },
  ];

  const pageContext = `This page covers mobile application penetration testing including:
- Android and iOS security fundamentals
- Mobile pentest tools: Frida, Objection, MobSF, jadx, apktool, mitmproxy
- Static analysis of APKs and IPAs
- Dynamic analysis and runtime hooking
- Certificate pinning bypass techniques
- Data storage security assessment
- Network traffic interception
- Common mobile vulnerabilities and exploitation
- Mobile app assessment methodology`;

  return (
    <LearnPageLayout pageTitle="Mobile Pentest" pageContext={pageContext}>
    <Box sx={{ minHeight: "100vh", bgcolor: "#0a0a0f", py: 4 }}>
      <Container maxWidth="lg">
        {/* Header */}
        <Box sx={{ mb: 4 }}>
          <Button
            startIcon={<ArrowBackIcon />}
            onClick={() => navigate("/learn")}
            sx={{ mb: 2, color: "grey.400", "&:hover": { color: "#10b981" } }}
          >
            Back to Learn Hub
          </Button>
          
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
            <Box
              sx={{
                p: 1.5,
                borderRadius: 2,
                background: "linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(52, 211, 153, 0.1) 100%)",
                border: "1px solid rgba(16, 185, 129, 0.3)",
              }}
            >
              <PhoneAndroidIcon sx={{ fontSize: 36, color: "#10b981" }} />
            </Box>
            <Box>
              <Typography
                variant="h3"
                sx={{
                  fontWeight: 700,
                  background: "linear-gradient(135deg, #10b981 0%, #34d399 50%, #6ee7b7 100%)",
                  backgroundClip: "text",
                  WebkitBackgroundClip: "text",
                  color: "transparent",
                }}
              >
                Mobile App Pentesting
              </Typography>
              <Typography variant="body1" sx={{ color: "grey.500" }}>
                Security testing methodology for Android and iOS applications
              </Typography>
            </Box>
          </Box>
          
          <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap", mt: 2 }}>
            <Chip 
              icon={<PhoneAndroidIcon />} 
              label="Android" 
              size="small" 
              sx={{ bgcolor: alpha("#10b981", 0.15), color: "#10b981", borderColor: "#10b981" }}
              variant="outlined"
            />
            <Chip 
              icon={<AppleIcon />} 
              label="iOS" 
              size="small"
              sx={{ bgcolor: alpha("#8b5cf6", 0.15), color: "#8b5cf6", borderColor: "#8b5cf6" }}
              variant="outlined"
            />
            <Chip icon={<SecurityIcon />} label="OWASP MASTG" size="small" variant="outlined" />
            <Chip icon={<BugReportIcon />} label="Runtime Analysis" size="small" variant="outlined" />
          </Box>
        </Box>

        {/* Quick Stats */}
        <Grid container spacing={2} sx={{ mb: 4 }}>
          {[
            { icon: <BuildIcon />, label: "10 Tools", color: "#10b981" },
            { icon: <BugReportIcon />, label: "OWASP Top 10", color: "#f59e0b" },
            { icon: <CodeIcon />, label: "Frida Scripts", color: "#8b5cf6" },
            { icon: <SecurityIcon />, label: "SSL Bypass", color: "#ef4444" },
          ].map((stat) => (
            <Grid item xs={6} sm={3} key={stat.label}>
              <Paper
                sx={{
                  p: 2,
                  textAlign: "center",
                  bgcolor: alpha(stat.color, 0.05),
                  border: `1px solid ${alpha(stat.color, 0.2)}`,
                  borderRadius: 2,
                }}
              >
                <Box sx={{ color: stat.color, mb: 0.5 }}>{stat.icon}</Box>
                <Typography variant="body2" sx={{ color: "grey.300", fontWeight: 500 }}>
                  {stat.label}
                </Typography>
              </Paper>
            </Grid>
          ))}
        </Grid>

        {/* Platform Cards */}
        <Grid container spacing={3} sx={{ mb: 4 }}>
          <Grid item xs={12} md={6}>
            <Card 
              sx={{ 
                bgcolor: "#12121a",
                border: "1px solid",
                borderColor: alpha("#10b981", 0.3),
                borderRadius: 3,
                overflow: "hidden",
              }}
            >
              <Box sx={{ height: 4, background: "linear-gradient(90deg, #10b981, #34d399)" }} />
              <CardContent sx={{ p: 3 }}>
                <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                  <Box sx={{ p: 1.5, borderRadius: 2, bgcolor: alpha("#10b981", 0.15) }}>
                    <PhoneAndroidIcon sx={{ color: "#10b981", fontSize: 28 }} />
                  </Box>
                  <Box>
                    <Typography variant="h6" sx={{ color: "#10b981", fontWeight: 600 }}>Android</Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>APK / Java / Kotlin</Typography>
                  </Box>
                  <Chip label="Easier" size="small" sx={{ ml: "auto", bgcolor: alpha("#10b981", 0.2), color: "#10b981" }} />
                </Box>
                <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 2 }} />
                <Grid container spacing={1}>
                  {[
                    { icon: <DownloadIcon />, text: "APK files easily extracted" },
                    { icon: <CodeIcon />, text: "Java bytecode decompiles well" },
                    { icon: <VisibilityIcon />, text: "Emulator testing supported" },
                    { icon: <LockOpenIcon />, text: "Root detection common" },
                  ].map((item, idx) => (
                    <Grid item xs={12} key={idx}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1.5 }}>
                        <Box sx={{ color: "#10b981", opacity: 0.7 }}>{item.icon}</Box>
                        <Typography variant="body2" sx={{ color: "grey.300" }}>{item.text}</Typography>
                      </Box>
                    </Grid>
                  ))}
                </Grid>
              </CardContent>
            </Card>
          </Grid>
          <Grid item xs={12} md={6}>
            <Card 
              sx={{ 
                bgcolor: "#12121a",
                border: "1px solid",
                borderColor: alpha("#8b5cf6", 0.3),
                borderRadius: 3,
                overflow: "hidden",
              }}
            >
              <Box sx={{ height: 4, background: "linear-gradient(90deg, #8b5cf6, #a855f7)" }} />
              <CardContent sx={{ p: 3 }}>
                <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                  <Box sx={{ p: 1.5, borderRadius: 2, bgcolor: alpha("#8b5cf6", 0.15) }}>
                    <AppleIcon sx={{ color: "#8b5cf6", fontSize: 28 }} />
                  </Box>
                  <Box>
                    <Typography variant="h6" sx={{ color: "#8b5cf6", fontWeight: 600 }}>iOS</Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>IPA / Swift / Obj-C</Typography>
                  </Box>
                  <Chip label="Harder" size="small" sx={{ ml: "auto", bgcolor: alpha("#f59e0b", 0.2), color: "#f59e0b" }} />
                </Box>
                <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 2 }} />
                <Grid container spacing={1}>
                  {[
                    { icon: <DownloadIcon />, text: "IPA extraction needs jailbreak" },
                    { icon: <CodeIcon />, text: "Compiled ARM, harder to RE" },
                    { icon: <VisibilityIcon />, text: "Requires macOS or device" },
                    { icon: <FingerprintIcon />, text: "Jailbreak detection common" },
                  ].map((item, idx) => (
                    <Grid item xs={12} key={idx}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1.5 }}>
                        <Box sx={{ color: "#8b5cf6", opacity: 0.7 }}>{item.icon}</Box>
                        <Typography variant="body2" sx={{ color: "grey.300" }}>{item.text}</Typography>
                      </Box>
                    </Grid>
                  ))}
                </Grid>
              </CardContent>
            </Card>
          </Grid>
        </Grid>

        {/* Tabs */}
        <Paper sx={{ bgcolor: "#12121a", borderRadius: 3, overflow: "hidden", border: "1px solid rgba(255,255,255,0.05)" }}>
          <Tabs
            value={tabValue}
            onChange={handleTabChange}
            variant="scrollable"
            scrollButtons="auto"
            sx={{
              bgcolor: "rgba(0,0,0,0.2)",
              borderBottom: "1px solid rgba(255,255,255,0.05)",
              "& .MuiTab-root": { 
                color: "grey.500",
                minHeight: 64,
                textTransform: "none",
                fontSize: "0.9rem",
                fontWeight: 500,
                "&:hover": { color: "grey.300" },
              },
              "& .Mui-selected": { color: "#10b981 !important" },
              "& .MuiTabs-indicator": { bgcolor: "#10b981", height: 3 },
            }}
          >
            <Tab icon={<BuildIcon />} label="Tools" iconPosition="start" />
            <Tab icon={<StorageIcon />} label="Data Storage" iconPosition="start" />
            <Tab icon={<WifiIcon />} label="Network" iconPosition="start" />
            <Tab icon={<SecurityIcon />} label="Frida" iconPosition="start" />
            <Tab icon={<CheckCircleIcon />} label="Checklist" iconPosition="start" />
          </Tabs>

          {/* Tab 0: Tools */}
          <TabPanel value={tabValue} index={0}>
            <Box sx={{ p: 3 }}>
              <Typography variant="h5" sx={{ color: "#10b981", mb: 1, fontWeight: 600 }}>
                Essential Tools
              </Typography>
              <Typography variant="body2" sx={{ color: "grey.500", mb: 3 }}>
                Core toolkit for mobile application security testing
              </Typography>

              <Grid container spacing={2} sx={{ mb: 3 }}>
                {tools.map((tool) => (
                  <Grid item xs={12} sm={6} md={4} key={tool.name}>
                    <Paper
                      sx={{
                        p: 2,
                        bgcolor: "#0d1117",
                        border: "1px solid",
                        borderColor: tool.platform === "Android" ? alpha("#10b981", 0.2) : tool.platform === "iOS" ? alpha("#8b5cf6", 0.2) : alpha("#3b82f6", 0.2),
                        borderRadius: 2,
                        height: "100%",
                        transition: "all 0.2s",
                        "&:hover": {
                          borderColor: tool.platform === "Android" ? "#10b981" : tool.platform === "iOS" ? "#8b5cf6" : "#3b82f6",
                          transform: "translateY(-2px)",
                        },
                      }}
                    >
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                        <Typography sx={{ fontSize: "1.2rem" }}>{tool.icon}</Typography>
                        <Typography sx={{ color: tool.platform === "Android" ? "#10b981" : tool.platform === "iOS" ? "#8b5cf6" : "#3b82f6", fontWeight: 600 }}>
                          {tool.name}
                        </Typography>
                      </Box>
                      <Typography variant="body2" sx={{ color: "grey.400", mb: 1.5, fontSize: "0.8rem" }}>
                        {tool.purpose}
                      </Typography>
                      <Chip 
                        label={tool.platform} 
                        size="small" 
                        sx={{ 
                          fontSize: "0.7rem",
                          bgcolor: tool.platform === "Both" ? alpha("#3b82f6", 0.15) : tool.platform === "Android" ? alpha("#10b981", 0.15) : alpha("#8b5cf6", 0.15),
                          color: tool.platform === "Both" ? "#3b82f6" : tool.platform === "Android" ? "#10b981" : "#8b5cf6",
                        }} 
                      />
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 3 }} />

              <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                Quick Setup
              </Typography>

              <CodeBlock
                title="Android Analysis Setup"
                language="bash"
                code={`# Extract & decompile APK
apktool d app.apk -o app_extracted
jadx -d output/ app.apk

# Install & debug app
adb install app.apk
adb shell pm list packages | grep appname
adb logcat | grep -i "com.app.name"`}
              />

              <CodeBlock
                title="iOS Analysis Setup"
                language="bash"
                code={`# Extract IPA (jailbroken device)
scp root@device:/var/containers/Bundle/Application/*/App.app .

# Decrypt binary (if encrypted)
./flexdecrypt /path/to/App

# Start MobSF (Docker)
docker run -p 8000:8000 opensecurity/mobile-security-framework-mobsf`}
              />

              <Grid container spacing={2}>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Signing & Entitlements Checks"
                    language="bash"
                    code={`# Android signing info
apksigner verify --print-certs app.apk
keytool -printcert -jarfile app.apk | grep -E "Owner|Valid"

# iOS entitlements + provisioning
codesign -d --entitlements - App.app/Contents/MacOS/App
security cms -D -i embedded.mobileprovision | grep -E "Name|get-task-allow"

# Debuggable clues
aapt dump xmltree app.apk AndroidManifest.xml | grep debuggable
/usr/libexec/PlistBuddy -c "Print :UIFileSharingEnabled" Info.plist`}
                  />
                </Grid>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Environment Prep"
                    language="bash"
                    code={`# Android emulator with Magisk (example heads-up)
# Use Pixel x86_64 image; flash patched boot for Magisk; disable Play Protect

# Proxy trust paths
# Android: add user CA to /system/etc/security/cacerts (rooted) or network_security_config
# iOS: install CA and enable full trust (Settings > General > About > Certificate Trust)

# Baseline captures
adb logcat -c && adb logcat > launch.log
tcpdump -i any -w launch.pcap`}
                  />
                </Grid>
              </Grid>

              <Grid container spacing={3} sx={{ mt: 1 }}>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#10b981", fontWeight: 600, mb: 1 }}>
                      Android First 10 Minutes
                    </Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>
                      Quick wins before deeper reversing
                    </Typography>
                    <Box sx={{ mt: 2, display: "grid", gap: 1.5 }}>
                      {[
                        { label: "Manifest & export review", value: 65, color: "#10b981" },
                        { label: "Network surface mapped", value: 50, color: "#f59e0b" },
                        { label: "Runtime hooks planned", value: 35, color: "#3b82f6" },
                      ].map((item) => (
                        <Box key={item.label}>
                          <Box sx={{ display: "flex", justifyContent: "space-between", color: "grey.400", fontSize: "0.8rem", mb: 0.5 }}>
                            <span>{item.label}</span>
                            <span>{item.value}%</span>
                          </Box>
                          <LinearProgress
                            variant="determinate"
                            value={item.value}
                            sx={{
                              height: 6,
                              borderRadius: 999,
                              bgcolor: "rgba(255,255,255,0.06)",
                              "& .MuiLinearProgress-bar": {
                                backgroundColor: item.color,
                              },
                            }}
                          />
                        </Box>
                      ))}
                    </Box>
                    <List dense sx={{ mt: 1 }}>
                      {[
                        "Pull and open AndroidManifest.xml (aapt/apktool) to spot exported components.",
                        "Scan for hardcoded base URLs, API keys, and feature flags in assets/res/strings.xml.",
                        "Check signing cert (keytool) to tell prod vs debug builds.",
                        "Baseline logcat while launching to catch secrets and crash clues early.",
                      ].map((item, idx) => (
                        <ListItem key={item} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <Chip label={idx + 1} size="small" sx={{ width: 22, height: 22, fontSize: "0.75rem", bgcolor: alpha("#10b981", 0.15), color: "#10b981" }} />
                          </ListItemIcon>
                          <ListItemText
                            primary={item}
                            sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }}
                          />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#f59e0b", fontWeight: 600, mb: 1 }}>
                      Android Dynamic Targets
                    </Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>
                      Plan hooks and breakpoints before launching Frida
                    </Typography>
                    <List dense sx={{ mt: 1 }}>
                      {[
                        "WebView bridges (addJavascriptInterface) and custom schemes/deep links.",
                        "OkHttp/Retrofit clients, interceptors, and custom certificate pinners.",
                        "KeyStore access (KeyStore.getInstance/KeyGenerator) and keystore aliases.",
                        "Room/Realm database helpers plus encryption wrappers.",
                        "SafetyNet/Play Integrity or root checks (SafetyNetApi, DroidGuard).",
                        "Feature flags/build configs toggling debug logging or alternate hosts.",
                      ].map((item) => (
                        <ListItem key={item} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <SecurityIcon sx={{ color: "#f59e0b" }} />
                          </ListItemIcon>
                          <ListItemText
                            primary={item}
                            sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }}
                          />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
              </Grid>

              <Grid container spacing={3} sx={{ mt: 2 }}>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#8b5cf6", fontWeight: 600, mb: 1 }}>
                      iOS First 10 Minutes
                    </Typography>
                    <Typography variant="caption" sx={{ color: "grey.500" }}>
                      Snapshot the surface before heavy reversing
                    </Typography>
                    <List dense sx={{ mt: 1 }}>
                      {[
                        "Unpack IPA and check entitlements/provisioning profile (debuggable? get-task-allow?).",
                        "Inspect Info.plist for ATS exceptions, URL schemes, and exported custom handlers.",
                        "List embedded frameworks; note common network libs (Alamofire/URLSession) and crypto libs.",
                        "Run class-dump / frida-objc to enumerate ObjC classes and selectors (login/token/storage).",
                        "Baseline console logs with idevicesyslog while launching; capture endpoints and secrets.",
                      ].map((item) => (
                        <ListItem key={item} sx={{ py: 0.4 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <CheckCircleIcon sx={{ color: "#8b5cf6" }} fontSize="small" />
                          </ListItemIcon>
                          <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                        </ListItem>
                      ))}
                    </List>
                    <CodeBlock
                      title="iOS Recon Quick Hits"
                      language="bash"
                      code={`# Entitlements / provisioning
codesign -d --entitlements - App.app/Contents/MacOS/App
security cms -D -i embedded.mobileprovision | grep -i get-task-allow

# URL schemes
/usr/libexec/PlistBuddy -c "Print :CFBundleURLTypes" Info.plist

# Enumerate classes/selectors (jailbroken)
frida-objc dump com.app.name
idevicesyslog | grep -i "com.app.name"`}
                    />
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper
                    sx={{
                      p: 3,
                      bgcolor: "#0d1117",
                      borderRadius: 2,
                      border: "1px solid rgba(255,255,255,0.05)",
                      height: "100%",
                    }}
                  >
                    <Typography variant="h6" sx={{ color: "#3b82f6", fontWeight: 600, mb: 1 }}>
                      Device Profiles & Access
                    </Typography>
                    <TableContainer>
                      <Table size="small">
                        <TableHead>
                          <TableRow>
                            <TableCell sx={{ color: "grey.500" }}>Profile</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Pros</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Best For</TableCell>
                          </TableRow>
                        </TableHead>
                        <TableBody>
                          {[
                            ["Android Emulator", "Quick snapshots, easy proxying, Magisk possible", "Static triage, Frida/Objection hooks, UI automation"],
                            ["Rooted Android", "Real sensors & OEM stacks", "Keystore tests, SafetyNet/Play Integrity bypass attempts"],
                            ["Jailbroken iOS", "Full filesystem + Frida, class-dump", "Keychain access, runtime hooks, decrypted binaries"],
                            ["Non-jailbroken iOS + proxy", "Real-world baseline", "ATS/pinning behavior, certificate trust paths"],
                          ].map(([profile, pros, best]) => (
                            <TableRow key={profile}>
                              <TableCell sx={{ color: "grey.200" }}>{profile}</TableCell>
                              <TableCell sx={{ color: "grey.400" }}>{pros}</TableCell>
                              <TableCell sx={{ color: "grey.300" }}>{best}</TableCell>
                            </TableRow>
                          ))}
                        </TableBody>
                      </Table>
                    </TableContainer>
                    <Alert severity="info" sx={{ mt: 2, bgcolor: "rgba(16,185,129,0.08)", "& .MuiAlert-icon": { color: "#10b981" } }}>
                      Keep at least two environments: one permissive (root/jailbreak) for hooks and one stock for validating real-world impact.
                    </Alert>
                  </Paper>
                </Grid>
              </Grid>

              <CodeBlock
                title="Android Recon Snippets"
                language="bash"
                code={`# Manifest, permissions, and exported components
aapt dump xmltree app.apk AndroidManifest.xml | grep -i exported
aapt dump badging app.apk | head -n 20

# Signing cert & build variant clues
keytool -printcert -jarfile app.apk
apksigner verify --print-certs app.apk

# Quick static sweeps
grep -R \"http\" -n app_extracted/res/values* app_extracted/smali*
strings app.apk | head

# Runtime baseline
adb shell dumpsys package com.app.name | findstr /i exported
adb logcat -s \"com.app.name\" \"AndroidRuntime\"`}
              />

              <CodeBlock
                title="Smali Patch: force root check to false"
                language="smali"
                code={`.method public isDeviceRooted()Z
    .locals 1
    const/4 v0, 0x0
    # Always return false to skip root detection
    return v0
.end method

# Rebuild & resign after patching:
#   apktool b app_extracted -o patched.apk
#   apksigner sign --ks tester.keystore patched.apk`}
              />
            </Box>
          </TabPanel>

          {/* Tab 1: Data Storage */}
          <TabPanel value={tabValue} index={1}>
            <Box sx={{ p: 3 }}>
              <Typography variant="h5" sx={{ color: "#10b981", mb: 1, fontWeight: 600 }}>
                Insecure Data Storage
              </Typography>
              <Typography variant="body2" sx={{ color: "grey.500", mb: 3 }}>
                Mobile apps frequently store sensitive data insecurely on device
              </Typography>

              <Alert 
                severity="warning" 
                sx={{ 
                  mb: 3, 
                  bgcolor: alpha("#f59e0b", 0.1),
                  "& .MuiAlert-icon": { color: "#f59e0b" },
                }}
              >
                <strong>OWASP M9:</strong> Insecure Data Storage is a top mobile vulnerability.
                Always check local storage for tokens, credentials, and PII!
              </Alert>

              <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ bgcolor: "#0d1117", borderRadius: 2, overflow: "hidden", height: "100%" }}>
                    <Box sx={{ p: 2, bgcolor: alpha("#10b981", 0.1), borderBottom: "1px solid", borderColor: alpha("#10b981", 0.2) }}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                        <PhoneAndroidIcon sx={{ color: "#10b981" }} />
                        <Typography variant="h6" sx={{ color: "#10b981" }}>Android Storage</Typography>
                      </Box>
                    </Box>
                    <Box sx={{ p: 2 }}>
                      <CodeBlock
                        language="bash"
                        code={`# App's private directory
adb shell run-as com.app.name \\
  ls /data/data/com.app.name/

# SharedPreferences (often has tokens!)
adb shell cat /data/data/com.app.name/\\
  shared_prefs/*.xml

# SQLite databases
adb pull /data/data/com.app.name/databases/
sqlite3 database.db ".dump"

# External storage (world-readable!)
adb shell ls /sdcard/Android/data/com.app.name/

# Search secrets in decompiled APK
grep -rE "api[_-]?key|password|secret|token" \\
  ./app_extracted/`}
                      />
                    </Box>
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ bgcolor: "#0d1117", borderRadius: 2, overflow: "hidden", height: "100%" }}>
                    <Box sx={{ p: 2, bgcolor: alpha("#8b5cf6", 0.1), borderBottom: "1px solid", borderColor: alpha("#8b5cf6", 0.2) }}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                        <AppleIcon sx={{ color: "#8b5cf6" }} />
                        <Typography variant="h6" sx={{ color: "#8b5cf6" }}>iOS Storage</Typography>
                      </Box>
                    </Box>
                    <Box sx={{ p: 2 }}>
                      <CodeBlock
                        language="bash"
                        code={`# App sandbox (jailbroken)
cd /var/mobile/Containers/Data/\\
  Application/<UUID>/

# Check plist files
find . -name "*.plist" -exec plutil -p {} \\;

# Keychain items
./keychain-dumper

# NSUserDefaults
cat Library/Preferences/\\
  com.app.name.plist

# SQLite databases
find . -name "*.sqlite" -o -name "*.db" | \\
  xargs -I {} sqlite3 {} ".tables"`}
                      />
                    </Box>
                  </Paper>
                </Grid>
              </Grid>

              <Box sx={{ mt: 4 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Common Vulnerabilities
                </Typography>
                <Grid container spacing={2}>
                  {[
                    { issue: "Plaintext credentials in SharedPrefs", severity: "Critical", color: "#ef4444" },
                    { issue: "API keys hardcoded in source", severity: "Critical", color: "#ef4444" },
                    { issue: "JWT tokens stored unencrypted", severity: "High", color: "#f59e0b" },
                    { issue: "PII logged to console/files", severity: "High", color: "#f59e0b" },
                    { issue: "Backup flag enabled (allowBackup)", severity: "Medium", color: "#3b82f6" },
                    { issue: "Data in external storage", severity: "Medium", color: "#3b82f6" },
                  ].map((item) => (
                    <Grid item xs={12} sm={6} key={item.issue}>
                      <Paper
                        sx={{
                          p: 2,
                          bgcolor: alpha(item.color, 0.05),
                          border: `1px solid ${alpha(item.color, 0.2)}`,
                          borderRadius: 2,
                          display: "flex",
                          alignItems: "center",
                          gap: 2,
                        }}
                      >
                        <WarningIcon sx={{ color: item.color }} />
                        <Box sx={{ flex: 1 }}>
                          <Typography variant="body2" sx={{ color: "grey.200" }}>{item.issue}</Typography>
                        </Box>
                        <Chip 
                          label={item.severity} 
                          size="small" 
                          sx={{ bgcolor: alpha(item.color, 0.2), color: item.color, fontWeight: 600 }}
                        />
                      </Paper>
                    </Grid>
                    ))}
                </Grid>
              </Box>

              <Box sx={{ mt: 4 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Android Artifact Map
                </Typography>
                <TableContainer
                  component={Paper}
                  sx={{
                    bgcolor: "#0d1117",
                    borderRadius: 2,
                    border: "1px solid rgba(255,255,255,0.05)",
                  }}
                >
                  <Table size="small">
                    <TableHead>
                      <TableRow>
                        <TableCell sx={{ color: "grey.500", fontWeight: 600 }}>Artifact</TableCell>
                        <TableCell sx={{ color: "grey.500", fontWeight: 600 }}>Location</TableCell>
                        <TableCell sx={{ color: "grey.500", fontWeight: 600 }}>What to inspect</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {[
                        { artifact: "SharedPreferences", location: "/data/data/<pkg>/shared_prefs/*.xml", inspect: "Tokens, feature flags, cached credentials, remember-me flags" },
                        { artifact: "SQLite / Room", location: "/data/data/<pkg>/databases/*.db", inspect: "PII, tokens, offline caches; check if SQLCipher or custom crypto used" },
                        { artifact: "WebView cache", location: "/data/data/<pkg>/app_webview/", inspect: "Cookies, cached responses, session replay risk" },
                        { artifact: "External storage", location: "/sdcard/Android/data/<pkg>/", inspect: "Images, PDFs, logs written world-readable" },
                        { artifact: "Keystore metadata", location: "KeyStore alias names (logcat/code)", inspect: "Alias names leak purpose; check if StrongBox/Hardware-backed required" },
                        { artifact: "Crash/log files", location: "/data/data/<pkg>/files/ /cache/", inspect: "Stack traces, API endpoints, verbose logging toggles" },
                      ].map((row) => (
                        <TableRow key={row.artifact} hover>
                          <TableCell sx={{ color: "grey.200" }}>{row.artifact}</TableCell>
                          <TableCell sx={{ color: "grey.400", fontFamily: "'Fira Code', monospace", fontSize: "0.85rem" }}>
                            {row.location}
                          </TableCell>
                          <TableCell sx={{ color: "grey.300" }}>{row.inspect}</TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
                <Alert
                  severity="info"
                  sx={{
                    mt: 2,
                    bgcolor: alpha("#10b981", 0.08),
                    border: `1px solid ${alpha("#10b981", 0.2)}`,
                    "& .MuiAlert-icon": { color: "#10b981" },
                  }}
                >
                  <strong>Keystore reality:</strong> Android Keystore entries cannot be exported, but keys can often be abused if apps allow decrypt/sign without user auth.
                  Hook the KeyStore alias and padding/mode to reproduce decryption in-memory.
                </Alert>
              </Box>

              <Box sx={{ mt: 4 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 1.5 }}>
                  Storage Testing Playbook
                </Typography>
                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Typography variant="subtitle1" sx={{ color: "#10b981", fontWeight: 600, mb: 1 }}>
                        Steps (Android/iOS)
                      </Typography>
                      <List dense>
                        {[
                          "Pull app sandbox (run-as/root/jailbreak) and enumerate SharedPrefs/NSUserDefaults, databases, caches, and logs.",
                          "Search for secrets in XML/plist/JSON; diff against in-memory values via Frida to see what gets decrypted at runtime.",
                          "Check backup/export paths: allowBackup flag (Android) and iTunes backup permissions (iOS) for data exfil via backup.",
                          "Verify platform crypto: AndroidKeyStore alias strength (hardware-backed?), iOS Keychain accessibility (kSecAttrAccessible).",
                          "Attempt downgrade: toggle offline/airplane mode to see if tokens are cached or stored long-term.",
                        ].map((item) => (
                          <ListItem key={item} sx={{ py: 0.4 }}>
                            <ListItemIcon sx={{ minWidth: 28 }}>
                              <CheckCircleIcon sx={{ color: "#10b981" }} fontSize="small" />
                            </ListItemIcon>
                            <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                          </ListItem>
                        ))}
                      </List>
                    </Paper>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <CodeBlock
                      title="Quick Greps & Logs"
                      language="bash"
                      code={`# Android: look for secrets
  grep -R \"Bearer|token|secret|key\" -n app_extracted/
  adb logcat | grep -i \"token\"
  
  # iOS: plist + keychain clues (jailbroken)
  plutil -p Library/Preferences/*.plist | head
  keychain_dumper | grep -i token
  
  # Room/Realm/SQLCipher checks
  file /data/data/<pkg>/databases/* | grep SQLite
  strings /data/data/<pkg>/databases/* | head
  
  # SQLCipher quick test (prompts if encrypted)
  sqlcipher /data/data/<pkg>/databases/secure.db \"PRAGMA key='test'; .tables\"
  
  # Realm file header check
  xxd -l 16 /data/data/<pkg>/databases/default.realm`}
                    />
                  </Grid>
                </Grid>
              </Box>

              <Box sx={{ mt: 3 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Pinning Bypass Options
                </Typography>
                <Grid container spacing={3}>
                  <Grid item xs={12} md={7}>
                    <TableContainer component={Paper} sx={{ bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Table size="small">
                        <TableHead>
                          <TableRow>
                            <TableCell sx={{ color: "grey.500" }}>Framework</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Approach</TableCell>
                            <TableCell sx={{ color: "grey.500" }}>Notes</TableCell>
                          </TableRow>
                        </TableHead>
                        <TableBody>
                          {[
                            ["OkHttp/Retrofit", "Hook CertificatePinner/TrustManager with Frida; repack network_security_config to trust user CAs", "Debug builds often trust user CAs if <certificates src=\"user\"/> present"],
                            ["WebView", "Hook WebViewClient.onReceivedSslError and SslErrorHandler.proceed()", "Look for custom WebViewClient overrides that bypass errors"],
                            ["NSURLSession (iOS)", "Hook -URLSession:didReceiveChallenge:completionHandler: to always trust", "Alternatively drop a custom NSURLProtocol to intercept requests"],
                            ["TrustKit/AFNetworking", "Hook pin validation methods or replace serverTrust evaluation", "Class-dump to locate TSKPinValidation or AFURLSessionManager"],
                            ["Custom native libs", "Frida Gum + Interceptor on SSL_write/SSL_connect/objc_msgSend", "Use frida-trace -U -i \"SSL_*\" -f <pkg> for quick wins"],
                          ].map(([fw, approach, note]) => (
                            <TableRow key={fw}>
                              <TableCell sx={{ color: "grey.200" }}>{fw}</TableCell>
                              <TableCell sx={{ color: "grey.300" }}>{approach}</TableCell>
                              <TableCell sx={{ color: "grey.400" }}>{note}</TableCell>
                            </TableRow>
                          ))}
                        </TableBody>
                      </Table>
                    </TableContainer>
                  </Grid>
                  <Grid item xs={12} md={5}>
                    <CodeBlock
                      title="API Replay & GraphQL Probes"
                      language="bash"
                      code={`# Replay captured request (HTTPie)
http -f POST https://api.example.com/login \\
  Authorization:"Bearer <token>" user_id:=123

# IDOR/GraphQL exploration
http https://api.example.com/graphql \\
  query='{me{id,email} users{ id email }}'

# Mitmproxy inline script to fuzz IDs
mitmdump -s idor_fuzz.py -p 8080

# Burp Repeater: remove pins/headers and observe server behavior`}
                    />
                  </Grid>
                </Grid>
              </Box>
            </Box>
          </TabPanel>

          {/* Tab 2: Network */}
          <TabPanel value={tabValue} index={2}>
            <Box sx={{ p: 3 }}>
              <Typography variant="h5" sx={{ color: "#10b981", mb: 1, fontWeight: 600 }}>
                Network Security Testing
              </Typography>
              <Typography variant="body2" sx={{ color: "grey.500", mb: 3 }}>
                Intercept and analyze mobile app network traffic
              </Typography>

              <Grid container spacing={3} sx={{ mb: 3 }}>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                    <Typography variant="h6" sx={{ color: "#10b981", mb: 2, display: "flex", alignItems: "center", gap: 1 }}>
                      <PhoneAndroidIcon /> Android Proxy Setup
                    </Typography>
                    <List dense>
                      {[
                        "Export Burp CA certificate (.der)",
                        "Push to device: adb push burp.der /sdcard/",
                        "Settings > Security > Install from storage",
                        "Set WiFi proxy to <your-ip>:8080",
                      ].map((step, idx) => (
                        <ListItem key={idx} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <Chip label={idx + 1} size="small" sx={{ width: 20, height: 20, fontSize: "0.7rem", bgcolor: "#10b981" }} />
                          </ListItemIcon>
                          <ListItemText primary={step} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                        </ListItem>
                      ))}
                    </List>
                    <Alert severity="warning" sx={{ mt: 2, py: 0 }}>
                      <Typography variant="caption">Android 7+: CA certs must be in system store or app must trust user certs</Typography>
                    </Alert>
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                    <Typography variant="h6" sx={{ color: "#8b5cf6", mb: 2, display: "flex", alignItems: "center", gap: 1 }}>
                      <AppleIcon /> iOS Proxy Setup
                    </Typography>
                    <List dense>
                      {[
                        "Navigate to http://burp in Safari",
                        "Download & install CA Certificate",
                        "Settings > General > About > Certificate Trust",
                        "Enable full trust for Burp cert",
                        "Set WiFi proxy to <your-ip>:8080",
                      ].map((step, idx) => (
                        <ListItem key={idx} sx={{ py: 0.5 }}>
                          <ListItemIcon sx={{ minWidth: 28 }}>
                            <Chip label={idx + 1} size="small" sx={{ width: 20, height: 20, fontSize: "0.7rem", bgcolor: "#8b5cf6" }} />
                          </ListItemIcon>
                          <ListItemText primary={step} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
              </Grid>

              <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                What to Look For
              </Typography>
              <Grid container spacing={2}>
                {[
                  { icon: <WarningIcon />, issue: "HTTP instead of HTTPS", desc: "Sensitive data transmitted in plaintext", color: "#ef4444" },
                  { icon: <LockOpenIcon />, issue: "No certificate pinning", desc: "Easy to intercept with proxy", color: "#f59e0b" },
                  { icon: <VisibilityIcon />, issue: "Tokens in URLs/logs", desc: "Exposed in server logs & history", color: "#f59e0b" },
                  { icon: <SecurityIcon />, issue: "Weak authentication", desc: "Predictable tokens, no expiry", color: "#3b82f6" },
                  { icon: <BugReportIcon />, issue: "IDOR vulnerabilities", desc: "Change IDs to access other users", color: "#ef4444" },
                  { icon: <CodeIcon />, issue: "API key in requests", desc: "Hardcoded keys in traffic", color: "#f59e0b" },
                ].map((item) => (
                  <Grid item xs={12} sm={6} key={item.issue}>
                    <Paper
                      sx={{
                        p: 2,
                        bgcolor: alpha(item.color, 0.05),
                        border: `1px solid ${alpha(item.color, 0.15)}`,
                        borderRadius: 2,
                      }}
                    >
                      <Box sx={{ display: "flex", alignItems: "flex-start", gap: 1.5 }}>
                        <Box sx={{ color: item.color, mt: 0.3 }}>{item.icon}</Box>
                        <Box>
                          <Typography variant="body2" sx={{ color: "grey.200", fontWeight: 500 }}>{item.issue}</Typography>
                          <Typography variant="caption" sx={{ color: "grey.500" }}>{item.desc}</Typography>
                        </Box>
                      </Box>
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 3 }} />

              <Box sx={{ mt: 2 }}>
                <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                  Android Network Deep Dive
                </Typography>
                <Grid container spacing={3}>
                  <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Typography variant="subtitle1" sx={{ color: "#10b981", fontWeight: 600, mb: 1 }}>
                        Checklist before attacking
                      </Typography>
                      <List dense>
                        {[
                          "Confirm if android:usesCleartextTraffic=\"true\" or network_security_config enables cleartext.",
                          "Identify OkHttp/Retrofit clients and look for custom CertificatePinner or HostnameVerifier overrides.",
                          "Check if debug overrides trust user CAs (debuggable builds) but release pins system only.",
                          "Inspect WebViewClient.onReceivedSslError overrides that may silently ignore errors.",
                          "Look for gRPC/GraphQL endpoints; test with replay and mutation not just REST.",
                        ].map((item) => (
                          <ListItem key={item} sx={{ py: 0.5 }}>
                            <ListItemIcon sx={{ minWidth: 28 }}>
                              <SecurityIcon sx={{ color: "#10b981" }} />
                            </ListItemIcon>
                            <ListItemText
                              primary={item}
                              sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }}
                            />
                          </ListItem>
                        ))}
                      </List>
                      <Alert severity="warning" sx={{ mt: 1, bgcolor: alpha("#f59e0b", 0.08), "& .MuiAlert-icon": { color: "#f59e0b" } }}>
                        <Typography variant="caption">
                          Android 7+ trusts user CAs only for debuggable apps unless <code>src=\"user\"</code> is specified in <code>network_security_config</code>.
                        </Typography>
                      </Alert>
                    </Paper>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <CodeBlock
                      title="network_security_config.xml (hardened)"
                      language="xml"
                      code={`<network-security-config>
  <domain-config cleartextTrafficPermitted="false">
    <domain includeSubdomains="true">api.example.com</domain>
    <pin-set expiration="2025-12-31">
      <pin digest="SHA-256">base64==</pin>
      <pin digest="SHA-256">backupPin==</pin>
    </pin-set>
  </domain-config>
  <debug-overrides>
    <trust-anchors>
      <certificates src="system" />
      <!-- If this is present, proxies will work on debuggable builds -->
      <certificates src="user" />
    </trust-anchors>
  </debug-overrides>
</network-security-config>`}
                    />
                    <CodeBlock
                      title="Pinning bypass via repack"
                      language="bash"
                      code={`# Make the app trust user CAs (emulators/rooted devices)
apktool d app.apk -o app_extracted
sed -i '' 's/src=\"system\"/src=\"user\"/g' app_extracted/res/xml/network_security_config.xml
apktool b app_extracted -o patched.apk
apksigner sign --ks tester.keystore patched.apk

# Or hook CertificatePinner at runtime (Frida)
frida -U -f com.app.name -l bypass.js --no-pause`}
                    />
                  </Grid>
                </Grid>
              </Box>
            </Box>
          </TabPanel>

          {/* Tab 3: Frida */}
          <TabPanel value={tabValue} index={3}>
            <Box sx={{ p: 3 }}>
              <Typography variant="h5" sx={{ color: "#10b981", mb: 1, fontWeight: 600 }}>
                Frida Dynamic Instrumentation
              </Typography>
              <Typography variant="body2" sx={{ color: "grey.500", mb: 3 }}>
                Inject JavaScript into running apps to bypass security controls
              </Typography>

              <Alert 
                severity="info" 
                sx={{ 
                  mb: 3,
                  bgcolor: alpha("#3b82f6", 0.1),
                  "& .MuiAlert-icon": { color: "#3b82f6" },
                }}
              >
                <strong>Frida</strong> lets you hook functions, modify return values, and trace execution 
                at runtime. Perfect for bypassing SSL pinning, root detection, and debugging obfuscated apps.
              </Alert>

              <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Frida Setup"
                    language="bash"
                    code={`# Install Frida tools
pip install frida-tools

# Download frida-server for your device arch
# https://github.com/frida/frida/releases

# Push & run on Android (rooted)
adb push frida-server /data/local/tmp/
adb shell chmod +x /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &

# List running apps
frida-ps -U

# Attach to running app
frida -U -n "App Name" -l script.js

# Spawn app with script
frida -U -f com.app.name -l script.js`}
                  />
                </Grid>
                <Grid item xs={12} md={6}>
                  <CodeBlock
                    title="Objection (Frida Made Easy)"
                    language="bash"
                    code={`# Install objection
pip install objection

# Explore running app
objection -g "com.app.name" explore

# Common bypasses (inside objection)
android sslpinning disable
android root disable
ios sslpinning disable
ios jailbreak disable

# Dump keychain/keystore
ios keychain dump
android keystore list

# Search classes
android hooking search classes password
ios hooking search classes Token`}
                  />
                </Grid>
              </Grid>

              <Divider sx={{ borderColor: "rgba(255,255,255,0.05)", my: 3 }} />

              <Typography variant="h6" sx={{ color: "grey.200", mb: 2 }}>
                Common Bypass Scripts
              </Typography>

              <Accordion defaultExpanded sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <LockOpenIcon sx={{ color: "#10b981" }} />
                    <Typography sx={{ color: "#10b981" }}>SSL Pinning Bypass (Android)</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    // Bypass TrustManager
    var TrustManager = Java.use('javax.net.ssl.X509TrustManager');
    var SSLContext = Java.use('javax.net.ssl.SSLContext');
    
    var TrustAllCerts = Java.registerClass({
        name: 'com.bypass.TrustAllCerts',
        implements: [TrustManager],
        methods: {
            checkClientTrusted: function(chain, authType) {},
            checkServerTrusted: function(chain, authType) {},
            getAcceptedIssuers: function() { return []; }
        }
    });
    
    var ctx = SSLContext.getInstance("TLS");
    ctx.init(null, [TrustAllCerts.$new()], null);
    console.log("[+] SSL Pinning Bypassed!");
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <FingerprintIcon sx={{ color: "#f59e0b" }} />
                    <Typography sx={{ color: "#f59e0b" }}>Root Detection Bypass</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    // Hook common root check methods
    var RootBeer = Java.use("com.scottyab.rootbeer.RootBeer");
    RootBeer.isRooted.implementation = function() {
        console.log("[+] RootBeer.isRooted() bypassed");
        return false;
    };
    
    // Hook Runtime.exec for "su" checks
    var Runtime = Java.use("java.lang.Runtime");
    Runtime.exec.overload('java.lang.String').implementation = function(cmd) {
        if (cmd.indexOf("su") !== -1) {
            console.log("[+] Blocked: " + cmd);
            throw new Error("Command not found");
        }
        return this.exec(cmd);
    };
    
    // Hook File.exists for path checks
    var File = Java.use("java.io.File");
    File.exists.implementation = function() {
        var path = this.getAbsolutePath();
        if (path.indexOf("su") !== -1 || path.indexOf("Superuser") !== -1) {
            console.log("[+] Hidden: " + path);
            return false;
        }
        return this.exists();
    };
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <WifiIcon sx={{ color: "#10b981" }} />
                    <Typography sx={{ color: "#10b981" }}>Log OkHttp Requests (Android)</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    var RequestBuilder = Java.use("okhttp3.Request$Builder");
    RequestBuilder.build.implementation = function() {
        var req = this.build();
        console.log("[HTTP] " + req.method() + " " + req.url());
        var headers = req.headers();
        for (var i = 0; i < headers.size(); i++) {
            var name = headers.name(i);
            var value = headers.value(i);
            console.log("  " + name + ": " + value);
        }
        return req;
    };
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <LockOpenIcon sx={{ color: "#3b82f6" }} />
                    <Typography sx={{ color: "#3b82f6" }}>Trace Crypto (Cipher / KeySpec)</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    language="javascript"
                    code={`Java.perform(function() {
    var Cipher = Java.use("javax.crypto.Cipher");
    var SecretKeySpec = Java.use("javax.crypto.spec.SecretKeySpec");
    var IvParameterSpec = Java.use("javax.crypto.spec.IvParameterSpec");

    SecretKeySpec.$init.overload('[B', 'java.lang.String').implementation = function(key, alg) {
        console.log("[+] KeySpec created for " + alg + " len=" + key.length);
        return this.$init(key, alg);
    };

    IvParameterSpec.$init.overload('[B').implementation = function(iv) {
        console.log("[+] IV: " + bytesToHex(iv));
        return this.$init(iv);
    };

    Cipher.doFinal.overload('[B').implementation = function(data) {
        console.log("[+] Cipher " + this.getAlgorithm() + " opmode=" + this.getOpmode());
        console.log("    in : " + bytesToHex(data));
        var out = this.doFinal(data);
        console.log("    out: " + bytesToHex(out));
        return out;
    };

    function bytesToHex(arr) {
        return Array.prototype.map.call(Java.array('byte', arr), function(b) {
            return ('0' + (b & 0xff).toString(16)).slice(-2);
        }).join('');
    }
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <AppleIcon sx={{ color: "#8b5cf6" }} />
                    <Typography sx={{ color: "#8b5cf6" }}>iOS Hooks: NSURLSession + Keychain</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <CodeBlock
                    title="Trust all challenges (Objective-C)"
                    language="javascript"
                    code={`if (ObjC.available) {
  const NSURLSession = ObjC.classes.NSURLSession;
  const delegateCls = ObjC.classes.NSURLSessionDelegate;
  Interceptor.attach(delegateCls['- URLSession:didReceiveChallenge:completionHandler:'].implementation, {
    onEnter(args) {
      const handler = new ObjC.Block(args[4]);
      handler.implementation = function(_chal, _cred) {
        const trust = ObjC.classes.NSURLCredential.credentialWithTrust_(args[3].value());
        return handler.original(_chal, trust);
      };
      console.log("[+] TLS challenge bypassed");
    }
  });
}`}
                  />
                  <CodeBlock
                    title="Log Keychain fetches (SecItemCopyMatching)"
                    language="javascript"
                    code={`const resolver = new ApiResolver("module");
resolver.enumerateMatches("exports:*/SecItemCopyMatching", {
  onMatch: function(match) {
    Interceptor.attach(match.address, {
      onEnter(args) {
        console.log("[+] Keychain query");
      },
      onLeave(retval) {
        console.log("[+] Keychain result: " + retval);
      }
    });
  },
  onComplete: function() {}
});`}
                  />
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                    <SecurityIcon sx={{ color: "#3b82f6" }} />
                    <Typography sx={{ color: "#3b82f6" }}>Stealth & Trace Targets</Typography>
                  </Box>
                </AccordionSummary>
                <AccordionDetails>
                  <List dense>
                    {[
                      "Spawn with --no-pause to minimize startup lag; attach late only if anti-debug present in early code.",
                      "Hide Frida process name: rename frida-server binary; consider tcp port randomization on rooted devices.",
                      "Trace families: SSL_* (OpenSSL), objc_msgSend (iOS), JNI_OnLoad + RegisterNatives (Android native), KeyStore/Keychain APIs.",
                      "Log call stacks for sensitive calls (crypto, keystore, jailbreak checks) to map code paths quickly.",
                    ].map((item) => (
                      <ListItem key={item} sx={{ py: 0.3 }}>
                        <ListItemIcon sx={{ minWidth: 28 }}>
                          <CheckCircleIcon sx={{ color: "#3b82f6" }} fontSize="small" />
                        </ListItemIcon>
                        <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300", fontSize: "0.85rem" } }} />
                      </ListItem>
                    ))}
                  </List>
                  <CodeBlock
                    title="Quick trace targets"
                    language="bash"
                    code={`# TLS / crypto
frida-trace -U -f com.app.name -i "SSL_*" -i "EVP_*"

# Android keystore + integrity APIs
frida-trace -U -f com.app.name -I "android.security.*" -I "com.google.android.gms.safetynet.*"

# iOS Objective-C messaging (heavy output)
frida-trace -U -f com.app.name -m "-[NSURLSession* *]"`}
                  />
                </AccordionDetails>
              </Accordion>

              <Alert severity="success" sx={{ mt: 3, bgcolor: alpha("#10b981", 0.1), "& .MuiAlert-icon": { color: "#10b981" } }}>
                <strong>Pro Tip:</strong> Use <code>frida-trace</code> to quickly trace method calls:
                <br />
                <code>frida-trace -U -i "SSL*" -n "App Name"</code>
              </Alert>
            </Box>
          </TabPanel>

          {/* Tab 4: Checklist */}
          <TabPanel value={tabValue} index={4}>
            <Box sx={{ p: 3 }}>
              <Typography variant="h5" sx={{ color: "#10b981", mb: 1, fontWeight: 600 }}>
                Mobile Pentest Checklist
              </Typography>
              <Typography variant="body2" sx={{ color: "grey.500", mb: 3 }}>
                Comprehensive testing checklist based on OWASP MASTG
              </Typography>

              <Paper sx={{ p: 3, mb: 3, bgcolor: "#0d1117", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 2 }}>
                <Typography variant="h6" sx={{ color: "#10b981", mb: 1 }}>
                  Engagement Flow (Day 1-2)
                </Typography>
                <List dense>
                  {[
                    "Baseline: collect hashes, app version/build, device profile, and proxy/log setup; snapshot VM/device state.",
                    "Static pass: manifest/Info.plist/entitlements, strings/secrets, exported components, network config, library inventory.",
                    "Dynamic plan: choose proxy/pinning bypass, Frida hooks (root/jailbreak/keystore/URLSession/OkHttp), and target flows (auth/payment/upload).",
                    "Execution: record PCAP + device logs + Frida output; capture screenshots/requests for each finding.",
                    "Wrap-up: dump storage (prefs/keychain/db), export modified APK/IPA and scripts used, compile IOC list (hosts, pins, keys).",
                  ].map((item) => (
                    <ListItem key={item} sx={{ py: 0.35 }}>
                      <ListItemIcon sx={{ minWidth: 28 }}>
                        <CheckCircleIcon sx={{ color: "#10b981" }} fontSize="small" />
                      </ListItemIcon>
                      <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300" } }} />
                    </ListItem>
                  ))}
                </List>
              </Paper>

              <Paper sx={{ p: 3, mb: 3, bgcolor: "#0d1117", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 2 }}>
                <Typography variant="h6" sx={{ color: "#3b82f6", mb: 1 }}>
                  Evidence Capture Checklist
                </Typography>
                <List dense>
                  {[
                    "Keep copies of original APK/IPA hashes, signing info, and build numbers.",
                    "Save proxy history (Burp/Mitmproxy) + PCAPs with timestamps for replay.",
                    "Export Frida/Objection scripts and terminal logs for reproducibility.",
                    "Capture storage artifacts (prefs/db/plist/realm) with hashes and paths.",
                    "Document bypass steps (pinning/root/jailbreak) and patched binaries used.",
                  ].map((item) => (
                    <ListItem key={item} sx={{ py: 0.35 }}>
                      <ListItemIcon sx={{ minWidth: 28 }}>
                        <CheckCircleIcon sx={{ color: "#3b82f6" }} fontSize="small" />
                      </ListItemIcon>
                      <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300" } }} />
                    </ListItem>
                  ))}
                </List>
              </Paper>

              <Grid container spacing={3}>
                {[
                  { 
                    category: "Static Analysis", 
                    icon: <CodeIcon />,
                    color: "#3b82f6",
                    items: [
                      "Decompile APK/IPA and review source",
                      "Search for hardcoded secrets & API keys",
                      "Check AndroidManifest.xml permissions",
                      "Review network_security_config.xml",
                      "Analyze third-party libraries for CVEs",
                      "Check for debug flags and logging",
                    ]
                  },
                  { 
                    category: "Data Storage", 
                    icon: <StorageIcon />,
                    color: "#f59e0b",
                    items: [
                      "Check SharedPreferences/NSUserDefaults",
                      "Examine SQLite databases for PII",
                      "Review Keychain/Keystore usage",
                      "Check logs for sensitive data",
                      "Verify backup flag (allowBackup)",
                      "Test clipboard data exposure",
                    ]
                  },
                  { 
                    category: "Network Security", 
                    icon: <WifiIcon />,
                    color: "#10b981",
                    items: [
                      "Test for SSL/TLS pinning",
                      "Intercept API traffic with proxy",
                      "Check for HTTP endpoints",
                      "Analyze authentication tokens",
                      "Test for IDOR vulnerabilities",
                      "Review API error messages",
                    ]
                  },
                  { 
                    category: "Runtime Analysis", 
                    icon: <BugReportIcon />,
                    color: "#ef4444",
                    items: [
                      "Bypass root/jailbreak detection",
                      "Hook and modify sensitive functions",
                      "Test biometric authentication bypass",
                      "Check runtime integrity checks",
                      "Test anti-tampering mechanisms",
                      "Analyze memory for secrets",
                    ]
                  },
                ].map((section) => (
                  <Grid item xs={12} md={6} key={section.category}>
                    <Paper 
                      sx={{ 
                        bgcolor: "#0d1117", 
                        borderRadius: 2, 
                        overflow: "hidden",
                        border: `1px solid ${alpha(section.color, 0.2)}`,
                        height: "100%",
                      }}
                    >
                      <Box 
                        sx={{ 
                          p: 2, 
                          bgcolor: alpha(section.color, 0.1),
                          borderBottom: `1px solid ${alpha(section.color, 0.2)}`,
                          display: "flex",
                          alignItems: "center",
                          gap: 1.5,
                        }}
                      >
                        <Box sx={{ color: section.color }}>{section.icon}</Box>
                        <Typography variant="h6" sx={{ color: section.color, fontWeight: 600 }}>
                          {section.category}
                        </Typography>
                      </Box>
                      <Box sx={{ p: 2 }}>
                        {section.items.map((item, idx) => (
                          <Box 
                            key={idx} 
                            sx={{ 
                              display: "flex", 
                              alignItems: "center", 
                              gap: 1.5, 
                              py: 0.75,
                              borderBottom: idx < section.items.length - 1 ? "1px solid rgba(255,255,255,0.03)" : "none",
                            }}
                          >
                            <CheckCircleIcon sx={{ fontSize: 16, color: "grey.600" }} />
                            <Typography variant="body2" sx={{ color: "grey.300" }}>{item}</Typography>
                          </Box>
                        ))}
                      </Box>
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Box sx={{ mt: 4, p: 3, bgcolor: alpha("#8b5cf6", 0.1), borderRadius: 2, border: `1px solid ${alpha("#8b5cf6", 0.2)}` }}>
                <Typography variant="h6" sx={{ color: "#8b5cf6", mb: 2 }}>
                  Essential Resources
                </Typography>
                <Grid container spacing={2}>
                  {[
                    { name: "OWASP MASTG", desc: "Mobile Application Security Testing Guide" },
                    { name: "OWASP MASVS", desc: "Mobile Application Security Verification Standard" },
                    { name: "Frida Codeshare", desc: "Community Frida scripts" },
                    { name: "MobSF Docs", desc: "Mobile Security Framework documentation" },
                  ].map((resource) => (
                    <Grid item xs={12} sm={6} key={resource.name}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                        <CheckCircleIcon sx={{ color: "#8b5cf6", fontSize: 18 }} />
                        <Box>
                          <Typography variant="body2" sx={{ color: "grey.200", fontWeight: 500 }}>{resource.name}</Typography>
                          <Typography variant="caption" sx={{ color: "grey.500" }}>{resource.desc}</Typography>
                        </Box>
                      </Box>
                    </Grid>
                  ))}
                </Grid>
              </Box>
            </Box>
          </TabPanel>
        </Paper>

        {/* Footer */}
        <Box sx={{ mt: 4, textAlign: "center" }}>
          <Button
            variant="outlined"
            startIcon={<ArrowBackIcon />}
            onClick={() => navigate("/learn")}
            sx={{ 
              borderColor: alpha("#10b981", 0.5), 
              color: "#10b981",
              px: 4,
              py: 1,
              "&:hover": {
                borderColor: "#10b981",
                bgcolor: alpha("#10b981", 0.1),
              },
            }}
          >
            Back to Learn Hub
          </Button>
        </Box>
      </Container>
    </Box>
    </LearnPageLayout>
  );
};

export default MobilePentestPage;
