import React, { useState } from "react";
import LearnPageLayout from "../components/LearnPageLayout";
import {
  Box,
  Typography,
  Container,
  Paper,
  alpha,
  useTheme,
  Tabs,
  Tab,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Chip,
  Grid,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  IconButton,
  Divider,
  Alert,
  Card,
  CardContent,
  Tooltip,
} from "@mui/material";
import { useNavigate } from "react-router-dom";
import ArrowBackIcon from "@mui/icons-material/ArrowBack";
import ExpandMoreIcon from "@mui/icons-material/ExpandMore";
import SecurityIcon from "@mui/icons-material/Security";
import SearchIcon from "@mui/icons-material/Search";
import LockIcon from "@mui/icons-material/Lock";
import BugReportIcon from "@mui/icons-material/BugReport";
import StorageIcon from "@mui/icons-material/Storage";
import WebIcon from "@mui/icons-material/Web";
import SyncAltIcon from "@mui/icons-material/SyncAlt";
import AssignmentIcon from "@mui/icons-material/Assignment";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import WarningIcon from "@mui/icons-material/Warning";
import InfoIcon from "@mui/icons-material/Info";
import GavelIcon from "@mui/icons-material/Gavel";
import MapIcon from "@mui/icons-material/Map";
import AccountTreeIcon from "@mui/icons-material/AccountTree";
import VpnKeyIcon from "@mui/icons-material/VpnKey";
import PersonSearchIcon from "@mui/icons-material/PersonSearch";
import TimerIcon from "@mui/icons-material/Timer";
import TokenIcon from "@mui/icons-material/Token";
import LinkIcon from "@mui/icons-material/Link";
import PhonelinkLockIcon from "@mui/icons-material/PhonelinkLock";
import AdminPanelSettingsIcon from "@mui/icons-material/AdminPanelSettings";
import DataObjectIcon from "@mui/icons-material/DataObject";
import CodeIcon from "@mui/icons-material/Code";
import TerminalIcon from "@mui/icons-material/Terminal";
import CloudIcon from "@mui/icons-material/Cloud";
import FolderIcon from "@mui/icons-material/Folder";
import UploadFileIcon from "@mui/icons-material/UploadFile";
import SpeedIcon from "@mui/icons-material/Speed";
import SettingsIcon from "@mui/icons-material/Settings";
import JavascriptIcon from "@mui/icons-material/Javascript";
import HttpIcon from "@mui/icons-material/Http";
import MouseIcon from "@mui/icons-material/Mouse";
import PolicyIcon from "@mui/icons-material/Policy";
import FactCheckIcon from "@mui/icons-material/FactCheck";
import LinkOffIcon from "@mui/icons-material/LinkOff";
import WifiIcon from "@mui/icons-material/Wifi";
import DescriptionIcon from "@mui/icons-material/Description";
import PriorityHighIcon from "@mui/icons-material/PriorityHigh";

interface TabPanelProps {
  children?: React.ReactNode;
  index: number;
  value: number;
}

function TabPanel(props: TabPanelProps) {
  const { children, value, index, ...other } = props;
  return (
    <div role="tabpanel" hidden={value !== index} {...other}>
      {value === index && <Box sx={{ pt: 3 }}>{children}</Box>}
    </div>
  );
}

interface TopicSection {
  title: string;
  icon: React.ReactNode;
  color: string;
  description: string;
  keyPoints: string[];
  techniques?: string[];
  tools?: string[];
  tips?: string[];
  cwe?: string[];
}

// Section 1: Overview and Methodology
const overviewTopics: TopicSection[] = [
  {
    title: "Scope and Rules of Engagement",
    icon: <GavelIcon />,
    color: "#6366f1",
    description: "Before any testing begins, establish clear boundaries and legal authorization to protect both tester and client.",
    keyPoints: [
      "Obtain written authorization (Get Out of Jail Free letter)",
      "Define in-scope and out-of-scope systems, IPs, and domains",
      "Clarify testing windows and blackout periods",
      "Establish emergency contact procedures",
      "Agree on acceptable testing techniques (DoS, social engineering, etc.)",
      "Define data handling and confidentiality requirements",
      "Set up secure communication channels for findings",
    ],
    tips: [
      "Always keep authorization documents accessible during testing",
      "Document everything with timestamps for legal protection",
      "Clarify third-party hosted services (AWS, Cloudflare) - they may need separate authorization",
      "Understand local laws regarding penetration testing",
    ],
  },
  {
    title: "Reconnaissance and Application Mapping",
    icon: <MapIcon />,
    color: "#8b5cf6",
    description: "Systematically discover and document all application components, endpoints, and technologies.",
    keyPoints: [
      "Passive recon: OSINT, DNS records, certificate transparency logs",
      "Active scanning: port scanning, service enumeration",
      "Technology fingerprinting: server, frameworks, libraries",
      "Endpoint discovery: spidering, directory brute-forcing",
      "API documentation discovery (Swagger, GraphQL introspection)",
      "JavaScript analysis for hidden endpoints and secrets",
      "Subdomain enumeration and virtual host discovery",
    ],
    tools: ["Burp Suite", "OWASP ZAP", "Nmap", "Gobuster", "ffuf", "Amass", "Subfinder", "Nuclei", "httpx", "waybackurls"],
    techniques: [
      "robots.txt and sitemap.xml analysis",
      "Google dorking for sensitive files",
      "GitHub/GitLab secret scanning",
      "Shodan/Censys for exposed services",
      "WHOIS and reverse IP lookups",
    ],
  },
  {
    title: "Threat Modelling and Attack Surface",
    icon: <AccountTreeIcon />,
    color: "#ec4899",
    description: "Identify and prioritize potential attack vectors based on application architecture and business logic.",
    keyPoints: [
      "Map data flows between components",
      "Identify trust boundaries and authentication points",
      "Document entry points (forms, APIs, file uploads)",
      "Assess business-critical functionality",
      "Consider insider threat scenarios",
      "Map third-party integrations and dependencies",
      "Prioritize testing based on risk and impact",
    ],
    techniques: [
      "STRIDE threat modelling (Spoofing, Tampering, Repudiation, Information Disclosure, DoS, Elevation)",
      "Attack trees for complex scenarios",
      "Data flow diagrams (DFDs)",
      "PASTA (Process for Attack Simulation and Threat Analysis)",
    ],
  },
];

// Section 2: Authentication and Authorization
const authTopics: TopicSection[] = [
  {
    title: "Authentication Models",
    icon: <VpnKeyIcon />,
    color: "#3b82f6",
    description: "Understanding different authentication mechanisms and their common weaknesses.",
    keyPoints: [
      "Form-based authentication: username/password flows",
      "HTTP Basic and Digest authentication",
      "Certificate-based (mutual TLS) authentication",
      "API key authentication patterns",
      "Token-based authentication (Bearer tokens)",
      "Passwordless authentication (magic links, WebAuthn)",
      "Risk-based and adaptive authentication",
    ],
    techniques: [
      "Test for default credentials",
      "Check password policy enforcement",
      "Verify account lockout mechanisms",
      "Test remember-me functionality security",
      "Assess password reset flows",
    ],
  },
  {
    title: "Enumeration and Brute Force",
    icon: <PersonSearchIcon />,
    color: "#ef4444",
    description: "Techniques to discover valid accounts and bypass authentication through credential attacks.",
    keyPoints: [
      "Username enumeration via error messages",
      "Timing-based user enumeration",
      "Password spraying vs credential stuffing",
      "Rate limiting bypass techniques",
      "CAPTCHA bypass methods",
      "Account lockout policy testing",
      "Response analysis for enumeration",
    ],
    tools: ["Hydra", "Burp Intruder", "ffuf", "Patator", "CeWL", "Turbo Intruder"],
    tips: [
      "Check registration, login, and password reset for enumeration",
      "Compare response times, sizes, and content",
      "Try IP rotation and header manipulation for rate limit bypass",
      "Test with common password lists (rockyou, SecLists)",
    ],
    cwe: ["CWE-307: Improper Restriction of Excessive Authentication Attempts"],
  },
  {
    title: "Session Management",
    icon: <TimerIcon />,
    color: "#f59e0b",
    description: "Testing session token generation, handling, and termination for security flaws.",
    keyPoints: [
      "Session token entropy and predictability",
      "Secure cookie attributes (HttpOnly, Secure, SameSite)",
      "Session fixation vulnerabilities",
      "Session timeout and idle timeout",
      "Concurrent session handling",
      "Session termination on logout",
      "Session regeneration after privilege changes",
    ],
    techniques: [
      "Analyze token randomness with Burp Sequencer",
      "Test session persistence across authentication events",
      "Check for session tokens in URLs (session ID exposure)",
      "Verify logout actually invalidates server-side session",
      "Test cross-device/cross-browser session handling",
    ],
    cwe: ["CWE-384: Session Fixation", "CWE-613: Insufficient Session Expiration"],
  },
  {
    title: "JWT Security",
    icon: <TokenIcon />,
    color: "#10b981",
    description: "Common vulnerabilities in JSON Web Token implementations and how to exploit them.",
    keyPoints: [
      "Algorithm confusion attacks (none, HS256 vs RS256)",
      "Weak secret keys vulnerable to brute force",
      "Missing signature verification",
      "JWT header injection (jku, jwk, kid)",
      "Expired token acceptance",
      "Sensitive data in JWT payload",
      "Token replay and revocation issues",
    ],
    tools: ["jwt.io", "jwt_tool", "Burp JWT extensions", "hashcat (for cracking)"],
    techniques: [
      "Change alg to 'none' and remove signature",
      "Switch RS256 to HS256 and sign with public key",
      "Brute force weak HMAC secrets",
      "Inject malicious JWKS URL via jku header",
      "SQL injection via kid parameter",
    ],
    cwe: ["CWE-347: Improper Verification of Cryptographic Signature"],
  },
  {
    title: "OAuth and SSO Vulnerabilities",
    icon: <LinkIcon />,
    color: "#8b5cf6",
    description: "Security testing for OAuth 2.0, OpenID Connect, and Single Sign-On implementations.",
    keyPoints: [
      "Open redirect in redirect_uri parameter",
      "Authorization code interception",
      "CSRF in OAuth flows (missing state parameter)",
      "Token leakage via Referer header",
      "Scope escalation and privilege manipulation",
      "Client secret exposure",
      "PKCE bypass attempts",
      "IdP confusion and account linking issues",
    ],
    techniques: [
      "Test redirect_uri validation (subdomain, path traversal, parameter pollution)",
      "Attempt to reuse authorization codes",
      "Check for token in URL fragments vs query params",
      "Test implicit flow token exposure",
      "Verify state parameter uniqueness and binding",
    ],
    cwe: ["CWE-601: URL Redirection to Untrusted Site"],
  },
  {
    title: "Multi-Factor Authentication",
    icon: <PhonelinkLockIcon />,
    color: "#06b6d4",
    description: "Bypass techniques and weaknesses in MFA implementations.",
    keyPoints: [
      "MFA bypass via direct endpoint access",
      "Brute forcing OTP codes",
      "Response manipulation to skip MFA",
      "Backup code weaknesses",
      "MFA fatigue attacks (push notification spam)",
      "SIM swapping and SS7 attacks on SMS MFA",
      "Recovery flow bypasses",
    ],
    techniques: [
      "Check if MFA can be disabled without re-authentication",
      "Test rate limiting on OTP submission",
      "Attempt to access authenticated endpoints without completing MFA",
      "Manipulate response to indicate MFA success",
      "Test backup codes for reuse and entropy",
    ],
  },
  {
    title: "Access Control, IDOR, and BOLA",
    icon: <AdminPanelSettingsIcon />,
    color: "#dc2626",
    description: "Broken Object Level Authorization and Insecure Direct Object References testing.",
    keyPoints: [
      "Horizontal privilege escalation (accessing other users' data)",
      "Vertical privilege escalation (accessing admin functions)",
      "IDOR in API endpoints with numeric/UUID identifiers",
      "Mass assignment vulnerabilities",
      "Function-level access control bypass",
      "Path-based access control issues",
      "GraphQL authorization flaws",
    ],
    techniques: [
      "Swap user IDs, GUIDs, or other identifiers in requests",
      "Test with low-privilege and high-privilege accounts",
      "Check API endpoints for missing authorization checks",
      "Test batch operations and bulk endpoints",
      "Enumerate object IDs (sequential, predictable patterns)",
    ],
    cwe: ["CWE-639: Authorization Bypass Through User-Controlled Key", "CWE-284: Improper Access Control"],
  },
];

// Section 3: Injection Attacks
const injectionTopics: TopicSection[] = [
  {
    title: "Advanced SQL Injection",
    icon: <StorageIcon />,
    color: "#ef4444",
    description: "Beyond basic SQLi: blind techniques, filter bypass, and database-specific exploitation.",
    keyPoints: [
      "Union-based extraction techniques",
      "Boolean-based blind SQLi",
      "Time-based blind SQLi",
      "Error-based extraction",
      "Out-of-band (OOB) data exfiltration",
      "Second-order SQL injection",
      "WAF bypass techniques",
    ],
    tools: ["SQLMap", "Burp Suite", "Havij", "jSQL Injection"],
    techniques: [
      "Filter bypass: case variation, comments, encoding",
      "Stacked queries for command execution",
      "Database fingerprinting via errors",
      "Reading/writing files via SQL (LOAD_FILE, INTO OUTFILE)",
      "Privilege escalation via database features",
    ],
    cwe: ["CWE-89: SQL Injection"],
  },
  {
    title: "NoSQL Injection",
    icon: <DataObjectIcon />,
    color: "#f59e0b",
    description: "Injection attacks against MongoDB, CouchDB, and other NoSQL databases.",
    keyPoints: [
      "MongoDB operator injection ($gt, $ne, $regex)",
      "JSON/BSON injection in queries",
      "JavaScript injection in MongoDB",
      "CouchDB view injection",
      "Redis command injection",
      "GraphQL query manipulation",
    ],
    techniques: [
      "Replace values with objects: {\"$gt\": \"\"}",
      "Array injection for operator bypass",
      "Regex-based data extraction",
      "Server-side JavaScript injection via $where",
      "Blind NoSQL injection via timing",
    ],
    cwe: ["CWE-943: Improper Neutralization of Special Elements in Data Query Logic"],
  },
  {
    title: "Server-Side Template Injection (SSTI)",
    icon: <CodeIcon />,
    color: "#8b5cf6",
    description: "Exploiting template engines to achieve remote code execution.",
    keyPoints: [
      "Template engine identification",
      "Jinja2/Twig/Freemarker exploitation",
      "Sandbox escape techniques",
      "Blind SSTI detection",
      "Polyglot payloads for detection",
    ],
    tools: ["Tplmap", "SSTImap", "Burp Suite"],
    techniques: [
      "Detection: {{7*7}}, ${7*7}, <%= 7*7 %>",
      "Jinja2 RCE: {{config.__class__.__init__.__globals__['os'].popen('id').read()}}",
      "Identify template engine via error messages",
      "Chain object traversal for RCE",
    ],
    cwe: ["CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine"],
  },
  {
    title: "XXE Injection",
    icon: <DescriptionIcon />,
    color: "#10b981",
    description: "XML External Entity attacks for file disclosure, SSRF, and denial of service.",
    keyPoints: [
      "Classic XXE for file reading",
      "Blind XXE with out-of-band exfiltration",
      "XXE via file upload (SVG, DOCX, XLSX)",
      "XXE in SOAP web services",
      "Parameter entity attacks",
      "XXE to SSRF escalation",
    ],
    techniques: [
      "Basic payload: <!ENTITY xxe SYSTEM \"file:///etc/passwd\">",
      "Blind exfil via external DTD",
      "Error-based XXE for data extraction",
      "XXE DoS via billion laughs attack",
      "Test in Content-Type: application/xml requests",
    ],
    cwe: ["CWE-611: Improper Restriction of XML External Entity Reference"],
  },
  {
    title: "LDAP Injection",
    icon: <AccountTreeIcon />,
    color: "#6366f1",
    description: "Manipulating LDAP queries to bypass authentication or extract directory data.",
    keyPoints: [
      "Authentication bypass via filter manipulation",
      "Data extraction from directory services",
      "Blind LDAP injection techniques",
      "AND/OR filter exploitation",
    ],
    techniques: [
      "Bypass: *)(&, *)(|, admin)(&)",
      "Wildcard extraction: a*, b*, c*...",
      "Boolean-based blind extraction",
      "Test in login forms using LDAP backends",
    ],
    cwe: ["CWE-90: LDAP Injection"],
  },
  {
    title: "ORM and Query Builder Issues",
    icon: <DataObjectIcon />,
    color: "#ec4899",
    description: "Vulnerabilities in Object-Relational Mappers and query construction libraries.",
    keyPoints: [
      "Raw query usage in ORMs",
      "Unsafe interpolation in query builders",
      "Mass assignment leading to injection",
      "Order by and column name injection",
      "JSON field query injection",
    ],
    techniques: [
      "Identify ORM (Sequelize, Prisma, SQLAlchemy, ActiveRecord)",
      "Test dynamic column/table names",
      "Check for raw() or literal() query methods",
      "Test JSON operators for injection",
    ],
  },
  {
    title: "Command and Header Injection",
    icon: <TerminalIcon />,
    color: "#dc2626",
    description: "OS command injection and HTTP header injection attacks.",
    keyPoints: [
      "Command chaining: ;, &&, ||, |, newlines",
      "Command substitution: $(cmd), `cmd`",
      "Argument injection: --flag injection",
      "HTTP header injection (CRLF)",
      "Host header attacks",
      "Email header injection",
    ],
    techniques: [
      "Test: ; whoami, | id, `sleep 5`",
      "CRLF: %0d%0a for header injection",
      "Host header: internal hostname access",
      "Email: recipient%0aBcc:attacker@evil.com",
    ],
    cwe: ["CWE-78: OS Command Injection", "CWE-113: HTTP Response Splitting"],
  },
];

// Section 4: Server-Side Attacks
const serverSideTopics: TopicSection[] = [
  {
    title: "Insecure Deserialization",
    icon: <DataObjectIcon />,
    color: "#ef4444",
    description: "Exploiting unsafe deserialization for RCE and other attacks.",
    keyPoints: [
      "Java serialization (ObjectInputStream)",
      "PHP unserialize() vulnerabilities",
      "Python pickle exploitation",
      ".NET BinaryFormatter/ViewState",
      "Ruby Marshal vulnerabilities",
      "JSON deserialization gadgets",
    ],
    tools: ["ysoserial", "PHPGGC", "marshalsec", "Burp Deserialization Scanner"],
    techniques: [
      "Identify serialized data (magic bytes, base64 patterns)",
      "Java: rO0AB, .NET: AAEAAAD, PHP: O:4:",
      "Test with gadget chains for target framework",
      "Check ViewState MAC validation",
    ],
    cwe: ["CWE-502: Deserialization of Untrusted Data"],
  },
  {
    title: "Server-Side Request Forgery (SSRF)",
    icon: <CloudIcon />,
    color: "#8b5cf6",
    description: "Forcing servers to make requests to unintended destinations.",
    keyPoints: [
      "Basic SSRF to internal services",
      "Cloud metadata endpoint access (169.254.169.254)",
      "Protocol smuggling (file://, gopher://, dict://)",
      "Blind SSRF detection",
      "SSRF filter bypass techniques",
      "SSRF to RCE escalation",
    ],
    techniques: [
      "Target: http://127.0.0.1, http://localhost, http://[::1]",
      "Cloud: http://169.254.169.254/latest/meta-data/",
      "Bypass: decimal IP, IPv6, DNS rebinding",
      "Redirect-based SSRF bypass",
    ],
    cwe: ["CWE-918: Server-Side Request Forgery"],
  },
  {
    title: "File Inclusion and Path Traversal",
    icon: <FolderIcon />,
    color: "#f59e0b",
    description: "Local and Remote File Inclusion, directory traversal attacks.",
    keyPoints: [
      "Local File Inclusion (LFI)",
      "Remote File Inclusion (RFI)",
      "Path traversal (../ sequences)",
      "Null byte injection (%00)",
      "Filter bypass techniques",
      "Log poisoning for LFI to RCE",
    ],
    techniques: [
      "Traversal: ../../../etc/passwd",
      "Encoding: ..%2f, ..%252f, ....//",
      "Wrappers: php://filter, php://input",
      "Windows: ..\\..\\..\\windows\\win.ini",
    ],
    cwe: ["CWE-22: Path Traversal", "CWE-98: Improper Control of Filename for Include"],
  },
  {
    title: "File Upload Vulnerabilities",
    icon: <UploadFileIcon />,
    color: "#10b981",
    description: "Bypassing upload restrictions to achieve code execution.",
    keyPoints: [
      "Extension bypass (.php5, .phtml, .phar)",
      "Content-Type manipulation",
      "Magic byte injection",
      "Double extension attacks",
      "Null byte in filename",
      "SVG/XML upload for XSS/XXE",
      "Polyglot files (valid image + code)",
    ],
    techniques: [
      "Test: shell.php.jpg, shell.php%00.jpg",
      "Bypass: change Content-Type to image/jpeg",
      "Add valid image header before PHP code",
      "Case variation: .PhP, .PHP5",
      "Check for path traversal in filename",
    ],
    cwe: ["CWE-434: Unrestricted Upload of File with Dangerous Type"],
  },
  {
    title: "Race Conditions",
    icon: <SpeedIcon />,
    color: "#06b6d4",
    description: "Time-of-check to time-of-use (TOCTOU) and other race condition attacks.",
    keyPoints: [
      "TOCTOU vulnerabilities",
      "Limit overrun (coupon reuse, balance manipulation)",
      "File operation races",
      "Session race conditions",
      "Database race conditions",
    ],
    tools: ["Turbo Intruder", "Race The Web", "Burp Repeater (parallel)"],
    techniques: [
      "Send many parallel requests simultaneously",
      "Target: coupon redemption, account balance, voting",
      "Use HTTP/2 single-packet attack",
      "Test file upload + access race",
    ],
    cwe: ["CWE-362: Race Condition"],
  },
  {
    title: "Server-Side Prototype Pollution",
    icon: <DataObjectIcon />,
    color: "#ec4899",
    description: "Polluting JavaScript object prototypes on the server for various attacks.",
    keyPoints: [
      "Polluting Object.prototype via __proto__",
      "Constructor prototype pollution",
      "Gadget chains for RCE",
      "DoS via prototype pollution",
      "Bypassing security checks",
    ],
    techniques: [
      "Payload: {\"__proto__\": {\"admin\": true}}",
      "Target: JSON merge operations, lodash.merge",
      "Look for RCE gadgets (child_process spawn options)",
      "Test: {\"constructor\": {\"prototype\": {\"polluted\": true}}}",
    ],
    cwe: ["CWE-1321: Improperly Controlled Modification of Object Prototype Attributes"],
  },
  {
    title: "Misconfiguration and Debug Endpoints",
    icon: <SettingsIcon />,
    color: "#6366f1",
    description: "Exploiting exposed debug features, default configs, and sensitive endpoints.",
    keyPoints: [
      "Debug mode enabled in production",
      "Stack traces and verbose errors",
      "Default credentials",
      "Exposed admin panels",
      "Actuator/health endpoints (Spring Boot)",
      "GraphQL introspection enabled",
      "Exposed .git, .env, backup files",
    ],
    techniques: [
      "Check: /debug, /console, /actuator, /graphql",
      "Test for Spring Boot Actuator endpoints",
      "Look for phpinfo(), Django debug mode",
      "Enumerate /.git/config, /.env, /backup.sql",
    ],
  },
];

// Section 5: Client-Side Attacks
const clientSideTopics: TopicSection[] = [
  {
    title: "Cross-Site Scripting (XSS)",
    icon: <JavascriptIcon />,
    color: "#ef4444",
    description: "Reflected, Stored, and DOM-based XSS attacks and filter bypasses.",
    keyPoints: [
      "Reflected XSS in URL parameters",
      "Stored XSS in user content",
      "DOM-based XSS via client-side code",
      "Mutation XSS (mXSS)",
      "Context-aware payload crafting",
      "CSP bypass techniques",
      "XSS filter evasion",
    ],
    tools: ["XSS Hunter", "Burp Suite", "DOMPurify (for testing)", "BeEF"],
    techniques: [
      "Basic: <script>alert(1)</script>",
      "Event handlers: <img onerror=alert(1) src=x>",
      "SVG: <svg onload=alert(1)>",
      "Template literals: ${alert(1)}",
      "Encoding bypass: &#x3c;script&#x3e;",
    ],
    cwe: ["CWE-79: Cross-site Scripting"],
  },
  {
    title: "Cross-Site Request Forgery (CSRF)",
    icon: <SyncAltIcon />,
    color: "#f59e0b",
    description: "Forcing authenticated users to perform unintended actions.",
    keyPoints: [
      "Classic CSRF with form submission",
      "CSRF token bypass techniques",
      "JSON-based CSRF attacks",
      "Login CSRF for session fixation",
      "Logout CSRF for denial of service",
      "SameSite cookie bypass",
    ],
    techniques: [
      "Check for missing CSRF tokens",
      "Test token validation (remove, reuse, predictable)",
      "Try changing Content-Type for JSON endpoints",
      "Test GET-based state-changing operations",
      "Check SameSite cookie attribute",
    ],
    cwe: ["CWE-352: Cross-Site Request Forgery"],
  },
  {
    title: "DOM-Based Attacks",
    icon: <WebIcon />,
    color: "#8b5cf6",
    description: "Client-side vulnerabilities exploiting DOM manipulation.",
    keyPoints: [
      "DOM XSS via innerHTML, document.write",
      "DOM-based open redirect",
      "DOM clobbering",
      "Client-side template injection",
      "Prototype pollution in browser",
      "PostMessage vulnerabilities",
    ],
    techniques: [
      "Trace data flow from sources to sinks",
      "Sources: location.hash, location.search, document.referrer",
      "Sinks: innerHTML, eval, setTimeout, location",
      "Test postMessage origin validation",
    ],
    cwe: ["CWE-79: Cross-site Scripting"],
  },
  {
    title: "CORS and Same-Origin Policy",
    icon: <PolicyIcon />,
    color: "#10b981",
    description: "Misconfigured Cross-Origin Resource Sharing and SOP bypass.",
    keyPoints: [
      "Overly permissive Access-Control-Allow-Origin",
      "Null origin exploitation",
      "Credential leakage via CORS",
      "Pre-flight request bypass",
      "CORS header injection",
    ],
    techniques: [
      "Test: Origin: https://evil.com",
      "Check for wildcard (*) with credentials",
      "Test null origin from sandboxed iframes",
      "Check for origin reflection without validation",
      "Verify Access-Control-Allow-Credentials",
    ],
    cwe: ["CWE-942: Permissive CORS Policy"],
  },
  {
    title: "Client-Side Validation and Business Logic",
    icon: <FactCheckIcon />,
    color: "#06b6d4",
    description: "Bypassing client-side controls and exploiting business logic flaws.",
    keyPoints: [
      "Hidden form field manipulation",
      "Client-side price/quantity modification",
      "Step skipping in multi-step processes",
      "Parameter tampering",
      "Business logic race conditions",
      "Negative quantity/price attacks",
    ],
    techniques: [
      "Intercept and modify all client-side validated data",
      "Test purchase flows with negative values",
      "Skip steps by directly accessing URLs",
      "Modify hidden fields (user ID, prices, roles)",
      "Test limits and boundaries",
    ],
  },
  {
    title: "Clickjacking and UI Redressing",
    icon: <MouseIcon />,
    color: "#ec4899",
    description: "Tricking users into clicking hidden elements via iframe overlay.",
    keyPoints: [
      "Classic clickjacking with transparent iframe",
      "Likejacking on social platforms",
      "Cursorjacking attacks",
      "Drag-and-drop data theft",
      "X-Frame-Options bypass",
      "CSP frame-ancestors bypass",
    ],
    techniques: [
      "Check for X-Frame-Options header",
      "Check CSP frame-ancestors directive",
      "Test iframe embedding from different origins",
      "Create PoC with opacity: 0 iframe",
    ],
    cwe: ["CWE-1021: Improper Restriction of Rendered UI Layers"],
  },
];

// Section 6: HTTP Smuggling
const smugglingTopics: TopicSection[] = [
  {
    title: "Classic HTTP Request Smuggling",
    icon: <HttpIcon />,
    color: "#ef4444",
    description: "CL.TE and TE.CL desynchronization attacks between front-end and back-end servers.",
    keyPoints: [
      "Content-Length vs Transfer-Encoding disagreement",
      "CL.TE: Front-end uses CL, back-end uses TE",
      "TE.CL: Front-end uses TE, back-end uses CL",
      "TE.TE: Obfuscating Transfer-Encoding header",
      "Request poisoning and response queue poisoning",
    ],
    techniques: [
      "CL.TE: Send request where CL is shorter than body + chunked",
      "TE.CL: Send chunked request with CL covering only first chunk",
      "Obfuscation: Transfer-Encoding: chunked, Transfer-Encoding: x",
      "Use timing to detect vulnerabilities",
    ],
    tools: ["Burp Suite HTTP Request Smuggler", "smuggler.py"],
    cwe: ["CWE-444: HTTP Request/Response Smuggling"],
  },
  {
    title: "HTTP/2 Request Smuggling",
    icon: <SpeedIcon />,
    color: "#8b5cf6",
    description: "Exploiting HTTP/2 to HTTP/1.1 downgrade for smuggling attacks.",
    keyPoints: [
      "H2.CL and H2.TE smuggling",
      "HTTP/2 header injection via CRLF",
      "Pseudo-header manipulation",
      "HTTP/2 exclusive headers exploitation",
      "Request tunneling via CONNECT",
    ],
    techniques: [
      "Inject headers via HTTP/2 binary framing",
      "Exploit Content-Length handling differences",
      "Use HTTP/2 CONNECT for request tunneling",
      "Test with HTTP/2-specific tools",
    ],
  },
  {
    title: "WebSocket Smuggling",
    icon: <WifiIcon />,
    color: "#10b981",
    description: "Exploiting WebSocket upgrade handling for cross-site attacks.",
    keyPoints: [
      "WebSocket hijacking via smuggling",
      "Cross-Site WebSocket Hijacking (CSWSH)",
      "WebSocket to HTTP downgrade",
      "Origin validation bypass",
    ],
    techniques: [
      "Smuggle requests via WebSocket upgrade",
      "Test Origin header validation",
      "Check for CSRF in WebSocket handshake",
      "Exploit reverse proxy WebSocket handling",
    ],
  },
  {
    title: "Browser Desync Attacks",
    icon: <LinkOffIcon />,
    color: "#f59e0b",
    description: "Client-side desynchronization for connection hijacking.",
    keyPoints: [
      "Client-side desync via CL.0",
      "Pause-based desync",
      "Browser connection pool poisoning",
      "Stealing other users' responses",
    ],
    techniques: [
      "CL.0: Server ignores Content-Length completely",
      "Poison browser's connection pool",
      "Exploit keep-alive connection reuse",
      "Target same-site credential theft",
    ],
  },
];

// Section 7: Testing Workflow
const workflowTopics: TopicSection[] = [
  {
    title: "Building Test Cases from Findings",
    icon: <AssignmentIcon />,
    color: "#3b82f6",
    description: "Structuring your testing approach based on initial reconnaissance.",
    keyPoints: [
      "Create test cases for each endpoint",
      "Map test cases to OWASP Testing Guide",
      "Prioritize based on functionality risk",
      "Document authentication requirements per test",
      "Track coverage and completion",
      "Use checklists for consistency",
    ],
    tips: [
      "Start with authentication and authorization tests",
      "Test input validation on all parameters",
      "Document expected vs actual behavior",
      "Retest after developers claim fixes",
    ],
  },
  {
    title: "Chaining Vulnerabilities",
    icon: <LinkIcon />,
    color: "#8b5cf6",
    description: "Combining multiple findings to demonstrate maximum business impact.",
    keyPoints: [
      "Self-XSS + CSRF = Reflected XSS impact",
      "IDOR + sensitive data = full account takeover",
      "SSRF + cloud metadata = credential theft",
      "Low-severity chain to critical impact",
      "Document attack paths clearly",
    ],
    techniques: [
      "Map relationships between vulnerabilities",
      "Consider multi-step attack scenarios",
      "Think like an attacker: what's the end goal?",
      "Demo chains in controlled PoC environments",
    ],
  },
  {
    title: "Safe Proof of Concept Guidelines",
    icon: <WarningIcon />,
    color: "#f59e0b",
    description: "Demonstrating impact without causing harm to production systems.",
    keyPoints: [
      "Use benign payloads (alert, console.log)",
      "Avoid data destruction or modification",
      "Don't access more data than needed to prove the issue",
      "Use your own test accounts where possible",
      "Document with screenshots and video",
      "Never exfiltrate real user data",
    ],
    tips: [
      "For RCE: whoami, hostname (not rm -rf)",
      "For SQLi: SELECT version(), not DROP TABLE",
      "For XSS: alert(document.domain), not cookie theft",
      "Always coordinate with client before exploitation",
    ],
  },
  {
    title: "Documenting and Prioritizing Issues",
    icon: <DescriptionIcon />,
    color: "#10b981",
    description: "Writing clear, actionable reports with proper severity ratings.",
    keyPoints: [
      "Use CVSS for consistent severity scoring",
      "Include clear reproduction steps",
      "Provide remediation recommendations",
      "Include business impact assessment",
      "Attach supporting evidence",
      "Executive summary for non-technical stakeholders",
    ],
    techniques: [
      "Title: Clear, specific vulnerability name",
      "Severity: Critical/High/Medium/Low/Info",
      "Description: What, where, why it matters",
      "Steps: Numbered, reproducible instructions",
      "Impact: What an attacker could achieve",
      "Remediation: How to fix it",
    ],
  },
];

const tabSections = [
  { label: "Overview", icon: <SearchIcon />, color: "#6366f1" },
  { label: "Auth & Access", icon: <LockIcon />, color: "#3b82f6" },
  { label: "Injection", icon: <BugReportIcon />, color: "#ef4444" },
  { label: "Server-Side", icon: <StorageIcon />, color: "#8b5cf6" },
  { label: "Client-Side", icon: <WebIcon />, color: "#f59e0b" },
  { label: "Smuggling", icon: <SyncAltIcon />, color: "#10b981" },
  { label: "Workflow", icon: <AssignmentIcon />, color: "#ec4899" },
];

function TopicAccordion({ topics, defaultExpanded = false }: { topics: TopicSection[]; defaultExpanded?: boolean }) {
  const theme = useTheme();

  return (
    <>
      {topics.map((topic, index) => (
        <Accordion
          key={topic.title}
          defaultExpanded={defaultExpanded && index === 0}
          sx={{
            mb: 2,
            border: `1px solid ${alpha(topic.color, 0.2)}`,
            borderRadius: "12px !important",
            "&:before": { display: "none" },
            overflow: "hidden",
          }}
        >
          <AccordionSummary
            expandIcon={<ExpandMoreIcon />}
            sx={{
              borderLeft: `4px solid ${topic.color}`,
              "&:hover": { bgcolor: alpha(topic.color, 0.02) },
            }}
          >
            <Box sx={{ display: "flex", alignItems: "center", gap: 2 }}>
              <Box
                sx={{
                  width: 40,
                  height: 40,
                  borderRadius: 2,
                  bgcolor: alpha(topic.color, 0.1),
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  color: topic.color,
                }}
              >
                {topic.icon}
              </Box>
              <Box>
                <Typography variant="h6" sx={{ fontWeight: 700 }}>
                  {topic.title}
                </Typography>
                <Typography variant="body2" color="text.secondary" sx={{ display: { xs: "none", sm: "block" } }}>
                  {topic.description}
                </Typography>
              </Box>
            </Box>
          </AccordionSummary>
          <AccordionDetails sx={{ pt: 0 }}>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3, display: { xs: "block", sm: "none" } }}>
              {topic.description}
            </Typography>

            <Grid container spacing={3}>
              {/* Key Points */}
              <Grid item xs={12} md={topic.techniques || topic.tools ? 6 : 12}>
                <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 2, color: topic.color }}>
                  üìã Key Points
                </Typography>
                <List dense disablePadding>
                  {topic.keyPoints.map((point, i) => (
                    <ListItem key={i} disableGutters sx={{ py: 0.5 }}>
                      <ListItemIcon sx={{ minWidth: 28 }}>
                        <CheckCircleIcon sx={{ fontSize: 16, color: topic.color }} />
                      </ListItemIcon>
                      <ListItemText
                        primary={point}
                        primaryTypographyProps={{ variant: "body2" }}
                      />
                    </ListItem>
                  ))}
                </List>
              </Grid>

              {/* Techniques and Tools */}
              {(topic.techniques || topic.tools) && (
                <Grid item xs={12} md={6}>
                  {topic.techniques && (
                    <Box sx={{ mb: 3 }}>
                      <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 2, color: "warning.main" }}>
                        ‚ö° Techniques
                      </Typography>
                      <Paper
                        sx={{
                          p: 2,
                          bgcolor: alpha(theme.palette.warning.main, 0.03),
                          border: `1px solid ${alpha(theme.palette.warning.main, 0.15)}`,
                          borderRadius: 2,
                        }}
                      >
                        {topic.techniques.map((technique, i) => (
                          <Typography
                            key={i}
                            variant="body2"
                            sx={{
                              fontFamily: "monospace",
                              fontSize: "0.8rem",
                              mb: i < topic.techniques!.length - 1 ? 1 : 0,
                            }}
                          >
                            ‚Üí {technique}
                          </Typography>
                        ))}
                      </Paper>
                    </Box>
                  )}

                  {topic.tools && (
                    <Box sx={{ mb: 2 }}>
                      <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 1.5 }}>
                        üõ†Ô∏è Tools
                      </Typography>
                      <Box sx={{ display: "flex", flexWrap: "wrap", gap: 0.5 }}>
                        {topic.tools.map((tool) => (
                          <Chip
                            key={tool}
                            label={tool}
                            size="small"
                            sx={{
                              bgcolor: alpha(topic.color, 0.1),
                              color: topic.color,
                              fontWeight: 500,
                            }}
                          />
                        ))}
                      </Box>
                    </Box>
                  )}

                  {topic.cwe && (
                    <Box>
                      <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 1 }}>
                        üîó Related CWEs
                      </Typography>
                      {topic.cwe.map((cwe) => (
                        <Chip
                          key={cwe}
                          label={cwe}
                          size="small"
                          variant="outlined"
                          sx={{ mr: 0.5, mb: 0.5, fontSize: "0.7rem" }}
                        />
                      ))}
                    </Box>
                  )}
                </Grid>
              )}

              {/* Tips */}
              {topic.tips && (
                <Grid item xs={12}>
                  <Alert
                    severity="info"
                    icon={<InfoIcon />}
                    sx={{
                      borderRadius: 2,
                      "& .MuiAlert-message": { width: "100%" },
                    }}
                  >
                    <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 1 }}>
                      üí° Pro Tips
                    </Typography>
                    <List dense disablePadding>
                      {topic.tips.map((tip, i) => (
                        <ListItem key={i} disableGutters sx={{ py: 0.25 }}>
                          <Typography variant="body2">‚Ä¢ {tip}</Typography>
                        </ListItem>
                      ))}
                    </List>
                  </Alert>
                </Grid>
              )}
            </Grid>
          </AccordionDetails>
        </Accordion>
      ))}
    </>
  );
}

export default function PentestGuidePage() {
  const theme = useTheme();
  const navigate = useNavigate();
  const [tabValue, setTabValue] = useState(0);

  const pageContext = `This page covers penetration testing methodology and techniques. Topics include: reconnaissance, scanning, enumeration, exploitation, post-exploitation, and reporting. Current tab: ${['Methodology', 'Web Testing', 'Network Testing', 'Social Engineering', 'Reporting'][tabValue] || 'Overview'}. Covers OWASP testing methodology, common attack vectors, and professional pentest workflows.`;

  return (
    <LearnPageLayout pageTitle="Penetration Testing Guide" pageContext={pageContext}>
    <Container maxWidth="lg" sx={{ py: 4 }}>
      {/* Back Button */}
      <IconButton onClick={() => navigate("/learn")} sx={{ mb: 2 }}>
        <ArrowBackIcon />
      </IconButton>

      {/* Header */}
      <Box sx={{ mb: 5 }}>
        <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
          <Box
            sx={{
              width: 64,
              height: 64,
              borderRadius: 3,
              background: `linear-gradient(135deg, ${theme.palette.error.main}, ${theme.palette.warning.main})`,
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              boxShadow: `0 8px 32px ${alpha(theme.palette.error.main, 0.3)}`,
            }}
          >
            <SecurityIcon sx={{ fontSize: 32, color: "white" }} />
          </Box>
          <Box>
            <Typography
              variant="h3"
              sx={{
                fontWeight: 800,
                background: `linear-gradient(135deg, ${theme.palette.error.main}, ${theme.palette.warning.main})`,
                backgroundClip: "text",
                WebkitBackgroundClip: "text",
                WebkitTextFillColor: "transparent",
              }}
            >
              Web App Pentesting Guide
            </Typography>
            <Typography variant="h6" color="text.secondary">
              Comprehensive methodology for professional security assessments
            </Typography>
          </Box>
        </Box>
      </Box>

      {/* Stats */}
      <Grid container spacing={2} sx={{ mb: 4 }}>
        {[
          { value: "7", label: "Sections", color: "#6366f1" },
          { value: "30+", label: "Attack Categories", color: "#ef4444" },
          { value: "100+", label: "Techniques", color: "#f59e0b" },
          { value: "50+", label: "Tools Referenced", color: "#10b981" },
        ].map((stat) => (
          <Grid item xs={6} md={3} key={stat.label}>
            <Paper
              sx={{
                p: 2.5,
                textAlign: "center",
                borderRadius: 3,
                border: `1px solid ${alpha(stat.color, 0.2)}`,
                background: `linear-gradient(135deg, ${alpha(stat.color, 0.05)}, transparent)`,
              }}
            >
              <Typography variant="h4" sx={{ fontWeight: 800, color: stat.color }}>
                {stat.value}
              </Typography>
              <Typography variant="body2" color="text.secondary">
                {stat.label}
              </Typography>
            </Paper>
          </Grid>
        ))}
      </Grid>

      {/* Disclaimer */}
      <Alert
        severity="warning"
        icon={<WarningIcon />}
        sx={{
          mb: 4,
          borderRadius: 3,
          border: `1px solid ${alpha(theme.palette.warning.main, 0.3)}`,
        }}
      >
        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
          ‚ö†Ô∏è Legal Disclaimer
        </Typography>
        <Typography variant="body2">
          This guide is for authorized security testing only. Always obtain written permission before testing.
          Unauthorized access to computer systems is illegal. Use this knowledge responsibly and ethically.
        </Typography>
      </Alert>

      {/* Tabs */}
      <Paper sx={{ borderRadius: 3, overflow: "hidden" }}>
        <Tabs
          value={tabValue}
          onChange={(_, v) => setTabValue(v)}
          variant="scrollable"
          scrollButtons="auto"
          sx={{
            bgcolor: alpha(theme.palette.background.paper, 0.8),
            borderBottom: `1px solid ${theme.palette.divider}`,
            "& .MuiTab-root": {
              minHeight: 64,
              textTransform: "none",
              fontWeight: 600,
            },
          }}
        >
          {tabSections.map((section, i) => (
            <Tab
              key={section.label}
              label={
                <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                  <Box sx={{ color: tabValue === i ? section.color : "text.secondary" }}>
                    {section.icon}
                  </Box>
                  {section.label}
                </Box>
              }
            />
          ))}
        </Tabs>

        <Box sx={{ p: 3 }}>
          <TabPanel value={tabValue} index={0}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üìã Overview and Methodology
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Before diving into technical attacks, establish your testing framework, understand the scope,
              and map the application's attack surface.
            </Typography>
            <TopicAccordion topics={overviewTopics} defaultExpanded />
          </TabPanel>

          <TabPanel value={tabValue} index={1}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üîê Authentication and Authorization
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Identity and access control vulnerabilities often lead to complete application compromise.
              Test authentication mechanisms, session management, and authorization controls thoroughly.
            </Typography>
            <TopicAccordion topics={authTopics} defaultExpanded />
          </TabPanel>

          <TabPanel value={tabValue} index={2}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üíâ Injection Attacks
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Injection flaws allow attackers to send hostile data to interpreters. These attacks remain
              among the most dangerous and prevalent web vulnerabilities.
            </Typography>
            <TopicAccordion topics={injectionTopics} defaultExpanded />
          </TabPanel>

          <TabPanel value={tabValue} index={3}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üñ•Ô∏è Advanced Server-Side Attacks
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Server-side vulnerabilities can lead to remote code execution, internal network access,
              and complete infrastructure compromise.
            </Typography>
            <TopicAccordion topics={serverSideTopics} defaultExpanded />
          </TabPanel>

          <TabPanel value={tabValue} index={4}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üåê Advanced Client-Side Attacks
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Client-side attacks target users' browsers to steal credentials, perform actions, or
              pivot to other attacks.
            </Typography>
            <TopicAccordion topics={clientSideTopics} defaultExpanded />
          </TabPanel>

          <TabPanel value={tabValue} index={5}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üîÄ HTTP Request Smuggling
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Request smuggling exploits discrepancies in how servers parse HTTP requests, enabling
              cache poisoning, credential theft, and security bypass.
            </Typography>
            <TopicAccordion topics={smugglingTopics} defaultExpanded />
          </TabPanel>

          <TabPanel value={tabValue} index={6}>
            <Typography variant="h5" sx={{ fontWeight: 700, mb: 1 }}>
              üìù Testing Workflow and Reporting
            </Typography>
            <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
              Professional pentesting requires structured methodology, safe exploitation, and clear
              communication of findings to stakeholders.
            </Typography>
            <TopicAccordion topics={workflowTopics} defaultExpanded />
          </TabPanel>
        </Box>
      </Paper>

      {/* Quick Reference */}
      <Paper sx={{ mt: 4, p: 4, borderRadius: 3 }}>
        <Typography variant="h5" sx={{ fontWeight: 700, mb: 3 }}>
          üöÄ Quick Reference: Testing Checklist
        </Typography>
        <Grid container spacing={3}>
          {[
            {
              phase: "Pre-Engagement",
              items: ["Scope definition", "Authorization docs", "Rules of engagement", "Emergency contacts"],
              color: "#6366f1",
            },
            {
              phase: "Reconnaissance",
              items: ["Subdomain enum", "Tech fingerprint", "Endpoint discovery", "API mapping"],
              color: "#8b5cf6",
            },
            {
              phase: "Authentication",
              items: ["Login bypass", "Session tests", "MFA bypass", "OAuth flows"],
              color: "#3b82f6",
            },
            {
              phase: "Authorization",
              items: ["IDOR tests", "Privilege escalation", "Role bypass", "API authz"],
              color: "#10b981",
            },
            {
              phase: "Injection",
              items: ["SQLi all params", "XSS contexts", "Command injection", "SSTI"],
              color: "#ef4444",
            },
            {
              phase: "Reporting",
              items: ["PoC creation", "Impact assessment", "Remediation advice", "Executive summary"],
              color: "#f59e0b",
            },
          ].map((phase) => (
            <Grid item xs={12} sm={6} md={4} key={phase.phase}>
              <Card
                sx={{
                  height: "100%",
                  borderTop: `4px solid ${phase.color}`,
                  borderRadius: 2,
                }}
              >
                <CardContent>
                  <Typography variant="subtitle1" sx={{ fontWeight: 700, mb: 1.5, color: phase.color }}>
                    {phase.phase}
                  </Typography>
                  {phase.items.map((item) => (
                    <Box key={item} sx={{ display: "flex", alignItems: "center", gap: 1, mb: 0.5 }}>
                      <Box
                        sx={{
                          width: 16,
                          height: 16,
                          border: `2px solid ${alpha(phase.color, 0.3)}`,
                          borderRadius: 0.5,
                        }}
                      />
                      <Typography variant="body2">{item}</Typography>
                    </Box>
                  ))}
                </CardContent>
              </Card>
            </Grid>
          ))}
        </Grid>
      </Paper>

      {/* Resources */}
      <Paper sx={{ mt: 4, p: 4, borderRadius: 3, bgcolor: alpha(theme.palette.info.main, 0.02) }}>
        <Typography variant="h5" sx={{ fontWeight: 700, mb: 3 }}>
          üìö Essential Resources
        </Typography>
        <Grid container spacing={2}>
          {[
            { name: "OWASP Testing Guide", url: "https://owasp.org/www-project-web-security-testing-guide/", desc: "Comprehensive web security testing methodology" },
            { name: "PortSwigger Web Security Academy", url: "https://portswigger.net/web-security", desc: "Free interactive labs for all attack types" },
            { name: "HackTricks", url: "https://book.hacktricks.xyz/", desc: "Practical hacking tricks and techniques" },
            { name: "PayloadsAllTheThings", url: "https://github.com/swisskyrepo/PayloadsAllTheThings", desc: "Payload collections for various attacks" },
            { name: "OWASP Cheat Sheet Series", url: "https://cheatsheetseries.owasp.org/", desc: "Quick reference for secure development" },
            { name: "Bug Bounty Hunting Essentials", url: "https://www.bugcrowd.com/hackers/bugcrowd-university/", desc: "Bug bounty methodology and tips" },
          ].map((resource) => (
            <Grid item xs={12} sm={6} key={resource.name}>
              <Paper
                sx={{
                  p: 2,
                  borderRadius: 2,
                  border: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
                  cursor: "pointer",
                  transition: "all 0.2s",
                  "&:hover": {
                    borderColor: "primary.main",
                    transform: "translateY(-2px)",
                  },
                }}
                onClick={() => window.open(resource.url, "_blank")}
              >
                <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "primary.main" }}>
                  {resource.name} ‚Üó
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  {resource.desc}
                </Typography>
              </Paper>
            </Grid>
          ))}
        </Grid>
      </Paper>
    </Container>
    </LearnPageLayout>
  );
}
