import React, { useState } from "react";
import LearnPageLayout from "../components/LearnPageLayout";
import {
  Box,
  Container,
  Typography,
  Paper,
  Chip,
  Button,
  Grid,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Tabs,
  Tab,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Card,
  CardContent,
  Alert,
  Divider,
  IconButton,
  Tooltip,
  alpha,
  LinearProgress,
  useTheme,
} from "@mui/material";
import ArrowBackIcon from "@mui/icons-material/ArrowBack";
import AndroidIcon from "@mui/icons-material/Android";
import SecurityIcon from "@mui/icons-material/Security";
import BugReportIcon from "@mui/icons-material/BugReport";
import StorageIcon from "@mui/icons-material/Storage";
import WifiIcon from "@mui/icons-material/Wifi";
import CodeIcon from "@mui/icons-material/Code";
import LockOpenIcon from "@mui/icons-material/LockOpen";
import BuildIcon from "@mui/icons-material/Build";
import SearchIcon from "@mui/icons-material/Search";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import WarningIcon from "@mui/icons-material/Warning";
import ExpandMoreIcon from "@mui/icons-material/ExpandMore";
import TerminalIcon from "@mui/icons-material/Terminal";
import ContentCopyIcon from "@mui/icons-material/ContentCopy";
import QuizIcon from "@mui/icons-material/Quiz";
import EmojiEventsIcon from "@mui/icons-material/EmojiEvents";
import RefreshIcon from "@mui/icons-material/Refresh";
import { useNavigate } from "react-router-dom";

// Quiz Question Interface
interface QuizQuestion {
  id: number;
  question: string;
  options: string[];
  correctAnswer: number;
  explanation: string;
  topic: string;
}

// Android Pentesting Quiz Question Bank (75 questions)
const questionBank: QuizQuestion[] = [
  // Section 1: Android Architecture (10 questions)
  { id: 1, question: "What is the Android application sandbox based on?", options: ["Container technology", "Linux user-based isolation (UID)", "Virtual machines", "Hardware isolation"], correctAnswer: 1, explanation: "Android uses Linux UID isolation to give each app its own sandbox with unique user ID.", topic: "Architecture" },
  { id: 2, question: "Where are Android APK files installed on the device?", options: ["/system/app/", "/data/app/", "/sdcard/Android/", "/cache/app/"], correctAnswer: 1, explanation: "User-installed APKs are stored in /data/app/, while system apps are in /system/app/.", topic: "Architecture" },
  { id: 3, question: "What is the purpose of AndroidManifest.xml?", options: ["Store app data", "Declare components, permissions, and app metadata", "Store user preferences", "Database schema"], correctAnswer: 1, explanation: "AndroidManifest.xml declares all app components, required permissions, and configuration.", topic: "Architecture" },
  { id: 4, question: "What are the four main Android components?", options: ["Views, Controllers, Models, Services", "Activities, Services, Content Providers, Broadcast Receivers", "Fragments, Activities, Views, Adapters", "Intents, Bundles, Tasks, Processes"], correctAnswer: 1, explanation: "Android has four main components: Activities, Services, Content Providers, and Broadcast Receivers.", topic: "Architecture" },
  { id: 5, question: "What is DEX in Android?", options: ["Device EXchange", "Dalvik Executable bytecode format", "Data Encryption eXtension", "Debug EXecution"], correctAnswer: 1, explanation: "DEX (Dalvik Executable) is the bytecode format compiled from Java/Kotlin for Android runtime.", topic: "Architecture" },
  { id: 6, question: "What replaced Dalvik runtime in Android 5.0+?", options: ["JVM", "ART (Android Runtime)", "V8 Engine", "Native code only"], correctAnswer: 1, explanation: "ART replaced Dalvik, using Ahead-of-Time (AOT) compilation for better performance.", topic: "Architecture" },
  { id: 7, question: "What is the purpose of SELinux on Android?", options: ["User interface", "Mandatory Access Control for security policies", "Network management", "Battery optimization"], correctAnswer: 1, explanation: "SELinux provides mandatory access control, enforcing security policies beyond DAC.", topic: "Architecture" },
  { id: 8, question: "Where does Android store app-specific private data?", options: ["/sdcard/<package>/", "/data/data/<package>/", "/system/data/<package>/", "/tmp/<package>/"], correctAnswer: 1, explanation: "Private app data is stored in /data/data/<package_name>/ with restricted permissions.", topic: "Architecture" },
  { id: 9, question: "What is the Zygote process in Android?", options: ["Garbage collector", "Parent process that forks to create new app processes", "Security daemon", "UI renderer"], correctAnswer: 1, explanation: "Zygote is the parent process that pre-loads common classes and forks for new apps.", topic: "Architecture" },
  { id: 10, question: "What are Android permission protection levels?", options: ["Low, Medium, High", "Normal, Dangerous, Signature, SignatureOrSystem", "User, Admin, Root", "Read, Write, Execute"], correctAnswer: 1, explanation: "Android has Normal, Dangerous, Signature, and SignatureOrSystem protection levels.", topic: "Architecture" },

  // Section 2: Static Analysis (12 questions)
  { id: 11, question: "What tool is used to decompile APK files to smali?", options: ["jadx", "apktool", "dex2jar", "jd-gui"], correctAnswer: 1, explanation: "apktool decompiles APKs to smali code and extracts resources.", topic: "Static Analysis" },
  { id: 12, question: "What is jadx used for?", options: ["APK signing", "Decompiling DEX to Java source code", "Network analysis", "Debugging"], correctAnswer: 1, explanation: "jadx decompiles DEX bytecode directly to readable Java source code.", topic: "Static Analysis" },
  { id: 13, question: "What should you check in AndroidManifest.xml for security?", options: ["Colors and themes", "Exported components, permissions, backup flags", "Layout references", "String resources"], correctAnswer: 1, explanation: "Check exported components, declared permissions, android:allowBackup, and debuggable flags.", topic: "Static Analysis" },
  { id: 14, question: "What does android:debuggable='true' indicate?", options: ["Better performance", "App can be debugged, potential security risk in production", "Debug logs enabled", "Developer mode required"], correctAnswer: 1, explanation: "debuggable=true allows debugging tools to attach, which is a security risk in production.", topic: "Static Analysis" },
  { id: 15, question: "What is the risk of android:allowBackup='true'?", options: ["No risk", "App data can be extracted via adb backup", "Slower backups", "Only affects cloud backup"], correctAnswer: 1, explanation: "allowBackup=true allows extracting app data using adb backup without root.", topic: "Static Analysis" },
  { id: 16, question: "What should you search for as hardcoded secrets?", options: ["Comments only", "API keys, passwords, tokens, credentials in code/strings", "Variable names", "Class names"], correctAnswer: 1, explanation: "Search for API keys, passwords, tokens, and credentials hardcoded in source or resources.", topic: "Static Analysis" },
  { id: 17, question: "What is network_security_config.xml used for?", options: ["Network speed settings", "Defining SSL/TLS and cleartext traffic policies", "WiFi passwords", "DNS settings"], correctAnswer: 1, explanation: "Network security config defines certificate pinning, cleartext traffic, and trust anchors.", topic: "Static Analysis" },
  { id: 18, question: "What does an exported Activity without permissions indicate?", options: ["Normal behavior", "Any app can launch this activity", "System activity", "Internal only"], correctAnswer: 1, explanation: "Exported activities without permission checks can be launched by any app.", topic: "Static Analysis" },
  { id: 19, question: "What is smali code?", options: ["Java bytecode", "Human-readable assembly for DEX", "C++ code", "Native code"], correctAnswer: 1, explanation: "Smali is a human-readable representation of DEX bytecode, similar to assembly.", topic: "Static Analysis" },
  { id: 20, question: "What tool analyzes Android apps for common vulnerabilities?", options: ["Photoshop", "MobSF (Mobile Security Framework)", "Word processor", "Spreadsheet app"], correctAnswer: 1, explanation: "MobSF performs automated static and dynamic analysis of Android and iOS apps.", topic: "Static Analysis" },
  { id: 21, question: "What is the purpose of reviewing ProGuard/R8 configuration?", options: ["UI design", "Check code obfuscation and optimization settings", "Database setup", "Network config"], correctAnswer: 1, explanation: "ProGuard/R8 configs show obfuscation level and whether sensitive code is protected.", topic: "Static Analysis" },
  { id: 22, question: "What are .so files in an APK?", options: ["Sound files", "Native shared libraries (compiled C/C++ code)", "Style files", "Source files"], correctAnswer: 1, explanation: ".so files are native libraries containing compiled C/C++ code.", topic: "Static Analysis" },

  // Section 3: Dynamic Analysis (12 questions)
  { id: 23, question: "What is ADB used for in Android pentesting?", options: ["Audio editing", "Debugging, installing apps, and device shell access", "Photo editing", "Game development"], correctAnswer: 1, explanation: "ADB (Android Debug Bridge) enables debugging, app installation, and shell access.", topic: "Dynamic Analysis" },
  { id: 24, question: "What is Frida used for?", options: ["Photo filters", "Dynamic instrumentation and runtime manipulation", "File compression", "Email"], correctAnswer: 1, explanation: "Frida injects JavaScript to hook functions and modify app behavior at runtime.", topic: "Dynamic Analysis" },
  { id: 25, question: "What is objection?", options: ["Legal term", "Runtime mobile exploration toolkit built on Frida", "IDE", "Compiler"], correctAnswer: 1, explanation: "objection provides ready-made Frida scripts for common mobile pentesting tasks.", topic: "Dynamic Analysis" },
  { id: 26, question: "What is Drozer?", options: ["Drone software", "Android security assessment framework", "Music app", "Weather app"], correctAnswer: 1, explanation: "Drozer is a comprehensive framework for Android security testing.", topic: "Dynamic Analysis" },
  { id: 27, question: "How do you capture network traffic from an Android app?", options: ["Screenshot", "Configure proxy (Burp/mitmproxy) with CA certificate installed", "Record screen", "Take photo"], correctAnswer: 1, explanation: "Install proxy CA certificate and configure device to route traffic through the proxy.", topic: "Dynamic Analysis" },
  { id: 28, question: "What is logcat used for?", options: ["Photo catalog", "Viewing device and application logs", "Contact list", "App store"], correctAnswer: 1, explanation: "logcat displays system and application logs for debugging and analysis.", topic: "Dynamic Analysis" },
  { id: 29, question: "What is the Android Emulator useful for in pentesting?", options: ["Gaming", "Testing apps without physical device, easier to root", "Video editing", "Music production"], correctAnswer: 1, explanation: "Emulators allow testing without devices and can be easily configured for security testing.", topic: "Dynamic Analysis" },
  { id: 30, question: "What does 'adb shell' provide?", options: ["GUI interface", "Command-line shell access to the device", "File browser", "App store"], correctAnswer: 1, explanation: "adb shell provides interactive command-line access to the Android device.", topic: "Dynamic Analysis" },
  { id: 31, question: "How can you bypass SSL pinning?", options: ["Cannot be bypassed", "Using Frida scripts or patching the app", "Only by reinstalling", "Only on old devices"], correctAnswer: 1, explanation: "SSL pinning can be bypassed with Frida scripts, objection, or by modifying the APK.", topic: "Dynamic Analysis" },
  { id: 32, question: "What is root access useful for in pentesting?", options: ["Nothing", "Full filesystem access, bypassing sandbox restrictions", "Only for gaming", "Only for customization"], correctAnswer: 1, explanation: "Root access allows examining protected directories and bypassing security restrictions.", topic: "Dynamic Analysis" },
  { id: 33, question: "What is Magisk?", options: ["Magic trick app", "Systemless root solution with module support", "Music app", "Camera app"], correctAnswer: 1, explanation: "Magisk provides systemless root and can hide root status from apps.", topic: "Dynamic Analysis" },
  { id: 34, question: "What is memory dumping used for?", options: ["Freeing RAM", "Extracting sensitive data like keys from process memory", "Installing apps", "Taking screenshots"], correctAnswer: 1, explanation: "Memory dumping extracts runtime data including decrypted secrets and keys.", topic: "Dynamic Analysis" },

  // Section 4: Data Storage (10 questions)
  { id: 35, question: "What is SharedPreferences?", options: ["Social sharing", "Key-value storage for app preferences", "App store", "Contact sharing"], correctAnswer: 1, explanation: "SharedPreferences stores simple key-value pairs, often in XML format.", topic: "Data Storage" },
  { id: 36, question: "Where are SharedPreferences files stored?", options: ["/sdcard/", "/data/data/<pkg>/shared_prefs/", "/system/prefs/", "/tmp/prefs/"], correctAnswer: 1, explanation: "SharedPreferences are stored in /data/data/<package>/shared_prefs/ as XML files.", topic: "Data Storage" },
  { id: 37, question: "What is the Android KeyStore?", options: ["App store", "Hardware-backed secure key storage", "Password manager app", "File storage"], correctAnswer: 1, explanation: "Android KeyStore provides secure, often hardware-backed, storage for cryptographic keys.", topic: "Data Storage" },
  { id: 38, question: "What type of database do Android apps commonly use?", options: ["Oracle", "SQLite", "MongoDB", "PostgreSQL"], correctAnswer: 1, explanation: "SQLite is the default embedded database for Android applications.", topic: "Data Storage" },
  { id: 39, question: "What should you check in SQLite databases?", options: ["Query speed only", "Unencrypted sensitive data, credentials, tokens", "Table count", "Database size"], correctAnswer: 1, explanation: "Check for sensitive data stored unencrypted including credentials and tokens.", topic: "Data Storage" },
  { id: 40, question: "What is SQLCipher?", options: ["SQL editor", "Encryption extension for SQLite databases", "Cloud database", "Database backup"], correctAnswer: 1, explanation: "SQLCipher adds AES encryption to SQLite databases for secure storage.", topic: "Data Storage" },
  { id: 41, question: "What files should be checked on the SD card?", options: ["System files", "App-created files that may contain sensitive data", "Nothing", "Only photos"], correctAnswer: 1, explanation: "Apps may write sensitive data to external storage which is accessible to other apps.", topic: "Data Storage" },
  { id: 42, question: "What is the risk of logging sensitive data?", options: ["No risk", "Logs accessible via logcat or backup extraction", "Only affects debug builds", "Only affects performance"], correctAnswer: 1, explanation: "Sensitive data in logs can be read by other apps with READ_LOGS or via adb.", topic: "Data Storage" },
  { id: 43, question: "What is the cache directory used for?", options: ["Permanent storage", "Temporary storage that may contain sensitive cached data", "System files only", "Nothing sensitive"], correctAnswer: 1, explanation: "Cache may contain sensitive temporary data that persists longer than expected.", topic: "Data Storage" },
  { id: 44, question: "How can you access app files on a rooted device?", options: ["Cannot access", "Navigate to /data/data/<package>/ as root", "Only via backup", "Only via ADB pull"], correctAnswer: 1, explanation: "Root access allows direct filesystem navigation to app private directories.", topic: "Data Storage" },

  // Section 5: Network Security (10 questions)
  { id: 45, question: "What is certificate pinning?", options: ["Physical pinning", "Hardcoding expected server certificates in the app", "Network speed", "DNS pinning"], correctAnswer: 1, explanation: "Certificate pinning validates server certificates against embedded expected values.", topic: "Network Security" },
  { id: 46, question: "What is cleartext traffic?", options: ["Encrypted data", "Unencrypted HTTP traffic", "Clean traffic", "Filtered traffic"], correctAnswer: 1, explanation: "Cleartext traffic is unencrypted HTTP that exposes data to eavesdroppers.", topic: "Network Security" },
  { id: 47, question: "What does android:usesCleartextTraffic='false' enforce?", options: ["Nothing", "Blocks unencrypted HTTP connections", "Enables HTTP", "Disables network"], correctAnswer: 1, explanation: "usesCleartextTraffic=false prevents the app from making unencrypted HTTP requests.", topic: "Network Security" },
  { id: 48, question: "What is a WebView vulnerability?", options: ["Display issue", "JavaScript execution and file access through WebView", "Performance bug", "Layout problem"], correctAnswer: 1, explanation: "Insecure WebViews can execute malicious JavaScript or expose local files.", topic: "Network Security" },
  { id: 49, question: "What is MITM attack?", options: ["Movie title", "Man-in-the-Middle - intercepting communications", "Memory test", "Mobile app"], correctAnswer: 1, explanation: "MITM attacks intercept communications between the app and server.", topic: "Network Security" },
  { id: 50, question: "How to install CA certificate on Android 7+?", options: ["Just download", "Add to system store (requires root) or use network_security_config", "Email it", "Cannot install"], correctAnswer: 1, explanation: "Android 7+ requires system CA store (root) or app-specific trust config.", topic: "Network Security" },
  { id: 51, question: "What is OkHttp?", options: ["Greeting", "Popular HTTP client library for Android", "Authentication protocol", "Encryption algorithm"], correctAnswer: 1, explanation: "OkHttp is a widely-used HTTP client library in Android applications.", topic: "Network Security" },
  { id: 52, question: "What are common API vulnerabilities to test?", options: ["UI issues", "IDOR, injection, broken auth, rate limiting", "Performance only", "Design issues"], correctAnswer: 1, explanation: "Test for IDOR, injection flaws, authentication issues, and missing rate limits.", topic: "Network Security" },
  { id: 53, question: "What is intent sniffing?", options: ["Smelling intents", "Intercepting broadcast intents for sensitive data", "Intent debugging", "Intent creation"], correctAnswer: 1, explanation: "Malicious apps can intercept implicit broadcast intents to capture sensitive data.", topic: "Network Security" },
  { id: 54, question: "What is deep link vulnerability?", options: ["Deep web", "Manipulating app behavior through malicious deep links", "Link depth", "URL shortening"], correctAnswer: 1, explanation: "Malicious deep links can hijack app navigation or inject parameters.", topic: "Network Security" },

  // Section 6: Component Security (10 questions)
  { id: 55, question: "What is an exported component?", options: ["Deleted component", "Component accessible by other apps", "Hidden component", "System component"], correctAnswer: 1, explanation: "Exported components can be accessed and invoked by other applications.", topic: "Components" },
  { id: 56, question: "What is intent injection?", options: ["Drug injection", "Manipulating intents to access unauthorized functionality", "Intent creation", "Intent logging"], correctAnswer: 1, explanation: "Intent injection manipulates intent parameters to bypass security checks.", topic: "Components" },
  { id: 57, question: "What is a Content Provider vulnerability?", options: ["Content creation", "SQL injection or path traversal through providers", "Performance issue", "UI bug"], correctAnswer: 1, explanation: "Content Providers can be vulnerable to SQL injection or directory traversal.", topic: "Components" },
  { id: 58, question: "What is a Broadcast Receiver risk?", options: ["Radio quality", "Receiving malicious broadcasts or leaking data in broadcasts", "Sound issues", "Connectivity"], correctAnswer: 1, explanation: "Receivers may process malicious broadcasts or leak data in sent broadcasts.", topic: "Components" },
  { id: 59, question: "What is Service hijacking?", options: ["Car theft", "Binding to exported services to access functionality", "Service restart", "Performance issue"], correctAnswer: 1, explanation: "Exported services without proper permissions can be bound by malicious apps.", topic: "Components" },
  { id: 60, question: "What is a PendingIntent vulnerability?", options: ["Waiting too long", "Mutable PendingIntents can be modified by receivers", "Intent delay", "Performance issue"], correctAnswer: 1, explanation: "Mutable PendingIntents can be altered by receiving apps to perform unintended actions.", topic: "Components" },
  { id: 61, question: "What permission protects inter-app communication?", options: ["INTERNET", "Custom signature-level permissions", "STORAGE", "CAMERA"], correctAnswer: 1, explanation: "Signature-level permissions restrict access to apps signed with the same certificate.", topic: "Components" },
  { id: 62, question: "What is task hijacking?", options: ["Job stealing", "Manipulating activity back stack for phishing", "Task management", "Performance issue"], correctAnswer: 1, explanation: "Task hijacking manipulates the activity stack to overlay fake login screens.", topic: "Components" },
  { id: 63, question: "What flag prevents activity from appearing in recents?", options: ["FLAG_HIDDEN", "FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS", "FLAG_PRIVATE", "FLAG_SECURE"], correctAnswer: 1, explanation: "FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS prevents the activity from showing in recent apps.", topic: "Components" },
  { id: 64, question: "What is the Fragment injection vulnerability?", options: ["Code split", "Loading arbitrary fragments through extras", "UI layout", "Memory issue"], correctAnswer: 1, explanation: "PreferenceActivity could load arbitrary fragments through manipulated extras.", topic: "Components" },

  // Section 7: Binary Protection (11 questions)
  { id: 65, question: "What is root detection?", options: ["Plant care", "Checking if device has root access to protect against tampering", "User detection", "Network check"], correctAnswer: 1, explanation: "Root detection identifies compromised devices where app security may be bypassed.", topic: "Binary Protection" },
  { id: 66, question: "How can root detection be bypassed?", options: ["Cannot bypass", "Frida hooks, Magisk Hide, binary patching", "Only by unrooting", "Only by reinstalling"], correctAnswer: 1, explanation: "Root detection can be bypassed using Frida, Magisk Hide, or modifying the app.", topic: "Binary Protection" },
  { id: 67, question: "What is emulator detection?", options: ["Finding virtual devices", "Detecting if app runs in emulator for anti-analysis", "Hardware check", "Screen check"], correctAnswer: 1, explanation: "Emulator detection prevents analysis in controlled virtualized environments.", topic: "Binary Protection" },
  { id: 68, question: "What is APK signature verification?", options: ["File size check", "Verifying the app's cryptographic signature hasn't changed", "Name check", "Date check"], correctAnswer: 1, explanation: "Signature verification detects if the APK has been tampered with or re-signed.", topic: "Binary Protection" },
  { id: 69, question: "What is code obfuscation?", options: ["Code deletion", "Making code difficult to understand through renaming", "Code compilation", "Code formatting"], correctAnswer: 1, explanation: "Obfuscation makes reverse engineering harder by obscuring code logic and names.", topic: "Binary Protection" },
  { id: 70, question: "What is RASP?", options: ["Music genre", "Runtime Application Self-Protection", "Network protocol", "File format"], correctAnswer: 1, explanation: "RASP provides runtime security by detecting and responding to attacks.", topic: "Binary Protection" },
  { id: 71, question: "What is SafetyNet/Play Integrity?", options: ["Safety net for falls", "Google's device integrity verification API", "Network security", "Antivirus"], correctAnswer: 1, explanation: "SafetyNet/Play Integrity verifies device integrity and app authenticity.", topic: "Binary Protection" },
  { id: 72, question: "What is native code protection?", options: ["Nature protection", "Protecting C/C++ code from reverse engineering", "Java protection", "Resource protection"], correctAnswer: 1, explanation: "Native code may be protected with obfuscation, packing, or anti-debug checks.", topic: "Binary Protection" },
  { id: 73, question: "What is app attestation?", options: ["Witness statement", "Verifying app integrity with server-side checks", "User verification", "Network check"], correctAnswer: 1, explanation: "App attestation uses server-side verification to ensure app hasn't been tampered.", topic: "Binary Protection" },
  { id: 74, question: "What is debugger detection?", options: ["Finding bugs", "Detecting attached debuggers to prevent analysis", "Debug logging", "Error detection"], correctAnswer: 1, explanation: "Debugger detection prevents dynamic analysis by detecting attached debuggers.", topic: "Binary Protection" },
  { id: 75, question: "What is anti-hooking?", options: ["Fishing protection", "Detecting and preventing function hooking by tools like Frida", "UI protection", "Network security"], correctAnswer: 1, explanation: "Anti-hooking detects when tools like Frida attempt to hook app functions.", topic: "Binary Protection" },
];

// Quiz Section Component
function QuizSection() {
  const theme = useTheme();
  const [quizStarted, setQuizStarted] = React.useState(false);
  const [currentQuestions, setCurrentQuestions] = React.useState<QuizQuestion[]>([]);
  const [userAnswers, setUserAnswers] = React.useState<{ [key: number]: number }>({});
  const [showResults, setShowResults] = React.useState(false);
  const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);

  const shuffleAndSelectQuestions = () => {
    const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
    return shuffled.slice(0, 10);
  };

  const startQuiz = () => {
    setCurrentQuestions(shuffleAndSelectQuestions());
    setUserAnswers({});
    setShowResults(false);
    setCurrentQuestionIndex(0);
    setQuizStarted(true);
  };

  const handleAnswerSelect = (questionId: number, answerIndex: number) => {
    setUserAnswers((prev) => ({ ...prev, [questionId]: answerIndex }));
  };

  const calculateScore = () => {
    let correct = 0;
    currentQuestions.forEach((q) => {
      if (userAnswers[q.id] === q.correctAnswer) correct++;
    });
    return correct;
  };

  const getScoreColor = (score: number) => {
    if (score >= 8) return "#3ddc84";
    if (score >= 6) return "#f59e0b";
    return "#ef4444";
  };

  const getScoreMessage = (score: number) => {
    if (score === 10) return "Perfect! You're an Android security master! ðŸ†";
    if (score >= 8) return "Excellent! Strong Android pentesting knowledge! ðŸ¤–";
    if (score >= 6) return "Good job! Keep studying Android security! ðŸ“š";
    if (score >= 4) return "Not bad, but review the material again. ðŸ’ª";
    return "Keep learning! Review the sections above. ðŸ“–";
  };

  if (!quizStarted) {
    return (
      <Paper id="quiz-section" sx={{ p: 4, mb: 4, borderRadius: 3, bgcolor: alpha("#3ddc84", 0.03), border: `2px solid ${alpha("#3ddc84", 0.2)}` }}>
        <Typography variant="h5" sx={{ fontWeight: 800, mb: 2, display: "flex", alignItems: "center", gap: 2 }}>
          <Box sx={{ width: 48, height: 48, borderRadius: 2, background: "linear-gradient(135deg, #3ddc84, #00c853)", display: "flex", alignItems: "center", justifyContent: "center" }}>
            <QuizIcon sx={{ color: "white", fontSize: 28 }} />
          </Box>
          Test Your Android Pentesting Knowledge
        </Typography>
        <Typography variant="body1" sx={{ mb: 3, color: "text.secondary" }}>
          Ready to test what you've learned? Take this <strong>10-question quiz</strong> covering Android security testing. Questions are randomly selected from a pool of <strong>75 questions</strong>!
        </Typography>
        <Grid container spacing={2} sx={{ mb: 3 }}>
          {[{ label: "Questions", value: "10", color: "#3ddc84" }, { label: "Question Pool", value: "75", color: "#3b82f6" }, { label: "Topics", value: "7", color: "#8b5cf6" }, { label: "Retakes", value: "âˆž", color: "#f59e0b" }].map((stat) => (
            <Grid item xs={6} sm={3} key={stat.label}>
              <Paper sx={{ p: 2, textAlign: "center", bgcolor: alpha(stat.color, 0.1), borderRadius: 2 }}>
                <Typography variant="h4" sx={{ fontWeight: 800, color: stat.color }}>{stat.value}</Typography>
                <Typography variant="caption" color="text.secondary">{stat.label}</Typography>
              </Paper>
            </Grid>
          ))}
        </Grid>
        <Button variant="contained" size="large" onClick={startQuiz} startIcon={<QuizIcon />} sx={{ background: "linear-gradient(135deg, #3ddc84, #00c853)", fontWeight: 700, px: 4, py: 1.5, "&:hover": { background: "linear-gradient(135deg, #00c853, #00a043)" } }}>
          Start Quiz
        </Button>
      </Paper>
    );
  }

  if (showResults) {
    const score = calculateScore();
    return (
      <Paper id="quiz-section" sx={{ p: 4, mb: 4, borderRadius: 3, border: `2px solid ${alpha(getScoreColor(score), 0.3)}` }}>
        <Typography variant="h5" sx={{ fontWeight: 800, mb: 3, display: "flex", alignItems: "center", gap: 2 }}>
          <EmojiEventsIcon sx={{ color: getScoreColor(score), fontSize: 36 }} /> Quiz Results
        </Typography>
        <Box sx={{ textAlign: "center", mb: 4 }}>
          <Typography variant="h1" sx={{ fontWeight: 900, color: getScoreColor(score) }}>{score}/10</Typography>
          <Typography variant="h6" color="text.secondary" sx={{ mb: 2 }}>{getScoreMessage(score)}</Typography>
          <Chip label={`${score * 10}%`} sx={{ bgcolor: alpha(getScoreColor(score), 0.15), color: getScoreColor(score), fontWeight: 700, fontSize: "1rem" }} />
        </Box>
        <Divider sx={{ my: 3 }} />
        <Typography variant="h6" sx={{ fontWeight: 700, mb: 2 }}>Review Your Answers:</Typography>
        {currentQuestions.map((q, index) => {
          const isCorrect = userAnswers[q.id] === q.correctAnswer;
          return (
            <Paper key={q.id} sx={{ p: 2, mb: 2, borderRadius: 2, bgcolor: alpha(isCorrect ? "#3ddc84" : "#ef4444", 0.05), border: `1px solid ${alpha(isCorrect ? "#3ddc84" : "#ef4444", 0.2)}` }}>
              <Box sx={{ display: "flex", alignItems: "flex-start", gap: 1, mb: 1 }}>
                <Chip label={`Q${index + 1}`} size="small" sx={{ bgcolor: isCorrect ? "#3ddc84" : "#ef4444", color: "white", fontWeight: 700 }} />
                <Typography variant="body2" sx={{ fontWeight: 600 }}>{q.question}</Typography>
              </Box>
              <Typography variant="body2" color="text.secondary" sx={{ ml: 5 }}>
                <strong>Your answer:</strong> {q.options[userAnswers[q.id]] || "Not answered"}
                {!isCorrect && (<><br /><strong style={{ color: "#3ddc84" }}>Correct:</strong> {q.options[q.correctAnswer]}</>)}
              </Typography>
              {!isCorrect && <Alert severity="info" sx={{ mt: 1, ml: 5 }}><Typography variant="caption">{q.explanation}</Typography></Alert>}
            </Paper>
          );
        })}
        <Box sx={{ display: "flex", gap: 2, mt: 3 }}>
          <Button variant="contained" onClick={startQuiz} startIcon={<RefreshIcon />} sx={{ background: "linear-gradient(135deg, #3ddc84, #00c853)", fontWeight: 700 }}>Try Again</Button>
          <Button variant="outlined" onClick={() => setQuizStarted(false)}>Back to Overview</Button>
        </Box>
      </Paper>
    );
  }

  const currentQuestion = currentQuestions[currentQuestionIndex];
  const answeredCount = Object.keys(userAnswers).length;

  return (
    <Paper id="quiz-section" sx={{ p: 4, mb: 4, borderRadius: 3, border: `2px solid ${alpha("#3ddc84", 0.2)}` }}>
      <Box sx={{ mb: 3 }}>
        <Box sx={{ display: "flex", justifyContent: "space-between", alignItems: "center", mb: 1 }}>
          <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>Question {currentQuestionIndex + 1} of 10</Typography>
          <Chip label={currentQuestion.topic} size="small" sx={{ bgcolor: alpha("#8b5cf6", 0.15), color: "#8b5cf6", fontWeight: 600 }} />
        </Box>
        <LinearProgress variant="determinate" value={((currentQuestionIndex + 1) / 10) * 100} sx={{ height: 8, borderRadius: 1, bgcolor: alpha("#3ddc84", 0.1), "& .MuiLinearProgress-bar": { bgcolor: "#3ddc84" } }} />
      </Box>
      <Typography variant="h6" sx={{ fontWeight: 700, mb: 3, lineHeight: 1.5 }}>{currentQuestion.question}</Typography>
      <Grid container spacing={2} sx={{ mb: 4 }}>
        {currentQuestion.options.map((option, index) => {
          const isSelected = userAnswers[currentQuestion.id] === index;
          return (
            <Grid item xs={12} key={index}>
              <Paper onClick={() => handleAnswerSelect(currentQuestion.id, index)} sx={{ p: 2, borderRadius: 2, cursor: "pointer", bgcolor: isSelected ? alpha("#3ddc84", 0.1) : "background.paper", border: `2px solid ${isSelected ? "#3ddc84" : alpha(theme.palette.divider, 0.2)}`, transition: "all 0.2s", "&:hover": { borderColor: "#3ddc84", bgcolor: alpha("#3ddc84", 0.05) } }}>
                <Box sx={{ display: "flex", alignItems: "center", gap: 2 }}>
                  <Box sx={{ width: 32, height: 32, borderRadius: "50%", bgcolor: isSelected ? "#3ddc84" : alpha(theme.palette.divider, 0.3), color: isSelected ? "white" : "text.secondary", display: "flex", alignItems: "center", justifyContent: "center", fontWeight: 700 }}>{String.fromCharCode(65 + index)}</Box>
                  <Typography variant="body1" sx={{ fontWeight: isSelected ? 600 : 400 }}>{option}</Typography>
                </Box>
              </Paper>
            </Grid>
          );
        })}
      </Grid>
      <Box sx={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <Button variant="outlined" disabled={currentQuestionIndex === 0} onClick={() => setCurrentQuestionIndex((p) => p - 1)}>Previous</Button>
        <Typography variant="body2" color="text.secondary">{answeredCount}/10 answered</Typography>
        {currentQuestionIndex < 9 ? (
          <Button variant="contained" onClick={() => setCurrentQuestionIndex((p) => p + 1)} sx={{ background: "linear-gradient(135deg, #3ddc84, #00c853)" }}>Next</Button>
        ) : (
          <Button variant="contained" onClick={() => setShowResults(true)} disabled={answeredCount < 10} sx={{ background: answeredCount >= 10 ? "linear-gradient(135deg, #3b82f6, #2563eb)" : undefined, fontWeight: 700 }}>Submit Quiz</Button>
        )}
      </Box>
    </Paper>
  );
}

interface TabPanelProps {
  children?: React.ReactNode;
  index: number;
  value: number;
}

function TabPanel(props: TabPanelProps) {
  const { children, value, index, ...other } = props;
  return (
    <div role="tabpanel" hidden={value !== index} {...other}>
      {value === index && <Box sx={{ py: 3 }}>{children}</Box>}
    </div>
  );
}

const CodeBlock: React.FC<{ code: string; language?: string; title?: string }> = ({
  code,
  language = "bash",
  title,
}) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = () => {
    navigator.clipboard.writeText(code);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <Paper
      sx={{
        bgcolor: "#0d1117",
        borderRadius: 2,
        position: "relative",
        my: 2,
        border: "1px solid rgba(34, 197, 94, 0.2)",
        overflow: "hidden",
      }}
    >
      {title && (
        <Box sx={{ px: 2, py: 1, bgcolor: "rgba(34, 197, 94, 0.1)", borderBottom: "1px solid rgba(34, 197, 94, 0.2)" }}>
          <Typography variant="subtitle2" sx={{ color: "#22c55e", fontWeight: 600 }}>{title}</Typography>
        </Box>
      )}
      <Box sx={{ position: "absolute", top: title ? 40 : 8, right: 8, display: "flex", gap: 1 }}>
        <Chip label={language} size="small" sx={{ bgcolor: alpha("#22c55e", 0.2), color: "#22c55e", fontSize: "0.7rem" }} />
        <Tooltip title={copied ? "Copied!" : "Copy"}>
          <IconButton size="small" onClick={handleCopy} sx={{ color: copied ? "#22c55e" : "#888" }}>
            <ContentCopyIcon fontSize="small" />
          </IconButton>
        </Tooltip>
      </Box>
      <Box
        component="pre"
        sx={{
          m: 0,
          p: 2,
          pt: 3,
          overflow: "auto",
          fontFamily: "'Fira Code', 'Consolas', monospace",
          fontSize: "0.8rem",
          color: "#e6edf3",
          lineHeight: 1.6,
        }}
      >
        {code}
      </Box>
    </Paper>
  );
};

const introHighlights = [
  "Map the Android attack surface using the manifest, permissions, and exported components.",
  "Perform static analysis on the APK to locate insecure configs and hardcoded secrets.",
  "Run the app and intercept traffic to understand API calls and data flow.",
  "Validate data storage and crypto usage with repeatable, beginner friendly steps.",
  "Document issues with clear evidence and remediation guidance.",
];

const prerequisites = [
  "Basic command line comfort (adb, unzip, grep)",
  "Android emulator or test device",
  "Proxy tool (Burp Suite or mitmproxy)",
  "APK sample to test and permission to do so",
];

const scopeChecklist = [
  "Confirm app version, build type, and environment",
  "List user roles and permissions you can test",
  "Identify sensitive data and high value flows",
  "Define what is out of scope (rate limits, production systems)",
];

const pentestVsReverse = [
  {
    title: "Android Pentesting",
    focus: "Find security weaknesses in the running app and its backend.",
    outputs: "Validated findings with impact, evidence, and fixes.",
    tools: "Proxy, adb, jadx, MobSF, Frida (optional)",
  },
  {
    title: "Android Reverse Engineering",
    focus: "Understand how the app works internally, including logic and native code.",
    outputs: "Code comprehension, workflows, and undocumented behaviors.",
    tools: "jadx, apktool, Ghidra, Frida, debugging",
  },
];

const quickStats = [
  { label: "3 analysis modes", icon: <SearchIcon /> },
  { label: "6 core phases", icon: <SecurityIcon /> },
  { label: "8 attack surfaces", icon: <LockOpenIcon /> },
  { label: "7 common issues", icon: <BugReportIcon /> },
];
const methodologySteps = [
  {
    title: "Scope and threat model",
    color: "#22c55e",
    icon: <SearchIcon />,
    description:
      "Define what you can test, which app version is in scope, and what data matters most. This keeps your testing safe, legal, and focused.",
    focus: [
      "App version, build flavor, and environments",
      "User roles and privilege boundaries",
      "High value data: tokens, PII, payments",
      "Out of scope systems and rate limits",
    ],
    output: "A written scope and a short threat model.",
  },
  {
    title: "Static review (no execution)",
    color: "#3b82f6",
    icon: <CodeIcon />,
    description:
      "Open the APK and inspect the manifest, resources, and code without running the app. This is the fastest way to spot obvious issues.",
    focus: [
      "AndroidManifest.xml permissions and components",
      "network_security_config and cleartext rules",
      "Hardcoded secrets in strings or assets",
      "Third party SDK inventory and versions",
    ],
    output: "A list of suspected issues and test targets.",
  },
  {
    title: "Dynamic analysis and traffic",
    color: "#10b981",
    icon: <WifiIcon />,
    description:
      "Run the app on an emulator or device, intercept traffic, and validate what the app really does during login, payments, and other flows.",
    focus: [
      "Proxy API calls and map endpoints",
      "Test TLS handling and pinning",
      "Observe runtime behavior with logcat",
      "Confirm storage issues in practice",
    ],
    output: "Recorded requests, logs, and repro steps.",
  },
  {
    title: "Data storage and crypto",
    color: "#f59e0b",
    icon: <StorageIcon />,
    description:
      "Check how sensitive data is stored on the device and whether encryption and keys are handled correctly.",
    focus: [
      "SharedPreferences, SQLite, files, cache",
      "External storage usage and backup flags",
      "Keystore usage and key lifecycle",
      "Custom crypto or hardcoded keys",
    ],
    output: "Evidence of data at rest risk and fix options.",
  },
  {
    title: "Abuse cases and components",
    color: "#ef4444",
    icon: <LockOpenIcon />,
    description:
      "Try to misuse the app as a malicious app or a crafted link would. This reveals exported component and deep link issues.",
    focus: [
      "Deep links and intent injection",
      "Exported services and receivers",
      "WebView JavaScript bridge exposure",
      "Authorization and session reuse checks",
    ],
    output: "Exploit paths or blocked tests with notes.",
  },
  {
    title: "Report and remediation",
    color: "#8b5cf6",
    icon: <CheckCircleIcon />,
    description:
      "Turn findings into clear, prioritized fixes that developers can act on quickly.",
    focus: [
      "Impact and likelihood",
      "Minimal reproducible steps",
      "Screenshots, logs, or proxy evidence",
      "Remediation guidance and references",
    ],
    output: "Actionable report ready for triage.",
  },
];
const setupSections = [
  {
    title: "Device or emulator",
    icon: <AndroidIcon />,
    description:
      "Start with an emulator for most beginner checks. A rooted test device helps with deeper runtime and certificate work.",
    steps: [
      "Use a clean emulator image with Google APIs or AOSP",
      "Enable Developer Options and USB debugging",
      "Keep a snapshot so you can reset quickly",
      "Use a rooted test device only when authorized",
    ],
  },
  {
    title: "Proxy and certificates",
    icon: <WifiIcon />,
    description:
      "To inspect traffic, route the device through a proxy and trust the proxy CA certificate.",
    steps: [
      "Run Burp Suite or mitmproxy on your host",
      "Set device Wi-Fi proxy to host IP and port",
      "Install the proxy CA certificate on the device",
      "For Android 7+, use network_security_config or a test build",
    ],
  },
  {
    title: "Tooling basics",
    icon: <BuildIcon />,
    description:
      "A small set of tools covers most Android pentesting tasks without overwhelming beginners.",
    steps: [
      "jadx or jadx-gui for decompiling code",
      "apktool for decoding resources and manifest",
      "adb for device control and file access",
      "Frida and Objection for runtime hooks",
      "MobSF for automated analysis when available",
    ],
  },
];
const attackSurface = [
  {
    title: "Manifest and permissions",
    icon: <SecurityIcon />,
    description: "Permissions, exported components, and app flags define what the app allows.",
    checks: [
      "Dangerous permissions and unnecessary access",
      "android:exported and intent filters",
      "android:debuggable and allowBackup flags",
    ],
  },
  {
    title: "App components",
    icon: <LockOpenIcon />,
    description: "Activities, services, receivers, and providers can be entry points for attacks.",
    checks: [
      "Launch exported activities with adb",
      "Trigger receivers with crafted intents",
      "Query content providers for data exposure",
    ],
  },
  {
    title: "Network layer",
    icon: <WifiIcon />,
    description: "APIs are often the most sensitive part of a mobile app.",
    checks: [
      "Cleartext traffic or weak TLS",
      "Certificate pinning and error handling",
      "Auth tokens in headers and responses",
    ],
  },
  {
    title: "Local storage",
    icon: <StorageIcon />,
    description: "Data at rest must be protected against local attackers.",
    checks: [
      "SharedPreferences and SQLite for secrets",
      "Files, caches, and logs",
      "External storage usage",
    ],
  },
  {
    title: "WebView and hybrid content",
    icon: <CodeIcon />,
    description: "Hybrid apps can introduce web style risks inside native apps.",
    checks: [
      "JavaScript enabled with unsafe bridges",
      "File access and mixed content",
      "Deep link handling in WebView flows",
    ],
  },
  {
    title: "Crypto and keys",
    icon: <SecurityIcon />,
    description: "Custom crypto is often wrong. Validate algorithms and key handling.",
    checks: [
      "Hardcoded keys or IV reuse",
      "Use of weak algorithms or modes",
      "Keystore usage for sensitive keys",
    ],
  },
  {
    title: "Native libraries (JNI)",
    icon: <BuildIcon />,
    description: "Native code can contain memory safety issues and hidden logic.",
    checks: [
      "Inspect .so libraries for secrets and APIs",
      "Review JNI bridges for validation bugs",
      "Check for debug symbols or logging",
    ],
  },
  {
    title: "Third party SDKs",
    icon: <BugReportIcon />,
    description: "Analytics, ads, and payment SDKs can leak data or expand risk.",
    checks: [
      "Identify SDK versions and CVEs",
      "Track data sent to third party hosts",
      "Review privacy and consent handling",
    ],
  },
];

const attackSurfaceCommands = [
  { cmd: "aapt dump xmltree app.apk AndroidManifest.xml", desc: "List components and exported flags" },
  { cmd: "adb shell pm list packages | grep <name>", desc: "Find the package name quickly" },
  { cmd: "adb shell dumpsys package com.example.app | grep -i exported", desc: "Identify exported components" },
  { cmd: "adb shell am start -n com.example.app/.MainActivity", desc: "Launch an activity directly" },
  { cmd: "adb shell am broadcast -a com.example.ACTION", desc: "Trigger a broadcast receiver" },
  { cmd: "adb shell content query --uri content://com.example.provider/items", desc: "Query a content provider" },
];
const vulnerabilities = [
  {
    title: "Insecure data storage",
    severity: "High",
    description: "Sensitive data stored in plaintext in SharedPreferences, SQLite, files, or logs.",
    howToTest: "Search app storage for tokens, passwords, or PII. Check logs and cache files.",
    fix: "Encrypt sensitive data, minimize storage, and use the Android Keystore.",
  },
  {
    title: "Insecure communication",
    severity: "High",
    description: "Cleartext traffic, weak TLS, or broken certificate validation.",
    howToTest: "Proxy traffic and look for HTTP or trust-all certificate logic.",
    fix: "Enforce TLS, validate certificates, and avoid trust-all implementations.",
  },
  {
    title: "Broken authentication or session handling",
    severity: "Critical",
    description: "Tokens are reused, stored insecurely, or not validated server-side.",
    howToTest: "Replay tokens, test session expiry, and validate access control on APIs.",
    fix: "Use short lived tokens, rotate secrets, and enforce server-side checks.",
  },
  {
    title: "Exported components and intent injection",
    severity: "Medium",
    description: "Exported activities, services, or receivers can be abused by other apps.",
    howToTest: "Launch exported components with crafted intents and extras.",
    fix: "Restrict exported components, validate input, and require permissions.",
  },
  {
    title: "WebView and JavaScript bridge issues",
    severity: "High",
    description: "Unsafe JavaScript bridges or file access allow code injection or data theft.",
    howToTest: "Inspect WebView config and test HTML or JS payloads in web content.",
    fix: "Limit JavaScript interfaces, disable file access, and validate URLs.",
  },
  {
    title: "Weak crypto and key management",
    severity: "Critical",
    description: "Hardcoded keys, weak algorithms, or incorrect modes like ECB.",
    howToTest: "Search for crypto usage in code and trace runtime key material.",
    fix: "Use modern algorithms and store keys in the Keystore.",
  },
  {
    title: "Debug builds and excessive logging",
    severity: "Medium",
    description: "Debuggable apps and verbose logs expose sensitive data or bypasses.",
    howToTest: "Check android:debuggable and review logcat output.",
    fix: "Disable debug flags and remove sensitive logs in release builds.",
  },
];
const tools = [
  {
    name: "jadx-gui",
    focus: "Static analysis",
    description: "Decompile APKs to readable Java or Kotlin for quick code review.",
  },
  {
    name: "apktool",
    focus: "Resources and manifest",
    description: "Decode AndroidManifest.xml and resources for configuration analysis.",
  },
  {
    name: "adb",
    focus: "Device control",
    description: "Install, launch, and inspect apps on a device or emulator.",
  },
  {
    name: "Frida",
    focus: "Runtime analysis",
    description: "Hook functions, bypass checks, and observe sensitive operations.",
  },
  {
    name: "Objection",
    focus: "Runtime helper",
    description: "Frida powered commands for quick bypass and exploration.",
  },
  {
    name: "MobSF",
    focus: "Automation",
    description: "Static and dynamic automation for quick baselines.",
  },
  {
    name: "Burp Suite or mitmproxy",
    focus: "Network interception",
    description: "Intercept and modify API traffic with full request history.",
  },
  {
    name: "Ghidra",
    focus: "Native code",
    description: "Analyze native libraries and JNI behavior.",
  },
];
const commandSections = [
  {
    category: "APK inspection",
    commands: [
      { cmd: "apktool d app.apk -o decoded", desc: "Decode resources and manifest" },
      { cmd: "jadx -d src app.apk", desc: "Decompile APK to source" },
      { cmd: "aapt dump badging app.apk", desc: "Show package info and SDK levels" },
      { cmd: "aapt dump xmltree app.apk AndroidManifest.xml", desc: "View manifest details" },
      { cmd: "apksigner verify --print-certs app.apk", desc: "Inspect signing certificate" },
    ],
  },
  {
    category: "Device and logs",
    commands: [
      { cmd: "adb devices", desc: "List connected devices" },
      { cmd: "adb install app.apk", desc: "Install APK on device" },
      { cmd: "adb shell pm list packages | grep app", desc: "Find package name" },
      { cmd: "adb logcat | grep -i app", desc: "Watch logs for the app" },
      { cmd: "adb shell run-as com.example.app ls", desc: "List app data directory" },
    ],
  },
  {
    category: "Runtime and network",
    commands: [
      { cmd: "frida-ps -Ua", desc: "List running apps and package IDs" },
      { cmd: "frida -U -f com.example.app -l hook.js --no-pause", desc: "Start app with Frida script" },
      { cmd: "adb shell settings put global http_proxy <host>:<port>", desc: "Set device proxy" },
      { cmd: "adb shell settings put global http_proxy :0", desc: "Clear device proxy" },
      { cmd: "adb shell am start -W -a android.intent.action.VIEW -d \"app://test\"", desc: "Test a deep link" },
    ],
  },
];
const practiceLabs = [
  {
    name: "Manifest and permissions audit",
    difficulty: "Beginner",
    duration: "30 min",
    tools: "apktool, aapt, jadx",
    objectives: [
      "Identify exported components",
      "Review dangerous permissions",
      "Locate cleartext traffic settings",
    ],
    steps: [
      "Decode the APK and open AndroidManifest.xml",
      "List exported activities, receivers, and services",
      "Find usesCleartextTraffic and network_security_config",
      "Document findings with screenshots",
    ],
  },
  {
    name: "Traffic interception and API mapping",
    difficulty: "Beginner",
    duration: "45 min",
    tools: "Burp Suite or mitmproxy, adb",
    objectives: [
      "Capture login and profile requests",
      "Map base URLs and endpoints",
      "Check for weak TLS handling",
    ],
    steps: [
      "Set device proxy and install CA certificate",
      "Run the app and capture auth flow",
      "Identify tokens and headers in requests",
      "Test for HTTP or invalid cert acceptance",
    ],
  },
  {
    name: "Storage and crypto review",
    difficulty: "Intermediate",
    duration: "60 min",
    tools: "adb, jadx, Frida",
    objectives: [
      "Find sensitive data on device storage",
      "Trace encryption routines at runtime",
      "Validate Keystore usage",
    ],
    steps: [
      "Inspect SharedPreferences and databases",
      "Search for secrets in decompiled code",
      "Hook crypto APIs and observe keys",
      "Document storage locations and risks",
    ],
  },
];

const practiceApps = [
  {
    name: "DIVA",
    desc: "Damn Insecure and Vulnerable App with common Android bugs.",
  },
  {
    name: "InsecureBankv2",
    desc: "Vulnerable banking app with backend flows and auth issues.",
  },
  {
    name: "OWASP UnCrackable Apps",
    desc: "Progressive challenges for mobile security practice.",
  },
  {
    name: "MSTG Crackmes",
    desc: "Official OWASP test cases mapped to MASTG.",
  },
];
const reportStructure = [
  "Executive summary with overall risk",
  "Scope and test environment details",
  "Findings by severity with clear titles",
  "Reproduction steps and expected vs actual",
  "Evidence: screenshots, logs, request history",
  "Remediation guidance and references",
];

const findingTemplate = `Title: Insecure data storage in SharedPreferences
Severity: High
Impact: Token theft leads to account takeover
Steps:
1) Login as a test user
2) Pull /data/data/<package>/shared_prefs
3) Observe auth_token stored in plaintext
Evidence: screenshot + file path + sample redacted token
Recommendation: Use EncryptedSharedPreferences or Keystore backed encryption`;

const evidenceChecklist = [
  "App version, build number, and hashes",
  "Device model, Android version, and root status",
  "Proxy logs or request exports",
  "Storage artifacts with file paths",
  "Screenshots and timestamps for each issue",
];

const pageContext = `Android pentesting guide with a beginner friendly introduction, lab setup, methodology, attack surface mapping, common vulnerabilities, tools and commands, practice labs, and reporting guidance.`;

const AndroidPentestingPage: React.FC = () => {
  const navigate = useNavigate();
  const [tabValue, setTabValue] = useState(0);

  const handleTabChange = (_: React.SyntheticEvent, newValue: number) => {
    setTabValue(newValue);
  };

  return (
    <LearnPageLayout pageTitle="Android Pentesting" pageContext={pageContext}>
      <Box sx={{ minHeight: "100vh", bgcolor: "#0a0a0f", py: 4 }}>
        <Container maxWidth="lg">
          {/* Header */}
          <Box sx={{ mb: 4 }}>
            <Button
              startIcon={<ArrowBackIcon />}
              onClick={() => navigate("/learn")}
              sx={{ mb: 2, color: "#22c55e", "&:hover": { color: "#16a34a" } }}
            >
              Back to Learning Hub
            </Button>

            <Box sx={{ display: "flex", alignItems: "center", gap: 2, mb: 2 }}>
              <Box sx={{ p: 2, borderRadius: 2, bgcolor: alpha("#22c55e", 0.1) }}>
                <AndroidIcon sx={{ fontSize: 48, color: "#22c55e" }} />
              </Box>
              <Box>
                <Typography variant="h3" sx={{ fontWeight: 800, color: "white" }}>
                  Android Pentesting
                </Typography>
                <Typography variant="h6" sx={{ color: "grey.400" }}>
                  Beginner friendly guide to assessing Android app security
                </Typography>
              </Box>
            </Box>

            <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap" }}>
              <Chip icon={<AndroidIcon />} label="Android" size="small" variant="outlined" />
              <Chip icon={<SecurityIcon />} label="MASTG aligned" size="small" variant="outlined" />
              <Chip icon={<WifiIcon />} label="Network testing" size="small" variant="outlined" />
              <Chip icon={<StorageIcon />} label="Data storage" size="small" variant="outlined" />
            </Box>
          </Box>

          {/* Intro */}
          <Paper sx={{ p: 4, bgcolor: "#111118", borderRadius: 3, mb: 4 }}>
            <Typography variant="h5" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
              Introduction: What is Android pentesting?
            </Typography>
            <Typography variant="body1" sx={{ color: "grey.300", mb: 2, lineHeight: 1.8 }}>
              Android pentesting is a structured, authorized way to evaluate the security of an Android application.
              Instead of trying to break the phone, you focus on how the app stores data, talks to its backend, and
              protects sensitive actions. A good test answers simple questions: Can another app access this data?
              Can an attacker on the network read or modify requests? Can the app be tricked into doing something
              it should not do?
            </Typography>
            <Typography variant="body1" sx={{ color: "grey.300", mb: 2, lineHeight: 1.8 }}>
              An Android app is packaged as an APK. Inside it are the manifest (which declares permissions and
              components), compiled code, resources, and sometimes native libraries. Android isolates each app in
              its own sandbox, but the manifest can expose components like activities, services, broadcast receivers,
              and content providers. Those entry points are the attack surface you test.
            </Typography>
            <Typography variant="body1" sx={{ color: "grey.300", mb: 2, lineHeight: 1.8 }}>
              A beginner friendly workflow combines static analysis (reading the APK), dynamic analysis (running the
              app on a device or emulator), and network testing (intercepting API calls). You do not need a rooted phone
              for everything, but a rooted test device can unlock deeper checks. The goal is to find weaknesses and
              explain clear fixes, not to show off exploits.
            </Typography>
            <Divider sx={{ my: 2, borderColor: "rgba(255,255,255,0.08)" }} />
            <Typography variant="subtitle1" sx={{ color: "white", mb: 2, fontWeight: 600 }}>
              Android pentesting vs Android reverse engineering
            </Typography>
            <Grid container spacing={2} sx={{ mb: 2 }}>
              {pentestVsReverse.map((item) => (
                <Grid item xs={12} md={6} key={item.title}>
                  <Paper sx={{ p: 2.5, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                    <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 1 }}>
                      {item.title}
                    </Typography>
                    <Typography variant="body2" sx={{ color: "grey.300", mb: 1 }}>
                      <strong>Focus:</strong> {item.focus}
                    </Typography>
                    <Typography variant="body2" sx={{ color: "grey.300", mb: 1 }}>
                      <strong>Outputs:</strong> {item.outputs}
                    </Typography>
                    <Typography variant="body2" sx={{ color: "grey.400" }}>
                      <strong>Tools:</strong> {item.tools}
                    </Typography>
                  </Paper>
                </Grid>
              ))}
            </Grid>
            <Divider sx={{ my: 2, borderColor: "rgba(255,255,255,0.08)" }} />
            <Grid container spacing={2} sx={{ mb: 2 }}>
              <Grid item xs={12} md={6}>
                <Paper sx={{ p: 2.5, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                  <Typography variant="subtitle1" sx={{ color: "#22c55e", fontWeight: 700, mb: 1 }}>
                    Prerequisites
                  </Typography>
                  <List dense>
                    {prerequisites.map((item) => (
                      <ListItem key={item} sx={{ py: 0.2 }}>
                        <ListItemIcon sx={{ minWidth: 24 }}>
                          <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                        </ListItemIcon>
                        <ListItemText
                          primary={item}
                          primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                        />
                      </ListItem>
                    ))}
                  </List>
                </Paper>
              </Grid>
              <Grid item xs={12} md={6}>
                <Paper sx={{ p: 2.5, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                  <Typography variant="subtitle1" sx={{ color: "#22c55e", fontWeight: 700, mb: 1 }}>
                    Scope checklist
                  </Typography>
                  <List dense>
                    {scopeChecklist.map((item) => (
                      <ListItem key={item} sx={{ py: 0.2 }}>
                        <ListItemIcon sx={{ minWidth: 24 }}>
                          <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                        </ListItemIcon>
                        <ListItemText
                          primary={item}
                          primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                        />
                      </ListItem>
                    ))}
                  </List>
                </Paper>
              </Grid>
            </Grid>
            <Typography variant="subtitle1" sx={{ color: "white", mb: 1, fontWeight: 600 }}>
              What you will learn
            </Typography>
            <List dense>
              {introHighlights.map((item) => (
                <ListItem key={item} sx={{ py: 0.4 }}>
                  <ListItemIcon sx={{ minWidth: 28 }}>
                    <CheckCircleIcon sx={{ color: "#22c55e" }} fontSize="small" />
                  </ListItemIcon>
                  <ListItemText primary={item} sx={{ "& .MuiListItemText-primary": { color: "grey.300" } }} />
                </ListItem>
              ))}
            </List>
          </Paper>

          {/* Quick Stats */}
          <Grid container spacing={2} sx={{ mb: 4 }}>
            {quickStats.map((stat) => (
              <Grid item xs={6} md={3} key={stat.label}>
                <Paper
                  sx={{
                    p: 2,
                    textAlign: "center",
                    bgcolor: alpha("#22c55e", 0.05),
                    border: `1px solid ${alpha("#22c55e", 0.2)}`,
                    borderRadius: 2,
                  }}
                >
                  <Box sx={{ color: "#22c55e", mb: 0.5 }}>{stat.icon}</Box>
                  <Typography variant="body2" sx={{ color: "grey.300", fontWeight: 600 }}>
                    {stat.label}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>

          {/* Tabs */}
          <Paper sx={{ bgcolor: "#111118", borderRadius: 3, overflow: "hidden", border: "1px solid rgba(255,255,255,0.05)" }}>
            <Tabs
              value={tabValue}
              onChange={handleTabChange}
              variant="scrollable"
              scrollButtons="auto"
              sx={{
                borderBottom: "1px solid rgba(255,255,255,0.05)",
                "& .MuiTab-root": { color: "grey.400", fontWeight: 600 },
                "& .Mui-selected": { color: "#22c55e" },
                "& .MuiTabs-indicator": { bgcolor: "#22c55e" },
              }}
            >
              <Tab icon={<SearchIcon />} label="Methodology" iconPosition="start" />
              <Tab icon={<BuildIcon />} label="Lab Setup" iconPosition="start" />
              <Tab icon={<LockOpenIcon />} label="Attack Surface" iconPosition="start" />
              <Tab icon={<BugReportIcon />} label="Common Issues" iconPosition="start" />
              <Tab icon={<TerminalIcon />} label="Tools and Commands" iconPosition="start" />
              <Tab icon={<SecurityIcon />} label="Practice Labs" iconPosition="start" />
              <Tab icon={<CheckCircleIcon />} label="Reporting" iconPosition="start" />
            </Tabs>

            {/* Tab 0: Methodology */}
            <TabPanel value={tabValue} index={0}>
              <Grid container spacing={3}>
                {methodologySteps.map((step) => (
                  <Grid item xs={12} md={6} key={step.title}>
                    <Paper
                      sx={{
                        p: 3,
                        bgcolor: "#0d1117",
                        borderRadius: 2,
                        border: `1px solid ${alpha(step.color, 0.2)}`,
                        borderLeft: `4px solid ${step.color}`,
                        height: "100%",
                      }}
                    >
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1.5, mb: 1 }}>
                        <Box sx={{ color: step.color }}>{step.icon}</Box>
                        <Typography variant="h6" sx={{ color: "white", fontWeight: 700 }}>
                          {step.title}
                        </Typography>
                      </Box>
                      <Typography variant="body2" sx={{ color: "grey.400", mb: 2 }}>
                        {step.description}
                      </Typography>
                      <Typography variant="subtitle2" sx={{ color: step.color, mb: 1, fontWeight: 700 }}>
                        Focus areas
                      </Typography>
                      <List dense>
                        {step.focus.map((item) => (
                          <ListItem key={item} sx={{ py: 0.2 }}>
                            <ListItemIcon sx={{ minWidth: 24 }}>
                              <CheckCircleIcon sx={{ fontSize: 16, color: step.color }} />
                            </ListItemIcon>
                            <ListItemText
                              primary={item}
                              primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                            />
                          </ListItem>
                        ))}
                      </List>
                      <Typography variant="caption" sx={{ color: "grey.500" }}>
                        Output: {step.output}
                      </Typography>
                    </Paper>
                  </Grid>
                ))}
              </Grid>
            </TabPanel>

            {/* Tab 1: Lab Setup */}
            <TabPanel value={tabValue} index={1}>
              <Grid container spacing={3}>
                {setupSections.map((section) => (
                  <Grid item xs={12} md={4} key={section.title}>
                    <Card sx={{ bgcolor: "#0d1117", borderRadius: 2, height: "100%", border: "1px solid rgba(255,255,255,0.05)" }}>
                      <CardContent>
                        <Box sx={{ display: "flex", alignItems: "center", gap: 1.5, mb: 1 }}>
                          <Box sx={{ color: "#22c55e" }}>{section.icon}</Box>
                          <Typography variant="h6" sx={{ color: "white", fontWeight: 700 }}>
                            {section.title}
                          </Typography>
                        </Box>
                        <Typography variant="body2" sx={{ color: "grey.400", mb: 2 }}>
                          {section.description}
                        </Typography>
                        <List dense>
                          {section.steps.map((item) => (
                            <ListItem key={item} sx={{ py: 0.2 }}>
                              <ListItemIcon sx={{ minWidth: 24 }}>
                                <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                              </ListItemIcon>
                              <ListItemText
                                primary={item}
                                primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                              />
                            </ListItem>
                          ))}
                        </List>
                      </CardContent>
                    </Card>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ my: 3, borderColor: "rgba(255,255,255,0.05)" }} />

              <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700 }}>
                Quick setup commands
              </Typography>
              <CodeBlock
                title="Device prep and app control"
                language="bash"
                code={`# List devices and install APK
adb devices
adb install app.apk

# Launch the app
adb shell monkey -p com.example.app -c android.intent.category.LAUNCHER 1

# View logs for the app
adb logcat | grep -i "com.example.app"`}
              />
            </TabPanel>

            {/* Tab 2: Attack Surface */}
            <TabPanel value={tabValue} index={2}>
              <Grid container spacing={3}>
                {attackSurface.map((surface) => (
                  <Grid item xs={12} md={6} key={surface.title}>
                    <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, height: "100%", border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 1.5, mb: 1 }}>
                        <Box sx={{ color: "#22c55e" }}>{surface.icon}</Box>
                        <Typography variant="h6" sx={{ color: "white", fontWeight: 700 }}>
                          {surface.title}
                        </Typography>
                      </Box>
                      <Typography variant="body2" sx={{ color: "grey.400", mb: 2 }}>
                        {surface.description}
                      </Typography>
                      <List dense>
                        {surface.checks.map((item) => (
                          <ListItem key={item} sx={{ py: 0.2 }}>
                            <ListItemIcon sx={{ minWidth: 24 }}>
                              <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                            </ListItemIcon>
                            <ListItemText
                              primary={item}
                              primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                            />
                          </ListItem>
                        ))}
                      </List>
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ my: 3, borderColor: "rgba(255,255,255,0.05)" }} />
              <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
                Attack surface quick commands
              </Typography>
              <TableContainer component={Paper} sx={{ bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                <Table size="small">
                  <TableHead>
                    <TableRow>
                      <TableCell sx={{ color: "white", fontWeight: 700, width: "55%" }}>Command</TableCell>
                      <TableCell sx={{ color: "white", fontWeight: 700 }}>Purpose</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {attackSurfaceCommands.map((row) => (
                      <TableRow key={row.cmd}>
                        <TableCell sx={{ color: "#22c55e", fontFamily: "monospace", fontSize: "0.8rem" }}>
                          {row.cmd}
                        </TableCell>
                        <TableCell sx={{ color: "grey.300" }}>{row.desc}</TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
            </TabPanel>

            {/* Tab 3: Common Issues */}
            <TabPanel value={tabValue} index={3}>
              <Box sx={{ p: 1 }}>
                {vulnerabilities.map((vuln) => (
                  <Accordion key={vuln.title} sx={{ mb: 1, bgcolor: "#0d1117", "&:before": { display: "none" } }}>
                    <AccordionSummary expandIcon={<ExpandMoreIcon sx={{ color: "grey.500" }} />}>
                      <Box sx={{ display: "flex", alignItems: "center", gap: 2, width: "100%" }}>
                        <Chip
                          label={vuln.severity}
                          size="small"
                          sx={{
                            bgcolor: vuln.severity === "Critical" ? alpha("#ef4444", 0.2) :
                                     vuln.severity === "High" ? alpha("#f59e0b", 0.2) :
                                     alpha("#3b82f6", 0.2),
                            color: vuln.severity === "Critical" ? "#ef4444" :
                                   vuln.severity === "High" ? "#f59e0b" : "#3b82f6",
                            fontWeight: 700,
                          }}
                        />
                        <Typography variant="subtitle1" sx={{ color: "white", fontWeight: 700 }}>
                          {vuln.title}
                        </Typography>
                      </Box>
                    </AccordionSummary>
                    <AccordionDetails>
                      <Typography variant="body2" sx={{ color: "grey.400", mb: 2 }}>
                        {vuln.description}
                      </Typography>
                      <Paper sx={{ p: 2, bgcolor: alpha("#3b82f6", 0.08), borderRadius: 2, mb: 2 }}>
                        <Typography variant="subtitle2" sx={{ color: "#3b82f6", fontWeight: 700, mb: 1 }}>
                          How to test
                        </Typography>
                        <Typography variant="body2" sx={{ color: "grey.300" }}>
                          {vuln.howToTest}
                        </Typography>
                      </Paper>
                      <Paper sx={{ p: 2, bgcolor: alpha("#22c55e", 0.08), borderRadius: 2 }}>
                        <Typography variant="subtitle2" sx={{ color: "#22c55e", fontWeight: 700, mb: 1 }}>
                          Recommended fix
                        </Typography>
                        <Typography variant="body2" sx={{ color: "grey.300" }}>
                          {vuln.fix}
                        </Typography>
                      </Paper>
                    </AccordionDetails>
                  </Accordion>
                ))}
              </Box>
            </TabPanel>

            {/* Tab 4: Tools and Commands */}
            <TabPanel value={tabValue} index={4}>
              <Grid container spacing={3}>
                {tools.map((tool) => (
                  <Grid item xs={12} md={6} key={tool.name}>
                    <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, height: "100%", border: "1px solid rgba(255,255,255,0.05)" }}>
                      <Box sx={{ display: "flex", alignItems: "center", justifyContent: "space-between", mb: 1 }}>
                        <Typography variant="h6" sx={{ color: "white", fontWeight: 700 }}>
                          {tool.name}
                        </Typography>
                        <Chip label={tool.focus} size="small" sx={{ bgcolor: alpha("#22c55e", 0.2), color: "#22c55e" }} />
                      </Box>
                      <Typography variant="body2" sx={{ color: "grey.400" }}>
                        {tool.description}
                      </Typography>
                    </Paper>
                  </Grid>
                ))}
              </Grid>

              <Divider sx={{ my: 3, borderColor: "rgba(255,255,255,0.05)" }} />

              {commandSections.map((section) => (
                <Paper key={section.category} sx={{ p: 3, mb: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                  <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
                    {section.category}
                  </Typography>
                  <TableContainer>
                    <Table size="small">
                      <TableHead>
                        <TableRow>
                          <TableCell sx={{ color: "white", fontWeight: 700, width: "55%" }}>Command</TableCell>
                          <TableCell sx={{ color: "white", fontWeight: 700 }}>Description</TableCell>
                        </TableRow>
                      </TableHead>
                      <TableBody>
                        {section.commands.map((cmd) => (
                          <TableRow key={cmd.cmd}>
                            <TableCell sx={{ color: "#22c55e", fontFamily: "monospace", fontSize: "0.8rem" }}>
                              {cmd.cmd}
                            </TableCell>
                            <TableCell sx={{ color: "grey.300" }}>{cmd.desc}</TableCell>
                          </TableRow>
                        ))}
                      </TableBody>
                    </Table>
                  </TableContainer>
                </Paper>
              ))}
            </TabPanel>

            {/* Tab 5: Practice Labs */}
            <TabPanel value={tabValue} index={5}>
              <Grid container spacing={3}>
                {practiceLabs.map((lab) => (
                  <Grid item xs={12} key={lab.name}>
                    <Card sx={{ bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                      <CardContent>
                        <Box sx={{ display: "flex", alignItems: "center", justifyContent: "space-between", mb: 1 }}>
                          <Typography variant="h6" sx={{ color: "white", fontWeight: 700 }}>
                            {lab.name}
                          </Typography>
                          <Box sx={{ display: "flex", gap: 1 }}>
                            <Chip label={lab.difficulty} size="small" sx={{ bgcolor: alpha("#22c55e", 0.2), color: "#22c55e" }} />
                            <Chip label={lab.duration} size="small" variant="outlined" />
                          </Box>
                        </Box>
                        <Typography variant="body2" sx={{ color: "grey.400", mb: 1 }}>
                          Tools: {lab.tools}
                        </Typography>
                        <Divider sx={{ my: 2, borderColor: "rgba(255,255,255,0.05)" }} />
                        <Grid container spacing={2}>
                          <Grid item xs={12} md={6}>
                            <Typography variant="subtitle2" sx={{ color: "#22c55e", fontWeight: 700, mb: 1 }}>
                              Objectives
                            </Typography>
                            <List dense>
                              {lab.objectives.map((obj) => (
                                <ListItem key={obj} sx={{ py: 0.2 }}>
                                  <ListItemIcon sx={{ minWidth: 24 }}>
                                    <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                                  </ListItemIcon>
                                  <ListItemText
                                    primary={obj}
                                    primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                                  />
                                </ListItem>
                              ))}
                            </List>
                          </Grid>
                          <Grid item xs={12} md={6}>
                            <Typography variant="subtitle2" sx={{ color: "#22c55e", fontWeight: 700, mb: 1 }}>
                              Steps
                            </Typography>
                            <List dense>
                              {lab.steps.map((step, index) => (
                                <ListItem key={step} sx={{ py: 0.2 }}>
                                  <ListItemIcon sx={{ minWidth: 24 }}>
                                    <Typography variant="caption" sx={{ color: "#22c55e", fontWeight: 700 }}>
                                      {index + 1}.
                                    </Typography>
                                  </ListItemIcon>
                                  <ListItemText
                                    primary={step}
                                    primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                                  />
                                </ListItem>
                              ))}
                            </List>
                          </Grid>
                        </Grid>
                      </CardContent>
                    </Card>
                  </Grid>
                ))}
              </Grid>

              <Paper sx={{ p: 3, mt: 3, bgcolor: alpha("#22c55e", 0.08), borderRadius: 2, border: "1px solid rgba(34,197,94,0.2)" }}>
                <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
                  Practice apps
                </Typography>
                <Grid container spacing={2}>
                  {practiceApps.map((app) => (
                    <Grid item xs={12} md={6} key={app.name}>
                      <Paper sx={{ p: 2, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                        <Typography variant="subtitle1" sx={{ color: "white", fontWeight: 600 }}>
                          {app.name}
                        </Typography>
                        <Typography variant="body2" sx={{ color: "grey.400" }}>
                          {app.desc}
                        </Typography>
                      </Paper>
                    </Grid>
                  ))}
                </Grid>
              </Paper>
            </TabPanel>

            {/* Tab 6: Reporting */}
            <TabPanel value={tabValue} index={6}>
              <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                    <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
                      Report structure
                    </Typography>
                    <List dense>
                      {reportStructure.map((item) => (
                        <ListItem key={item} sx={{ py: 0.2 }}>
                          <ListItemIcon sx={{ minWidth: 24 }}>
                            <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                          </ListItemIcon>
                          <ListItemText
                            primary={item}
                            primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                          />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Paper sx={{ p: 3, bgcolor: "#0d1117", borderRadius: 2, border: "1px solid rgba(255,255,255,0.05)" }}>
                    <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
                      Evidence checklist
                    </Typography>
                    <List dense>
                      {evidenceChecklist.map((item) => (
                        <ListItem key={item} sx={{ py: 0.2 }}>
                          <ListItemIcon sx={{ minWidth: 24 }}>
                            <CheckCircleIcon sx={{ fontSize: 16, color: "#22c55e" }} />
                          </ListItemIcon>
                          <ListItemText
                            primary={item}
                            primaryTypographyProps={{ variant: "body2", sx: { color: "grey.300" } }}
                          />
                        </ListItem>
                      ))}
                    </List>
                  </Paper>
                </Grid>
                <Grid item xs={12}>
                  <Paper sx={{ p: 3, bgcolor: alpha("#3b82f6", 0.08), borderRadius: 2, border: "1px solid rgba(59,130,246,0.2)" }}>
                    <Typography variant="h6" sx={{ color: "#3b82f6", fontWeight: 700, mb: 1 }}>
                      Tips for beginners
                    </Typography>
                    <Typography variant="body2" sx={{ color: "grey.300" }}>
                      Keep your findings simple and specific. Show how to reproduce the issue and why it matters,
                      then recommend a fix that the development team can apply quickly. If you are unsure about impact,
                      describe the risk and ask for clarification instead of guessing.
                    </Typography>
                  </Paper>
                </Grid>
              </Grid>

              <Divider sx={{ my: 3, borderColor: "rgba(255,255,255,0.05)" }} />
              <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700 }}>
                Sample finding template
              </Typography>
              <CodeBlock language="text" code={findingTemplate} />
            </TabPanel>
          </Paper>

          {/* Legal Notice */}
          <Alert
            severity="warning"
            icon={<WarningIcon />}
            sx={{ mt: 4, bgcolor: alpha("#f59e0b", 0.1), color: "grey.200" }}
          >
            Only test applications you own or have explicit written permission to assess.
          </Alert>

          {/* Related Learning */}
          <Paper sx={{ p: 3, mt: 3, borderRadius: 3, bgcolor: alpha("#22c55e", 0.08) }}>
            <Typography variant="h6" sx={{ color: "#22c55e", fontWeight: 700, mb: 2 }}>
              Related learning
            </Typography>
            <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap" }}>
              <Chip label="APK Analysis" clickable onClick={() => navigate("/learn/apk-analysis")} />
              <Chip label="Android Reverse Engineering" clickable onClick={() => navigate("/learn/android-reverse-engineering")} />
              <Chip label="Mobile App Pentesting" clickable onClick={() => navigate("/learn/mobile-pentest")} />
              <Chip label="OWASP Mobile Top 10" clickable onClick={() => navigate("/learn/owasp-mobile")} />
            </Box>
          </Paper>

          {/* Quiz Section */}
          <Box sx={{ mt: 4 }}>
            <QuizSection />
          </Box>

          {/* Back to Learning Hub */}
          <Box sx={{ mt: 4, textAlign: "center" }}>
            <Button
              variant="outlined"
              startIcon={<ArrowBackIcon />}
              onClick={() => navigate("/learn")}
              sx={{
                borderColor: alpha("#22c55e", 0.5),
                color: "#22c55e",
                px: 4,
                py: 1,
                "&:hover": { borderColor: "#22c55e", bgcolor: alpha("#22c55e", 0.1) },
              }}
            >
              Back to Learning Hub
            </Button>
          </Box>
        </Container>
      </Box>
    </LearnPageLayout>
  );
};

export default AndroidPentestingPage;
